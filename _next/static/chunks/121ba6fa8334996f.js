(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,21168,(e,t,n)=>{var i={675:function(e,t){"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return(n+i)*3/4-i},t.toByteArray=function(e){var t,n,s=l(e),a=s[0],o=s[1],h=new r((a+o)*3/4-o),u=0,c=o>0?a-4:a;for(n=0;n<c;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===o&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===o&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,s=[],a=0,o=i-r;a<o;a+=16383)s.push(function(e,t,i){for(var r,s=[],a=t;a<i;a+=3)r=(e[a]<<16&0xff0000)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[r>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return s.join("")}(e,a,a+16383>o?o:a+16383));return 1===r?s.push(n[(t=e[i-1])>>2]+n[t<<4&63]+"=="):2===r&&s.push(n[(t=(e[i-2]<<8)+e[i-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=s.length;a<o;++a)n[a]=s[a],i[s.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}i[45]=62,i[95]=63},72:function(e,t,n){"use strict";var i=n(675),r=n(783),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function a(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,o.prototype),t}function o(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e){var i=e,r=t;if(("string"!=typeof r||""===r)&&(r="utf8"),!o.isEncoding(r))throw TypeError("Unknown encoding: "+r);var s=0|f(i,r),l=a(s),h=l.write(i,r);return h!==s&&(l=l.slice(0,h)),l}if(ArrayBuffer.isView(e))return c(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(N(e,ArrayBuffer)||e&&N(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(N(e,SharedArrayBuffer)||e&&N(e.buffer,SharedArrayBuffer)))return function(e,t,n){var i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),o.prototype),i}(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');var u=e.valueOf&&e.valueOf();if(null!=u&&u!==e)return o.from(u,t,n);var p=function(e){if(o.isBuffer(e)){var t=0|d(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||function(e){return e!=e}(e.length)?a(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(p)return p;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return o.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),a(e<0?0:0|d(e))}function c(e){for(var t=e.length<0?0:0|d(e.length),n=a(t),i=0;i<t;i+=1)n[i]=255&e[i];return n}t.Buffer=o,t.SlowBuffer=function(e){return+e!=e&&(e=0),o.alloc(+e)},t.INSPECT_MAX_BYTES=50,t.kMaxLength=0x7fffffff,o.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),o.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(o.prototype,"parent",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.buffer}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){if(o.isBuffer(this))return this.byteOffset}}),o.poolSize=8192,o.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(o.prototype,Uint8Array.prototype),Object.setPrototypeOf(o,Uint8Array),o.alloc=function(e,t,n){return(h(e),e<=0)?a(e):void 0!==t?"string"==typeof n?a(e).fill(t,n):a(e).fill(t):a(e)},o.allocUnsafe=function(e){return u(e)},o.allocUnsafeSlow=function(e){return u(e)};function d(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function f(e,t){if(o.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||N(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return C(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return k(e).length;default:if(r)return i?-1:C(e).length;t=(""+t).toLowerCase(),r=!0}}function p(e,t,n){var r,s,a,o=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",s=t;s<n;++s)r+=R[e[s]];return r}(this,t,n);case"utf8":case"utf-8":return _(this,t,n);case"ascii":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":return r=this,s=t,a=n,0===s&&a===r.length?i.fromByteArray(r):i.fromByteArray(r.slice(s,a));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){for(var i=e.slice(t,n),r="",s=0;s<i.length;s+=2)r+=String.fromCharCode(i[s]+256*i[s+1]);return r}(this,t,n);default:if(o)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function g(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function m(e,t,n,i,r){var s;if(0===e.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n*=1)!=s&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length)if(r)return -1;else n=e.length-1;else if(n<0)if(!r)return -1;else n=0;if("string"==typeof t&&(t=o.from(t,i)),o.isBuffer(t))return 0===t.length?-1:y(e,t,n,i,r);if("number"==typeof t){if(t&=255,"function"==typeof Uint8Array.prototype.indexOf)if(r)return Uint8Array.prototype.indexOf.call(e,t,n);else return Uint8Array.prototype.lastIndexOf.call(e,t,n);return y(e,[t],n,i,r)}throw TypeError("val must be string, number or Buffer")}function y(e,t,n,i,r){var s,a=1,o=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;a=2,o/=2,l/=2,n/=2}function h(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(r){var u=-1;for(s=n;s<o;s++)if(h(e,s)===h(t,-1===u?0:s-u)){if(-1===u&&(u=s),s-u+1===l)return u*a}else -1!==u&&(s-=s-u),u=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var c=!0,d=0;d<l;d++)if(h(e,s+d)!==h(t,d)){c=!1;break}if(c)return s}return -1}o.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==o.prototype},o.compare=function(e,t){if(N(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),N(t,Uint8Array)&&(t=o.from(t,t.offset,t.byteLength)),!o.isBuffer(e)||!o.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,i=t.length,r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:+(i<n)},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;var n,i=o.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(N(s,Uint8Array)&&(s=o.from(s)),!o.isBuffer(s))throw TypeError('"list" argument must be an Array of Buffers');s.copy(i,r),r+=s.length}return i},o.byteLength=f,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},o.prototype.toString=function(){var e=this.length;return 0===e?"":0==arguments.length?_(this,0,e):p.apply(this,arguments)},o.prototype.toLocaleString=o.prototype.toString,o.prototype.equals=function(e){if(!o.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(o.prototype[s]=o.prototype.inspect),o.prototype.compare=function(e,t,n,i,r){if(N(e,Uint8Array)&&(e=o.from(e,e.offset,e.byteLength)),!o.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;for(var s=r-i,a=n-t,l=Math.min(s,a),h=this.slice(i,r),u=e.slice(t,n),c=0;c<l;++c)if(h[c]!==u[c]){s=h[c],a=u[c];break}return s<a?-1:+(a<s)},o.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},o.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},o.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)};function _(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var s,a,o,l,h=e[r],u=null,c=h>239?4:h>223?3:h>191?2:1;if(r+c<=n)switch(c){case 1:h<128&&(u=h);break;case 2:(192&(s=e[r+1]))==128&&(l=(31&h)<<6|63&s)>127&&(u=l);break;case 3:s=e[r+1],a=e[r+2],(192&s)==128&&(192&a)==128&&(l=(15&h)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(u=l);break;case 4:s=e[r+1],a=e[r+2],o=e[r+3],(192&s)==128&&(192&a)==128&&(192&o)==128&&(l=(15&h)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(u=l)}null===u?(u=65533,c=1):u>65535&&(u-=65536,i.push(u>>>10&1023|55296),u=56320|1023&u),i.push(u),r+=c}var d=i,f=d.length;if(f<=4096)return String.fromCharCode.apply(String,d);for(var p="",g=0;g<f;)p+=String.fromCharCode.apply(String,d.slice(g,g+=4096));return p}function v(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function w(e,t,n,i,r,s){if(!o.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw RangeError('"value" argument is out of bounds');if(n+i>e.length)throw RangeError("Index out of range")}function b(e,t,n,i,r,s){if(n+i>e.length||n<0)throw RangeError("Index out of range")}function T(e,t,n,i,s){return t*=1,n>>>=0,s||b(e,t,n,4,34028234663852886e22,-34028234663852886e22),r.write(e,t,n,i,23,4),n+4}function E(e,t,n,i,s){return t*=1,n>>>=0,s||b(e,t,n,8,17976931348623157e292,-17976931348623157e292),r.write(e,t,n,i,52,8),n+8}o.prototype.write=function(e,t,n,i){if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var r,s,a,o,l,h,u,c,d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var f=!1;;)switch(i){case"hex":return function(e,t,n,i){n=Number(n)||0;var r=e.length-n;i?(i=Number(i))>r&&(i=r):i=r;var s=t.length;i>s/2&&(i=s/2);for(var a=0;a<i;++a){var o,l=parseInt(t.substr(2*a,2),16);if((o=l)!=o)break;e[n+a]=l}return a}(this,e,t,n);case"utf8":case"utf-8":return r=t,s=n,A(C(e,this.length-r),this,r,s);case"ascii":return a=t,o=n,A(S(e),this,a,o);case"latin1":case"binary":return function(e,t,n,i){return A(S(t),e,n,i)}(this,e,t,n);case"base64":return l=t,h=n,A(k(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,A(function(e,t){for(var n,i,r=[],s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r.push(n%256),r.push(i);return r}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},o.prototype.slice=function(e,t){var n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var i=this.subarray(e,t);return Object.setPrototypeOf(i,o.prototype),i},o.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i},o.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e+--t],r=1;t>0&&(r*=256);)i+=this[e+--t]*r;return i},o.prototype.readUInt8=function(e,t){return e>>>=0,t||v(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return e>>>=0,t||v(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},o.prototype.readUInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=this[e],r=1,s=0;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},o.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||v(e,t,this.length);for(var i=t,r=1,s=this[e+--i];i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},o.prototype.readInt8=function(e,t){return(e>>>=0,t||v(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},o.prototype.readInt16LE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt16BE=function(e,t){e>>>=0,t||v(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},o.prototype.readInt32LE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return e>>>=0,t||v(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return e>>>=0,t||v(e,4,this.length),r.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return e>>>=0,t||v(e,4,this.length),r.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return e>>>=0,t||v(e,8,this.length),r.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return e>>>=0,t||v(e,8,this.length),r.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;w(this,e,t,n,r,0)}var s=1,a=0;for(this[t]=255&e;++a<n&&(s*=256);)this[t+a]=e/s&255;return t+n},o.prototype.writeUIntBE=function(e,t,n,i){if(e*=1,t>>>=0,n>>>=0,!i){var r=Math.pow(2,8*n)-1;w(this,e,t,n,r,0)}var s=n-1,a=1;for(this[t+s]=255&e;--s>=0&&(a*=256);)this[t+s]=e/a&255;return t+n},o.prototype.writeUInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,255,0),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeUInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeUInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},o.prototype.writeUInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeIntLE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);w(this,e,t,n,r-1,-r)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeIntBE=function(e,t,n,i){if(e*=1,t>>>=0,!i){var r=Math.pow(2,8*n-1);w(this,e,t,n,r-1,-r)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a|0)-o&255;return t+n},o.prototype.writeInt8=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},o.prototype.writeInt16BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},o.prototype.writeInt32LE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},o.prototype.writeInt32BE=function(e,t,n){return e*=1,t>>>=0,n||w(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},o.prototype.writeFloatLE=function(e,t,n){return T(this,e,t,!0,n)},o.prototype.writeFloatBE=function(e,t,n){return T(this,e,t,!1,n)},o.prototype.writeDoubleLE=function(e,t,n){return E(this,e,t,!0,n)},o.prototype.writeDoubleBE=function(e,t,n){return E(this,e,t,!1,n)},o.prototype.copy=function(e,t,n,i){if(!o.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);var r=i-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(t,n,i);else if(this===e&&n<t&&t<i)for(var s=r-1;s>=0;--s)e[s+t]=this[s+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),t);return r},o.prototype.fill=function(e,t,n,i){if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!o.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){var r,s=e.charCodeAt(0);("utf8"===i&&s<128||"latin1"===i)&&(e=s)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{var a=o.isBuffer(e)?e:o.from(e,i),l=a.length;if(0===l)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=a[r%l]}return this};var I=/[^+/0-9A-Za-z-_]/g;function C(e,t){t=t||1/0;for(var n,i=e.length,r=null,s=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319||a+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function S(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function k(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(I,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function A(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length)&&!(r>=e.length);++r)t[r+n]=e[r];return r}function N(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}var R=function(){for(var e="0123456789abcdef",t=Array(256),n=0;n<16;++n)for(var i=16*n,r=0;r<16;++r)t[i+r]=e[n]+e[r];return t}()},783:function(e,t){t.read=function(e,t,n,i,r){var s,a,o=8*r-i-1,l=(1<<o)-1,h=l>>1,u=-7,c=n?r-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=o;u>0;s=256*s+e[t+c],c+=d,u-=8);for(a=s&(1<<-u)-1,s>>=-u,u+=i;u>0;a=256*a+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,i),s-=h}return(f?-1:1)*a*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var a,o,l,h=8*s-r-1,u=(1<<h)-1,c=u>>1,d=5960464477539062e-23*(23===r),f=i?0:s-1,p=i?1:-1,g=+(t<0||0===t&&1/t<0);for(isNaN(t=Math.abs(t))||t===1/0?(o=+!!isNaN(t),a=u):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),a+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(a++,l/=2),a+c>=u?(o=0,a=u):a+c>=1?(o=(t*l-1)*Math.pow(2,r),a+=c):(o=t*Math.pow(2,c-1)*Math.pow(2,r),a=0));r>=8;e[n+f]=255&o,f+=p,o/=256,r-=8);for(a=a<<r|o,h+=r;h>0;e[n+f]=255&a,f+=p,a/=256,h-=8);e[n+f-p]|=128*g}}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={exports:{}},a=!0;try{i[e](n,n.exports,s),a=!1}finally{a&&delete r[e]}return n.exports}s.ab="/ROOT/node_modules/next/dist/compiled/buffer/",t.exports=s(72)},48559,16649,62069,64376,85498,59385,81516,e=>{"use strict";let t,n,i,r,s,a,o,l,h,u,c,d,f,p,g,m,y,_,v,w,b,T,E,I;var C,S,k,A,N,R,P,x,D,O,L,M,F,U,V,j,q,B,z,$=e.i(50461);let H=function(e,t){if(!e)throw W(t)},W=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},K=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},G=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],a=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&a)}}return t.join("")},Q={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,h=r>>2,u=(3&r)<<4|a>>4,c=(15&a)<<2|l>>6,d=63&l;!o&&(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(K(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):G(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,a=++t<e.length?n[e.charAt(t)]:64,o=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==a||null==o)throw new Y;let l=r<<2|s>>4;if(i.push(l),64!==a){let e=s<<4&240|a>>2;if(i.push(e),64!==o){let e=a<<6&192|o;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Y extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let J=function(e){let t=K(e);return Q.encodeByteArray(t,!0)},X=function(e){return J(e).replace(/\./g,"")},Z=function(e){try{return Q.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},ee=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===$.default||void 0===$.default.env)return;let e=$.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&Z(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},et=e=>{var t,n;return null==(n=null==(t=ee())?void 0:t.emulatorHosts)?void 0:n[e]},en=e=>{let t=et(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},ei=()=>{var e;return null==(e=ee())?void 0:e.config},er=e=>{var t;return null==(t=ee())?void 0:t[`_${e}`]};class es{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function ea(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[X(JSON.stringify({alg:"none",type:"JWT"})),X(JSON.stringify(s)),""].join(".")}function eo(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function el(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(eo())}function eh(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function eu(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ec(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ed(){return false}function ef(){try{return"object"==typeof indexedDB}catch(e){return!1}}function ep(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null==(e=r.error)?void 0:e.message)||"")}}catch(e){t(e)}})}function eg(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}class em extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,em.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ey.prototype.create)}}class ey{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,a=this.errors[e],o=a?(n=a,i=r,n.replace(e_,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${o} (${s}).`;return new em(s,l,r)}}let e_=/\{\$([^}]+)}/g;function ev(e){return JSON.parse(e)}function ew(e){return JSON.stringify(e)}let eb=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=ev(Z(s[0])||""),n=ev(Z(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},eT=function(e){let t=eb(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},eE=function(e){let t=eb(e).claims;return"object"==typeof t&&!0===t.admin};function eI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eC(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eS(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ek(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eA(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(eN(n)&&eN(s)){if(!eA(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function eN(e){return null!==e&&"object"==typeof e}function eR(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function eP(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ex(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eD{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],a=this.chain_[1],o=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^a&(o^l),i=0x5a827999):(n=a^o^l,i=0x6ed9eba1):e<60?(n=a&o|l&(a|o),i=0x8f1bbcdc):(n=a^o^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=o,o=(a<<30|a>>>2)&0xffffffff,a=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+a|0,this.chain_[2]=this.chain_[2]+o|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class eO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=eL),void 0===i.error&&(i.error=eL),void 0===i.complete&&(i.complete=eL);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eL(){}function eM(e,t){return`${e} failed: ${t} argument `}let eF=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;H(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eU=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function eV(e,t=1e3,n=2){let i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function ej(e){return e&&e._delegate?e._delegate:e}function eq(e){return e.endsWith(".cloudworkstations.dev")}async function eB(e){return(await fetch(e,{credentials:"include"})).ok}class ez{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let e$="[DEFAULT]";class eH{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new es;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}if(i)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:e$})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=e$){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=e$){return this.instances.has(e)}getOptions(e=e$){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!=(n=this.onInitCallbacks.get(i))?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===e$?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch(e){}return i||null}normalizeInstanceIdentifier(e=e$){return this.component?this.component.multipleInstances?e:e$:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eW{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eH(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eK=[];(C=A||(A={}))[C.DEBUG=0]="DEBUG",C[C.VERBOSE=1]="VERBOSE",C[C.INFO=2]="INFO",C[C.WARN=3]="WARN",C[C.ERROR=4]="ERROR",C[C.SILENT=5]="SILENT";let eG={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},eQ=A.INFO,eY={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},eJ=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eY[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eX{constructor(e){this.name=e,this._logLevel=eQ,this._logHandler=eJ,this._userLogHandler=null,eK.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in A))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eG[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...e),this._logHandler(this,A.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...e),this._logHandler(this,A.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,A.INFO,...e),this._logHandler(this,A.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,A.WARN,...e),this._logHandler(this,A.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...e),this._logHandler(this,A.ERROR,...e)}}let eZ=new WeakMap,e0=new WeakMap,e1=new WeakMap,e2=new WeakMap,e3=new WeakMap,e6={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return e0.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e1.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return e5(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e5(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(e5(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eZ.set(t,e)}).catch(()=>{}),e3.set(t,e),t}if(e2.has(e))return e2.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(e4(this),t),e5(eZ.get(this))}:function(...t){return e5(e.apply(e4(this),t))}:function(t,...n){let i=e.call(e4(this),t,...n);return e1.set(i,t.sort?t.sort():[t]),e5(i)};return e instanceof IDBTransaction&&function(e){if(e0.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});e0.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,e6):e}(e);return i!==e&&(e2.set(e,i),e3.set(i,e)),i}let e4=e=>e3.get(e);function e8(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let a=indexedDB.open(e,t),o=e5(a);return i&&a.addEventListener("upgradeneeded",e=>{i(e5(a.result),e.oldVersion,e.newVersion,e5(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let e9=["get","getKey","getAll","getAllKeys","count"],e7=["put","add","delete","clear"],te=new Map;function tt(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(te.get(t))return te.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=e7.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e9.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),a=s.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),r&&s.done]))[0]};return te.set(t,s),s}e6={...I=e6,get:(e,t,n)=>tt(e,t)||I.get(e,t,n),has:(e,t)=>!!tt(e,t)||I.has(e,t)};class tn{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if((null==(t=e.getComponent())?void 0:t.type)!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let ti="@firebase/app",tr="0.12.1",ts=new eX("@firebase/app"),ta="[DEFAULT]",to={[ti]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tl=new Map,th=new Map,tu=new Map;function tc(e,t){try{e.container.addComponent(t)}catch(n){ts.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function td(e,t){e.container.addOrOverwriteComponent(t)}function tf(e){let t=e.name;if(tu.has(t))return ts.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(tu.set(t,e),tl.values()))tc(n,e);for(let t of th.values())tc(t,e);return!0}function tp(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function tg(e,t,n=ta){tp(e,t).clearInstance(n)}function tm(e){return void 0!==e.options}function ty(e){return null!=e&&void 0!==e.settings}function t_(){tu.clear()}let tv=new ey("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tw{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ez("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tv.create("app-deleted",{appName:this._name})}}function tb(e,t){let n=Z(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tT extends tw{constructor(e,t,n,i){const r=void 0!==t.automaticDataCollectionEnabled&&t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig=Object.assign({automaticDataCollectionEnabled:r},t),this._serverConfig.authIdToken&&tb(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tb(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tN(ti,tr,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tA(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tv.create("server-app-deleted")}}let tE="11.7.1";function tI(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i=Object.assign({name:ta,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw tv.create("bad-app-name",{appName:String(r)});if(n||(n=ei()),!n)throw tv.create("no-options");let s=tl.get(r);if(s)if(eA(n,s.options)&&eA(i,s.config))return s;else throw tv.create("duplicate-app",{appName:r});let a=new eW(r);for(let e of tu.values())a.addComponent(e);let o=new tw(n,i,a);return tl.set(r,o),o}function tC(e,t){let n;if(("undefined"!=typeof window||eh())&&!eh())throw tv.create("invalid-server-app-environment");void 0===t.automaticDataCollectionEnabled&&(t.automaticDataCollectionEnabled=!1),n=tm(e)?e.options:e;let i=Object.assign(Object.assign({},t),n);if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==t.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw tv.create("finalization-registry-not-supported",{});let r=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),s=th.get(r);if(s)return s.incRefCount(t.releaseOnDeref),s;let a=new eW(r);for(let e of tu.values())a.addComponent(e);let o=new tT(n,t,r,a);return th.set(r,o),o}function tS(e=ta){let t=tl.get(e);if(!t&&e===ta&&ei())return tI();if(!t)throw tv.create("no-app",{appName:e});return t}function tk(){return Array.from(tl.values())}async function tA(e){let t=!1,n=e.name;tl.has(n)?(t=!0,tl.delete(n)):th.has(n)&&0>=e.decRefCount()&&(th.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tN(e,t,n){var i;let r=null!=(i=to[e])?i:e;n&&(r+=`-${n}`);let s=r.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${r}" with version "${t}":`];s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ts.warn(e.join(" "));return}tf(new ez(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tR(e,t){if(null!==e&&"function"!=typeof e)throw tv.create("invalid-log-argument");for(let n of eK){let i=null;t&&t.level&&(i=eG[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(null!=i?i:t.logLevel)&&e({level:A[n].toLowerCase(),message:s,args:r,type:t.name})}}}function tP(e){eK.forEach(t=>{t.setLogLevel(e)})}let tx="firebase-heartbeat-store",tD=null;function tO(){return tD||(tD=e8("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tx)}catch(e){console.warn(e)}}}).catch(e=>{throw tv.create("idb-open",{originalErrorMessage:e.message})})),tD}async function tL(e){try{let t=(await tO()).transaction(tx),n=await t.objectStore(tx).get(tF(e));return await t.done,n}catch(e){if(e instanceof em)ts.warn(e.message);else{let t=tv.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ts.warn(t.message)}}}async function tM(e,t){try{let n=(await tO()).transaction(tx,"readwrite"),i=n.objectStore(tx);await i.put(t,tF(e)),await n.done}catch(e){if(e instanceof em)ts.warn(e.message);else{let t=tv.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ts.warn(t.message)}}}function tF(e){return`${e.name}!${e.options.appId}`}class tU{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tj(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=tV();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){ts.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=tV(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tq(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tq(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=X(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ts.warn(e),""}}}function tV(){return new Date().toISOString().substring(0,10)}class tj{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ef()&&ep().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tL(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tM(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return tM(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function tq(e){return X(JSON.stringify({version:2,heartbeats:e})).length}tf(new ez("platform-logger",e=>new tn(e),"PRIVATE")),tf(new ez("heartbeat",e=>new tU(e),"PRIVATE")),tN(ti,tr,""),tN(ti,tr,"esm2017"),tN("fire-js",""),e.s(["SDK_VERSION",()=>tE,"_DEFAULT_ENTRY_NAME",()=>ta,"_addComponent",()=>tc,"_addOrOverwriteComponent",()=>td,"_apps",()=>tl,"_clearComponents",()=>t_,"_components",()=>tu,"_getProvider",()=>tp,"_isFirebaseApp",()=>tm,"_isFirebaseServerApp",()=>ty,"_registerComponent",()=>tf,"_removeServiceInstance",()=>tg,"_serverApps",()=>th,"deleteApp",()=>tA,"getApp",()=>tS,"getApps",()=>tk,"initializeApp",()=>tI,"initializeServerApp",()=>tC,"onLog",()=>tR,"registerVersion",()=>tN,"setLogLevel",()=>tP],3251),tN("firebase","11.7.1","app"),e.i(3251);let tB="@firebase/installations",tz="0.6.14",t$=`w:${tz}`,tH="FIS_v2",tW=new ey("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function tK(e){return e instanceof em&&e.code.includes("request-failed")}function tG({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function tQ(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function tY(e,t){let n=(await t.json()).error;return tW.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function tJ({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function tX(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function tZ({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let i=tG(e),r=tJ(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let a={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:tH,appId:e.appId,sdkVersion:t$})},o=await tX(()=>fetch(i,a));if(o.ok){let e=await o.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:tQ(e.authToken)}}throw await tY("Create Installation",o)}function t0(e){return new Promise(t=>{setTimeout(t,e)})}let t1=/^[cdef][\w-]{21}$/;function t2(e){return`${e.appName}!${e.appId}`}let t3=new Map;function t6(e,t){var n,i;let r,s=t2(e);t5(s,t),n=s,i=t,(r=(!t4&&"BroadcastChannel"in self&&((t4=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{t5(e.data.key,e.data.fid)}),t4))&&r.postMessage({key:n,fid:i}),0===t3.size&&t4&&(t4.close(),t4=null)}function t5(e,t){let n=t3.get(e);if(n)for(let e of n)e(t)}let t4=null,t8="firebase-installations-store",t9=null;function t7(){return t9||(t9=e8("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(t8)}})),t9}async function ne(e,t){let n=t2(e),i=(await t7()).transaction(t8,"readwrite"),r=i.objectStore(t8),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||t6(e,t.fid),t}async function nt(e){let t=t2(e),n=(await t7()).transaction(t8,"readwrite");await n.objectStore(t8).delete(t),await n.done}async function nn(e,t){let n=t2(e),i=(await t7()).transaction(t8,"readwrite"),r=i.objectStore(t8),s=await r.get(n),a=t(s);return void 0===a?await r.delete(n):await r.put(a,n),await i.done,a&&(!s||s.fid!==a.fid)&&t6(e,a.fid),a}async function ni(e){let t,n=await nn(e.appConfig,n=>{let i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(tW.create("app-offline"))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=nr(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ns(e)}:{installationEntry:t}}(e,no(n||{fid:function(){try{var e;let t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;let n=(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22));return t1.test(n)?n:""}catch(e){return""}}(),registrationStatus:0}));return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function nr(e,t){try{let n=await tZ(e,t);return ne(e.appConfig,n)}catch(n){throw tK(n)&&409===n.customData.serverCode?await nt(e.appConfig):await ne(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function ns(e){let t=await na(e.appConfig);for(;1===t.registrationStatus;)await t0(100),t=await na(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await ni(e);return n||t}return t}function na(e){return nn(e,e=>{if(!e)throw tW.create("installation-not-found");return no(e)})}function no(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function nl({appConfig:e,heartbeatServiceProvider:t},n){let i=function(e,{fid:t}){return`${tG(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){var n;let i=tJ(e);return i.append("Authorization",(n=t,`${tH} ${n}`)),i}(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let a={method:"POST",headers:r,body:JSON.stringify({installation:{sdkVersion:t$,appId:e.appId}})},o=await tX(()=>fetch(i,a));if(o.ok)return tQ(await o.json());throw await tY("Generate Auth Token",o)}async function nh(e,t=!1){let n,i=await nn(e.appConfig,i=>{var r,s,a;let o;if(!nf(i))throw tW.create("not-registered");let l=i.authToken;if(!t&&2===(r=l).requestStatus&&(s=r,!((o=Date.now())<s.creationTime)&&!(s.creationTime+s.expiresIn<o+36e5)))return i;if(1===l.requestStatus)return n=nu(e,t),i;{let t;if(!navigator.onLine)throw tW.create("app-offline");let r=(a=i,t={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},a),{authToken:t}));return n=nd(e,r),r}});return n?await n:i.authToken}async function nu(e,t){let n=await nc(e.appConfig);for(;1===n.authToken.requestStatus;)await t0(100),n=await nc(e.appConfig);let i=n.authToken;return 0===i.requestStatus?nh(e,t):i}function nc(e){return nn(e,e=>{var t;if(!nf(e))throw tW.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function nd(e,t){try{let n=await nl(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await ne(e.appConfig,i),n}catch(n){if(tK(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await nt(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await ne(e.appConfig,n)}throw n}}function nf(e){return void 0!==e&&2===e.registrationStatus}async function np(e){let{installationEntry:t,registrationPromise:n}=await ni(e);return n?n.catch(console.error):nh(e).catch(console.error),t.fid}async function ng(e,t=!1){return await nm(e),(await nh(e,t)).token}async function nm(e){let{registrationPromise:t}=await ni(e);t&&await t}function ny(e){return tW.create("missing-app-config-values",{valueName:e})}let n_="installations";tf(new ez(n_,e=>{let t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw ny("App Configuration");if(!e.name)throw ny("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw ny(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),i=tp(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},"PUBLIC")),tf(new ez("installations-internal",e=>{let t=tp(e.getProvider("app").getImmediate(),n_).getImmediate();return{getId:()=>np(t),getToken:e=>ng(t,e)}},"PRIVATE")),tN(tB,tz),tN(tB,tz,"esm2017");let nv="analytics",nw="https://www.googletagmanager.com/gtag/js",nb=new eX("@firebase/analytics"),nT=new ey("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function nE(e){if(!e.startsWith(nw)){let t=nT.create("invalid-gtag-resource",{gtagURL:e});return nb.warn(t.message),""}return e}function nI(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function nC(e,t,n,i,r,s){let a=i[r];try{if(a)await t[a];else{let e=(await nI(n)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(e){nb.error(e)}e("config",r,s)}async function nS(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);let i=await nI(n);for(let n of e){let e=i.find(e=>e.measurementId===n),r=e&&t[e.appId];if(r)s.push(r);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){nb.error(e)}}let nk=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};async function nA(e){var t;let{appId:n,apiKey:i}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":i})},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),a=await fetch(s,r);if(200!==a.status&&304!==a.status){let e="";try{let n=await a.json();(null==(t=n.error)?void 0:t.message)&&(e=n.error.message)}catch(e){}throw nT.create("config-fetch-failed",{httpStatus:a.status,responseMessage:e})}return a.json()}async function nN(e,t=nk,n){let{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw nT.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw nT.create("no-api-key")}let a=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},o=new nP;return setTimeout(async()=>{o.abort()},void 0!==n?n:6e4),nR({appId:i,apiKey:r,measurementId:s},a,o,t)}async function nR(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=nk){var s,a,o;let{appId:l,measurementId:h}=e;try{await (a=i,o=t,new Promise((e,t)=>{let n=setTimeout(e,Math.max(o-Date.now(),0));a.addEventListener(()=>{clearTimeout(n),t(nT.create("fetch-throttle",{throttleEndTimeMillis:o}))})}))}catch(e){if(h)return nb.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:l,measurementId:h};throw e}try{let t=await nA(e);return r.deleteThrottleMetadata(l),t}catch(o){if(!function(e){if(!(e instanceof em)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(o)){if(r.deleteThrottleMetadata(l),h)return nb.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${h} provided in the "measurementId" field in the local Firebase config. [${null==o?void 0:o.message}]`),{appId:l,measurementId:h};throw o}let t=503===Number(null==(s=null==o?void 0:o.customData)?void 0:s.httpStatus)?eV(n,r.intervalMillis,30):eV(n,r.intervalMillis),a={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return r.setThrottleMetadata(l,a),nb.debug(`Calling attemptFetch again in ${t} millis`),nR(e,a,i,r)}}class nP{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function nx(e,t,n,i,r){if(r&&r.global)return void e("event",n,i);{let r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}async function nD(){if(!ef())return nb.warn(nT.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await ep()}catch(e){return nb.warn(nT.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function nO(e,t,n,s,a,o,l){var h,u,c;let d,f,p,g,m=nN(e);m.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&nb.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>nb.error(e)),t.push(m);let y=nD().then(e=>e?s.getId():void 0),[_,v]=await Promise.all([m,y]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(nw)&&t.src.includes(e))return t;return null}(o)&&(u=_.measurementId,c={createScriptURL:nE},window.trustedTypes&&(d=window.trustedTypes.createPolicy("firebase-js-sdk-policy",c)),f=d,p=document.createElement("script"),g=`${nw}?l=${o}&id=${u}`,p.src=f?null==f?void 0:f.createScriptURL(g):g,p.async=!0,document.head.appendChild(p)),r&&(a("consent","default",r),r=void 0),a("js",new Date);let w=null!=(h=null==l?void 0:l.config)?h:{};return w.origin="firebase",w.update=!0,null!=v&&(w.firebase_id=v),a("config",_.measurementId,w),i&&(a("set",i),i=void 0),_.measurementId}class nL{constructor(e){this.app=e}_delete(){return delete nM[this.app.options.appId],Promise.resolve()}}let nM={},nF=[],nU={},nV="dataLayer",nj=!1;async function nq(){if(eu()||!eg()||!ef())return!1;try{return await ep()}catch(e){return!1}}let nB="@firebase/analytics",nz="0.10.13";tf(new ez(nv,(e,{options:t})=>(function(e,t,n){let i=[];if(eu()&&i.push("This is a browser extension environment."),eg()||i.push("Cookies are not available."),i.length>0){let e=i.map((e,t)=>`(${t+1}) ${e}`).join(" "),t=nT.create("invalid-analytics-context",{errorInfo:e});nb.warn(t.message)}let r=e.options.appId;if(!r)throw nT.create("no-app-id");if(!e.options.apiKey)if(e.options.measurementId)nb.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw nT.create("no-api-key");if(null!=nM[r])throw nT.create("already-exists",{id:r});if(!nj){var o,l;let e,t;e=[],Array.isArray(window[nV])?e=window[nV]:window[nV]=e;let{wrappedGtag:n,gtagCore:i}=(o="gtag",t=function(){window[nV].push(arguments)},window[o]&&"function"==typeof window[o]&&(t=window[o]),window[o]=(l=t,async function(e,...t){try{if("event"===e){let[e,n]=t;await nS(l,nM,nF,e,n)}else if("config"===e){let[e,n]=t;await nC(l,nM,nF,nU,e,n)}else if("consent"===e){let[e,n]=t;l("consent",e,n)}else if("get"===e){let[e,n,i]=t;l("get",e,n,i)}else if("set"===e){let[e]=t;l("set",e)}else l(e,...t)}catch(e){nb.error(e)}}),{gtagCore:t,wrappedGtag:window[o]});a=n,s=i,nj=!0}return nM[r]=nO(e,nF,nU,t,s,nV,n),new nL(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),tf(new ez("analytics-internal",function(e){try{let t=e.getProvider(nv).getImmediate();return{logEvent:(e,n,i)=>{var r;return r=t,void(r=ej(r),nx(a,nM[r.app.options.appId],e,n,i).catch(e=>nb.error(e)))}}}catch(e){throw nT.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),tN(nB,nz),tN(nB,nz,"esm2017");let n$="@firebase/database",nH="1.0.15",nW="";class nK{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ew(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ev(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class nG{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eI(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let nQ=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new nK(t)}}catch(e){}return new nG},nY=nQ("localStorage"),nJ=nQ("sessionStorage"),nX=new eX("@firebase/database"),nZ=(b=1,function(){return b++}),n0=function(e){let t=eF(e),n=new eD;n.update(t);let i=n.digest();return Q.encodeByteArray(i)},n1=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=n1.apply(null,i):"object"==typeof i?t+=ew(i):t+=i,t+=" "}return t},n2=null,n3=!0,n6=function(e,t){H(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(nX.logLevel=A.VERBOSE,n2=nX.log.bind(nX),t&&nJ.set("logging_enabled",!0)):"function"==typeof e?n2=e:(n2=null,nJ.remove("logging_enabled"))},n5=function(...e){if(!0===n3&&(n3=!1,null===n2&&!0===nJ.get("logging_enabled")&&n6(!0)),n2){let t=n1.apply(null,e);n2(t)}},n4=function(e){return function(...t){n5(e,...t)}},n8=function(...e){let t="FIREBASE INTERNAL ERROR: "+n1(...e);nX.error(t)},n9=function(...e){let t=`FIREBASE FATAL ERROR: ${n1(...e)}`;throw nX.error(t),Error(t)},n7=function(...e){let t="FIREBASE WARNING: "+n1(...e);nX.warn(t)},ie=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&n7("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},it=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},ii=function(e){if(ed()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},ir="[MIN_NAME]",is="[MAX_NAME]",ia=function(e,t){if(e===t)return 0;{if(e===ir||t===is)return -1;if(t===ir||e===is)return 1;let n=ig(e),i=ig(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},io=function(e,t){return e===t?0:e<t?-1:1},il=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ew(t))},ih=function(e){if("object"!=typeof e||null===e)return ew(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=ew(t[i]),n+=":",n+=ih(e[t[i]]);return n+"}"},iu=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function ic(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let id=function(e){let t,n,i,r,s;H(!it(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let a=[];for(s=52;s;s-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(+!!t),a.reverse();let o=a.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(o.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},ip=RegExp("^-?(0*)\\d{1,10}$"),ig=function(e){if(ip.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},im=function(e){try{e()}catch(e){setTimeout(()=>{throw n7("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},iy=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class i_{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ty(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null==(t=this.appCheckProvider)||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){n7(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class iv{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(n5("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',n7(e)}}class iw{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}iw.OWNER="owner";let ib=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,iT="websocket",iE="long_polling";class iI{constructor(e,t,n,i,r=!1,s="",a=!1,o=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=o,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=nY.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&nY.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function iC(e,t,n){let i;if(H("string"==typeof t,"typeof type must == string"),H("object"==typeof n,"typeof params must == object"),t===iT)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===iE)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return ic(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class iS{constructor(){this.counters_={}}incrementCounter(e,t=1){eI(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let ik={},iA={};function iN(e){let t=e.toString();return ik[t]||(ik[t]=new iS),ik[t]}class iR{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&im(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let iP="start";class ix{constructor(e,t,n,i,r,s,a){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=n4(e),this.stats_=iN(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),iC(t,iE,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new iR(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),ii(()=>{if(this.isClosed_)return;this.scriptTagHolder=new iD((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===iP)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[iP]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&ib.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){ix.forceAllow_=!0}static forceDisallow(){ix.forceDisallow_=!0}static isAvailable(){return!ed()&&(!!ix.forceAllow_||!ix.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ew(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=iu(J(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ed())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ew(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class iD{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ed())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=nZ(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=iD.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){n5("frame writing exception"),e.stack&&n5(e.stack),n5(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||n5("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){ed()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{n5("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let iO=null;"undefined"!=typeof MozWebSocket?iO=MozWebSocket:"undefined"!=typeof WebSocket&&(iO=WebSocket);class iL{constructor(e,t,n,i,r,s,a){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=n4(this.connId),this.stats_=iN(t),this.connURL=iL.connectionURL_(t,s,a,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!ed()&&"undefined"!=typeof location&&location.hostname&&ib.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),iC(e,iT,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,nY.set("previous_websocket_failure",!0);try{let e;if(ed()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${nW}/${$.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=$.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new iO(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){iL.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==iO&&!iL.forceDisallow_}static previouslyFailed(){return nY.isInMemoryStorage||!0===nY.get("previous_websocket_failure")}markConnectionHealthy(){nY.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ev(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(H(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ew(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=iu(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}iL.responsesRequiredToBeHealthy=2,iL.healthyTimeout=3e4;class iM{static get ALL_TRANSPORTS(){return[ix,iL]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=iL&&iL.isAvailable(),n=t&&!iL.previouslyFailed();if(e.webSocketOnly&&(t||n7("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[iL];else{let e=this.transports_=[];for(let t of iM.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);iM.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}iM.globalTransportInitialized_=!1;class iF{constructor(e,t,n,i,r,s,a,o,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=a,this.onDisconnect_=o,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=n4("c:"+this.id+":"),this.transportManager_=new iM(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=iy(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=il("t",e),n=il("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=il("t",e),n=il("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=il("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?n8("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):n8("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&n7("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),iy(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):iy(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(nY.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class iU{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class iV{constructor(e){this.allowedEvents_=e,this.listeners_={},H(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){H(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class ij extends iV{static getInstance(){return new ij}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||el()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return H("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class iq{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function iB(){return new iq("")}function iz(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function i$(e){return e.pieces_.length-e.pieceNum_}function iH(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new iq(e.pieces_,t)}function iW(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function iK(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function iG(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new iq(t,0)}function iQ(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof iq)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new iq(n,0)}function iY(e){return e.pieceNum_>=e.pieces_.length}function iJ(e,t){let n=iz(e),i=iz(t);if(null===n)return t;if(n===i)return iJ(iH(e),iH(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function iX(e,t){if(i$(e)!==i$(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function iZ(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(i$(e)>i$(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class i0{constructor(e,t){this.errorPrefix_=t,this.parts_=iK(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eU(this.parts_[e]);i1(this)}}function i1(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+i2(e))}function i2(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class i3 extends iV{static getInstance(){return new i3}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return H("visible"===e,"Unknown event type: "+e),[this.visible_]}}class i6 extends iU{constructor(e,t,n,i,r,s,a,o){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=a,this.authOverride_=o,this.id=i6.nextPersistentConnectionId_++,this.log_=n4("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,o&&!ed())throw Error("Auth override specified in options, but not supported on non Node.js platforms");i3.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ij.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(ew(r)),H(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new es,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),H(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let a={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,a=r.s;i6.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==a&&this.removeListen_(n,i),e.onComplete&&e.onComplete(a,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eI(e,"w")){let n=eC(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();n7(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||eE(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eT(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ew(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):n8("Unrecognized action received from server: "+ew(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){H(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+i6.nextConnectionId_++,r=this.lastSessionId,s=!1,a=null,o=function(){a?a.close():(s=!0,n())};this.realtime_={close:o,sendRequest:function(e){H(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[o,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?n5("getToken() completed but was canceled"):(n5("getToken() completed. Creating connection."),this.authToken_=o&&o.accessToken,this.appCheckToken_=h&&h.token,a=new iF(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{n7(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&n7(e),o())}}}interrupt(e){n5("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){n5("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eS(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>ih(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new iq(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){n5("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){n5("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";ed()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+nW.replace(/\./g,"-")]=1,el()?e["framework.cordova"]=1:ec()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=ij.getInstance().currentlyOnline();return eS(this.interruptReasons_)&&e}}i6.nextPersistentConnectionId_=0,i6.nextConnectionId_=0;class i5{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new i5(e,t)}}class i4{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new i5(ir,e),i=new i5(ir,t);return 0!==this.compare(n,i)}minPost(){return i5.MIN}}class i8 extends i4{static get __EMPTY_NODE(){return o}static set __EMPTY_NODE(e){o=e}compare(e,t){return ia(e.name,t.name)}isDefinedOn(e){throw W("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return i5.MIN}maxPost(){return new i5(is,o)}makePost(e,t){return H("string"==typeof e,"KeyIndex indexValue must always be a string."),new i5(e,o)}toString(){return".key"}}let i9=new i8;class i7{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class re{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:re.RED,this.left=null!=i?i:rt.EMPTY_NODE,this.right=null!=r?r:rt.EMPTY_NODE}copy(e,t,n,i,r){return new re(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return rt.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return rt.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}re.RED=!0,re.BLACK=!1;class rt{constructor(e,t=rt.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new rt(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,re.BLACK,null,null))}remove(e){return new rt(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,re.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new i7(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new i7(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new i7(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new i7(this.root_,null,this.comparator_,!0,e)}}function rn(e,t){return ia(e.name,t.name)}function ri(e,t){return ia(e,t)}rt.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new re(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let rr=function(e){return"number"==typeof e?"number:"+id(e):"string:"+e},rs=function(e){if(e.isLeafNode()){let t=e.val();H("string"==typeof t||"number"==typeof t||"object"==typeof t&&eI(t,".sv"),"Priority must be a string or number.")}else H(e===l||e.isEmpty(),"priority of unexpected type.");H(e===l||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class ra{static set __childrenNodeConstructor(e){h=e}static get __childrenNodeConstructor(){return h}constructor(e,t=ra.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,H(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),rs(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ra(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ra.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return iY(e)?this:".priority"===iz(e)?this.priorityNode_:ra.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ra.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=iz(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(H(".priority"!==n||1===i$(e),".priority must be the last token in a path"),this.updateImmediateChild(n,ra.__childrenNodeConstructor.EMPTY_NODE.updateChild(iH(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+rr(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=id(this.value_):e+=this.value_,this.lazyHash_=n0(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ra.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ra.__childrenNodeConstructor?-1:(H(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=ra.VALUE_TYPE_ORDER.indexOf(t),r=ra.VALUE_TYPE_ORDER.indexOf(n);return(H(i>=0,"Unknown leaf type: "+t),H(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}ra.VALUE_TYPE_ORDER=["object","boolean","number","string"];let ro=new class extends i4{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?ia(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return i5.MIN}maxPost(){return new i5(is,new ra("[PRIORITY-POST]",c))}makePost(e,t){return new i5(t,new ra("[PRIORITY-POST]",u(e)))}toString(){return".priority"}},rl=Math.log(2);class rh{constructor(e){this.count=parseInt(Math.log(e+1)/rl,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let ru=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,a=i-t;if(0===a)return null;if(1===a)return s=e[t],new re(n?n(s):s,s.node,re.BLACK,null,null);{let o=parseInt(a/2,10)+t,l=r(t,o),h=r(o+1,i);return s=e[o],new re(n?n(s):s,s.node,re.BLACK,l,h)}};return new rt(i||t,function(t){let i=null,s=null,a=e.length,o=function(t,i){let s=a-t,o=a;a-=t;let h=r(s+1,o),u=e[s];l(new re(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?o(i,re.BLACK):(o(i,re.BLACK),o(i,re.RED))}return s}(new rh(e.length)))},rc={};class rd{static get Default(){return H(rc&&ro,"ChildrenNode.ts has not been loaded"),d=d||new rd({".priority":rc},{".priority":ro})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eC(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof rt?t:null}hasIndex(e){return eI(this.indexSet_,e.toString())}addIndex(e,t){let n;H(e!==i9,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(i5.Wrap),a=s.getNext();for(;a;)r=r||e.isDefinedOn(a.node),i.push(a),a=s.getNext();n=r?ru(i,e.getCompare()):rc;let o=e.toString(),l=Object.assign({},this.indexSet_);l[o]=e;let h=Object.assign({},this.indexes_);return h[o]=n,new rd(h,l)}addToIndexes(e,t){return new rd(ek(this.indexes_,(n,i)=>{let r=eC(this.indexSet_,i);if(H(r,"Missing index implementation for "+i),n===rc)if(!r.isDefinedOn(e.node))return rc;else{let n=[],i=t.getIterator(i5.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),ru(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new i5(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new rd(ek(this.indexes_,n=>{if(n===rc)return n;{let i=t.get(e.name);return i?n.remove(new i5(e.name,i)):n}}),this.indexSet_)}}class rf{static get EMPTY_NODE(){return f||(f=new rf(new rt(ri),null,rd.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&rs(this.priorityNode_),this.children_.isEmpty()&&H(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||f}updatePriority(e){return this.children_.isEmpty()?this:new rf(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?f:t}}getChild(e){let t=iz(e);return null===t?this:this.getImmediateChild(t).getChild(iH(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(H(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new i5(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?f:this.priorityNode_;return new rf(n,s,i)}}updateChild(e,t){let n=iz(e);if(null===n)return t;{H(".priority"!==iz(e)||1===i$(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(iH(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(ro,(s,a)=>{t[s]=a.val(e),n++,r&&rf.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+rr(this.getPriority().val())+":"),this.forEachChild(ro,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":n0(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new i5(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new i5(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new i5(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,i5.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,i5.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===rp?-1:0}withIndex(e){if(e===i9||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new rf(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===i9||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(ro),n=e.getIterator(ro),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===i9?null:this.indexMap_.get(e.toString())}}rf.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let rp=new class extends rf{constructor(){super(new rt(ri),rf.EMPTY_NODE,rd.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return rf.EMPTY_NODE}isEmpty(){return!1}};function rg(e,t=null){if(null===e)return rf.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),H(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ra(e,rg(t));if(e instanceof Array){let n=rf.EMPTY_NODE;return ic(e,(t,i)=>{if(eI(e,t)&&"."!==t.substring(0,1)){let e=rg(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(rg(t))}{let n=[],i=!1;if(ic(e,(e,t)=>{if("."!==e.substring(0,1)){let r=rg(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new i5(e,r)))}}),0===n.length)return rf.EMPTY_NODE;let r=ru(n,rn,e=>e.name,ri);if(!i)return new rf(r,rg(t),rd.Default);{let e=ru(n,ro.getCompare());return new rf(r,rg(t),new rd({".priority":e},{".priority":ro}))}}}Object.defineProperties(i5,{MIN:{value:new i5(ir,rf.EMPTY_NODE)},MAX:{value:new i5(is,rp)}}),i8.__EMPTY_NODE=rf.EMPTY_NODE,ra.__childrenNodeConstructor=rf,l=rp,c=rp,u=rg;class rm extends i4{constructor(e){super(),this.indexPath_=e,H(!iY(e)&&".priority"!==iz(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?ia(e.name,t.name):r}makePost(e,t){let n=rg(e);return new i5(t,rf.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new i5(is,rf.EMPTY_NODE.updateChild(this.indexPath_,rp))}toString(){return iK(this.indexPath_,0).join("/")}}let ry=new class extends i4{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?ia(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return i5.MIN}maxPost(){return i5.MAX}makePost(e,t){return new i5(t,rg(e))}toString(){return".value"}};function r_(e){return{type:"value",snapshotNode:e}}function rv(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function rw(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function rb(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class rT{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){H(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(i).equals(n.getChild(i))&&a.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(rw(t,a)):H(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(rv(t,n)):s.trackChildChange(rb(t,n,a))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ro,(e,i)=>{t.hasChild(e)||n.trackChildChange(rw(e,i))}),t.isLeafNode()||t.forEachChild(ro,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(rb(t,i,r))}else n.trackChildChange(rv(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?rf.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class rE{constructor(e){this.indexedFilter_=new rT(e.getIndex()),this.index_=e.getIndex(),this.startPost_=rE.getStartPost_(e),this.endPost_=rE.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new i5(t,n))||(n=rf.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=rf.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(rf.EMPTY_NODE);let r=this;return t.forEachChild(ro,(e,t)=>{r.matches(new i5(e,t))||(i=i.updateImmediateChild(e,rf.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class rI{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new rE(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new i5(t,n))||(n=rf.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=rf.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=rf.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(rf.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,rf.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();H(e.numChildren()===this.limit_,"");let a=new i5(t,n),o=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,o,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,a);if(l&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(rb(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(rw(t,h));let n=e.updateImmediateChild(t,rf.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(rv(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l?s(o,a)>=0?(null!=r&&(r.trackChildChange(rw(o.name,o.node)),r.trackChildChange(rv(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(o.name,rf.EMPTY_NODE)):e:e}}class rC{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ro}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return H(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(H(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:ir}hasEnd(){return this.endSet_}getIndexEndValue(){return H(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(H(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:is}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return H(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ro}copy(){let e=new rC;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function rS(e){let t,n={};if(e.isDefault())return n;if(e.index_===ro?t="$priority":e.index_===ry?t="$value":e.index_===i9?t="$key":(H(e.index_ instanceof rm,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ew(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ew(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ew(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ew(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ew(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function rk(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ro&&(t.i=e.index_.toString()),t}class rA extends iU{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(H(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=n4("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=rA.getListenId_(e,n),a={};this.listens_[s]=a;let o=rS(e._queryParams);this.restRequest_(r+".json",o,(e,t)=>{let o=t;(404===e&&(o=null,e=null),null===e&&this.onDataUpdate_(r,o,!1,n),eC(this.listens_,s)===a)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=rA.getListenId_(e,t);delete this.listens_[n]}get(e){let t=rS(e._queryParams),n=e._path.toString(),i=new es;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eR(t);this.log_("Sending REST request for "+s);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(n&&4===a.readyState){this.log_("REST Response for "+s+" received. status:",a.status,"response:",a.responseText);let e=null;if(a.status>=200&&a.status<300){try{e=ev(a.responseText)}catch(e){n7("Failed to parse JSON response for "+s+": "+a.responseText)}n(null,e)}else 401!==a.status&&404!==a.status&&n7("Got unsuccessful REST response for "+s+" Status: "+a.status),n(a.status);n=null}},a.open("GET",s,!0),a.send()})}}class rN{constructor(){this.rootNode_=rf.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function rR(){return{value:null,children:new Map}}function rP(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{rP(i,new iq(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class rx{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ic(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class rD{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new rx(e);const n=1e4+2e4*Math.random();iy(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ic(e,(e,i)=>{i>0&&eI(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),iy(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function rO(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function rL(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function rM(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(S=N||(N={}))[S.OVERWRITE=0]="OVERWRITE",S[S.MERGE=1]="MERGE",S[S.ACK_USER_WRITE=2]="ACK_USER_WRITE",S[S.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class rF{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=N.ACK_USER_WRITE,this.source=rO()}operationForChild(e){if(!iY(this.path))return H(iz(this.path)===e,"operationForChild called for unrelated child."),new rF(iH(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return H(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new iq(e));return new rF(iB(),t,this.revert)}}}class rU{constructor(e,t){this.source=e,this.path=t,this.type=N.LISTEN_COMPLETE}operationForChild(e){return iY(this.path)?new rU(this.source,iB()):new rU(this.source,iH(this.path))}}class rV{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=N.OVERWRITE}operationForChild(e){return iY(this.path)?new rV(this.source,iB(),this.snap.getImmediateChild(e)):new rV(this.source,iH(this.path),this.snap)}}class rj{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=N.MERGE}operationForChild(e){if(!iY(this.path))return H(iz(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new rj(this.source,iH(this.path),this.children);{let t=this.children.subtree(new iq(e));return t.isEmpty()?null:t.value?new rV(this.source,iB(),t.value):new rj(this.source,iB(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class rq{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(iY(e))return this.isFullyInitialized()&&!this.filtered_;let t=iz(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class rB{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function rz(e,t,n,i,r,s){let a=i.filter(e=>e.type===n);a.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw W("Should only compare child_ events.");let i=new i5(t.childName,t.snapshotNode),r=new i5(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),a.forEach(n=>{var i,a,o;let l=(i=e,a=n,o=s,"value"===a.type||"child_removed"===a.type||(a.prevName=o.getPredecessorChildName(a.childName,a.snapshotNode,i.index_)),a);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function r$(e,t){return{eventCache:e,serverCache:t}}function rH(e,t,n,i){return r$(new rq(t,n,i),e.serverCache)}function rW(e,t,n,i){return r$(e.eventCache,new rq(t,n,i))}function rK(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function rG(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class rQ{static fromObject(e){let t=new rQ(null);return ic(e,(e,n)=>{t=t.set(new iq(e),n)}),t}constructor(e,t=(!p&&(p=new rt(io)),p)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:iB(),value:this.value};{if(iY(e))return null;let n=iz(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(iH(e),t);return null!=r?{path:iQ(new iq(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(iY(e))return this;{let t=iz(e),n=this.children.get(t);return null!==n?n.subtree(iH(e)):new rQ(null)}}set(e,t){if(iY(e))return new rQ(t,this.children);{let n=iz(e),i=(this.children.get(n)||new rQ(null)).set(iH(e),t),r=this.children.insert(n,i);return new rQ(this.value,r)}}remove(e){if(iY(e))if(this.children.isEmpty())return new rQ(null);else return new rQ(null,this.children);{let t=iz(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(iH(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new rQ(null):new rQ(this.value,i)}}}get(e){if(iY(e))return this.value;{let t=iz(e),n=this.children.get(t);return n?n.get(iH(e)):null}}setTree(e,t){if(iY(e))return t;{let n,i=iz(e),r=(this.children.get(i)||new rQ(null)).setTree(iH(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new rQ(this.value,n)}}fold(e){return this.fold_(iB(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(iQ(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,iB(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(iY(e))return null;let i=iz(e),r=this.children.get(i);return r?r.findOnPath_(iH(e),iQ(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,iB(),t)}foreachOnPath_(e,t,n){if(iY(e))return this;{this.value&&n(t,this.value);let i=iz(e),r=this.children.get(i);return r?r.foreachOnPath_(iH(e),iQ(t,i),n):new rQ(null)}}foreach(e){this.foreach_(iB(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(iQ(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class rY{constructor(e){this.writeTree_=e}static empty(){return new rY(new rQ(null))}}function rJ(e,t,n){if(iY(t))return new rY(new rQ(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,a=iJ(r,t);return s=s.updateChild(a,n),new rY(e.writeTree_.set(r,s))}{let i=new rQ(n);return new rY(e.writeTree_.setTree(t,i))}}}function rX(e,t,n){let i=e;return ic(n,(e,n)=>{i=rJ(i,iQ(t,e),n)}),i}function rZ(e,t){return iY(t)?rY.empty():new rY(e.writeTree_.setTree(t,new rQ(null)))}function r0(e,t){return null!=r1(e,t)}function r1(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(iJ(n.path,t)):null}function r2(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ro,(e,n)=>{t.push(new i5(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new i5(e,n.value))}),t}function r3(e,t){if(iY(t))return e;{let n=r1(e,t);return new rY(null!=n?new rQ(n):e.writeTree_.subtree(t))}}function r6(e){return e.writeTree_.isEmpty()}function r5(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(H(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(iQ(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(iQ(t,".priority"),r)),i}}(iB(),e.writeTree_,t)}function r4(e){return e.visible}function r8(e,t,n){let i=rY.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)iZ(n,t)?i=rJ(i,e=iJ(n,t),s.snap):iZ(t,n)&&(e=iJ(t,n),i=rJ(i,iB(),s.snap.getChild(e)));else if(s.children){if(iZ(n,t))i=rX(i,e=iJ(n,t),s.children);else if(iZ(t,n))if(iY(e=iJ(t,n)))i=rX(i,iB(),s.children);else{let t=eC(s.children,iz(e));if(t){let n=t.getChild(iH(e));i=rJ(i,iB(),n)}}}else throw W("WriteRecord should have .snap or .children")}}return i}function r9(e,t,n,i,r){if(i||r){let s=r3(e.visibleWrites,t);return!r&&r6(s)?n:r||null!=n||r0(s,iB())?r5(r8(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(iZ(e.path,t)||iZ(t,e.path))},t),n||rf.EMPTY_NODE):null}{let i=r1(e.visibleWrites,t);if(null!=i)return i;{let i=r3(e.visibleWrites,t);return r6(i)?n:null!=n||r0(i,iB())?r5(i,n||rf.EMPTY_NODE):null}}}function r7(e,t,n,i){return r9(e.writeTree,e.treePath,t,n,i)}function se(e,t){return function(e,t,n){let i=rf.EMPTY_NODE,r=r1(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(ro,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return r2(r3(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=r3(e.visibleWrites,t);return n.forEachChild(ro,(e,t)=>{let n=r5(r3(r,new iq(e)),t);i=i.updateImmediateChild(e,n)}),r2(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function st(e,t,n,i){return function(e,t,n,i,r){H(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=iQ(t,n);if(r0(e.visibleWrites,s))return null;{let t=r3(e.visibleWrites,s);return r6(t)?r.getChild(n):r5(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function sn(e,t){var n,i;return n=e.writeTree,i=iQ(e.treePath,t),r1(n.visibleWrites,i)}function si(e,t,n){var i,r;let s,a;return i=e.writeTree,r=e.treePath,s=iQ(r,t),null!=(a=r1(i.visibleWrites,s))?a:n.isCompleteForChild(t)?r5(r3(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function sr(e,t){return ss(iQ(e.treePath,t),e.writeTree)}function ss(e,t){return{treePath:e,writeTree:t}}class sa{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;H("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),H(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,rb(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,rw(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,rv(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,rb(n,e.snapshotNode,i.oldSnap));else throw W("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let so=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class sl{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new rq(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return si(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:rG(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,a){let o,l=r3(e.visibleWrites,t),h=r1(l,iB());if(null!=h)o=h;else{if(null==n)return[];o=r5(l,n)}if((o=o.withIndex(a)).isEmpty()||o.isLeafNode())return[];{let e=[],t=a.getCompare(),n=s?o.getReverseIteratorFrom(i,a):o.getIteratorFrom(i,a),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function sh(e,t,n,i,r,s){let a=t.eventCache;if(null!=sn(i,n))return t;{let o,l;if(iY(n))if(H(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=rG(t),r=se(i,n instanceof rf?n:rf.EMPTY_NODE);o=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=r7(i,rG(t));o=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=iz(n);if(".priority"===h){H(1===i$(n),"Can't have a priority with additional path components");let r=a.getNode(),s=st(i,n,r,l=t.serverCache.getNode());o=null!=s?e.filter.updatePriority(r,s):a.getNode()}else{let u,c=iH(n);if(a.isCompleteForChild(h)){l=t.serverCache.getNode();let e=st(i,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(c,e):a.getNode().getImmediateChild(h)}else u=si(i,h,t.serverCache);o=null!=u?e.filter.updateChild(a.getNode(),h,u,c,r,s):a.getNode()}}return rH(t,o,a.isFullyInitialized()||iY(n),e.filter.filtersNodes())}}function su(e,t,n,i,r,s,a,o){let l,h=t.serverCache,u=a?e.filter:e.filter.getIndexedFilter();if(iY(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=iz(n);if(!h.isCompleteForPath(n)&&i$(n)>1)return t;let r=iH(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,so,null)}let c=rW(t,l,h.isFullyInitialized()||iY(n),u.filtersNodes()),d=new sl(r,c,s);return sh(e,c,n,r,d,o)}function sc(e,t,n,i,r,s,a){let o,l,h=t.eventCache,u=new sl(r,t,s);if(iY(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,a),o=rH(t,l,!0,e.filter.filtersNodes());else{let r=iz(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),o=rH(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=iH(n),c=h.getNode().getImmediateChild(r);if(iY(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===iW(l)&&e.getChild(iG(l)).isEmpty()?e:e.updateChild(l,i):rf.EMPTY_NODE}o=c.equals(s)?t:rH(t,e.filter.updateChild(h.getNode(),r,s,l,u,a),h.isFullyInitialized(),e.filter.filtersNodes())}}return o}function sd(e,t){return e.eventCache.isCompleteForChild(t)}function sf(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function sp(e,t,n,i,r,s,a,o){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=iY(n)?i:new rQ(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=sf(e,t.serverCache.getNode().getImmediateChild(n),i);h=su(e,h,new iq(n),l,r,s,a,o)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=sf(e,t.serverCache.getNode().getImmediateChild(n),i);h=su(e,h,new iq(n),l,r,s,a,o)}}),h}class sg{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new rT(n.getIndex()),r=function(e){return e.loadsAllData()?new rT(e.getIndex()):e.hasLimit()?new rI(e):new rE(e)}(n);this.processor_={filter:r};const s=t.serverCache,a=t.eventCache,o=i.updateFullNode(rf.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(rf.EMPTY_NODE,a.getNode(),null),h=new rq(o,s.isFullyInitialized(),i.filtersNodes()),u=new rq(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=r$(u,h),this.eventGenerator_=new rB(this.query_)}get query(){return this.query_}}function sm(e){return 0===e.eventRegistrations_.length}function sy(e,t,n){let i=[];if(n){H(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function s_(e,t,n,i){var r,s;t.type===N.MERGE&&null!==t.source.queryId&&(H(rG(e.viewCache_),"We should always have a full cache before handling merges"),H(rK(e.viewCache_),"Missing event cache, even though we have a server cache"));let a=e.viewCache_,o=function(e,t,n,i,r){var s,a,o,l,h,u,c,d,f,p,g,m;let y,_,v=new sa;if(n.type===N.OVERWRITE)n.source.fromUser?y=sc(e,t,n.path,n.snap,i,r,v):(H(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered()&&!iY(n.path),y=su(e,t,n.path,n.snap,i,r,_,v));else if(n.type===N.MERGE){let d;n.source.fromUser?(s=e,a=t,o=n.path,l=n.children,h=i,u=r,c=v,d=a,l.foreach((e,t)=>{let n=iQ(o,e);sd(a,iz(n))&&(d=sc(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=iQ(o,e);sd(a,iz(n))||(d=sc(s,d,n,t,h,u,c))}),y=d):(H(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered(),y=sp(e,t,n.path,n.children,i,r,_,v))}else if(n.type===N.ACK_USER_WRITE)y=n.revert?function(e,t,n,i,r,s){let a;if(null!=sn(i,n))return t;{let o,l=new sl(i,t,r),h=t.eventCache.getNode();if(iY(n)||".priority"===iz(n)){let n;if(t.serverCache.isFullyInitialized())n=r7(i,rG(t));else{let e=t.serverCache.getNode();H(e instanceof rf,"serverChildren would be complete if leaf node"),n=se(i,e)}o=e.filter.updateFullNode(h,n,s)}else{let r=iz(n),u=si(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(o=null!=u?e.filter.updateChild(h,r,u,iH(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,rf.EMPTY_NODE,iH(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=r7(i,rG(t))).isLeafNode()&&(o=e.filter.updateFullNode(o,a,s))}return a=t.serverCache.isFullyInitialized()||null!=sn(i,iB()),rH(t,o,a,e.filter.filtersNodes())}}(e,t,n.path,i,r,v):function(e,t,n,i,r,s,a){if(null!=sn(r,n))return t;let o=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(iY(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return su(e,t,n,l.getNode().getChild(n),r,s,o,a);else{if(!iY(n))return t;let i=new rQ(null);return l.getNode().forEachChild(i9,(e,t)=>{i=i.set(new iq(e),t)}),sp(e,t,n,i,r,s,o,a)}{let h=new rQ(null);return i.foreach((e,t)=>{let i=iQ(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),sp(e,t,n,h,r,s,o,a)}}(e,t,n.path,n.affectedTree,i,r,v);else if(n.type===N.LISTEN_COMPLETE){let r;d=e,f=t,p=n.path,g=i,m=v,r=f.serverCache,y=sh(d,rW(f,r.getNode(),r.isFullyInitialized()||iY(p),r.isFiltered()),p,g,so,m)}else throw W("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=rK(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(r_(rK(t)))}}(t,y,w),{viewCache:y,changes:w}}(e.processor_,a,t,n,i);return r=e.processor_,H((s=o.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),H(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),H(o.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,sv(e,o.changes,o.viewCache.eventCache.getNode(),null)}function sv(e,t,n,i){var r;let s,a,o=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],a=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),rz(r,s,"child_removed",t,o,n),rz(r,s,"child_added",t,o,n),rz(r,s,"child_moved",a,o,n),rz(r,s,"child_changed",t,o,n),rz(r,s,"value",t,o,n),s}class sw{constructor(){this.views=new Map}}function sb(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return H(null!=s,"SyncTree gave us an op for an invalid query."),s_(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(s_(s,t,n,i));return r}}function sT(e,t,n,i,r){let s=t._queryIdentifier,a=e.views.get(s);if(!a){let e=r7(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof rf?se(n,i):rf.EMPTY_NODE,s=!1),new sg(t,r$(new rq(e,s,!1),new rq(i,r,!1)))}return a}function sE(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function sI(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=rG(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!iY(t)&&!n.getImmediateChild(iz(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function sC(e,t){if(t._queryParams.loadsAllData())return sk(e);{let n=t._queryIdentifier;return e.views.get(n)}}function sS(e){return null!=sk(e)}function sk(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let sA=1;class sN{constructor(e){this.listenProvider_=e,this.syncPointTree_=new rQ(null),this.pendingWriteTree_={visibleWrites:rY.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function sR(e,t,n,i,r){var s,a;return(s=e.pendingWriteTree_,a=r,H(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===a&&(a=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:a}),a&&(s.visibleWrites=rJ(s.visibleWrites,t,n)),s.lastWriteId=i,r)?sM(e,new rV(rO(),t,n)):[]}function sP(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);H(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,a=!1,o=e.allWrites.length-1;for(;s&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=i&&function(e,t){if(e.snap)return iZ(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&iZ(iQ(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:iZ(r.path,t.path)&&(a=!0)),o--}return!!s&&(a?((n=e).visibleWrites=r8(n.allWrites,r4,iB()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=rZ(e.visibleWrites,r.path):ic(r.children,t=>{e.visibleWrites=rZ(e.visibleWrites,iQ(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new rQ(null);return null!=i.snap?t=t.set(iB(),!0):ic(i.children,e=>{t=t.set(new iq(e),!0)}),sM(e,new rF(i.path,t,n))}}function sx(e,t,n){return sM(e,new rV(rL(),t,n))}function sD(e,t,n,i,r=!1){let s=t._path,a=e.syncPointTree_.get(s),o=[];if(a&&("default"===t._queryIdentifier||null!=sC(a,t))){let u=function(e,t,n,i){let r=t._queryIdentifier,s=[],a=[],o=sS(e);if("default"===r)for(let[t,r]of e.views.entries())a=a.concat(sy(r,n,i)),sm(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(a=a.concat(sy(t,n,i)),sm(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return o&&!sS(e)&&s.push(new(H(g,"Reference.ts has not been loaded"),g)(t._repo,t._path)),{removed:s,events:a}}(a,t,n,i);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let c=u.removed;if(o=u.events,!r){let n=-1!==c.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>sS(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&sS(t))return[sk(t)];{let e=[];return t&&(e=sE(t)),ic(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=sF(e,i);e.listenProvider_.startListening(sz(r),sU(e,r),s.hashFn,s.onComplete)}}}r||!(c.length>0)||i||(n?e.listenProvider_.stopListening(sz(t),null):c.forEach(t=>{let n=e.queryToTagMap.get(sV(t));e.listenProvider_.stopListening(sz(t),n)}))}var l=e,h=c;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=sV(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return o}function sO(e,t,n,i){let r=sj(e,i);if(null==r)return[];{let i=sq(r),s=i.path,a=i.queryId,o=iJ(s,t);return sB(e,s,new rV(rM(a),o,n))}}function sL(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=sI(n,iJ(e,t));if(i)return i});return r9(i,t,r,n,!0)}function sM(e,t){var n;return function e(t,n,i,r){if(iY(t.path))return function e(t,n,i,r){let s=n.get(iB());null==i&&null!=s&&(i=sI(s,iB()));let a=[];return n.children.inorderTraversal((n,s)=>{let o=i?i.getImmediateChild(n):null,l=sr(r,n),h=t.operationForChild(n);h&&(a=a.concat(e(h,s,o,l)))}),s&&(a=a.concat(sb(s,t,r,i))),a}(t,n,i,r);{let s=n.get(iB());null==i&&null!=s&&(i=sI(s,iB()));let a=[],o=iz(t.path),l=t.operationForChild(o),h=n.children.get(o);if(h&&l){let t=i?i.getImmediateChild(o):null,n=sr(r,o);a=a.concat(e(l,h,t,n))}return s&&(a=a.concat(sb(s,t,r,i))),a}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,ss(iB(),n)))}function sF(e,t){let n=t.query,i=sU(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||rf.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=sj(e,n);if(!i)return[];{let n=sq(i),r=n.path,s=n.queryId,a=iJ(r,t);return sB(e,r,new rU(rM(s),a))}}(e,n._path,i);else return r=n._path,sM(e,new rU(rL(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return sD(e,n,null,s)}}}}function sU(e,t){let n=sV(t);return e.queryToTagMap.get(n)}function sV(e){return e._path.toString()+"$"+e._queryIdentifier}function sj(e,t){return e.tagToQueryMap.get(t)}function sq(e){let t=e.indexOf("$");return H(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new iq(e.substr(0,t))}}function sB(e,t,n){let i=e.syncPointTree_.get(t);return H(i,"Missing sync point for query tag that we're tracking"),sb(i,n,ss(t,e.pendingWriteTree_),null)}function sz(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(H(m,"Reference.ts has not been loaded"),m)(e._repo,e._path):e}class s${constructor(e){this.node_=e}getImmediateChild(e){return new s$(this.node_.getImmediateChild(e))}node(){return this.node_}}class sH{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=iQ(this.path_,e);return new sH(this.syncTree_,t)}node(){return sL(this.syncTree_,this.path_)}}let sW=function(e,t,n){return e&&"object"==typeof e?(H(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?sK(e[".sv"],t,n):"object"==typeof e[".sv"]?sG(e[".sv"],t):void H(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},sK=function(e,t,n){if("timestamp"===e)return n.timestamp;H(!1,"Unexpected server value: "+e)},sG=function(e,t,n){e.hasOwnProperty("increment")||H(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&H(!1,"Unexpected increment value: "+i);let r=t.node();if(H(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},sQ=function(e,t,n){return sY(e,new s$(t),n)};function sY(e,t,n){let i,r=sW(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new ra(r))),e.forEachChild(ro,(e,r)=>{let s=sY(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=sW(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new ra(i,rg(r)):e}}class sJ{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function sX(e,t){let n=t instanceof iq?t:new iq(t),i=e,r=iz(n);for(;null!==r;){let e=eC(i.node.children,r)||{children:{},childCount:0};i=new sJ(r,i,e),r=iz(n=iH(n))}return i}function sZ(e){return e.node.value}function s0(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===sZ(i)&&!s1(i),s=eI(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function s1(e){return e.node.childCount>0}function s2(e,t){ic(e.node.children,(n,i)=>{t(new sJ(n,e,i))})}function s3(e){return new iq(null===e.parent?e.name:s3(e.parent)+"/"+e.name)}let s6=/[\[\].#$\/\u0000-\u001F\u007F]/,s5=/[\[\].#$\u0000-\u001F\u007F]/,s4=function(e){return"string"==typeof e&&0!==e.length&&!s6.test(e)},s8=function(e){return"string"==typeof e&&0!==e.length&&!s5.test(e)},s9=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!it(e)||e&&"object"==typeof e&&eI(e,".sv")},s7=function(e,t,n,i){i&&void 0===t||ae(eM(e,"value"),t,n)},ae=function(e,t,n){let i=n instanceof iq?new i0(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+i2(i));if("function"==typeof t)throw Error(e+"contains a function "+i2(i)+" with contents = "+t.toString());if(it(t))throw Error(e+"contains "+t.toString()+" "+i2(i));if("string"==typeof t&&t.length>3495253.3333333335&&eU(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+i2(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(ic(t,(t,s)=>{let a;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!s4(t)))throw Error(e+" contains an invalid key ("+t+") "+i2(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eU(t),i1(i),ae(e,s,i),a=i.parts_.pop(),i.byteLength_-=eU(a),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+i2(i)+" in addition to actual children.")}},at=function(e,t,n,i){if((!i||void 0!==n)&&!s4(n))throw Error(eM(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},an=function(e,t,n,i){if((!i||void 0!==n)&&!s8(n))throw Error(eM(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ai=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),an(e,t,n,i)},ar=function(e,t){if(".info"===iz(t))throw Error(e+" failed = Can't modify data under /.info/")},as=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!s4(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!s8(n)))throw Error(eM(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class aa{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ao(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||iX(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function al(e,t,n){ao(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();n2&&n5("event: "+n.toString()),im(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>iZ(e,t)||iZ(t,e))}class ah{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new aa,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=rR(),this.transactionQueueTree_=new sJ,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function au(e){let t=e.infoData_.getNode(new iq(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ac(e){var t;return(t=t={timestamp:au(e)}).timestamp=t.timestamp||new Date().getTime(),t}function ad(e,t,n,i,r){e.dataUpdateCount++;let s=new iq(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let a=[];if(r)if(i){let t=ek(n,e=>rg(e));a=function(e,t,n,i){let r=sj(e,i);if(!r)return[];{let i=sq(r),s=i.path,a=i.queryId,o=iJ(s,t),l=rQ.fromObject(n);return sB(e,s,new rj(rM(a),o,l))}}(e.serverSyncTree_,s,t,r)}else{let t=rg(n);a=sO(e.serverSyncTree_,s,t,r)}else if(i){var o;let t,i=ek(n,e=>rg(e));o=e.serverSyncTree_,t=rQ.fromObject(i),a=sM(o,new rj(rL(),s,t))}else{let t=rg(n);a=sx(e.serverSyncTree_,s,t)}let l=s;a.length>0&&(l=a_(e,s)),al(e.eventQueue_,l,a)}function af(e,t){var n;let i,r,s;ap(e,"connected",t),!1===t&&(am(n=e,"onDisconnectEvents"),i=ac(n),r=rR(),rP(n.onDisconnect_,iB(),(e,t)=>{var s;let a=(s=n.serverSyncTree_,sY(t,new sH(s,e),i));!function e(t,n,i){if(iY(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=iz(n);t.children.has(r)||t.children.set(r,rR()),e(t.children.get(r),n=iH(n),i)}}(r,e,a)}),s=[],rP(r,iB(),(e,t)=>{s=s.concat(sx(n.serverSyncTree_,e,t));let i=aT(n,e);a_(n,i)}),n.onDisconnect_=rR(),al(n.eventQueue_,iB(),s))}function ap(e,t,n){let i=new iq("/.info/"+t),r=rg(n);e.infoData_.updateSnapshot(i,r);let s=sx(e.infoSyncTree_,i,r);al(e.eventQueue_,i,s)}function ag(e){return e.nextWriteId_++}function am(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),n5(n,...t)}function ay(e,t,n){return sL(e.serverSyncTree_,t,n)||rf.EMPTY_NODE}function a_(e,t){let n=av(e,t),i=s3(n),r=aw(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let a=0;a<t.length;a++){let o=t[a],l=iJ(n,o.path),h=!1,u;if(H(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===o.status)h=!0,u=o.abortReason,r=r.concat(sP(e.serverSyncTree_,o.currentWriteId,!0));else if(0===o.status)if(o.retryCount>=25)h=!0,u="maxretry",r=r.concat(sP(e.serverSyncTree_,o.currentWriteId,!0));else{let n=ay(e,o.path,s);o.currentInputSnapshot=n;let i=t[a].update(n.val());if(void 0!==i){ae("transaction failed: Data returned ",i,o.path);let t=rg(i);"object"==typeof i&&null!=i&&eI(i,".priority")||(t=t.updatePriority(n.getPriority()));let a=o.currentWriteId,l=sQ(t,n,ac(e));o.currentOutputSnapshotRaw=t,o.currentOutputSnapshotResolved=l,o.currentWriteId=ag(e),s.splice(s.indexOf(a),1),r=(r=r.concat(sR(e.serverSyncTree_,o.path,l,o.currentWriteId,o.applyLocally))).concat(sP(e.serverSyncTree_,a,!0))}else h=!0,u="nodata",r=r.concat(sP(e.serverSyncTree_,o.currentWriteId,!0))}al(e.eventQueue_,n,r),r=[],h&&(t[a].status=2,setTimeout(t[a].unwatcher,Math.floor(0)),t[a].onComplete&&("nodata"===u?i.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):i.push(()=>t[a].onComplete(Error(u),!1,null))))}ab(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)im(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||ab(t,n),sZ(n)){let i=aw(t,n);H(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=ay(t,n,i.map(e=>e.currentWriteId)),s=r,a=r.hash();for(let e=0;e<i.length;e++){let t=i[e];H(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=iJ(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let o=s.val(!0);t.server_.put(n.toString(),o,r=>{am(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(sP(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();ab(t,sX(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),al(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)im(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{n7("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}a_(t,n)}},a)}(t,s3(n),i)}else s1(n)&&s2(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function av(e,t){let n,i=e.transactionQueueTree_;for(n=iz(t);null!==n&&void 0===sZ(i);)i=sX(i,n),n=iz(t=iH(t));return i}function aw(e,t){let n=[];return function e(t,n,i){let r=sZ(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);s2(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function ab(e,t){let n=sZ(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,s0(t,n.length>0?n:void 0)}s2(t,t=>{ab(e,t)})}function aT(e,t){let n=s3(av(e,t)),i=sX(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{aE(e,t)}),aE(e,i),!function e(t,n,i,r){i&&!r&&n(t),s2(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{aE(e,t)}),n}function aE(e,t){let n=sZ(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(H(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(H(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(sP(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?s0(t,void 0):n.length=s+1,al(e.eventQueue_,s3(t),r);for(let e=0;e<i.length;e++)im(i[e])}}let aI=function(e,t){let n=aC(e),i=n.namespace;"firebase.com"===n.domain&&n9(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||n9("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||ie();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new iI(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new iq(n.pathString)}},aC=function(e){let t="",n="",i="",r="",s="",a=!0,o="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(o=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):n7(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(a="https"===o||"wss"===o,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:a,scheme:o,pathString:r,namespace:s}},aS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ak=(T=0,E=[],function(e){let t,n=e===T;T=e;let i=Array(8);for(t=7;t>=0;t--)i[t]=aS.charAt(e%64),e=Math.floor(e/64);H(0===e,"Cannot push at time == 0");let r=i.join("");if(n){for(t=11;t>=0&&63===E[t];t--)E[t]=0;E[t]++}else for(t=0;t<12;t++)E[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)r+=aS.charAt(E[t]);return H(20===r.length,"nextPushId: Length should be 20."),r});class aA{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ew(this.snapshot.exportVal())}}class aN{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class aR{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return H(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class aP{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return iY(this._path)?null:iW(this._path)}get ref(){return new aO(this._repo,this._path)}get _queryIdentifier(){let e=ih(rk(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return rk(this._queryParams)}isEqual(e){if(!((e=ej(e))instanceof aP))return!1;let t=this._repo===e._repo,n=iX(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function ax(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===i9){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==ir)throw Error(i);if("string"!=typeof t)throw Error(r)}if(e.hasEnd()){if(e.getIndexEndName()!==is)throw Error(i);if("string"!=typeof n)throw Error(r)}}else if(e.getIndex()===ro){if(null!=t&&!s9(t)||null!=n&&!s9(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(H(e.getIndex()instanceof rm||e.getIndex()===ry,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function aD(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class aO extends aP{constructor(e,t){super(e,t,new rC,!1)}get parent(){let e=iG(this._path);return null===e?null:new aO(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class aL{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new iq(e),n=aF(this.ref,e);return new aL(this._node.getChild(t),n,ro)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new aL(n,aF(this.ref,t),ro)))}hasChild(e){let t=new iq(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function aM(e,t){return(e=ej(e))._checkNotDeleted("ref"),void 0!==t?aF(e._root,t):e._root}function aF(e,t){return null===iz((e=ej(e))._path)?ai("child","path",t,!1):an("child","path",t,!1),new aO(e._repo,iQ(e._path,t))}function aU(e,t){let n;ar("push",(e=ej(e))._path),s7("push",t,e._path,!0);let i=ak(au(e._repo)),r=aF(e,i),s=aF(e,i);return r.then=(n=null!=t?aV(s,t).then(()=>s):Promise.resolve(s)).then.bind(n),r.catch=n.then.bind(n,void 0),r}function aV(e,t){var n,i,r;let s,a,o,l,h,u;ar("set",(e=ej(e))._path),s7("set",t,e._path,!1);let c=new es;return n=e._repo,i=e._path,r=c.wrapCallback(()=>{}),am(n,"set",{path:i.toString(),value:t,priority:null}),s=ac(n),o=sQ(a=rg(t,null),sL(n.serverSyncTree_,i),s),l=ag(n),h=sR(n.serverSyncTree_,i,o,l,!0),ao(n.eventQueue_,h),n.server_.put(i.toString(),a.val(!0),(e,t)=>{var s,a,o;let h="ok"===e;h||n7("set at "+i+" failed: "+e);let u=sP(n.serverSyncTree_,l,!h);al(n.eventQueue_,i,u),s=r,a=e,o=t,s&&im(()=>{if("ok"===a)s(null);else{let e=(a||"error").toUpperCase(),t=e;o&&(t+=": "+o);let n=Error(t);n.code=e,s(n)}})}),u=aT(n,i),a_(n,u),al(n.eventQueue_,u,[]),c.promise}function aj(e){var t,n,i,r,s;let a,o,l,h,u,c,d;e=ej(e);let f=new aq(new aR(()=>{}));return(t=e._repo,n=e,i=t.serverSyncTree_,o=(r=n)._path,l=null,i.syncPointTree_.foreachOnPath(o,(e,t)=>{let n=iJ(e,o);l=l||sI(t,n)}),(h=i.syncPointTree_.get(o))?l=l||sI(h,iB()):(h=new sw,i.syncPointTree_=i.syncPointTree_.set(o,h)),c=(u=null!=l)?new rq(l,!0,!1):null,d=(s=i.pendingWriteTree_,ss(r._path,s)),null!=(a=rK(sT(h,r,d,u?c.getNode():rf.EMPTY_NODE,u).viewCache_))?Promise.resolve(a):t.server_.get(n).then(e=>{let i,r=rg(e).withIndex(n._queryParams.getIndex());if(!function(e,t,n,i=!1){var r;let s,a,o,l,h=t._path,u=null,c=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=iJ(e,h);u=u||sI(t,n),c=c||sS(t)});let d=e.syncPointTree_.get(h);d?(c=c||sS(d),u=u||sI(d,iB())):(d=new sw,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=u?s=!0:(s=!1,u=rf.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=sI(t,iB());n&&(u=u.updateImmediateChild(e,n))}));let f=null!=sC(d,t);if(!f&&!t._queryParams.loadsAllData()){let n=sV(t);H(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=sA++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let p=ss(h,e.pendingWriteTree_),g=(a=sT(r=d,t,p,u,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,a),a.eventRegistrations_.push(n),o=a.viewCache_.eventCache,l=[],o.getNode().isLeafNode()||o.getNode().forEachChild(ro,(e,t)=>{l.push(rv(e,t))}),o.isFullyInitialized()&&l.push(r_(o.getNode())),sv(a,l,o.getNode(),n));if(!f&&!c&&!i){let n=sC(d,t);g=g.concat(function(e,t,n){let i=t._path,r=sU(e,t),s=sF(e,n),a=e.listenProvider_.startListening(sz(t),r,s.hashFn,s.onComplete),o=e.syncPointTree_.subtree(i);if(r)H(!sS(o.value),"If we're adding a query, it shouldn't be shadowed");else{let t=o.fold((e,t,n)=>{if(!iY(e)&&t&&sS(t))return[sk(t).query];{let e=[];return t&&(e=e.concat(sE(t).map(e=>e.query))),ic(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(sz(i),sU(e,i))}}return a}(e,t,n))}}(t.serverSyncTree_,n,f,!0),n._queryParams.loadsAllData())i=sx(t.serverSyncTree_,n._path,r);else{let e=sU(t.serverSyncTree_,n);i=sO(t.serverSyncTree_,n._path,r,e)}return al(t.eventQueue_,n._path,i),sD(t.serverSyncTree_,n,f,null,!0),r},e=>(am(t,"get for query "+ew(n)+" failed: "+e),Promise.reject(Error(e))))).then(t=>new aL(t,new aO(e._repo,e._path),e._queryParams.getIndex()))}class aq{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new aA("value",this,new aL(e.snapshotNode,new aO(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new aN(this,e,t):null}matches(e){return e instanceof aq&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class aB{}class az extends aB{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){var t,n,i;let r;s7("endAt",this._value,e._path,!0);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.copy()).endSet_=!0,void 0===n&&(n=null),r.indexEndValue_=n,void 0!==i?(r.endNameSet_=!0,r.indexEndName_=i):(r.endNameSet_=!1,r.indexEndName_=""),r);if(aD(s),ax(s),e._queryParams.hasEnd())throw Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new aP(e._repo,e._path,s,e._orderByCalled)}}class a$ extends aB{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){var t,n,i;let r;s7("startAt",this._value,e._path,!0);let s=(t=e._queryParams,n=this._value,i=this._key,(r=t.copy()).startSet_=!0,void 0===n&&(n=null),r.indexStartValue_=n,null!=i?(r.startNameSet_=!0,r.indexStartName_=i):(r.startNameSet_=!1,r.indexStartName_=""),r);if(aD(s),ax(s),e._queryParams.hasStart())throw Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new aP(e._repo,e._path,s,e._orderByCalled)}}class aH extends aB{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){var t;let n;if(!0===e._orderByCalled)throw Error("orderByChild: You can't combine multiple orderBy calls.");let i=new iq(this._path);if(iY(i))throw Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let r=new rm(i),s=(t=e._queryParams,(n=t.copy()).index_=r,n);return ax(s),new aP(e._repo,e._path,s,!0)}}function aW(e){if("$key"===e)throw Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return an("orderByChild","path",e,!1),new aH(e)}class aK extends aB{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(s7("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new az(this._value,this._key)._apply(new a$(this._value,this._key)._apply(e))}}function aG(e,t){return at("equalTo","key",t,!0),new aK(e,t)}function aQ(e,...t){let n=ej(e);for(let e of t)n=e._apply(n);return n}H(!g,"__referenceConstructor has already been defined"),g=aO,H(!m,"__referenceConstructor has already been defined"),m=aO;let aY={};class aJ{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=iN(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new rA(e.repoInfo_,(t,n,i,r)=>{ad(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>af(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ew(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new i6(e.repoInfo_,t,(t,n,i,r)=>{ad(e,t,n,i,r)},t=>{af(e,t)},t=>{var n;n=e,ic(t,(e,t)=>{ap(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,iA[r=i.toString()]||(iA[r]=(()=>new rD(e.stats_,e.server_))()),e.statsReporter_=iA[r],e.infoData_=new rN,e.infoSyncTree_=new sN({startListening:(t,n,i,r)=>{let s=[],a=e.infoData_.getNode(t._path);return a.isEmpty()||(s=sx(e.infoSyncTree_,t._path,a),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),ap(e,"connected",!1),e.serverSyncTree_=new sN({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);al(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new aO(this._repo,iB())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=aY[t=this.app.name])&&n[e.key]===e||n9(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&n9("Cannot call "+e+" on a deleted database.")}}function aX(e=tS(),t){let n=tp(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=en("database");e&&function(e,t,n,i={}){var r;let s,a,o;(e=ej(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eA(i,h.repoInfo_.emulatorOptions))return;n9("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&n9('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new iw(iw.OWNER)):i.mockUserToken&&(s=new iw("string"==typeof i.mockUserToken?i.mockUserToken:ea(i.mockUserToken,e.app.options.projectId))),eq(t)&&eB(t),r=s,a=l.lastIndexOf(":"),o=eq(l.substring(0,a)),h.repoInfo_=new iI(l,o,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}(n,...e)}return n}i6.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},i6.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},nW=tE,tf(new ez("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let a,o,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),g=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||n9("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),n5("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=aI(l,void 0)).repoInfo,void 0!==$.default&&$.default.env&&(c=$.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=aI(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new iv(f.name,f.options,p),as("Invalid Firebase Database URL",h),iY(h.path)||n9("Database URL must point to the root of a Firebase Database (not including a child path)."),new aJ((n=u,i=f,r=d,s=new i_(f,g),(a=aY[i.name])||(a={},aY[i.name]=a),(o=a[n.toURLString()])&&n9("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new ah(n,!1,r,s),a[n.toURLString()]=o,o),f)},"PUBLIC").setMultipleInstances(!0)),tN(n$,nH,void 0),tN(n$,nH,"esm2017"),e.s(["equalTo",()=>aG,"get",()=>aj,"getDatabase",()=>aX,"orderByChild",()=>aW,"push",()=>aU,"query",()=>aQ,"ref",()=>aM,"set",()=>aV],16649),e.s([],62069);function aZ(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}function a0(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}"function"==typeof SuppressedError&&SuppressedError;let a1=new ey("auth","Firebase",a0()),a2=new eX("@firebase/auth");function a3(e,...t){a2.logLevel<=A.ERROR&&a2.error(`Auth (${tE}): ${e}`,...t)}function a6(e,...t){throw a7(e,...t)}function a5(e,...t){return a7(e,...t)}function a4(e,t,n){return new ey("auth","Firebase",Object.assign(Object.assign({},a0()),{[t]:n})).create(t,{appName:e.name})}function a8(e){return a4(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function a9(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&a6(e,"argument-error"),a4(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function a7(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return a1.create(e,...t)}function oe(e,t,...n){if(!e)throw a7(t,...n)}function ot(e){let t="INTERNAL ASSERTION FAILED: "+e;throw a3(t),Error(t)}function on(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function oi(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}class or{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||ot(n),this.isMobile=el()||ec()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===oi()||"https:"===oi()||eu()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function os(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||ot(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class oa{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void ot("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void ot("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void ot("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let oo={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},ol=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],oh=new or(3e4,6e4);function ou(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function oc(e,t,n,i,r={}){return od(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let a=eR(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:o},r);return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&eq(e.emulatorConfig.host)&&(l.credentials="include"),oa.fetch()(await op(e,e.config.apiHost,n,a),l)})}async function od(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},oo),t);try{let t=new og(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw om(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw om(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw om(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw om(e,"user-disabled",s);let a=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw a4(e,a,n);a6(e,a)}}catch(t){if(t instanceof em)throw t;a6(e,"network-request-failed",{message:String(t)})}}async function of(e,t,n,i,r={}){let s=await oc(e,t,n,i,r);return"mfaPendingCredential"in s&&a6(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function op(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?os(e.config,r):`${e.config.apiScheme}://${r}`;return ol.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class og{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(a5(this.auth,"network-request-failed")),oh.get())})}}function om(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=a5(e,t,i);return r.customData._tokenResponse=n,r}function oy(e){return void 0!==e&&void 0!==e.enterprise}class o_{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function ov(e,t){return oc(e,"GET","/v2/recaptchaConfig",ou(e,t))}async function ow(e,t){return oc(e,"POST","/v1/accounts:delete",t)}async function ob(e,t){return oc(e,"POST","/v1/accounts:lookup",t)}function oT(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function oE(e,t=!1){return ej(e).getIdToken(t)}async function oI(e,t=!1){let n=ej(e),i=await n.getIdToken(t),r=oS(i);oe(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:oT(oC(r.auth_time)),issuedAtTime:oT(oC(r.iat)),expirationTime:oT(oC(r.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function oC(e){return 1e3*Number(e)}function oS(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return a3("JWT malformed, contained fewer than 3 sections"),null;try{let e=Z(n);if(!e)return a3("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return a3("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function ok(e){let t=oS(e);return oe(t,"internal-error"),oe(void 0!==t.exp,"internal-error"),oe(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function oA(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof em&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class oN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class oR{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=oT(this.lastLoginAt),this.creationTime=oT(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function oP(e){var t,n,i;let r=e.auth,s=await e.getIdToken(),a=await oA(e,ob(r,{idToken:s}));oe(null==a?void 0:a.users.length,r,"internal-error");let o=a.users[0];e._notifyReloadListener(o);let l=(null==(t=o.providerUserInfo)?void 0:t.length)?oD(o.providerUserInfo):[],h=(n=e.providerData,i=l,[...n.filter(e=>!i.some(t=>t.providerId===e.providerId)),...i]),u=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!(null==h?void 0:h.length);Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:h,metadata:new oR(o.createdAt,o.lastLoginAt),isAnonymous:!!u&&c})}async function ox(e){let t=ej(e);await oP(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function oD(e){return e.map(e=>{var{providerId:t}=e,n=aZ(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function oO(e,t){let n=await od(e,{},async()=>{let n=eR({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await op(e,i,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",oa.fetch()(s,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function oL(e,t){return oc(e,"POST","/v2/accounts:revokeToken",ou(e,t))}class oM{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){oe(e.idToken,"internal-error"),oe(void 0!==e.idToken,"internal-error"),oe(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ok(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){oe(0!==e.length,"internal-error");let t=ok(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(oe(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await oO(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new oM;return n&&(oe("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(oe("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(oe("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new oM,this.toJSON())}_performRefresh(){return ot("not implemented")}}function oF(e,t){oe("string"==typeof e||void 0===e,"internal-error",{appName:t})}class oU{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=aZ(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new oN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new oR(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await oA(this,this.stsTokenManager.getToken(this.auth,e));return oe(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return oI(this,e)}reload(){return ox(this)}_assign(e){this!==e&&(oe(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new oU(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){oe(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await oP(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ty(this.auth.app))return Promise.reject(a8(this.auth));let e=await this.getIdToken();return await oA(this,ow(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,a,o,l,h;let u=null!=(n=t.displayName)?n:void 0,c=null!=(i=t.email)?i:void 0,d=null!=(r=t.phoneNumber)?r:void 0,f=null!=(s=t.photoURL)?s:void 0,p=null!=(a=t.tenantId)?a:void 0,g=null!=(o=t._redirectEventId)?o:void 0,m=null!=(l=t.createdAt)?l:void 0,y=null!=(h=t.lastLoginAt)?h:void 0,{uid:_,emailVerified:v,isAnonymous:w,providerData:b,stsTokenManager:T}=t;oe(_&&T,e,"internal-error");let E=oM.fromJSON(this.name,T);oe("string"==typeof _,e,"internal-error"),oF(u,e.name),oF(c,e.name),oe("boolean"==typeof v,e,"internal-error"),oe("boolean"==typeof w,e,"internal-error"),oF(d,e.name),oF(f,e.name),oF(p,e.name),oF(g,e.name),oF(m,e.name),oF(y,e.name);let I=new oU({uid:_,auth:e,email:c,emailVerified:v,displayName:u,isAnonymous:w,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return b&&Array.isArray(b)&&(I.providerData=b.map(e=>Object.assign({},e))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(e,t,n=!1){let i=new oM;i.updateFromServerResponse(t);let r=new oU({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await oP(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];oe(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?oD(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length),a=new oM;a.updateFromIdToken(n);let o=new oU({uid:i.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new oR(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length)}),o}}let oV=new Map;function oj(e){var t,n;t="Expected a class definition",e instanceof Function||ot(t);let i=oV.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||ot(n)):(i=new e,oV.set(e,i)),i}class oq{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function oB(e,t,n){return`firebase:${e}:${t}:${n}`}oq.type="NONE";class oz{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=oB(this.userKey,i.apiKey,r),this.fullPersistenceKey=oB("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await ob(this.auth,{idToken:e}).catch(()=>void 0);return t?oU._fromGetAccountInfoResponse(this.auth,t,e):null}return oU._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new oz(oj(oq),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||oj(oq),s=oB(n,e.config.apiKey,e.name),a=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await ob(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await oU._fromGetAccountInfoResponse(e,n,t)}else i=oU._fromJSON(e,t);n!==r&&(a=i),r=n;break}}catch(e){}let o=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&o.length&&(r=o[0],a&&await r._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new oz(r,e,n)}}function o$(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(oG(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(oH(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(oY(t))return"Blackberry";if(oJ(t))return"Webos";if(oW(t))return"Safari";if((t.includes("chrome/")||oK(t))&&!t.includes("edge/"))return"Chrome";if(oQ(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function oH(e=eo()){return/firefox\//i.test(e)}function oW(e=eo()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oK(e=eo()){return/crios\//i.test(e)}function oG(e=eo()){return/iemobile/i.test(e)}function oQ(e=eo()){return/android/i.test(e)}function oY(e=eo()){return/blackberry/i.test(e)}function oJ(e=eo()){return/webos/i.test(e)}function oX(e=eo()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function oZ(e=eo()){return oX(e)||oQ(e)||oJ(e)||oY(e)||/windows phone/i.test(e)||oG(e)}function o0(e,t=[]){let n;switch(e){case"Browser":n=o$(eo());break;case"Worker":n=`${o$(eo())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tE}/${i}`}class o1{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function o2(e,t={}){return oc(e,"GET","/v2/passwordPolicy",ou(e,t))}class o3{constructor(e){var t,n,i,r;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(i=null==(n=e.allowedNonAlphanumericCharacters)?void 0:n.join(""))?i:"",this.forceUpgradeOnSignin=null!=(r=e.forceUpgradeOnSignin)&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(n=o.meetsMaxPasswordLength)||n),o.isValid&&(o.isValid=null==(i=o.containsLowercaseLetter)||i),o.isValid&&(o.isValid=null==(r=o.containsUppercaseLetter)||r),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class o6{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new o5(this),this.idTokenSubscription=new o5(this),this.beforeStateQueue=new o1(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=a1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=oj(t)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted){if(this.persistenceManager=await oz.create(this,e),null==(n=this._resolvePersistenceManagerAvailable)||n.call(this),!this._deleted){if(null==(i=this._popupRedirectResolver)?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await ob(this,{idToken:e}),n=await oU._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(ty(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),i=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==i?void 0:i._redirectEventId,a=await this.tryRedirectSignIn(e);(!n||n===s)&&(null==a?void 0:a.user)&&(i=a.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return(oe(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId)?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await oP(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ty(this.app))return Promise.reject(a8(this));let t=e?ej(e):null;return t&&oe(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&oe(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ty(this.app)?Promise.reject(a8(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ty(this.app)?Promise.reject(a8(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(oj(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new o3(await o2(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ey("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await oL(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&oj(e)||this._popupRedirectResolver;oe(t,this,"argument-error"),this.redirectPersistenceManager=await oz.create(this,[oj(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(n=this.redirectUser)?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(oe(a,this,"internal-error"),a.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return oe(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=o0(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(ty(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){a2.logLevel<=A.WARN&&a2.warn(`Auth (${tE}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}class o5{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eO(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return oe(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let o4={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function o8(e){return`__${e}${Math.floor(1e6*Math.random())}`}class o9{constructor(){this.enterprise=new o7}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class o7{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let le="NO_RECAPTCHA";class lt{constructor(e){this.type="recaptcha-enterprise",this.auth=ej(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{ov(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new o_(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;oy(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(le)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new o9().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&oy(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=o4.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,o4.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function ln(e,t,n,i=!1,r=!1){let s,a=new lt(e);if(r)s=le;else try{s=await a.verify(n)}catch(e){s=await a.verify(n,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function li(e,t,n,i,r){var s,a;if("EMAIL_PASSWORD_PROVIDER"===r)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await ln(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await ln(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let r=await ln(e,t,n);return i(e,r).catch(async r=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await ln(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await ln(e,t,n,!1,!0);return i(e,r)}}async function lr(e){let t=ej(e),n=new o_(await ov(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new lt(t).verify()}function ls(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function la(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class lo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return ot("not implemented")}_getIdTokenResponse(e){return ot("not implemented")}_linkToIdToken(e,t){return ot("not implemented")}_getReauthenticationResolver(e){return ot("not implemented")}}async function ll(e,t){return oc(e,"POST","/v1/accounts:signUp",t)}async function lh(e,t){return of(e,"POST","/v1/accounts:signInWithPassword",ou(e,t))}async function lu(e,t){return oc(e,"POST","/v1/accounts:sendOobCode",ou(e,t))}async function lc(e,t){return lu(e,t)}async function ld(e,t){return of(e,"POST","/v1/accounts:signInWithEmailLink",ou(e,t))}async function lf(e,t){return of(e,"POST","/v1/accounts:signInWithEmailLink",ou(e,t))}class lp extends lo{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new lp(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new lp(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return li(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",lh,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ld(e,{email:this._email,oobCode:this._password});default:a6(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return li(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ll,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return lf(e,{idToken:t,email:this._email,oobCode:this._password});default:a6(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function lg(e,t){return of(e,"POST","/v1/accounts:signInWithIdp",ou(e,t))}class lm extends lo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new lm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):a6("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=aZ(t,["providerId","signInMethod"]);if(!n||!i)return null;let s=new lm(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return lg(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,lg(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,lg(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eR(t)}return e}}async function ly(e,t){return oc(e,"POST","/v1/accounts:sendVerificationCode",ou(e,t))}async function l_(e,t){return of(e,"POST","/v1/accounts:signInWithPhoneNumber",ou(e,t))}async function lv(e,t){let n=await of(e,"POST","/v1/accounts:signInWithPhoneNumber",ou(e,t));if(n.temporaryProof)throw om(e,"account-exists-with-different-credential",n);return n}let lw={USER_NOT_FOUND:"user-not-found"};async function lb(e,t){return of(e,"POST","/v1/accounts:signInWithPhoneNumber",ou(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),lw)}class lT extends lo{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new lT({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new lT({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return l_(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return lv(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return lb(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new lT({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class lE{constructor(e){var t,n,i,r,s,a;const o=eP(ex(e)),l=null!=(t=o.apiKey)?t:null,h=null!=(n=o.oobCode)?n:null,u=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(i=o.mode)?i:null);oe(l&&h&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=h,this.continueUrl=null!=(r=o.continueUrl)?r:null,this.languageCode=null!=(s=o.lang)?s:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){let t,n,i,r=(n=(t=eP(ex(e)).link)?eP(ex(t)).deep_link_id:null,((i=eP(ex(e)).deep_link_id)?eP(ex(i)).link:null)||i||n||t||e);try{return new lE(r)}catch(e){return null}}}class lI{constructor(){this.providerId=lI.PROVIDER_ID}static credential(e,t){return lp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=lE.parseLink(t);return oe(n,"argument-error"),lp._fromEmailAndCode(e,n.code,n.tenantId)}}lI.PROVIDER_ID="password",lI.EMAIL_PASSWORD_SIGN_IN_METHOD="password",lI.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class lC{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class lS extends lC{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class lk extends lS{constructor(){super("facebook.com")}static credential(e){return lm._fromParams({providerId:lk.PROVIDER_ID,signInMethod:lk.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lk.credentialFromTaggedObject(e)}static credentialFromError(e){return lk.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lk.credential(e.oauthAccessToken)}catch(e){return null}}}lk.FACEBOOK_SIGN_IN_METHOD="facebook.com",lk.PROVIDER_ID="facebook.com";class lA extends lS{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return lm._fromParams({providerId:lA.PROVIDER_ID,signInMethod:lA.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return lA.credentialFromTaggedObject(e)}static credentialFromError(e){return lA.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return lA.credential(t,n)}catch(e){return null}}}lA.GOOGLE_SIGN_IN_METHOD="google.com",lA.PROVIDER_ID="google.com";class lN extends lS{constructor(){super("github.com")}static credential(e){return lm._fromParams({providerId:lN.PROVIDER_ID,signInMethod:lN.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return lN.credentialFromTaggedObject(e)}static credentialFromError(e){return lN.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return lN.credential(e.oauthAccessToken)}catch(e){return null}}}lN.GITHUB_SIGN_IN_METHOD="github.com",lN.PROVIDER_ID="github.com";class lR extends lS{constructor(){super("twitter.com")}static credential(e,t){return lm._fromParams({providerId:lR.PROVIDER_ID,signInMethod:lR.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return lR.credentialFromTaggedObject(e)}static credentialFromError(e){return lR.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return lR.credential(t,n)}catch(e){return null}}}async function lP(e,t){return of(e,"POST","/v1/accounts:signUp",ou(e,t))}lR.TWITTER_SIGN_IN_METHOD="twitter.com",lR.PROVIDER_ID="twitter.com";class lx{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new lx({user:await oU._fromIdTokenResponse(e,n,i),providerId:lD(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new lx({user:e,providerId:lD(n),_tokenResponse:n,operationType:t})}}function lD(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function lO(e){var t;if(ty(e.app))return Promise.reject(a8(e));let n=ej(e);if(await n._initializationPromise,null==(t=n.currentUser)?void 0:t.isAnonymous)return new lx({user:n.currentUser,providerId:null,operationType:"signIn"});let i=await lP(n,{returnSecureToken:!0}),r=await lx._fromIdTokenResponse(n,"signIn",i,!0);return await n._updateCurrentUser(r.user),r}class lL extends em{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,lL.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new lL(e,t,n,i)}}function lM(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw lL._fromErrorAndOperation(e,n,t,i);throw n})}async function lF(e,t,n=!1){let i=await oA(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return lx._forOperation(e,"link",i)}async function lU(e,t,n=!1){let{auth:i}=e;if(ty(i.app))return Promise.reject(a8(i));let r="reauthenticate";try{let s=await oA(e,lM(i,r,t,e),n);oe(s.idToken,i,"internal-error");let a=oS(s.idToken);oe(a,i,"internal-error");let{sub:o}=a;return oe(e.uid===o,i,"user-mismatch"),lx._forOperation(e,r,s)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&a6(i,"user-mismatch"),e}}async function lV(e,t,n=!1){if(ty(e.app))return Promise.reject(a8(e));let i="signIn",r=await lM(e,i,t),s=await lx._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}async function lj(e,t){return lV(ej(e),t)}class lq{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?lB._fromServerResponse(e,t):"totpInfo"in t?lz._fromServerResponse(e,t):a6(e,"internal-error")}}class lB extends lq{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new lB(t)}}class lz extends lq{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new lz(t)}}async function l$(e){let t=ej(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function lH(e,t,n){var i;let r=ej(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&(oe((null==(i=n.url)?void 0:i.length)>0,r,"invalid-continue-uri"),oe(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,r,"invalid-dynamic-link-domain"),oe(void 0===n.linkDomain||n.linkDomain.length>0,r,"invalid-hosting-link-domain"),s.continueUrl=n.url,s.dynamicLinkDomain=n.dynamicLinkDomain,s.linkDomain=n.linkDomain,s.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(oe(n.iOS.bundleId.length>0,r,"missing-ios-bundle-id"),s.iOSBundleId=n.iOS.bundleId),n.android&&(oe(n.android.packageName.length>0,r,"missing-android-pkg-name"),s.androidInstallApp=n.android.installApp,s.androidMinimumVersionCode=n.android.minimumVersion,s.androidPackageName=n.android.packageName)),await li(r,s,"getOobCode",lc,"EMAIL_PASSWORD_PROVIDER")}async function lW(e,t,n){if(ty(e.app))return Promise.reject(a8(e));let i=ej(e),r=li(i,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",lP,"EMAIL_PASSWORD_PROVIDER"),s=await r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&l$(e),t}),a=await lx._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(a.user),a}function lK(e,t,n){return ty(e.app)?Promise.reject(a8(e)):lj(ej(e),lI.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&l$(e),t})}function lG(e,t,n,i){return ej(e).onIdTokenChanged(t,n,i)}function lQ(e,t,n,i){return ej(e).onAuthStateChanged(t,n,i)}function lY(e){return ej(e).signOut()}function lJ(e,t){return oc(e,"POST","/v2/accounts/mfaEnrollment:start",ou(e,t))}new WeakMap;let lX="__sak";class lZ{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(lX,"1"),this.storage.removeItem(lX),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class l0 extends lZ{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oZ(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=eo()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}l0.type="LOCAL";class l1 extends lZ{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}l1.type="SESSION";class l2{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new l2(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),a=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function l3(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}l2.receivers=[];class l6{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((a,o)=>{let l=l3("",20);s.port1.start();let h=setTimeout(()=>{o(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{o(Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(e.data.response);break;default:clearTimeout(h),clearTimeout(i),o(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function l5(){return window}function l4(){return void 0!==l5().WorkerGlobalScope&&"function"==typeof l5().importScripts}async function l8(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let l9="firebaseLocalStorageDb",l7="firebaseLocalStorage",he="fbase_key";class ht{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function hn(e,t){return e.transaction([l7],t?"readwrite":"readonly").objectStore(l7)}function hi(){let e=indexedDB.open(l9,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(l7,{keyPath:he})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(l7)?t(n):(n.close(),await new ht(indexedDB.deleteDatabase(l9)).toPromise(),t(await hi()))})})}async function hr(e,t,n){return new ht(hn(e,!0).put({[he]:t,value:n})).toPromise()}async function hs(e,t){let n=hn(e,!1).get(t),i=await new ht(n).toPromise();return void 0===i?null:i.value}function ha(e,t){return new ht(hn(e,!0).delete(t)).toPromise()}class ho{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await hi()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return l4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=l2._getInstance(l4()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await l8(),!this.activeServiceWorker)return;this.sender=new l6(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null==(e=n[0])?void 0:e.fulfilled)&&(null==(t=n[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await hi();return await hr(e,lX,"1"),await ha(e,lX),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>hr(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>hs(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ha(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new ht(hn(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function hl(e,t){return oc(e,"POST","/v2/accounts/mfaSignIn:start",ou(e,t))}ho.type="LOCAL",o8("rcb"),new or(3e4,6e4);let hh="recaptcha";async function hu(e,t,n){var i;if(!e._getRecaptchaConfig())try{await lr(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){oe("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===le){oe((null==n?void 0:n.type)===hh,e,"argument-error");let i=await hc(e,t,n);return lJ(e,i)}return lJ(e,t)},a=li(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{oe("signin"===t.type,e,"internal-error");let s=(null==(i=r.multiFactorHint)?void 0:i.uid)||r.multiFactorUid;oe(s,e,"missing-multi-factor-info");let a={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===le){oe((null==n?void 0:n.type)===hh,e,"argument-error");let i=await hc(e,t,n);return hl(e,i)}return hl(e,t)},l=li(e,a,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===le){oe((null==n?void 0:n.type)===hh,e,"argument-error");let i=await hc(e,t,n);return ly(e,i)}return ly(e,t)},s=li(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==n||n._reset()}}async function hc(e,t,n){oe(n.type===hh,e,"argument-error");let i=await n.verify();oe("string"==typeof i,e,"argument-error");let r=Object.assign({},t);if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class hd{constructor(e){this.providerId=hd.PROVIDER_ID,this.auth=ej(e)}verifyPhoneNumber(e,t){return hu(this.auth,e,ej(t))}static credential(e,t){return lT._fromVerification(e,t)}static credentialFromResult(e){return hd.credentialFromTaggedObject(e)}static credentialFromError(e){return hd.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?lT._fromTokenResponse(t,n):null}}function hf(e,t){return t?oj(t):(oe(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}hd.PROVIDER_ID="phone",hd.PHONE_SIGN_IN_METHOD="phone";class hp extends lo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return lg(e,this._buildIdpRequest())}_linkToIdToken(e,t){return lg(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return lg(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function hg(e){return lV(e.auth,new hp(e),e.bypassAuthState)}function hm(e){let{auth:t,user:n}=e;return oe(n,t,"internal-error"),lU(n,new hp(e),e.bypassAuthState)}async function hy(e){let{auth:t,user:n}=e;return oe(n,t,"internal-error"),lF(n,new hp(e),e.bypassAuthState)}class h_{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:a}=e;if(s)return void this.reject(s);let o={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return hg;case"linkViaPopup":case"linkViaRedirect":return hy;case"reauthViaPopup":case"reauthViaRedirect":return hm;default:a6(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||ot(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||ot(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let hv=new or(2e3,1e4);async function hw(e,t,n){if(ty(e.app))return Promise.reject(a5(e,"operation-not-supported-in-this-environment"));let i=ej(e);a9(e,t,lC);let r=hf(i,n);return new hb(i,"signInViaPopup",t,r).executeNotNull()}class hb extends h_{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,hb.currentPopupAction&&hb.currentPopupAction.cancel(),hb.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return oe(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||ot(t);let n=l3();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(a5(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(a5(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,hb.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null==(n=null==(t=this.authWindow)?void 0:t.window)?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(a5(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,hv.get())};e()}}hb.currentPopupAction=null;let hT=new Map;class hE extends h_{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=hT.get(this.auth._key());if(!e){try{let t=await hI(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}hT.set(this.auth._key(),e)}return this.bypassAuthState||hT.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function hI(e,t){let n=hA(t),i=hk(e);if(!await i._isAvailable())return!1;let r=await i._get(n)==="true";return await i._remove(n),r}async function hC(e,t){return hk(e)._set(hA(t),"true")}function hS(e,t){hT.set(e._key(),t)}function hk(e){return oj(e._redirectPersistence)}function hA(e){return oB("pendingRedirect",e.config.apiKey,e.name)}function hN(e,t,n){return hR(e,t,n)}async function hR(e,t,n){if(ty(e.app))return Promise.reject(a8(e));let i=ej(e);a9(e,t,lC),await i._initializationPromise;let r=hf(i,n);return await hC(r,i),r._openRedirect(i,t,"signInViaRedirect")}async function hP(e,t){return await ej(e)._initializationPromise,hx(e,t,!1)}async function hx(e,t,n=!1){if(ty(e.app))return Promise.reject(a8(e));let i=ej(e),r=hf(i,t),s=new hE(i,r,n),a=await s.execute();return a&&!n&&(delete a.user._redirectEventId,await i._persistUserIfCurrent(a.user),await i._setRedirectUser(null,t)),a}class hD{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return hL(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!hL(e)){let i=(null==(n=e.error.code)?void 0:n.split("auth/")[1])||"internal-error";t.onError(a5(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(hO(e))}saveEventToCache(e){this.cachedEventUids.add(hO(e)),this.lastProcessedEventTime=Date.now()}}function hO(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function hL({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function hM(e,t={}){return oc(e,"GET","/v1/projects",t)}let hF=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hU=/^https?/;async function hV(e){if(e.config.emulator)return;let{authorizedDomains:t}=await hM(e);for(let e of t)try{if(function(e){let t=on(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!hU.test(n))return!1;if(hF.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch(e){}a6(e,"unauthorized-domain")}let hj=new or(3e4,6e4);function hq(){let e=l5().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let hB=null,hz=new or(5e3,15e3),h$={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},hH=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function hW(e){let t,n,i,r,s,a=await (hB=hB||new Promise((t,n)=>{var i,r,s,a;function o(){hq(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{hq(),n(a5(e,"network-request-failed"))},timeout:hj.get()})}if(null==(r=null==(i=l5().gapi)?void 0:i.iframes)?void 0:r.Iframe)t(gapi.iframes.getContext());else if(null==(s=l5().gapi)?void 0:s.load)o();else{let t=o8("iframefcb");return l5()[t]=()=>{gapi.load?o():n(a5(e,"network-request-failed"))},(a=`${o4.gapiScript}?onload=${t}`,o4.loadJS(a)).catch(e=>n(e))}}).catch(e=>{throw hB=null,e})),o=l5().gapi;return oe(o,e,"internal-error"),a.open({where:document.body,url:(oe((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?os(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:tE},(r=hH.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${eR(i).slice(1)}`),messageHandlersFilter:o.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:h$,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=a5(e,"network-request-failed"),s=l5().setTimeout(()=>{i(r)},hz.get());function a(){l5().clearTimeout(s),n(t)}t.ping(a).then(a,()=>{i(r)})}))}let hK={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class hG{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let hQ=encodeURIComponent("fac");async function hY(e,t,n,i,r,s){oe(e.config.authDomain,e,"auth-domain-config-required"),oe(e.config.apiKey,e,"invalid-api-key");let a={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:tE,eventId:r};if(t instanceof lC)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),a.providerId=t.providerId||"",eS(t.getCustomParameters())||(a.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))a[n]=i;if(t instanceof lS){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(a.scopes=e.join(","))}for(let t of(e.tenantId&&(a.tid=e.tenantId),Object.keys(a)))void 0===a[t]&&delete a[t];let o=await e._getAppCheckToken(),l=o?`#${hQ}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?os(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eR(a).slice(1)}${l}`}let hJ="webStorageSupport",hX=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=l1,this._completeRedirectFn=hx,this._overrideRedirectResult=hS}async _openPopup(e,t,n,i){var r,s,a;s=null==(r=this.eventManagers[e._key()])?void 0:r.manager,a="_initialize() not called before _openPopup()",s||ot(a);let o=await hY(e,t,n,on(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString(),o="",l=Object.assign(Object.assign({},hK),{width:i.toString(),height:r.toString(),top:s,left:a}),h=eo().toLowerCase();n&&(o=oK(h)?"_blank":n),oH(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=eo()){var t;return oX(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(h)&&"_self"!==o){var c,d;let e,n;return c=t||"",d=o,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new hG(null)}let f=window.open(t||"",o,u);oe(f,e,"popup-blocked");try{f.focus()}catch(e){}return new hG(f)}(e,o,l3())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await hY(e,t,n,on(),i),l5().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||ot(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await hW(e),n=new hD(e);return t.register("authEvent",t=>(oe(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(hJ,{type:hJ},n=>{var i;let r=null==(i=null==n?void 0:n[0])?void 0:i[hJ];void 0!==r&&t(!!r),a6(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hV(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oZ()||oW()||oX()}};var hZ="@firebase/auth",h0="1.10.2";class h1{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){oe(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let h2=er("authIdTokenMaxAge")||300,h3=null;function h6(e=tS()){let t=tp(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=tp(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eA(n.getOptions(),null!=t?t:{}))return e;a6(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:hX,persistence:[ho,l0,l1]}),i=er("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t,i=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>h2)return;let r=null==n?void 0:n.token;h3!==r&&(h3=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});ej(n).beforeAuthStateChanged(i,()=>i(n.currentUser)),lG(n,e=>i(e))}}let r=et("auth");return r&&function(e,t,n){let i=ej(e);oe(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=ls(t),{host:s,port:a}=function(e){let t=ls(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:la(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:la(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${r}//${s}${o}/`},h=Object.freeze({host:s,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){oe(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),oe(eA(l,i.config.emulator)&&eA(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}(),eq(s)&&eB(`${r}//${s}${o}`)}(n,`http://${r}`),n}o4={loadJS:e=>new Promise((t,n)=>{var i,r;let s=document.createElement("script");s.setAttribute("src",e),s.onload=t,s.onerror=e=>{let t=a5("internal-error");t.customData=e,n(t)},s.type="text/javascript",s.charset="UTF-8",(null!=(r=null==(i=document.getElementsByTagName("head"))?void 0:i[0])?r:document).appendChild(s)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},k="Browser",tf(new ez("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=r.options;oe(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});let h=new o6(r,s,a,{apiKey:o,authDomain:l,clientPlatform:k,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:o0(k)});return i=(Array.isArray(n=(null==t?void 0:t.persistence)||[])?n:[n]).map(oj),(null==t?void 0:t.errorMap)&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),tf(new ez("auth-internal",e=>new h1(ej(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tN(hZ,h0,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(k)),tN(hZ,h0,"esm2017"),e.s([],44353),e.s([],64376),e.i(44353),e.s(["GoogleAuthProvider",()=>lA,"createUserWithEmailAndPassword",()=>lW,"getAuth",()=>h6,"getIdToken",()=>oE,"getRedirectResult",()=>hP,"onAuthStateChanged",()=>lQ,"onIdTokenChanged",()=>lG,"sendPasswordResetEmail",()=>lH,"signInAnonymously",()=>lO,"signInWithEmailAndPassword",()=>lK,"signInWithPopup",()=>hw,"signInWithRedirect",()=>hN,"signOut",()=>lY],85498);var h5=e.i(21168),h4="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,h8={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}var t=function(){this.blockSize=-1};function n(){}function i(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],a=t+(s^n&(r^s))+i[0]+0xd76aa478|0;a=s+(r^(t=n+(a<<7|a>>>25))&(n^r))+i[1]+0xe8c7b756|0,a=r+(n^(s=t+(a<<12|a>>>20))&(t^n))+i[2]+0x242070db|0,a=n+(t^(r=s+(a<<17|a>>>15))&(s^t))+i[3]+0xc1bdceee|0,a=t+(s^(n=r+(a<<22|a>>>10))&(r^s))+i[4]+0xf57c0faf|0,a=s+(r^(t=n+(a<<7|a>>>25))&(n^r))+i[5]+0x4787c62a|0,a=r+(n^(s=t+(a<<12|a>>>20))&(t^n))+i[6]+0xa8304613|0,a=n+(t^(r=s+(a<<17|a>>>15))&(s^t))+i[7]+0xfd469501|0,a=t+(s^(n=r+(a<<22|a>>>10))&(r^s))+i[8]+0x698098d8|0,a=s+(r^(t=n+(a<<7|a>>>25))&(n^r))+i[9]+0x8b44f7af|0,a=r+(n^(s=t+(a<<12|a>>>20))&(t^n))+i[10]+0xffff5bb1|0,a=n+(t^(r=s+(a<<17|a>>>15))&(s^t))+i[11]+0x895cd7be|0,a=t+(s^(n=r+(a<<22|a>>>10))&(r^s))+i[12]+0x6b901122|0,a=s+(r^(t=n+(a<<7|a>>>25))&(n^r))+i[13]+0xfd987193|0,a=r+(n^(s=t+(a<<12|a>>>20))&(t^n))+i[14]+0xa679438e|0,a=n+(t^(r=s+(a<<17|a>>>15))&(s^t))+i[15]+0x49b40821|0,n=r+(a<<22|a>>>10),a=t+(r^s&(n^r))+i[1]+0xf61e2562|0,t=n+(a<<5|a>>>27),a=s+(n^r&(t^n))+i[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=r+(t^n&(s^t))+i[11]+0x265e5a51|0,r=s+(a<<14|a>>>18),a=n+(s^t&(r^s))+i[0]+0xe9b6c7aa|0,n=r+(a<<20|a>>>12),a=t+(r^s&(n^r))+i[5]+0xd62f105d|0,t=n+(a<<5|a>>>27),a=s+(n^r&(t^n))+i[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=r+(t^n&(s^t))+i[15]+0xd8a1e681|0,r=s+(a<<14|a>>>18),a=n+(s^t&(r^s))+i[4]+0xe7d3fbc8|0,n=r+(a<<20|a>>>12),a=t+(r^s&(n^r))+i[9]+0x21e1cde6|0,t=n+(a<<5|a>>>27),a=s+(n^r&(t^n))+i[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=r+(t^n&(s^t))+i[3]+0xf4d50d87|0,r=s+(a<<14|a>>>18),a=n+(s^t&(r^s))+i[8]+0x455a14ed|0,n=r+(a<<20|a>>>12),a=t+(r^s&(n^r))+i[13]+0xa9e3e905|0,t=n+(a<<5|a>>>27),a=s+(n^r&(t^n))+i[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=r+(t^n&(s^t))+i[7]+0x676f02d9|0,r=s+(a<<14|a>>>18),a=n+(s^t&(r^s))+i[12]+0x8d2a4c8a|0,a=t+((n=r+(a<<20|a>>>12))^r^s)+i[5]+0xfffa3942|0,a=s+((t=n+(a<<4|a>>>28))^n^r)+i[8]+0x8771f681|0,a=r+((s=t+(a<<11|a>>>21))^t^n)+i[11]+0x6d9d6122|0,a=n+((r=s+(a<<16|a>>>16))^s^t)+i[14]+0xfde5380c|0,a=t+((n=r+(a<<23|a>>>9))^r^s)+i[1]+0xa4beea44|0,a=s+((t=n+(a<<4|a>>>28))^n^r)+i[4]+0x4bdecfa9|0,a=r+((s=t+(a<<11|a>>>21))^t^n)+i[7]+0xf6bb4b60|0,a=n+((r=s+(a<<16|a>>>16))^s^t)+i[10]+0xbebfbc70|0,a=t+((n=r+(a<<23|a>>>9))^r^s)+i[13]+0x289b7ec6|0,a=s+((t=n+(a<<4|a>>>28))^n^r)+i[0]+0xeaa127fa|0,a=r+((s=t+(a<<11|a>>>21))^t^n)+i[3]+0xd4ef3085|0,a=n+((r=s+(a<<16|a>>>16))^s^t)+i[6]+0x4881d05|0,a=t+((n=r+(a<<23|a>>>9))^r^s)+i[9]+0xd9d4d039|0,a=s+((t=n+(a<<4|a>>>28))^n^r)+i[12]+0xe6db99e5|0,a=r+((s=t+(a<<11|a>>>21))^t^n)+i[15]+0x1fa27cf8|0,a=n+((r=s+(a<<16|a>>>16))^s^t)+i[2]+0xc4ac5665|0,n=r+(a<<23|a>>>9),a=t+(r^(n|~s))+i[0]+0xf4292244|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~r))+i[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=r+(t^(s|~n))+i[14]+0xab9423a7|0,r=s+(a<<15|a>>>17),a=n+(s^(r|~t))+i[5]+0xfc93a039|0,n=r+(a<<21|a>>>11),a=t+(r^(n|~s))+i[12]+0x655b59c3|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~r))+i[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=r+(t^(s|~n))+i[10]+0xffeff47d|0,r=s+(a<<15|a>>>17),a=n+(s^(r|~t))+i[1]+0x85845dd1|0,n=r+(a<<21|a>>>11),a=t+(r^(n|~s))+i[8]+0x6fa87e4f|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~r))+i[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=r+(t^(s|~n))+i[6]+0xa3014314|0,r=s+(a<<15|a>>>17),a=n+(s^(r|~t))+i[13]+0x4e0811a1|0,n=r+(a<<21|a>>>11),a=t+(r^(n|~s))+i[4]+0xf7537e82|0,t=n+(a<<6|a>>>26),a=s+(n^(t|~r))+i[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=r+(t^(s|~n))+i[2]+0x2ad7d2bb|0,r=s+(a<<15|a>>>17),a=n+(s^(r|~t))+i[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(r+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+r|0,e.g[3]=e.g[3]+s|0}function r(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)},e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.B,s=this.h,a=0;a<t;){if(0==s)for(;a<=n;)i(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[s++]=e.charCodeAt(a++),s==this.blockSize){i(this,r),s=0;break}}else for(;a<t;)if(r[s++]=e[a++],s==this.blockSize){i(this,r),s=0;break}}this.h=s,this.o+=t},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var s,a={};function o(e){var t;return -128<=e&&128>e?(t=function(e){return new r([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(a,e)?a[e]:a[e]=t(e)):new r([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return p(l(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=0x100000000;return new r(t,0)}var h=o(0),u=o(1),c=o(0x1000000);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,i=t;0>=i.l(e);)n=v(n),i=v(i);var r=w(n,1),s=w(i,1);for(i=w(i,2),n=w(n,2);!d(i);){var a=s.add(i);0>=a.l(e)&&(r=r.add(n),s=a),i=w(i,1),n=w(n,1)}return t=g(e,r.j(t)),new y(r,t)}for(r=h;0<=e.l(t);){for(i=48>=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,i-48),a=(s=l(n)).j(t);f(a)||0<a.l(e);)n-=i,a=(s=l(n)).j(t);d(s)&&(s=u),r=r.add(s),e=g(e,a)}return new y(r,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function w(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+n)>>>t|e.i(a+n+1)<<32-t:e.i(a+n);return new r(s,e.h)}(s=r.prototype).m=function(){if(f(this))return-p(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:0x100000000+i)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,i="";;){var r=_(n,t).g,s=((0<(n=g(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,n[s]=o<<16|a}return new r(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var a=this.i(i)>>>16,o=65535&this.i(i),u=e.i(s)>>>16,g=65535&e.i(s);n[2*i+2*s]+=o*g,m(n,2*i+2*s),n[2*i+2*s+1]+=a*g,m(n,2*i+2*s+1),n[2*i+2*s+1]+=o*u,m(n,2*i+2*s+1),n[2*i+2*s+2]+=a*u,m(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},s.A=function(e){return _(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,P=h8.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=l(Math.pow(n,8)),r=h,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),o=parseInt(t.substring(s,s+a),n);8>a?(a=l(Math.pow(n,a)),r=r.j(a).add(l(o))):r=(r=r.j(i)).add(l(o))}return r},R=h8.Integer=r}).apply(void 0!==h4?h4:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var h9="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,h7={};(function(){var e,t,n,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof h9&&h9];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var a=e[s];if(!(a in n))break e;n=n[a]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,i,r;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,i=!1,(r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return r},r}});var s=s||{},a=this||self;function o(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function l(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function h(e,t,n){return e.call.apply(e.bind,arguments)}function u(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?h:u).apply(null,arguments)}function d(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function f(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function p(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function g(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(o(n)){let t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}function m(e){return/^[\s\xa0]*$/.test(e)}function y(){var e=a.navigator;return e&&(e=e.userAgent)?e:""}function _(e){return _[" "](e),e}_[" "]=function(){};var v=-1!=y().indexOf("Gecko")&&(-1==y().toLowerCase().indexOf("webkit")||-1!=y().indexOf("Edge"))&&-1==y().indexOf("Trident")&&-1==y().indexOf("MSIE")&&-1==y().indexOf("Edge");function w(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function b(e){let t={};for(let n in e)t[n]=e[n];return t}let T="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<T.length;t++)n=T[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}var I=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new C,e=>e.reset());class C{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let S,k=!1,A=new class{constructor(){this.h=this.g=null}add(e,t){let n=I.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{let e=a.Promise.resolve(void 0);S=()=>{e.then(R)}};var R=()=>{let e;for(var t;e=null,A.g&&(e=A.g,A.g=A.g.next,A.g||(A.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){a.setTimeout(()=>{throw e},0)}(e)}I.j(t),100>I.h&&(I.h++,t.next=I.g,I.g=t)}k=!1};function P(){this.s=this.s,this.C=this.C}function j(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}P.prototype.s=!1,P.prototype.ma=function(){this.s||(this.s=!0,this.N())},P.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},j.prototype.h=function(){this.defaultPrevented=!0};var q=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};a.addEventListener("test",e,t),a.removeEventListener("test",e,t)}catch(e){}return e}();function B(e,t){if(j.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(v){e:{try{_(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:z[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&B.aa.h.call(this)}}f(B,j);var z={2:"touch",3:"pen",4:"mouse"};B.prototype.h=function(){B.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var $="closure_listenable_"+(1e6*Math.random()|0),H=0;function W(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++H,this.da=this.fa=!1}function K(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function G(e){this.src=e,this.g={},this.h=0}function Q(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Array.prototype.indexOf.call(r,t,void 0);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(K(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Y(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==i)return r}return -1}G.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var a=Y(e,t,i,r);return -1<a?(t=e[a],n||(t.fa=!1)):((t=new W(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var J="closure_lm_"+(1e6*Math.random()|0),X={};function Z(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var a=l(r)?!!r.capture:!!r,o=ei(e);if(o||(e[J]=o=new G(e)),(n=o.add(t,n,i,a,s)).proxy)return n;if(i=function e(t){return en.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)q||(r=a),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(et(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function ee(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[$])Q(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(et(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ei(t))?(Q(n,e),0==n.h&&(n.src=null,t[J]=null)):K(e)}}}function et(e){return e in X?X[e]:X[e]="on"+e}function en(e,t){if(e.da)e=!0;else{t=new B(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&ee(e),e=n.call(i,t)}return e}function ei(e){return(e=e[J])instanceof G?e:null}var er="__closure_events_fn_"+(1e9*Math.random()>>>0);function es(e){return"function"==typeof e?e:(e[er]||(e[er]=function(t){return e.handleEvent(t)}),e[er])}function ea(){P.call(this),this.i=new G(this),this.M=this,this.F=null}function eo(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new j(t,e);else if(t instanceof j)t.target=t.target||e;else{var r=t;E(t=new j(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var a=t.g=n[s];r=el(a,i,!0,t)&&r}if(r=el(a=t.g=e,i,!0,t)&&r,r=el(a,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=el(a=t.g=n[s],i,!1,t)&&r}function el(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var a=t[s];if(a&&!a.da&&a.capture==n){var o=a.listener,l=a.ha||a.src;a.fa&&Q(e.i,a),r=!1!==o.call(l,i)&&r}}return r&&!i.defaultPrevented}function eh(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else if(e&&"function"==typeof e.handleEvent)e=c(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:a.setTimeout(e,t||0)}f(ea,P),ea.prototype[$]=!0,ea.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);else(r=l(r)?!!r.capture:!!r,i=es(i),t&&t[$])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=Y(a=t.g[n],i,r,s))&&(K(a[i]),Array.prototype.splice.call(a,i,1),0==a.length&&(delete t.g[n],t.h--))):t&&(t=ei(t))&&(n=t.g[n.toString()],t=-1,n&&(t=Y(n,i,r,s)),(i=-1<t?n[t]:null)&&ee(i))}(this,e,t,n,i)},ea.prototype.N=function(){if(ea.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)K(n[i]);delete t.g[e],t.h--}}this.F=null},ea.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},ea.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class eu extends P{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=eh(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ec(e){P.call(this),this.h=e,this.g={}}f(ec,P);var ed=[];function ef(e){w(e.g,function(e,t){this.g.hasOwnProperty(t)&&ee(e)},e),e.g={}}ec.prototype.N=function(){ec.aa.N.call(this),ef(this)},ec.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ep=a.JSON.stringify,eg=a.JSON.parse,em=class{stringify(e){return a.JSON.stringify(e,void 0)}parse(e){return a.JSON.parse(e,void 0)}};function ey(){}function e_(e){return e.h||(e.h=e.i())}function ev(){}ey.prototype.h=null;var ew={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eb(){j.call(this,"d")}function eT(){j.call(this,"c")}f(eb,j),f(eT,j);var eE={},eI=null;function eC(){return eI=eI||new ea}function eS(e){j.call(this,eE.La,e)}function ek(e){let t=eC();eo(t,new eS(t))}function eA(e,t){j.call(this,eE.STAT_EVENT,e),this.stat=t}function eN(e){let t=eC();eo(t,new eA(t,e))}function eR(e,t){j.call(this,eE.Ma,e),this.size=t}function eP(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){e()},t)}function ex(){this.g=!0}function eD(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<r.length;a++)r[a]=""}}}}return ep(n)}catch(e){return t}}(e,n)+(i?" "+i:"")})}eE.La="serverreachability",f(eS,j),eE.STAT_EVENT="statevent",f(eA,j),eE.Ma="timingevent",f(eR,j),ex.prototype.xa=function(){this.g=!1},ex.prototype.info=function(){};var eO={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eL={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eM(){}function eF(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new ec(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new eU}function eU(){this.i=null,this.g="",this.h=!1}f(eM,ey),eM.prototype.g=function(){return new XMLHttpRequest},eM.prototype.i=function(){return{}},t=new eM;var eV={},ej={};function eq(e,t,n){e.L=1,e.v=tn(e8(t)),e.m=n,e.P=!0,eB(e,null)}function eB(e,t){e.F=Date.now(),e$(e),e.A=e8(e.v);var n,i,r,s,a,o,h=e.A,u=e.R;Array.isArray(u)||(u=[String(u)]),tg(h.i,"t",u),e.C=0,h=e.j.J,e.h=new eU,e.g=t1(e.j,h?t:null,!e.m),0<e.O&&(e.M=new eu(c(e.Y,e,e.g),e.O)),t=e.U,h=e.g,u=e.ca;var d="readystatechange";Array.isArray(d)||(d&&(ed[0]=d.toString()),d=ed);for(var f=0;f<d.length;f++){var p=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=es(i),t&&t[$]?t.L(n,i,l(r)?!!r.capture:!!r,s):Z(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var a=0;a<n.length;a++)e(t,n[a],i,r,s);return null}return i=es(i),t&&t[$]?t.K(n,i,l(r)?!!r.capture:!!r,s):Z(t,n,i,!1,r,s)}(h,d[f],u||t.handleEvent,!1,t.h||t);if(!p)break;t.g[p.key]=p}t=e.H?b(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),ek(),n=e.i,i=e.u,r=e.A,s=e.l,a=e.R,o=e.m,n.info(function(){if(n.g)if(o)for(var e="",t=o.split("&"),l=0;l<t.length;l++){var h=t[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");e=2<=c.length&&"type"==c[1]?e+(u+"=")+h+"&":e+(u+"=redacted&")}}else e=null;else e=o;return"XMLHTTP REQ ("+s+") [attempt "+a+"]: "+i+"\n"+r+"\n"+e})}function ez(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function e$(e){e.S=Date.now()+e.I,eH(e,e.I)}function eH(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eP(c(e.ba,e),t)}function eW(e){e.B&&(a.clearTimeout(e.B),e.B=null)}function eK(e){0==e.j.G||e.J||tY(e.j,e)}function eG(e){eW(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ef(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eQ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e0(n.h,e))){if(!e.K&&e0(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)tQ(n),tV(n);else break e;tW(n),eN(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=eP(c(n.Za,n),6e3));if(1>=eZ(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else tX(n,11)}else if((e.K||n.g==e)&&tQ(n),!m(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let o=r[t];if(n.T=o[0],o=o[1],2==n.G)if("c"==o[0]){n.K=o[1],n.ia=o[2];let t=o[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let r=o[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));let l=o[5];null!=l&&"number"==typeof l&&0<l&&(n.L=i=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e1(s,s.h),s.h=null))}if(i.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,tt(i.I,i.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(i=n).qa=t0(i,i.J?i.ia:null,i.W),e.K){e2(i.h,e);var a=i.L;a&&(e.I=a),e.B&&(eW(e),e$(e)),i.g=e}else tH(i);0<n.i.length&&tq(n)}else"stop"!=o[0]&&"close"!=o[0]||tX(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?tX(n,7):tU(n):"noop"!=o[0]&&n.l&&n.l.ta(o),n.v=0)}}ek(4)}catch(e){}}eF.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tO(e)?t.j():this.Y(e)},eF.prototype.Y=function(e){try{if(e==this.g)e:{let v=tO(this.g);var t=this.g.Ba();let w=this.g.Z();if(!(3>v)&&(3!=v||this.g&&(this.h.h||this.g.oa()||tL(this.g)))){this.J||4!=v||7==t||(8==t||0>=w?ek(3):ek(2)),eW(this);var n=this.g.Z();this.X=n;t:if(ez(this)){var i=tL(this.g);e="";var r=i.length,s=4==tO(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eG(this),eK(this);var o="";break t}this.h.i=new a.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(s&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,l=this.i,h=this.u,u=this.A,c=this.l,d=this.R,f=n,l.info(function(){return"XMLHTTP RESP ("+c+") [ attempt "+d+"]: "+h+"\n"+u+"\n"+v+" "+f}),this.o){if(this.T&&!this.K){t:{if(this.g){var l,h,u,c,d,f,p,g=this.g;if((p=g.g?g.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!m(p)){var y=p;break t}}y=null}if(n=y)eD(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eQ(this,n);else{this.o=!1,this.s=3,eN(12),eG(this),eK(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?ej:isNaN(n=Number(t.substring(n,i)))?eV:(i+=1)+n>t.length?ej:(t=t.slice(i,i+n),e.C=i+n,t)}(this,o))==ej){4==v&&(this.s=4,eN(14),n=!1),eD(this.i,this.l,null,"[Incomplete Response]");break}else if(e==eV){this.s=4,eN(15),eD(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eD(this.i,this.l,e,null),eQ(this,e);if(ez(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=v||0!=o.length||this.h.h||(this.s=1,eN(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var _=this.j;_.g==this&&_.ba&&!_.M&&(_.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tK(_),_.M=!0,eN(11))}}else eD(this.i,this.l,o,"[Invalid Chunked Response]"),eG(this),eK(this)}else eD(this.i,this.l,o,null),eQ(this,o);4==v&&eG(this),this.o&&!this.J&&(4==v?tY(this.j,this):(this.o=!1,e$(this)))}else(function(e){let t={};e=(e.g&&2<=tO(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(m(e[i]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]);let r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[r]||[];t[r]=s,s.push(n)}var i=function(e){return e.join(", ")};for(let e in t)i.call(void 0,t[e],e,t)})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,eN(12)):(this.s=0,eN(13)),eG(this),eK(this)}}}catch(e){}finally{}},eF.prototype.cancel=function(){this.J=!0,eG(this)},eF.prototype.ba=function(){var e,t;this.B=null;let n=Date.now();0<=n-this.S?(e=this.i,t=this.A,e.info(function(){return"TIMEOUT: "+t}),2!=this.L&&(ek(),eN(17)),eG(this),this.s=2,eK(this)):eH(this,this.S-n)};var eY=class{constructor(e,t){this.g=e,this.map=t}};function eJ(e){this.l=e||10,e=a.PerformanceNavigationTiming?0<(e=a.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function eX(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eZ(e){return e.h?1:e.g?e.g.size:0}function e0(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e1(e,t){e.g?e.g.add(t):e.h=t}function e2(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e3(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return p(e.i)}function e6(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(o(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(o(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(o(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}eJ.prototype.cancel=function(){if(this.i=e3(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e5=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function e4(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof e4){this.h=e.h,e9(this,e.j),this.o=e.o,this.g=e.g,e7(this,e.s),this.l=e.l;var t=e.i,n=new tc;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),te(this,n),this.m=e.m}else e&&(t=String(e).match(e5))?(this.h=!1,e9(this,t[1]||"",!0),this.o=ti(t[2]||""),this.g=ti(t[3]||"",!0),e7(this,t[4]),this.l=ti(t[5]||"",!0),te(this,t[6]||"",!0),this.m=ti(t[7]||"")):(this.h=!1,this.i=new tc(null,this.h))}function e8(e){return new e4(e)}function e9(e,t,n){e.j=n?ti(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e7(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function te(e,t,n){var i,r;t instanceof tc?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(td(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(tf(this,t),tg(this,n,e))},i)),i.j=r):(n||(t=tr(t,th)),e.i=new tc(t,e.h))}function tt(e,t,n){e.i.set(t,n)}function tn(e){return tt(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ti(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,ts),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ts(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}e4.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tr(t,ta,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tr(t,ta,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tr(n,"/"==n.charAt(0)?tl:to,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",tr(n,tu)),e.join("")};var ta=/[#\/\?@]/g,to=/[#\?:]/g,tl=/[#\?]/g,th=/[#\?@]/g,tu=/#/g;function tc(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function td(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function tf(e,t){td(e),t=tm(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function tp(e,t){return td(e),t=tm(e,t),e.g.has(t)}function tg(e,t,n){tf(e,t),0<n.length&&(e.i=null,e.g.set(tm(e,t),p(n)),e.h+=n.length)}function tm(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ty(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(e){}}function t_(){this.g=new em}function tv(e){this.l=e.Ub||null,this.j=e.eb||!1}function tw(e,t){ea.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tb(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tT(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tE(e)}function tE(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tI(e){let t="";return w(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tC(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=tI(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):tt(e,t,n))}function tS(e){ea.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tc.prototype).add=function(e,t){td(this),this.i=null,e=tm(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){td(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},n.na=function(){td(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},n.V=function(e){td(this);let t=[];if("string"==typeof e)tp(this,e)&&(t=t.concat(this.g.get(tm(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return td(this),this.i=null,tp(this,e=tm(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let s=encodeURIComponent(String(i)),a=this.V(i);for(i=0;i<a.length;i++){var r=s;""!==a[i]&&(r+="="+encodeURIComponent(String(a[i]))),e.push(r)}}return this.i=e.join("&")},f(tv,ey),tv.prototype.g=function(){return new tw(this.l,this.j)},tv.prototype.i=(e={},function(){return e}),f(tw,ea),(n=tw.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tE(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||a).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tT(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tE(this)),this.g&&(this.readyState=3,tE(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==a.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tb(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tT(this):tE(this),3==this.readyState&&tb(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tT(this))},n.Qa=function(e){this.g&&(this.response=e,tT(this))},n.ga=function(){this.g&&tT(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tw.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),f(tS,ea);var tk=/^https?$/i,tA=["POST","PUT"];function tN(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tR(e),tx(e)}function tR(e){e.A||(e.A=!0,eo(e,"complete"),eo(e,"error"))}function tP(e){if(e.h&&void 0!==s&&(!e.v[1]||4!=tO(e)||2!=e.Z())){if(e.u&&4==tO(e))eh(e.Ea,0,e);else if(eo(e,"readystatechange"),4==tO(e)){e.h=!1;try{let s=e.Z();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===s){var r=String(e.D).match(e5)[1]||null;!r&&a.self&&a.self.location&&(r=a.self.location.protocol.slice(0,-1)),n=!tk.test(r?r.toLowerCase():"")}t=n}if(t)eo(e,"complete"),eo(e,"success");else{e.m=6;try{var o=2<tO(e)?e.g.statusText:""}catch(e){o=""}e.l=o+" ["+e.Z()+"]",tR(e)}}finally{tx(e)}}}}function tx(e,t){if(e.g){tD(e);let n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||eo(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function tD(e){e.I&&(a.clearTimeout(e.I),e.I=null)}function tO(e){return e.g?e.g.readyState:0}function tL(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tM(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tF(e){this.Aa=0,this.i=[],this.j=new ex,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tM("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tM("baseRetryDelayMs",5e3,e),this.cb=tM("retryDelaySeedMs",1e4,e),this.Wa=tM("forwardChannelMaxRetries",2,e),this.wa=tM("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new eJ(e&&e.concurrentRequestLimit),this.Da=new t_,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tU(e){if(tj(e),3==e.G){var t=e.U++,n=e8(e.I);if(tt(n,"SID",e.K),tt(n,"RID",t),tt(n,"TYPE","terminate"),tz(e,n),(t=new eF(e,e.j,t)).L=2,t.v=tn(e8(n)),n=!1,a.navigator&&a.navigator.sendBeacon)try{n=a.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&a.Image&&((new Image).src=t.v,n=!0),n||(t.g=t1(t.j,null),t.g.ea(t.v)),t.F=Date.now(),e$(t)}tZ(e)}function tV(e){e.g&&(tK(e),e.g.cancel(),e.g=null)}function tj(e){tV(e),e.u&&(a.clearTimeout(e.u),e.u=null),tQ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&a.clearTimeout(e.s),e.s=null)}function tq(e){if(!eX(e.h)&&!e.s){e.s=!0;var t=e.Ga;S||N(),k||(S(),k=!0),A.add(t,e),e.B=0}}function tB(e,t){var n;n=t?t.l:e.U++;let i=e8(e.I);tt(i,"SID",e.K),tt(i,"RID",n),tt(i,"AID",e.T),tz(e,i),e.m&&e.o&&tC(i,e.m,e.o),n=new eF(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=t$(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e1(e.h,n),eq(n,i,t)}function tz(e,t){e.H&&w(e.H,function(e,n){tt(t,n,e)}),e.l&&e6({},function(e,n){tt(t,n,e)})}function t$(e,t,n){n=Math.min(e.i.length,n);var i=e.l?c(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let a=0;a<n;a++){let n=r[a].g,o=r[a].map;if(0>(n-=t))t=Math.max(0,r[a].g-100),s=!1;else try{!function(e,t,n){let i=n||"";try{e6(e,function(e,n){let r=e;l(e)&&(r=ep(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}(o,e,"req"+n+"_")}catch(e){i&&i(o)}}if(s){i=e.join("&");break e}}}return t.D=e=e.i.splice(0,n),i}function tH(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;S||N(),k||(S(),k=!0),A.add(t,e),e.v=0}}function tW(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eP(c(e.Fa,e),tJ(e,e.v)),e.v++,!0)}function tK(e){null!=e.A&&(a.clearTimeout(e.A),e.A=null)}function tG(e){e.g=new eF(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=e8(e.qa);tt(t,"RID","rpc"),tt(t,"SID",e.K),tt(t,"AID",e.T),tt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&tt(t,"TO",e.ja),tt(t,"TYPE","xmlhttp"),tz(e,t),e.m&&e.o&&tC(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=tn(e8(t)),n.m=null,n.P=!0,eB(n,e)}function tQ(e){null!=e.C&&(a.clearTimeout(e.C),e.C=null)}function tY(e,t){var n,i=null;if(e.g==t){tQ(e),tK(e),e.g=null;var r=2}else{if(!e0(e.h,t))return;i=t.D,e2(e.h,t),r=1}if(0!=e.G){if(t.o)if(1==r){i=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;eo(r=eC(),new eR(r,i)),tq(e)}else tH(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==r&&(n=t,!(eZ(e.h)>=e.h.j-!!e.s)&&(e.s?(e.i=n.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eP(c(e.Ga,e,n),tJ(e,e.B)),e.B++,!0)))||2==r&&tW(e)))switch(i&&0<i.length&&((t=e.h).i=t.i.concat(i)),s){case 1:tX(e,5);break;case 4:tX(e,10);break;case 3:tX(e,6);break;default:tX(e,2)}}}function tJ(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function tX(e,t){if(e.j.info("Error code "+t),2==t){let t,s,o;var n,i=c(e.fb,e),r=e.Xa;let l=!r;r=new e4(r||"//www.google.com/images/cleardot.gif"),a.location&&"http"==a.location.protocol||e9(r,"https"),tn(r),l?function(e,t){let n=new ex;if(a.Image){let i=new Image;i.onload=d(ty,n,"TestLoadImage: loaded",!0,t,i),i.onerror=d(ty,n,"TestLoadImage: error",!1,t,i),i.onabort=d(ty,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=d(ty,n,"TestLoadImage: timeout",!1,t,i),a.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(r.toString(),i):(n=r.toString(),t=new ex,s=new AbortController,o=setTimeout(()=>{s.abort(),ty(t,"TestPingServer: timeout",!1,i)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(o),e.ok?ty(t,"TestPingServer: ok",!0,i):ty(t,"TestPingServer: server error",!1,i)}).catch(()=>{clearTimeout(o),ty(t,"TestPingServer: error",!1,i)}))}else eN(2);e.G=0,e.l&&e.l.sa(t),tZ(e),tj(e)}function tZ(e){if(e.G=0,e.ka=[],e.l){let t=e3(e.h);(0!=t.length||0!=e.i.length)&&(g(e.ka,t),g(e.ka,e.i),e.h.i.length=0,p(e.i),e.i.length=0),e.l.ra()}}function t0(e,t,n){var i=n instanceof e4?e8(n):new e4(n);if(""!=i.g)t&&(i.g=t+"."+i.g),e7(i,i.s);else{var r=a.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new e4(null);i&&e9(s,i),t&&(s.g=t),r&&e7(s,r),n&&(s.l=n),i=s}return n=e.D,t=e.ya,n&&t&&tt(i,n,t),tt(i,"VER",e.la),tz(e,i),i}function t1(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tS(e.Ca&&!e.pa?new tv({eb:n}):e.pa)).Ha(e.J),t}function t2(){}function t3(){}function t6(e,t){ea.call(this),this.g=new tF(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!m(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!m(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t8(this)}function t5(e){eb.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t4(){eT.call(this),this.status=1}function t8(e){this.g=e}(n=tS.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?e_(this.o):e_(t),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tN(this,e);return}if(e=i||"",i=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)i.set(s,r[s]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())i.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r));for(let[t,o]of(r=Array.from(i.keys()).find(e=>"content-type"==e.toLowerCase()),s=a.FormData&&e instanceof a.FormData,!(0<=Array.prototype.indexOf.call(tA,n,void 0))||r||s||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tD(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tN(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,eo(this,"complete"),eo(this,"abort"),tx(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tx(this,!0)),tS.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tP(this):this.bb())},n.bb=function(){tP(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tO(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eg(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tF.prototype).la=8,n.G=1,n.connect=function(e,t,n,i){eN(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=t0(this,null,this.W),tq(this)},n.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let r=new eF(this,this.j,e),s=this.o;if(this.S&&(s?E(s=b(s),this.S):s=this.S),null!==this.m||this.O||(r.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=t$(this,r,t),tt(n=e8(this.I),"RID",e),tt(n,"CVER",22),this.D&&tt(n,"X-HTTP-Session-Id",this.D),tz(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tI(s)))+"&"+t:this.m&&tC(n,this.m,s)),e1(this.h,r),this.Ua&&tt(n,"TYPE","init"),this.P?(tt(n,"$req",t),tt(n,"SID","null"),r.T=!0,eq(r,n,null)):eq(r,n,t),this.G=2}}else 3==this.G&&(e?tB(this,e):0==this.i.length||eX(this.h)||tB(this))},n.Fa=function(){if(this.u=null,tG(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eP(c(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eN(10),tV(this),tG(this))},n.Za=function(){null!=this.C&&(this.C=null,tV(this),tW(this),eN(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eN(2)):(this.j.info("Failed to ping google.com"),eN(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t2.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t3.prototype.g=function(e,t){return new t6(e,t)},f(t6,ea),t6.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t6.prototype.close=function(){tU(this.g)},t6.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=ep(e),e=n);t.i.push(new eY(t.Ya++,e)),3==t.G&&tq(t)},t6.prototype.N=function(){this.g.l=null,delete this.j,tU(this.g),delete this.g,t6.aa.N.call(this)},f(t5,eb),f(t4,eT),f(t8,t2),t8.prototype.ua=function(){eo(this.g,"a")},t8.prototype.ta=function(e){eo(this.g,new t5(e))},t8.prototype.sa=function(e){eo(this.g,new t4)},t8.prototype.ra=function(){eo(this.g,"b")},t3.prototype.createWebChannel=t3.prototype.g,t6.prototype.send=t6.prototype.o,t6.prototype.open=t6.prototype.m,t6.prototype.close=t6.prototype.close,V=h7.createWebChannelTransport=function(){return new t3},U=h7.getStatEventTarget=function(){return eC()},F=h7.Event=eE,M=h7.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eO.NO_ERROR=0,eO.TIMEOUT=8,eO.HTTP_ERROR=6,L=h7.ErrorCode=eO,eL.COMPLETE="complete",O=h7.EventType=eL,ev.EventType=ew,ew.OPEN="a",ew.CLOSE="b",ew.ERROR="c",ew.MESSAGE="d",ea.prototype.listen=ea.prototype.K,D=h7.WebChannel=ev,h7.FetchXmlHttpFactory=tv,tS.prototype.listenOnce=tS.prototype.L,tS.prototype.getLastError=tS.prototype.Ka,tS.prototype.getLastErrorCode=tS.prototype.Ba,tS.prototype.getStatus=tS.prototype.Z,tS.prototype.getResponseJson=tS.prototype.Oa,tS.prototype.getResponseText=tS.prototype.oa,tS.prototype.send=tS.prototype.ea,tS.prototype.setWithCredentials=tS.prototype.Ha,x=h7.XhrIo=tS}).apply(void 0!==h9?h9:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let ue="@firebase/firestore",ut="4.7.12";class un{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}un.UNAUTHENTICATED=new un(null),un.GOOGLE_CREDENTIALS=new un("google-credentials-uid"),un.FIRST_PARTY=new un("first-party-uid"),un.MOCK_USER=new un("mock-user");let ui="11.7.0",ur=new eX("@firebase/firestore");function us(){return ur.logLevel}function ua(e,...t){if(ur.logLevel<=A.DEBUG){let n=t.map(uh);ur.debug(`Firestore (${ui}): ${e}`,...n)}}function uo(e,...t){if(ur.logLevel<=A.ERROR){let n=t.map(uh);ur.error(`Firestore (${ui}): ${e}`,...n)}}function ul(e,...t){if(ur.logLevel<=A.WARN){let n=t.map(uh);ur.warn(`Firestore (${ui}): ${e}`,...n)}}function uh(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function uu(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,uc(e,i,n)}function uc(e,t,n){let i=`FIRESTORE (${ui}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw uo(i),Error(i)}function ud(e,t,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,e||uc(t,r,i)}let uf={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class up extends em{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ug{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class um{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class uy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(un.UNAUTHENTICATED))}shutdown(){}}class u_{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class uv{constructor(e){this.t=e,this.currentUser=un.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ud(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new ug;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ug,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},a=e=>{ua("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?a(e):(ua("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ug)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ua("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ud("string"==typeof t.accessToken,31837,{l:t}),new um(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return ud(null===e||"string"==typeof e,2055,{h:e}),new un(e)}}class uw{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=un.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ub{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new uw(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(un.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class uT{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uE{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ty(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ud(void 0===this.o,3512);let n=e=>{null!=e.error&&ua("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,ua("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{ua("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?i(e):ua("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new uT(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ud("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new uT(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function uI(){return new TextEncoder}class uC{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function uS(e,t){return e<t?-1:+(e>t)}function uk(e,t){let n=0;for(;n<e.length&&n<t.length;){let i=e.codePointAt(n),r=t.codePointAt(n);if(i!==r){if(i<128&&r<128)return uS(i,r);{let s=uI(),a=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return uS(e[n],t[n]);return uS(e.length,t.length)}(s.encode(uA(e,n)),s.encode(uA(t,n)));return 0!==a?a:uS(i,r)}}n+=i>65535?2:1}return uS(e.length,t.length)}function uA(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function uN(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class uR{static now(){return uR.fromMillis(Date.now())}static fromDate(e){return uR.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new uR(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new up(uf.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new up(uf.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?uS(this.nanoseconds,e.nanoseconds):uS(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class uP{static fromTimestamp(e){return new uP(e)}static min(){return new uP(new uR(0,0))}static max(){return new uP(new uR(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let ux="__name__";class uD{constructor(e,t,n){void 0===t?t=0:t>e.length&&uu(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&uu(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===uD.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof uD?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=uD.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return uS(e.length,t.length)}static compareSegments(e,t){let n=uD.isNumericId(e),i=uD.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?uD.extractNumericId(e).compare(uD.extractNumericId(t)):uk(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return R.fromString(e.substring(4,e.length-2))}}class uO extends uD{construct(e,t,n){return new uO(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new up(uf.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new uO(t)}static emptyPath(){return new uO([])}}let uL=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class uM extends uD{construct(e,t,n){return new uM(e,t,n)}static isValidIdentifier(e){return uL.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),uM.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ux}static keyField(){return new uM([ux])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new up(uf.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new up(uf.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new up(uf.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new up(uf.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new uM(t)}static emptyPath(){return new uM([])}}class uF{constructor(e){this.path=e}static fromPath(e){return new uF(uO.fromString(e))}static fromName(e){return new uF(uO.fromString(e).popFirst(5))}static empty(){return new uF(uO.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===uO.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return uO.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new uF(new uO(e.slice()))}}class uU{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new uU(uP.min(),uF.empty(),-1)}static max(){return new uU(uP.max(),uF.empty(),-1)}}class uV{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function uj(e){if(e.code!==uf.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;ua("LocalStore","Unexpectedly lost primary lease")}class uq{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&uu(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new uq((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof uq?t:uq.resolve(t)}catch(e){return uq.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):uq.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):uq.reject(t)}static resolve(e){return new uq((t,n)=>{t(e)})}static reject(e){return new uq((t,n)=>{n(e)})}static waitFor(e){return new uq((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=uq.resolve(!1);for(let n of e)t=t.next(e=>e?uq.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new uq((n,i)=>{let r=e.length,s=Array(r),a=0;for(let o=0;o<r;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new uq((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}function uB(e){return"IndexedDbTransactionError"===e.name}class uz{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}uz.le=-1;function u$(e){return 0===e&&1/e==-1/0}function uH(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function uW(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function uK(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class uG{constructor(e,t){this.comparator=e,this.root=t||uY.EMPTY}insert(e,t){return new uG(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,uY.BLACK,null,null))}remove(e){return new uG(this.comparator,this.root.remove(e,this.comparator).copy(null,null,uY.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new uQ(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new uQ(this.root,e,this.comparator,!1)}getReverseIterator(){return new uQ(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new uQ(this.root,e,this.comparator,!0)}}class uQ{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class uY{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:uY.RED,this.left=null!=i?i:uY.EMPTY,this.right=null!=r?r:uY.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new uY(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return uY.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return uY.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,uY.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,uY.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw uu(43730,{key:this.key,value:this.value});if(this.right.isRed())throw uu(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw uu(27949);return e+ +!this.isRed()}}uY.EMPTY=null,uY.RED=!0,uY.BLACK=!1,uY.EMPTY=new class{constructor(){this.size=0}get key(){throw uu(57766)}get value(){throw uu(16141)}get color(){throw uu(16727)}get left(){throw uu(29726)}get right(){throw uu(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new uY(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class uJ{constructor(e){this.comparator=e,this.data=new uG(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new uX(this.data.getIterator())}getIteratorFrom(e){return new uX(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof uJ)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new uJ(this.comparator);return t.data=e,t}}class uX{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class uZ{constructor(e){this.fields=e,e.sort(uM.comparator)}static empty(){return new uZ([])}unionWith(e){let t=new uJ(uM.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new uZ(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return uN(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class u0 extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class u1{constructor(e){this.binaryString=e}static fromBase64String(e){return new u1(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new u0("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new u1(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return uS(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}u1.EMPTY_BYTE_STRING=new u1("");let u2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function u3(e){if(ud(!!e,39018),"string"==typeof e){let t=0,n=u2.exec(e);if(ud(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:u6(e.seconds),nanos:u6(e.nanos)}}function u6(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function u5(e){return"string"==typeof e?u1.fromBase64String(e):u1.fromUint8Array(e)}let u4="server_timestamp",u8="__type__",u9="__previous_value__",u7="__local_write_time__";function ce(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[u8])?void 0:n.stringValue)===u4}function ct(e){let t=e.mapValue.fields[u9];return ce(t)?ct(t):t}function cn(e){let t=u3(e.mapValue.fields[u7].timestampValue);return new uR(t.seconds,t.nanos)}class ci{constructor(e,t,n,i,r,s,a,o,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=h}}let cr="(default)";class cs{constructor(e,t){this.projectId=e,this.database=t||cr}static empty(){return new cs("","")}get isDefaultDatabase(){return this.database===cr}isEqual(e){return e instanceof cs&&e.projectId===this.projectId&&e.database===this.database}}let ca="__type__",co="__max__",cl={},ch="__vector__",cu="value";function cc(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ce(e)?4:cC(e)?0x1fffffffffffff:cE(e)?10:11:uu(28295,{value:e})}function cd(e,t){if(e===t)return!0;let n=cc(e);if(n!==cc(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return cn(e).isEqual(cn(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let i=u3(e.timestampValue),r=u3(t.timestampValue);return i.seconds===r.seconds&&i.nanos===r.nanos;case 5:return e.stringValue===t.stringValue;case 6:return u5(e.bytesValue).isEqual(u5(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return u6(e.geoPointValue.latitude)===u6(t.geoPointValue.latitude)&&u6(e.geoPointValue.longitude)===u6(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return u6(e.integerValue)===u6(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=u6(e.doubleValue),i=u6(t.doubleValue);return n===i?u$(n)===u$(i):isNaN(n)&&isNaN(i)}return!1;case 9:return uN(e.arrayValue.values||[],t.arrayValue.values||[],cd);case 10:case 11:let s=e.mapValue.fields||{},a=t.mapValue.fields||{};if(uH(s)!==uH(a))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===a[e]||!cd(s[e],a[e])))return!1;return!0;default:return uu(52216,{left:e})}}function cf(e,t){return void 0!==(e.values||[]).find(e=>cd(e,t))}function cp(e,t){var n,i,r,s,a,o,l,h,u,c;if(e===t)return 0;let d=cc(e),f=cc(t);if(d!==f)return uS(d,f);switch(d){case 0:case 0x1fffffffffffff:return 0;case 1:return uS(e.booleanValue,t.booleanValue);case 2:let p,g;return p=u6(e.integerValue||e.doubleValue),p<(g=u6(t.integerValue||t.doubleValue))?-1:p>g?1:p===g?0:isNaN(p)?isNaN(g)?0:-1:1;case 3:return cg(e.timestampValue,t.timestampValue);case 4:return cg(cn(e),cn(t));case 5:return uk(e.stringValue,t.stringValue);case 6:let m,y;return n=e.bytesValue,i=t.bytesValue,m=u5(n),y=u5(i),m.compareTo(y);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=uS(n[e],i[e]);if(0!==t)return t}return uS(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:let _;return r=e.geoPointValue,s=t.geoPointValue,0!==(_=uS(u6(r.latitude),u6(s.latitude)))?_:uS(u6(r.longitude),u6(s.longitude));case 9:return cm(e.arrayValue,t.arrayValue);case 10:let v,w,b,T,E;return a=e.mapValue,o=t.mapValue,v=a.fields||{},w=o.fields||{},b=null==(l=v[cu])?void 0:l.arrayValue,T=null==(h=w[cu])?void 0:h.arrayValue,0!==(E=uS((null==(u=null==b?void 0:b.values)?void 0:u.length)||0,(null==(c=null==T?void 0:T.values)?void 0:c.length)||0))?E:cm(b,T);case 11:return function(e,t){if(e===cl&&t===cl)return 0;if(e===cl)return 1;if(t===cl)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=uk(i[e],s[e]);if(0!==t)return t;let a=cp(n[i[e]],r[s[e]]);if(0!==a)return a}return uS(i.length,s.length)}(e.mapValue,t.mapValue);default:throw uu(23264,{Pe:d})}}function cg(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return uS(e,t);let n=u3(e),i=u3(t),r=uS(n.seconds,i.seconds);return 0!==r?r:uS(n.nanos,i.nanos)}function cm(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=cp(n[e],i[e]);if(t)return t}return uS(n.length,i.length)}function cy(e){var t,n;let i;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(i=u3(e.timestampValue),`time(${i.seconds},${i.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?u5(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,uF.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=cy(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${cy(e.fields[r])}`;return n+"}"}(e.mapValue):uu(61005,{value:e})}function c_(e){return!!e&&"integerValue"in e}function cv(e){return!!e&&"arrayValue"in e}function cw(e){return!!e&&"nullValue"in e}function cb(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function cT(e){return!!e&&"mapValue"in e}function cE(e){var t,n;return(null==(n=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[ca])?void 0:n.stringValue)===ch}function cI(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return uW(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=cI(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=cI(e.arrayValue.values[n]);return t}return Object.assign({},e)}function cC(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===co}class cS{constructor(e){this.value=e}static empty(){return new cS({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!cT(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=cI(t)}setAll(e){let t=uM.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=cI(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());cT(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return cd(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];cT(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(uW(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new cS(cI(this.value))}}class ck{constructor(e,t,n,i,r,s,a){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=a}static newInvalidDocument(e){return new ck(e,0,uP.min(),uP.min(),uP.min(),cS.empty(),0)}static newFoundDocument(e,t,n,i){return new ck(e,1,t,uP.min(),n,i,0)}static newNoDocument(e,t){return new ck(e,2,t,uP.min(),uP.min(),cS.empty(),0)}static newUnknownDocument(e,t){return new ck(e,3,t,uP.min(),uP.min(),cS.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(uP.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=cS.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=cS.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=uP.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ck&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ck(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class cA{constructor(e,t){this.position=e,this.inclusive=t}}function cN(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],a=e.position[r];if(i=s.field.isKeyField()?uF.comparator(uF.fromName(a.referenceValue),n.key):cp(a,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function cR(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!cd(e.position[n],t.position[n]))return!1;return!0}class cP{constructor(e,t="asc"){this.field=e,this.dir=t}}class cx{}class cD extends cx{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new cF(e,t,n):"array-contains"===t?new cq(e,n):"in"===t?new cB(e,n):"not-in"===t?new cz(e,n):"array-contains-any"===t?new c$(e,n):new cD(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new cU(e,n):new cV(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(cp(t,this.value)):null!==t&&cc(this.value)===cc(t)&&this.matchesComparison(cp(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return uu(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class cO extends cx{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new cO(e,t)}matches(e){return cL(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function cL(e){return"and"===e.op}function cM(e){for(let t of e.filters)if(t instanceof cO)return!1;return!0}class cF extends cD{constructor(e,t,n){super(e,t,n),this.key=uF.fromName(n.referenceValue)}matches(e){let t=uF.comparator(e.key,this.key);return this.matchesComparison(t)}}class cU extends cD{constructor(e,t){super(e,"in",t),this.keys=cj("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class cV extends cD{constructor(e,t){super(e,"not-in",t),this.keys=cj("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function cj(e,t){var n;return((null==(n=t.arrayValue)?void 0:n.values)||[]).map(e=>uF.fromName(e.referenceValue))}class cq extends cD{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cv(t)&&cf(t.arrayValue,this.value)}}class cB extends cD{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&cf(this.value.arrayValue,t)}}class cz extends cD{constructor(e,t){super(e,"not-in",t)}matches(e){if(cf(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!cf(this.value.arrayValue,t)}}class c$ extends cD{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!cv(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>cf(this.value.arrayValue,e))}}class cH{constructor(e,t=null,n=[],i=[],r=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=a,this.Ie=null}}function cW(e,t=null,n=[],i=[],r=null,s=null,a=null){return new cH(e,t,n,i,r,s,a)}function cK(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof cD)return t.field.canonicalString()+t.op.toString()+cy(t.value);if(cM(t)&&cL(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>cy(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>cy(e)).join(",")),e.Ie=t}return e.Ie}function cG(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof cD?n instanceof cD&&t.op===n.op&&t.field.isEqual(n.field)&&cd(t.value,n.value):t instanceof cO?n instanceof cO&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void uu(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!cR(e.startAt,t.startAt)&&cR(e.endAt,t.endAt)}function cQ(e){return uF.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class cY{constructor(e,t=null,n=[],i=[],r=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=a,this.endAt=o,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function cJ(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function cX(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new uJ(uM.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new cP(t,i))}),n.has(uM.keyField().canonicalString())||e.Ee.push(new cP(uM.keyField(),i))}return e.Ee}function cZ(e){return e.de||(e.de=function(e,t){if("F"===e.limitType)return cW(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new cP(e.field,t)});let n=e.endAt?new cA(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new cA(e.startAt.position,e.startAt.inclusive):null;return cW(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(e,cX(e))),e.de}function c0(e,t,n){return new cY(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function c1(e,t){return cG(cZ(e),cZ(t))&&e.limitType===t.limitType}function c2(e){return`${cK(cZ(e))}|lt:${e.limitType}`}function c3(e){var t;let n;return`Query(target=${n=(t=cZ(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof cD?`${t.field.canonicalString()} ${t.op} ${cy(t.value)}`:t instanceof cO?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>cy(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>cy(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function c6(e,t){var n,i,r,s;let a,o,l;return t.isFoundDocument()&&(a=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(a):uF.isDocumentKey(e.path)?e.path.isEqual(a):e.path.isImmediateParentOf(a))&&function(e,t){for(let n of cX(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,i=t,(!n.startAt||(r=n.startAt,o=cN(r,cX(n),i),r.inclusive?!!(o<=0):!!(o<0)))&&(!n.endAt||(s=n.endAt,l=cN(s,cX(n),i),s.inclusive?!!(l>=0):!!(l>0))))}function c5(e){return(t,n)=>{let i=!1;for(let r of cX(e)){let e=function(e,t,n){var i;let r,s,a=e.field.isKeyField()?uF.comparator(t.key,n.key):(i=e.field,r=t.data.field(i),s=n.data.field(i),null!==r&&null!==s?cp(r,s):uu(42886));switch(e.dir){case"asc":return a;case"desc":return -1*a;default:return uu(19790,{direction:e.dir})}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class c4{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){uW(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return uK(this.inner)}size(){return this.innerSize}}let c8=new uG(uF.comparator),c9=new uG(uF.comparator);function c7(...e){let t=c9;for(let n of e)t=t.insert(n.key,n);return t}function de(e){let t=c9;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function dt(){return new c4(e=>e.toString(),(e,t)=>e.isEqual(t))}let dn=new uG(uF.comparator),di=new uJ(uF.comparator);function dr(...e){let t=di;for(let n of e)t=t.add(n);return t}let ds=new uJ(uS);function da(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:u$(t)?"-0":t}}function dl(e){return{integerValue:""+e}}class dh{constructor(){this._=void 0}}function du(e,t){return e instanceof dm?c_(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class dc extends dh{}class dd extends dh{constructor(e){super(),this.elements=e}}function df(e,t){let n=d_(t);for(let t of e.elements)n.some(e=>cd(e,t))||n.push(t);return{arrayValue:{values:n}}}class dp extends dh{constructor(e){super(),this.elements=e}}function dg(e,t){let n=d_(t);for(let t of e.elements)n=n.filter(e=>!cd(e,t));return{arrayValue:{values:n}}}class dm extends dh{constructor(e,t){super(),this.serializer=e,this.Re=t}}function dy(e){return u6(e.integerValue||e.doubleValue)}function d_(e){return cv(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class dv{constructor(e,t){this.version=e,this.transformResults=t}}class dw{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new dw}static exists(e){return new dw(void 0,e)}static updateTime(e){return new dw(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function db(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class dT{}function dE(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new dP(e.key,dw.none()):new dS(e.key,e.data,dw.none());{let n=e.data,i=cS.empty(),r=new uJ(uM.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new dk(e.key,i,new uZ(r.toArray()),dw.none())}}function dI(e,t,n,i){return e instanceof dS?function(e,t,n,i){if(!db(e.precondition,t))return n;let r=e.value.clone(),s=dR(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof dk?function(e,t,n,i){if(!db(e.precondition,t))return n;let r=dR(e.fieldTransforms,i,t),s=t.data;return(s.setAll(dA(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):db(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function dC(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&uN(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof dd&&i instanceof dd||n instanceof dp&&i instanceof dp?uN(n.elements,i.elements,cd):n instanceof dm&&i instanceof dm?cd(n.Re,i.Re):n instanceof dc&&i instanceof dc)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class dS extends dT{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class dk extends dT{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function dA(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function dN(e,t,n){let i=new Map;ud(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var r;let a=e[s],o=a.transform,l=t.data.field(a.field);i.set(a.field,(r=n[s],o instanceof dd?df(o,l):o instanceof dp?dg(o,l):r))}return i}function dR(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,function(e,t,n){var i;let r,s,a;return e instanceof dc?(i=t,r={fields:{[u8]:{stringValue:u4},[u7]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},i&&ce(i)&&(i=ct(i)),i&&(r.fields[u9]=i),{mapValue:r}):e instanceof dd?df(e,t):e instanceof dp?dg(e,t):(a=dy(s=du(e,t))+dy(e.Re),c_(s)&&c_(e.Re)?dl(a):da(e.serializer,a))}(e,s,t))}return i}class dP extends dT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class dx extends dT{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class dD{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let i=this.mutations[t];i.key.isEqual(e.key)&&function(e,t,n){let i,r;e instanceof dS?(i=e.value.clone(),r=dN(e.fieldTransforms,t,n.transformResults),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()):e instanceof dk?function(e,t,n){if(!db(e.precondition,t))return t.convertToUnknownDocument(n.version);let i=dN(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(dA(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(i,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=dI(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=dI(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=dt();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,a=this.applyToLocalView(s,r.mutatedFields),o=dE(s,a=t.has(i.key)?null:a);null!==o&&n.set(i.key,o),s.isValidDocument()||s.convertToNoDocument(uP.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),dr())}isEqual(e){return this.batchId===e.batchId&&uN(this.mutations,e.mutations,(e,t)=>dC(e,t))&&uN(this.baseMutations,e.baseMutations,(e,t)=>dC(e,t))}}class dO{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){ud(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=dn,r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new dO(e,t,n,i)}}class dL{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class dM{constructor(e,t){this.count=e,this.unchangedNames=t}}function dF(e){if(void 0===e)return uo("GRPC error has no .code"),uf.UNKNOWN;switch(e){case j.OK:return uf.OK;case j.CANCELLED:return uf.CANCELLED;case j.UNKNOWN:return uf.UNKNOWN;case j.DEADLINE_EXCEEDED:return uf.DEADLINE_EXCEEDED;case j.RESOURCE_EXHAUSTED:return uf.RESOURCE_EXHAUSTED;case j.INTERNAL:return uf.INTERNAL;case j.UNAVAILABLE:return uf.UNAVAILABLE;case j.UNAUTHENTICATED:return uf.UNAUTHENTICATED;case j.INVALID_ARGUMENT:return uf.INVALID_ARGUMENT;case j.NOT_FOUND:return uf.NOT_FOUND;case j.ALREADY_EXISTS:return uf.ALREADY_EXISTS;case j.PERMISSION_DENIED:return uf.PERMISSION_DENIED;case j.FAILED_PRECONDITION:return uf.FAILED_PRECONDITION;case j.ABORTED:return uf.ABORTED;case j.OUT_OF_RANGE:return uf.OUT_OF_RANGE;case j.UNIMPLEMENTED:return uf.UNIMPLEMENTED;case j.DATA_LOSS:return uf.DATA_LOSS;default:return uu(39323,{code:e})}}(q=j||(j={}))[q.OK=0]="OK",q[q.CANCELLED=1]="CANCELLED",q[q.UNKNOWN=2]="UNKNOWN",q[q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",q[q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",q[q.NOT_FOUND=5]="NOT_FOUND",q[q.ALREADY_EXISTS=6]="ALREADY_EXISTS",q[q.PERMISSION_DENIED=7]="PERMISSION_DENIED",q[q.UNAUTHENTICATED=16]="UNAUTHENTICATED",q[q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",q[q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",q[q.ABORTED=10]="ABORTED",q[q.OUT_OF_RANGE=11]="OUT_OF_RANGE",q[q.UNIMPLEMENTED=12]="UNIMPLEMENTED",q[q.INTERNAL=13]="INTERNAL",q[q.UNAVAILABLE=14]="UNAVAILABLE",q[q.DATA_LOSS=15]="DATA_LOSS";let dU=new R([0xffffffff,0xffffffff],0);function dV(e){let t=uI().encode(e),n=new P;return n.update(t),new Uint8Array(n.digest())}function dj(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),i=t.getUint32(4,!0),r=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new R([n,i],0),new R([r,s],0)]}class dq{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new dB(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new dB(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new dB(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=R.fromNumber(this.pe)}we(e,t,n){let i=e.add(t.multiply(R.fromNumber(n)));return 1===i.compare(dU)&&(i=new R([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,n]=dj(dV(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);if(!this.be(i))return!1}return!0}static create(e,t,n){let i=new dq(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.pe)return;let[t,n]=dj(dV(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);this.Se(i)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class dB extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class dz{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,d$.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new dz(uP.min(),i,new uG(uS),c8,dr())}}class d${constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new d$(n,t,dr(),dr(),dr())}}class dH{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}}class dW{constructor(e,t){this.targetId=e,this.Ce=t}}class dK{constructor(e,t,n=u1.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class dG{constructor(){this.Fe=0,this.Me=dJ(),this.xe=u1.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=dr(),t=dr(),n=dr();return this.Me.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:uu(38017,{changeType:r})}}),new d$(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=dJ()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,ud(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class dQ{constructor(e){this.ze=e,this.je=new Map,this.He=c8,this.Je=dY(),this.Ye=dY(),this.Ze=new uG(uS)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:uu(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){let t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){let r=i.target;if(cQ(r))if(0===n){let e=new uF(r.path);this.tt(t,e,ck.newNoDocument(e,uP.min()))}else ud(1===n,20013,{expectedCount:n});else{let i=this.ut(t);if(i!==n){let n=this.ct(e),r=n?this.lt(n,e,i):1;0!==r&&(this.st(t),this.Ze=this.Ze.insert(t,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ct(e){let t,n,i=e.Ce.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:a=0}=i;try{t=u5(r).toUint8Array()}catch(e){if(e instanceof u0)return ul("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new dq(t,s,a)}catch(e){return ul(e instanceof dB?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.pe?null:n}lt(e,t,n){return 2*(t.Ce.count!==n-this.Tt(e,t.targetId))}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),i=0;return n.forEach(n=>{let r=this.ze.Pt(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),i++)}),i}It(e){let t=new Map;this.je.forEach((n,i)=>{let r=this._t(i);if(r){if(n.current&&cQ(r.target)){let t=new uF(r.target.path);this.Et(t).has(i)||this.dt(i,t)||this.tt(i,t,ck.newNoDocument(t,e))}n.Le&&(t.set(i,n.qe()),n.Qe())}});let n=dr();this.Ye.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));let i=new dz(e,t,this.Ze,this.He,n);return this.He=c8,this.Je=dY(),this.Ye=dY(),this.Ze=new uG(uS),i}et(e,t){if(!this.it(e))return;let n=2*!!this.dt(e,t.key);this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new dG,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new uJ(uS),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new uJ(uS),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||ua("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new dG),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function dY(){return new uG(uF.comparator)}function dJ(){return new uG(uF.comparator)}let dX={asc:"ASCENDING",desc:"DESCENDING"},dZ={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},d0={and:"AND",or:"OR"};class d1{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function d2(e,t){return e.useProto3Json||null==t?t:{value:t}}function d3(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function d6(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function d5(e){let t;return ud(!!e,49232),uP.fromTimestamp(new uR((t=u3(e)).seconds,t.nanos))}function d4(e,t){return d8(e,t).canonicalString()}function d8(e,t){let n=new uO(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function d9(e){let t=uO.fromString(e);return ud(fo(t),10190,{key:t.toString()}),t}function d7(e,t){return d4(e.databaseId,t.path)}function fe(e,t){let n=d9(t);if(n.get(1)!==e.databaseId.projectId)throw new up(uf.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new up(uf.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new uF(fi(n))}function ft(e,t){return d4(e.databaseId,t)}function fn(e){return new uO(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function fi(e){return ud(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function fr(e,t,n){return{name:d7(e,t),fields:n.value.mapValue.fields}}function fs(e){return{fieldPath:e.canonicalString()}}function fa(e){return uM.fromServerFormat(e.fieldPath)}function fo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class fl{constructor(e,t,n,i,r=uP.min(),s=uP.min(),a=u1.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new fl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new fl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new fl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new fl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class fh{constructor(e){this.wt=e}}class fu{vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(+!!e.booleanValue);else if("integerValue"in e)this.Mt(t,15),t.xt(u6(e.integerValue));else if("doubleValue"in e){let n=u6(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),u$(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=u3(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(u5(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?cC(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):cE(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):uu(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,i;let r=e.fields||{};this.Mt(t,53);let s=(null==(i=null==(n=r[cu].arrayValue)?void 0:n.values)?void 0:i.length)||0;this.Mt(t,15),t.xt(u6(s)),this.Nt(cu,t),this.Ct(r[cu],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),uF.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}fu.Wt=new fu;class fc{constructor(){this.yn=new fd}addToCollectionParentIndex(e,t){return this.yn.add(t),uq.resolve()}getCollectionParents(e,t){return uq.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return uq.resolve()}deleteFieldIndex(e,t){return uq.resolve()}deleteAllFieldIndexes(e){return uq.resolve()}createTargetIndexes(e,t){return uq.resolve()}getDocumentsMatchingTarget(e,t){return uq.resolve(null)}getIndexType(e,t){return uq.resolve(0)}getFieldIndexes(e,t){return uq.resolve([])}getNextCollectionGroupToUpdate(e){return uq.resolve(null)}getMinOffset(e,t){return uq.resolve(uU.min())}getMinOffsetFromCollectionGroup(e,t){return uq.resolve(uU.min())}updateCollectionGroup(e,t,n){return uq.resolve()}updateIndexEntries(e,t){return uq.resolve()}}class fd{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new uJ(uO.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new uJ(uO.comparator)).toArray()}}new Uint8Array(0);let ff={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class fp{static withCacheSize(e){return new fp(e,fp.DEFAULT_COLLECTION_PERCENTILE,fp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}fp.DEFAULT_COLLECTION_PERCENTILE=10,fp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,fp.DEFAULT=new fp(0x2800000,fp.DEFAULT_COLLECTION_PERCENTILE,fp.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),fp.DISABLED=new fp(-1,0,0);class fg{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new fg(0)}static ir(){return new fg(-1)}}let fm="LruGarbageCollector";function fy([e,t],[n,i]){let r=uS(e,n);return 0===r?uS(t,i):r}class f_{constructor(e){this.cr=e,this.buffer=new uJ(fy),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>fy(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fv{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return null!==this.Tr}Ir(e){ua(fm,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){uB(e)?ua(fm,"Ignoring IndexedDB error during garbage collection: ",e):await uj(e)}await this.Ir(3e5)})}}class fw{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return uq.resolve(uz.le);let n=new f_(t);return this.Er.forEachTarget(e,e=>n.Pr(e.sequenceNumber)).next(()=>this.Er.Ar(e,e=>n.Pr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ua("LruGarbageCollector","Garbage collection skipped; disabled"),uq.resolve(ff)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ua("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ff):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,i,r,s,a,o,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ua("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,a=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,o=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),us()<=A.DEBUG&&ua("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${i} in `+(a-s)+"ms\n"+`	Removed ${r} targets in `+(o-a)+"ms\n"+`	Removed ${e} documents in `+(l-o)+"ms\n"+`Total Duration: ${l-h}ms`),uq.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class fb{constructor(){this.changes=new c4(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ck.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?uq.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class fE{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&dI(n.mutation,e,uZ.empty(),uR.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,dr()).next(()=>t))}getLocalViewOfDocuments(e,t,n=dr()){let i=dt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=c7();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=dt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,dr()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=c8,s=dt(),a=dt();return t.forEach((e,t)=>{let a=n.get(t.key);i.has(t.key)&&(void 0===a||a.mutation instanceof dk)?r=r.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),dI(a.mutation,t,a.mutation.getFieldMask(),uR.now())):s.set(t.key,uZ.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return a.set(e,new fT(t,null!=(n=s.get(e))?n:null))}),a))}recalculateAndSaveOverlays(e,t){let n=dt(),i=new uG((e,t)=>e-t),r=dr();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=n.get(e)||uZ.empty();a=r.applyToLocalView(s,a),n.set(e,a);let o=(i.get(r.batchId)||dr()).add(e);i=i.insert(r.batchId,o)})}).next(()=>{let s=[],a=i.getReverseIterator();for(;a.hasNext();){let i=a.getNext(),o=i.key,l=i.value,h=dt();l.forEach(e=>{if(!r.has(e)){let i=dE(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,h))}return uq.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return uF.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):uq.resolve(dt()),a=-1,o=r;return s.next(t=>uq.forEach(t,(t,n)=>(a<n.largestBatchId&&(a=n.largestBatchId),r.get(t)?uq.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,dr())).next(e=>({batchId:a,changes:de(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new uF(t)).next(e=>{let t=c7();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let r=t.collectionGroup,s=c7();return this.indexManager.getCollectionParents(e,r).next(a=>uq.forEach(a,a=>{let o=new cY(a.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,o,n,i).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,ck.newInvalidDocument(i)))});let n=c7();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&dI(s.mutation,i,uZ.empty(),uR.now()),c6(t,i)&&(n=n.insert(e,i))}),n})}}class fI{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return uq.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,{id:t.id,version:t.version,createTime:d5(t.createTime)}),uq.resolve()}getNamedQuery(e,t){return uq.resolve(this.Mr.get(t))}saveNamedQuery(e,t){var n;let i;return this.Mr.set(t.name,{name:t.name,query:(i=function(e){var t,n,i,r;let s,a,o,l,h,u=4===(s=d9(e.parent)).length?uO.emptyPath():fi(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){ud(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(a=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=fa(e.unaryFilter.field);return cD.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=fa(e.unaryFilter.field);return cD.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=fa(e.unaryFilter.field);return cD.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=fa(e.unaryFilter.field);return cD.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return uu(61313);default:return uu(60726)}}(t):void 0!==t.fieldFilter?cD.create(fa(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return uu(58110);default:return uu(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?cO.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return uu(1026)}}(t.compositeFilter.op)):uu(30097,{filter:t})}(c.where))instanceof cO&&cM(t=a)&&cL(t)?a.getFilters():[a]);let g=[];c.orderBy&&(g=c.orderBy.map(e=>new cP(fa(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let m=null;c.limit&&(m=null==(o="object"==typeof(n=c.limit)?n.value:n)?null:o);let y=null;c.startAt&&(l=!!(i=c.startAt).before,y=new cA(i.values||[],l));let _=null;return c.endAt&&(h=!(r=c.endAt).before,_=new cA(r.values||[],h)),new cY(u,f,g,p,m,"F",y,_)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?c0(i,i.limit,"L"):i),readTime:d5(t.readTime)}),uq.resolve()}}class fC{constructor(){this.overlays=new uG(uF.comparator),this.Or=new Map}getOverlay(e,t){return uq.resolve(this.overlays.get(t))}getOverlays(e,t){let n=dt();return uq.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),uq.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Or.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.Or.delete(n)),uq.resolve()}getOverlaysForCollection(e,t,n){let i=dt(),r=t.length+1,s=new uF(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return uq.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new uG((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=dt(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=dt(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=i)););return uq.resolve(a)}St(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.Or.get(i.largestBatchId).delete(n.key);this.Or.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new dL(t,n));let r=this.Or.get(t);void 0===r&&(r=dr(),this.Or.set(t,r)),this.Or.set(t,r.add(n.key))}}class fS{constructor(){this.sessionToken=u1.EMPTY_BYTE_STRING}getSessionToken(e){return uq.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,uq.resolve()}}class fk{constructor(){this.Nr=new uJ(fA.Br),this.Lr=new uJ(fA.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let n=new fA(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Qr(new fA(e,t))}$r(e,t){e.forEach(e=>this.removeReference(e,t))}Ur(e){let t=new uF(new uO([])),n=new fA(t,e),i=new fA(t,e+1),r=[];return this.Lr.forEachInRange([n,i],e=>{this.Qr(e),r.push(e.key)}),r}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new uF(new uO([])),n=new fA(t,e),i=new fA(t,e+1),r=dr();return this.Lr.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new fA(e,0),n=this.Nr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class fA{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return uF.comparator(e.key,t.key)||uS(e.Gr,t.Gr)}static kr(e,t){return uS(e.Gr,t.Gr)||uF.comparator(e.key,t.key)}}class fN{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new uJ(fA.Br)}checkEmpty(e){return uq.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new dD(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.zr=this.zr.add(new fA(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return uq.resolve(s)}lookupMutationBatch(e,t){return uq.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Hr(t+1),i=n<0?0:n;return uq.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return uq.resolve(0===this.mutationQueue.length?-1:this.Jn-1)}getAllMutationBatches(e){return uq.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new fA(t,0),i=new fA(t,1/0),r=[];return this.zr.forEachInRange([n,i],e=>{let t=this.jr(e.Gr);r.push(t)}),uq.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new uJ(uS);return t.forEach(e=>{let t=new fA(e,0),i=new fA(e,1/0);this.zr.forEachInRange([t,i],e=>{n=n.add(e.Gr)})}),uq.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;uF.isDocumentKey(r)||(r=r.child(""));let s=new fA(new uF(r),0),a=new uJ(uS);return this.zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(a=a.add(e.Gr)),!0)},s),uq.resolve(this.Jr(a))}Jr(e){let t=[];return e.forEach(e=>{let n=this.jr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){ud(0===this.Yr(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.zr;return uq.forEach(t.mutations,i=>{let r=new fA(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=n})}Xn(e){}containsKey(e,t){let n=new fA(t,0),i=this.zr.firstAfterOrEqual(n);return uq.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,uq.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class fR{constructor(e){this.Zr=e,this.docs=new uG(uF.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return uq.resolve(n?n.document.mutableCopy():ck.newInvalidDocument(t))}getEntries(e,t){let n=c8;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():ck.newInvalidDocument(e))}),uq.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=c8,s=t.path,a=new uF(s.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=uF.comparator(e.documentKey,t.documentKey))?n:uS(e.largestBatchId,t.largestBatchId)}(new uU(a.readTime,a.key,-1),n)||(i.has(a.key)||c6(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return uq.resolve(r)}getAllFromCollectionGroup(e,t,n,i){uu(9500)}Xr(e,t){return uq.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new fP(this)}getSize(e){return uq.resolve(this.size)}}class fP extends fb{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(n)}),uq.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}class fx{constructor(e){this.persistence=e,this.ei=new c4(e=>cK(e),cG),this.lastRemoteSnapshotVersion=uP.min(),this.highestTargetId=0,this.ti=0,this.ni=new fk,this.targetCount=0,this.ri=fg.rr()}forEachTarget(e,t){return this.ei.forEach((e,n)=>t(n)),uq.resolve()}getLastRemoteSnapshotVersion(e){return uq.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return uq.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),uq.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),uq.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new fg(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,uq.resolve()}updateTargetData(e,t){return this.ar(t),uq.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,uq.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.ei.forEach((s,a)=>{a.sequenceNumber<=t&&null===n.get(a.targetId)&&(this.ei.delete(s),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),uq.waitFor(r).next(()=>i)}getTargetCount(e){return uq.resolve(this.targetCount)}getTargetData(e,t){let n=this.ei.get(t)||null;return uq.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),uq.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),uq.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),uq.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ni.Wr(t);return uq.resolve(n)}containsKey(e,t){return uq.resolve(this.ni.containsKey(t))}}class fD{constructor(e,t){this.ii={},this.overlays={},this.si=new uz(0),this.oi=!1,this.oi=!0,this._i=new fS,this.referenceDelegate=e(this),this.ai=new fx(this),this.indexManager=new fc,this.remoteDocumentCache=new fR(e=>this.referenceDelegate.ui(e)),this.serializer=new fh(t),this.ci=new fI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new fN(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){ua("MemoryPersistence","Starting transaction:",e);let i=new fO(this.si.next());return this.referenceDelegate.li(),n(i).next(e=>this.referenceDelegate.hi(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Pi(e,t){return uq.or(Object.values(this.ii).map(n=>()=>n.containsKey(e,t)))}}class fO extends uV{constructor(e){super(),this.currentSequenceNumber=e}}class fL{constructor(e){this.persistence=e,this.Ti=new fk,this.Ii=null}static Ei(e){return new fL(e)}get di(){if(this.Ii)return this.Ii;throw uu(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),uq.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),uq.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),uq.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return uq.forEach(this.di,n=>{let i=uF.fromPath(n);return this.Ai(e,i).next(e=>{e||t.removeEntry(i,uP.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return uq.or([()=>uq.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class fM{constructor(e,t){this.persistence=e,this.Ri=new c4(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,i=e.length;for(let t=0;t<i;t++){let i=e.charAt(t);switch(i){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=i}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new fw(this,t)}static Ei(e,t){return new fM(e,t)}li(){}hi(e){return uq.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}Ar(e,t){return uq.forEach(this.Ri,(n,i)=>this.gr(e,n,i).next(e=>e?uq.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.Xr(e,i=>this.gr(e,i,t).next(e=>{e||(n++,r.removeEntry(i,uP.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),uq.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),uq.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),uq.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),uq.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(cc(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=ct(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return u5(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var i;let r;return i=t.mapValue,r=0,uW(i.fields,(t,n)=>{r+=t.length+e(n)}),r;default:throw uu(13486,{value:t})}}(e.data.value)),t}gr(e,t,n){return uq.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Ri.get(t);return uq.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fF{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=i}static Ps(e,t){let n=dr(),i=dr();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new fF(e,t.fromCache,n,i)}}class fU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fV{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=function(){let t;return!function(){var t;let n=null==(t=ee())?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=eo().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,i){let r={result:null};return this.Rs(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Vs(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;let n=new fU;return this.fs(e,t,n).next(i=>{if(r.result=i,this.Is)return this.gs(e,t,n,i.size)})}).next(()=>r.result)}gs(e,t,n,i){return n.documentReadCount<this.Es?(us()<=A.DEBUG&&ua("QueryEngine","SDK will not create cache indexes for query:",c3(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),uq.resolve()):(us()<=A.DEBUG&&ua("QueryEngine","Query:",c3(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(us()<=A.DEBUG&&ua("QueryEngine","The SDK decides to create cache indexes for query:",c3(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,cZ(t))):uq.resolve())}Rs(e,t){if(cJ(t))return uq.resolve(null);let n=cZ(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=cZ(t=c0(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=dr(...i);return this.As.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ps(t,i);return this.ys(t,s,r,n.readTime)?this.Rs(e,c0(t,null,"F")):this.ws(e,s,t,n)}))})))}Vs(e,t,n,i){return cJ(t)||i.isEqual(uP.min())?uq.resolve(null):this.As.getDocuments(e,n).next(r=>{let s,a,o=this.ps(t,r);return this.ys(t,o,n,i)?uq.resolve(null):(us()<=A.DEBUG&&ua("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),c3(t)),this.ws(e,o,t,(s=i.toTimestamp().seconds,a=i.toTimestamp().nanoseconds+1,new uU(uP.fromTimestamp(1e9===a?new uR(s+1,0):new uR(s,a)),uF.empty(),-1))).next(e=>e))})}ps(e,t){let n=new uJ(c5(e));return t.forEach((t,i)=>{c6(e,i)&&(n=n.add(i))}),n}ys(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}fs(e,t,n){return us()<=A.DEBUG&&ua("QueryEngine","Using full collection scan to execute query:",c3(t)),this.As.getDocumentsMatchingQuery(e,t,uU.min(),n)}ws(e,t,n,i){return this.As.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let fj="LocalStore";class fq{constructor(e,t,n,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new uG(uS),this.Ds=new c4(e=>cK(e),cG),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new fE(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}}async function fB(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.Fs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],a=dr();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return e.localDocuments.getDocuments(n,a).next(e=>({Ms:e,removedBatchIds:r,addedBatchIds:s}))})})}function fz(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}async function f$(e,t,n){let i=e.Ss.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!uB(e))throw e;ua(fj,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ss=e.Ss.remove(t),e.Ds.delete(i.target)}function fH(e,t,n){let i=uP.min(),r=dr();return e.persistence.runTransaction("Execute query","readwrite",s=>{var a;let o;return(a=cZ(t),void 0!==(o=e.Ds.get(a))?uq.resolve(e.Ss.get(o)):e.ai.getTargetData(s,a)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.ai.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.bs.getDocumentsMatchingQuery(s,t,n?i:uP.min(),n?r:dr())).next(n=>{var i,s,a;let o;return i=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),a=n,o=i.vs.get(s)||uP.min(),a.forEach((e,t)=>{t.readTime.compareTo(o)>0&&(o=t.readTime)}),i.vs.set(s,o),{documents:n,Ns:r}})})}class fW{constructor(){this.activeTargetIds=ds}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class fK{constructor(){this.So=new fW,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new fW,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class fG{vo(e){}shutdown(){}}let fQ="ConnectivityMonitor";class fY{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){for(let e of(ua(fQ,"Network connectivity changed: AVAILABLE"),this.Oo))e(0)}xo(){for(let e of(ua(fQ,"Network connectivity changed: UNAVAILABLE"),this.Oo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let fJ=null;function fX(){return null===fJ?fJ=0x10000000+Math.round(0x80000000*Math.random()):fJ++,"0x"+fJ.toString(16)}let fZ="RestConnection",f0={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class f1{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${i}`,this.qo=this.databaseId.database===cr?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Qo(e,t,n,i,r){let s=fX(),a=this.$o(e,t.toUriEncodedString());ua(fZ,`Sending RPC '${e}' ${s}:`,a,n);let o={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};this.Uo(o,i,r);let{host:l}=new URL(a),h=eq(l);return this.Ko(e,a,o,n,h).then(t=>(ua(fZ,`Received RPC '${e}' ${s}: `,t),t),t=>{throw ul(fZ,`RPC '${e}' ${s} failed with error: `,t,"url: ",a,"request:",n),t})}Wo(e,t,n,i,r,s){return this.Qo(e,t,n,i,r)}Uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+ui,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}$o(e,t){let n=f0[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}}class f2{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}let f3="WebChannelConnection";class f6 extends f1{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,i,r){let s=fX();return new Promise((r,a)=>{let o=new x;o.setWithCredentials(!0),o.listenOnce(O.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case L.NO_ERROR:let t=o.getResponseJson();ua(f3,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),r(t);break;case L.TIMEOUT:ua(f3,`RPC '${e}' ${s} timed out`),a(new up(uf.DEADLINE_EXCEEDED,"Request time out"));break;case L.HTTP_ERROR:let n=o.getStatus();if(ua(f3,`RPC '${e}' ${s} failed with status:`,n,"response text:",o.getResponseText()),n>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(uf).indexOf(e)>=0?e:uf.UNKNOWN);a(new up(n,t.message))}else a(new up(uf.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new up(uf.UNAVAILABLE,"Connection failed."));break;default:uu(9055,{s_:e,streamId:s,o_:o.getLastErrorCode(),__:o.getLastError()})}}finally{ua(f3,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(i);ua(f3,`RPC '${e}' ${s} sending request:`,i),o.send(t,"POST",l,n,15)})}a_(e,t,n){let i=fX(),r=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=V(),a=U(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.Uo(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;let h=r.join("");ua(f3,`Creating RPC '${e}' stream ${i}: ${h}`,o);let u=s.createWebChannel(h,o),c=!1,d=!1,f=new f2({Go:t=>{d?ua(f3,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(c||(ua(f3,`Opening RPC '${e}' stream ${i} transport.`),u.open(),c=!0),ua(f3,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,D.EventType.OPEN,()=>{d||(ua(f3,`RPC '${e}' stream ${i} transport opened.`),f.t_())}),p(u,D.EventType.CLOSE,()=>{d||(d=!0,ua(f3,`RPC '${e}' stream ${i} transport closed`),f.r_())}),p(u,D.EventType.ERROR,t=>{d||(d=!0,ul(f3,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),f.r_(new up(uf.UNAVAILABLE,"The operation could not be completed")))}),p(u,D.EventType.MESSAGE,t=>{var n;if(!d){let r=t.data[0];ud(!!r,16349);let s=(null==r?void 0:r.error)||(null==(n=r[0])?void 0:n.error);if(s){ua(f3,`RPC '${e}' stream ${i} received error:`,s);let t=s.status,n=function(e){let t=j[e];if(void 0!==t)return dF(t)}(t),r=s.message;void 0===n&&(n=uf.INTERNAL,r="Unknown error status: "+t+" with message "+s.message),d=!0,f.r_(new up(n,r)),u.close()}else ua(f3,`RPC '${e}' stream ${i} received:`,r),f.i_(r)}}),p(a,F.STAT_EVENT,t=>{t.stat===M.PROXY?ua(f3,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===M.NOPROXY&&ua(f3,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{f.n_()},0),f}}function f5(){return"undefined"!=typeof document?document:null}function f4(e){return new d1(e,!0)}class f8{constructor(e,t,n=1e3,i=1.5,r=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=i,this.l_=r,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-n);i>0&&ua("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){null!==this.P_&&(this.P_.skipDelay(),this.P_=null)}cancel(){null!==this.P_&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}let f9="PersistentStream";class f7{constructor(e,t,n,i,r,s,a,o){this.bi=e,this.R_=n,this.V_=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new f8(e,t)}w_(){return 1===this.state||5===this.state||this.b_()}b_(){return 2===this.state||3===this.state}start(){this.p_=0,4!==this.state?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&null===this.f_&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,t){this.M_(),this.x_(),this.y_.cancel(),this.m_++,4!==e?this.y_.reset():t&&t.code===uf.RESOURCE_EXHAUSTED?(uo(t.toString()),uo("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===uf.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(t)}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.m_===t&&this.B_(e,n)},t=>{e(()=>{let e=new up(uf.UNKNOWN,"Fetching auth token failed: "+t.message);return this.L_(e)})})}B_(e,t){let n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{n(()=>this.listener.jo())}),this.stream.Jo(()=>{n(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(e=>{n(()=>this.L_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.p_?this.q_(e):this.onNext(e))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return ua(f9,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(ua(f9,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pe extends f7{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:uu(39313,{state:i}),a=t.targetChange.targetIds||[],o=(r=t.targetChange.resumeToken,e.useProto3Json?(ud(void 0===r||"string"==typeof r,58123),u1.fromBase64String(r||"")):(ud(void 0===r||r instanceof h5.Buffer||r instanceof Uint8Array,16193),u1.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause;n=new dK(s,a,o,l&&new up(void 0===l.code?uf.UNKNOWN:dF(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=fe(e,i.document.name),s=d5(i.document.updateTime),a=i.document.createTime?d5(i.document.createTime):uP.min(),o=new cS({mapValue:{fields:i.document.fields}}),l=ck.newFoundDocument(r,s,a,o);n=new dH(i.targetIds||[],i.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=fe(e,i.document),s=i.readTime?d5(i.readTime):uP.min(),a=ck.newNoDocument(r,s);n=new dH([],i.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=fe(e,i.document);n=new dH([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return uu(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new dM(i,r);n=new dW(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return uP.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?uP.min():t.readTime?d5(t.readTime):uP.min()}(e);return this.listener.Q_(t,n)}U_(e){let t,n={};n.database=fn(this.serializer),n.addTarget=function(e,t){var n,i;let r,s,a,o,l,h,u,c=t.target;if((r=cQ(c)?{documents:{documents:[ft(e,c.path)]}}:{query:(a={structuredQuery:{}},o=c.path,null!==c.collectionGroup?(s=o,a.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=o.popLast(),a.structuredQuery.from=[{collectionId:o.lastSegment()}]),a.parent=ft(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let i;return t instanceof cD?function(e){if("=="===e.op){if(cb(e.value))return{unaryFilter:{field:fs(e.field),op:"IS_NAN"}};if(cw(e.value))return{unaryFilter:{field:fs(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(cb(e.value))return{unaryFilter:{field:fs(e.field),op:"IS_NOT_NAN"}};if(cw(e.value))return{unaryFilter:{field:fs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:fs(e.field),op:dZ[e.op],value:e.value}}}(t):t instanceof cO?1===(i=(n=t).getFilters().map(t=>e(t))).length?i[0]:{compositeFilter:{op:d0[n.op],filters:i}}:uu(54877,{filter:t})}(cO.create(e,"and"))}(c.filters))&&(a.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:fs(e.field),direction:dX[e.dir]}))}(c.orderBy))&&(a.structuredQuery.orderBy=h),null!==(u=d2(e,c.limit))&&(a.structuredQuery.limit=u),c.startAt&&(a.structuredQuery.startAt={before:(n=c.startAt).inclusive,values:n.position}),c.endAt&&(a.structuredQuery.endAt={before:!(i=c.endAt).inclusive,values:i.position}),{gt:a,parent:s}).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=d6(e,t.resumeToken);let n=d2(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(uP.min())>0){r.readTime=d3(e,t.snapshotVersion.toTimestamp());let n=d2(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);let i=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return uu(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});i&&(n.labels=i),this.F_(n)}K_(e){let t={};t.database=fn(this.serializer),t.removeTarget=e,this.F_(t)}}class pt extends f7{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return ud(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ud(!e.writeResults||0===e.writeResults.length,55816),this.listener.z_()}onNext(e){var t,n;ud(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(ud(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?d5(e.updateTime):d5(n)).isEqual(uP.min())&&(t=d5(n)),new dv(t,e.transformResults||[])})):[]),r=d5(e.commitTime);return this.listener.j_(r,i)}H_(){let e={};e.database=fn(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,i;let r;if(t instanceof dS)r={update:fr(e,t.key,t.value)};else if(t instanceof dP)r={delete:d7(e,t.key)};else if(t instanceof dk){let n;r={update:fr(e,t.key,t.data),updateMask:(i=t.fieldMask,n=[],i.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof dx))return uu(16599,{ft:t.type});r={verify:d7(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof dc)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof dd)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof dp)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof dm)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw uu(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(r.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:d3(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:uu(27497)),r})(this.serializer,e))};this.F_(t)}}class pn{}class pi extends pn{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new up(uf.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Qo(e,d8(t,n),i,r,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uf.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new up(uf.UNKNOWN,e.toString())})}Wo(e,t,n,i,r){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,d8(t,n),i,s,a,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===uf.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new up(uf.UNKNOWN,e.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class pr{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){0===this.Z_&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){"Online"===this.state?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,"Online"===e&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(uo(t),this.ea=!1):ua("OnlineStateTracker",t)}sa(){null!==this.X_&&(this.X_.cancel(),this.X_=null)}}let ps="RemoteStore";class pa{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=r,this.ca.vo(e=>{n.enqueueAndForget(async()=>{pg(this)&&(ua(ps,"Restarting streams for network reachability change."),await async function(e){e.aa.add(4),await pl(e),e.la.set("Unknown"),e.aa.delete(4),await po(e)}(this))})}),this.la=new pr(n,i)}}async function po(e){if(pg(e))for(let t of e.ua)await t(!0)}async function pl(e){for(let t of e.ua)await t(!1)}function ph(e,t){e._a.has(t.targetId)||(e._a.set(t.targetId,t),pp(e)?pf(e):pP(e).b_()&&pc(e,t))}function pu(e,t){let n=pP(e);e._a.delete(t),n.b_()&&pd(e,t),0===e._a.size&&(n.b_()?n.v_():pg(e)&&e.la.set("Unknown"))}function pc(e,t){if(e.ha.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(uP.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}pP(e).U_(t)}function pd(e,t){e.ha.Ke(t),pP(e).K_(t)}function pf(e){e.ha=new dQ({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e._a.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),pP(e).start(),e.la.ta()}function pp(e){return pg(e)&&!pP(e).w_()&&e._a.size>0}function pg(e){return 0===e.aa.size}async function pm(e){e.la.set("Online")}async function py(e){e._a.forEach((t,n)=>{pc(e,t)})}async function p_(e,t){e.ha=void 0,pp(e)?(e.la.ia(t),pf(e)):e.la.set("Unknown")}async function pv(e,t,n){if(e.la.set("Online"),t instanceof dK&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e._a.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e._a.delete(i),e.ha.removeTarget(i))}(e,t)}catch(n){ua(ps,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await pw(e,n)}else if(t instanceof dH?e.ha.Xe(t):t instanceof dW?e.ha.ot(t):e.ha.nt(t),!n.isEqual(uP.min()))try{let t,i=await fz(e.localStore);n.compareTo(i)>=0&&await ((t=e.ha.It(n)).targetChanges.forEach((t,i)=>{if(t.resumeToken.approximateByteSize()>0){let r=e._a.get(i);r&&e._a.set(i,r.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let i=e._a.get(t);if(!i)return;e._a.set(t,i.withResumeToken(u1.EMPTY_BYTE_STRING,i.snapshotVersion)),pd(e,t);let r=new fl(i.target,t,n,i.sequenceNumber);pc(e,r)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ua(ps,"Failed to raise snapshot:",t),await pw(e,t)}}async function pw(e,t,n){if(!uB(t))throw t;e.aa.add(1),await pl(e),e.la.set("Offline"),n||(n=()=>fz(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ua(ps,"Retrying IndexedDB access"),await n(),e.aa.delete(1),await po(e)})}function pb(e,t){return t().catch(n=>pw(e,n,t))}async function pT(e){var t;let n=px(e),i=e.oa.length>0?e.oa[e.oa.length-1].batchId:-1;for(;pg(t=e)&&t.oa.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,i);if(null===t){0===e.oa.length&&n.v_();break}i=t.batchId,function(e,t){e.oa.push(t);let n=px(e);n.b_()&&n.W_&&n.G_(t.mutations)}(e,t)}catch(t){await pw(e,t)}pE(e)&&pI(e)}function pE(e){return pg(e)&&!px(e).w_()&&e.oa.length>0}function pI(e){px(e).start()}async function pC(e){px(e).H_()}async function pS(e){let t=px(e);for(let n of e.oa)t.G_(n.mutations)}async function pk(e,t,n){let i=e.oa.shift(),r=dO.from(i,t,n);await pb(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await pT(e)}async function pA(e,t){t&&px(e).W_&&await async function(e,t){var n;if(function(e){switch(e){case uf.OK:return uu(64938);case uf.CANCELLED:case uf.UNKNOWN:case uf.DEADLINE_EXCEEDED:case uf.RESOURCE_EXHAUSTED:case uf.INTERNAL:case uf.UNAVAILABLE:case uf.UNAUTHENTICATED:return!1;case uf.INVALID_ARGUMENT:case uf.NOT_FOUND:case uf.ALREADY_EXISTS:case uf.PERMISSION_DENIED:case uf.FAILED_PRECONDITION:case uf.ABORTED:case uf.OUT_OF_RANGE:case uf.UNIMPLEMENTED:case uf.DATA_LOSS:return!0;default:return uu(15467,{code:e})}}(n=t.code)&&n!==uf.ABORTED){let n=e.oa.shift();px(e).D_(),await pb(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await pT(e)}}(e,t),pE(e)&&pI(e)}async function pN(e,t){e.asyncQueue.verifyOperationInProgress(),ua(ps,"RemoteStore received new credentials");let n=pg(e);e.aa.add(3),await pl(e),n&&e.la.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.aa.delete(3),await po(e)}async function pR(e,t){t?(e.aa.delete(2),await po(e)):t||(e.aa.add(2),await pl(e),e.la.set("Unknown"))}function pP(e){var t,n,i;return e.Pa||(t=e.datastore,n=e.asyncQueue,i={jo:pm.bind(null,e),Jo:py.bind(null,e),Zo:p_.bind(null,e),Q_:pv.bind(null,e)},t.Y_(),e.Pa=new pe(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.ua.push(async t=>{t?(e.Pa.D_(),pp(e)?pf(e):e.la.set("Unknown")):(await e.Pa.stop(),e.ha=void 0)})),e.Pa}function px(e){var t,n,i;return e.Ta||(t=e.datastore,n=e.asyncQueue,i={jo:()=>Promise.resolve(),Jo:pC.bind(null,e),Zo:pA.bind(null,e),z_:pS.bind(null,e),j_:pk.bind(null,e)},t.Y_(),e.Ta=new pt(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i),e.ua.push(async t=>{t?(e.Ta.D_(),await pT(e)):(await e.Ta.stop(),e.oa.length>0&&(ua(ps,`Stopping write stream with ${e.oa.length} pending writes`),e.oa=[]))})),e.Ta}class pD{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new ug,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){let s=new pD(e,t,Date.now()+n,i,r);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new up(uf.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function pO(e,t){if(uo("AsyncQueue",`${t}: ${e}`),uB(e))return new up(uf.UNAVAILABLE,`${t}: ${e}`);throw e}class pL{static emptySet(e){return new pL(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||uF.comparator(t.key,n.key):(e,t)=>uF.comparator(e.key,t.key),this.keyedMap=c7(),this.sortedSet=new uG(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pL)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new pL;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class pM{constructor(){this.Ia=new uG(uF.comparator)}track(e){let t=e.doc.key,n=this.Ia.get(t);n?0!==e.type&&3===n.type?this.Ia=this.Ia.insert(t,e):3===e.type&&1!==n.type?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Ia=this.Ia.remove(t):1===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):uu(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,n)=>{e.push(n)}),e}}class pF{constructor(e,t,n,i,r,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new pF(e,t,pL.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&c1(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class pU{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class pV{constructor(){this.queries=pj(),this.onlineState="Unknown",this.fa=new Set}terminate(){var e;let t;e=new up(uf.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=pj(),t.forEach((t,n)=>{for(let t of n.Ra)t.onError(e)})}}function pj(){return new c4(e=>c2(e),c1)}async function pq(e,t){let n=3,i=t.query,r=e.queries.get(i);r?!r.Va()&&t.ma()&&(n=2):(r=new pU,n=+!t.ma());try{switch(n){case 0:r.Aa=await e.onListen(i,!0);break;case 1:r.Aa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(n){let e=pO(n,`Initialization of query '${c3(t.query)}' failed`);return void t.onError(e)}e.queries.set(i,r),r.Ra.push(t),t.ga(e.onlineState),r.Aa&&t.pa(r.Aa)&&pH(e)}async function pB(e,t){let n=t.query,i=3,r=e.queries.get(n);if(r){let e=r.Ra.indexOf(t);e>=0&&(r.Ra.splice(e,1),0===r.Ra.length?i=+!t.ma():!r.Va()&&t.ma()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function pz(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.Ra)e.pa(i)&&(n=!0);r.Aa=i}}n&&pH(e)}function p$(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.Ra)e.onError(n);e.queries.delete(t)}function pH(e){e.fa.forEach(e=>{e.next()})}(z=B||(B={})).ya="default",z.Cache="cache";class pW{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new pF(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){return!(e.fromCache&&this.ma())||(!this.options.Fa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ca(e){e=pF.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==B.Cache}}class pK{constructor(e){this.key=e}}class pG{constructor(e){this.key=e}}class pQ{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=dr(),this.mutatedKeys=dr(),this.Ua=c5(e),this.Ka=new pL(this.Ua)}get Wa(){return this.qa}Ga(e,t){let n=t?t.za:new pM,i=t?t.Ka:this.Ka,r=t?t.mutatedKeys:this.mutatedKeys,s=i,a=!1,o="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=c6(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.ja(h,u)||(n.track({type:2,doc:u}),f=!0,(o&&this.Ua(u,o)>0||l&&0>this.Ua(u,l))&&(a=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(o||l)&&(a=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ka:s,za:n,ys:a,mutatedKeys:r}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let r=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let s=e.za.da();s.sort((e,t)=>{var n,i;let r;return n=e.type,i=t.type,(r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return uu(20277,{Vt:e})}})(n)-r(i)||this.Ua(e.doc,t.doc)}),this.Ha(n),i=null!=i&&i;let a=t&&!i?this.Ja():[],o=0===this.$a.size&&this.current&&!i?1:0,l=o!==this.Qa;return(this.Qa=o,0!==s.length||l)?{snapshot:new pF(this.query,e.Ka,r,s,e.mutatedKeys,0===o,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:a}:{Ya:a}}ga(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new pM,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(e=>this.qa=this.qa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qa=this.qa.delete(e)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=dr(),this.Ka.forEach(e=>{this.Za(e.key)&&(this.$a=this.$a.add(e.key))});let t=[];return e.forEach(e=>{this.$a.has(e)||t.push(new pG(e))}),this.$a.forEach(n=>{e.has(n)||t.push(new pK(n))}),t}Xa(e){this.qa=e.Ns,this.$a=dr();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return pF.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,0===this.Qa,this.hasCachedResults)}}let pY="SyncEngine";class pJ{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class pX{constructor(e){this.key=e,this.tu=!1}}class pZ{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.nu={},this.ru=new c4(e=>c2(e),c1),this.iu=new Map,this.su=new Set,this.ou=new uG(uF.comparator),this._u=new Map,this.au=new fk,this.uu={},this.cu=new Map,this.lu=fg.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return!0===this.hu}}async function p0(e,t,n=!0){let i,r=gc(e),s=r.ru.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=await p2(r,t,n,!0),i}async function p1(e,t){let n=gc(e);await p2(n,t,!0,!1)}async function p2(e,t,n,i){var r,s;let a,o=await (r=e.localStore,s=cZ(t),r.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return r.ai.getTargetData(e,s).next(n=>n?(t=n,uq.resolve(t)):r.ai.allocateTargetId(e).next(n=>(t=new fl(s,n,"TargetPurposeListen",e.currentSequenceNumber),r.ai.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=r.Ss.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(r.Ss=r.Ss.insert(e.targetId,e),r.Ds.set(s,e.targetId)),e})),l=o.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return i&&(a=await p3(e,t,l,"current"===h,o.resumeToken)),e.isPrimaryClient&&n&&ph(e.remoteStore,o),a}async function p3(e,t,n,i,r){e.Pu=(t,n,i)=>(async function(e,t,n,i){let r=t.view.Ga(n);r.ys&&(r=await fH(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ga(e,r)));let s=i&&i.targetChanges.get(t.targetId),a=i&&null!=i.targetMismatches.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,s,a);return ga(e,t.targetId,o.Ya),o.snapshot})(e,t,n,i);let s=await fH(e.localStore,t,!0),a=new pQ(t,s.Ns),o=a.Ga(s.documents),l=d$.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=a.applyChanges(o,e.isPrimaryClient,l);ga(e,n,h.Ya);let u=new pJ(t,n,a);return e.ru.set(t,u),e.iu.has(n)?e.iu.get(n).push(t):e.iu.set(n,[t]),h.snapshot}async function p6(e,t,n){let i=e.ru.get(t),r=e.iu.get(i.targetId);r.length>1?(e.iu.set(i.targetId,r.filter(e=>!c1(e,t))),e.ru.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||await f$(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),n&&pu(e.remoteStore,i.targetId),gr(e,i.targetId)}).catch(uj)):(gr(e,i.targetId),await f$(e.localStore,i.targetId,!0))}async function p5(e,t){let n=e.ru.get(t),i=e.iu.get(n.targetId);e.isPrimaryClient&&1===i.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),pu(e.remoteStore,n.targetId))}async function p4(e,t,n){var i,r,s;let a=((i=e).remoteStore.remoteSyncer.applySuccessfulWrite=ge.bind(null,i),i.remoteStore.remoteSyncer.rejectFailedWrite=gt.bind(null,i),i);try{let e,i,o,l,h,u=await (r=a.localStore,o=uR.now(),l=t.reduce((e,t)=>e.add(t.key),dr()),r.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=c8,a=dr();return r.Cs.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(a=a.add(e))})}).next(()=>r.localDocuments.getOverlayedDocuments(n,s)).next(i=>{e=i;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let i of e.fieldTransforms){let e=t.data.field(i.field),r=du(i.transform,e||null);null!=r&&(null===n&&(n=cS.empty()),n.set(i.field,r))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new dk(n.key,t,function e(t){let n=[];return uW(t.fields,(t,i)=>{let r=new uM([t]);if(cT(i)){let t=e(i.mapValue).fields;if(0===t.length)n.push(r);else for(let e of t)n.push(r.child(e))}else n.push(r)}),new uZ(n)}(t.value.mapValue),dw.exists(!0)))}return r.mutationQueue.addMutationBatch(n,o,s,t)}).next(t=>{i=t;let s=t.applyToLocalDocumentSet(e,a);return r.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:i.batchId,changes:de(e)})));a.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=a.uu[a.currentUser.toKey()])||(h=new uG(uS)),h=h.insert(s,n),a.uu[a.currentUser.toKey()]=h,await gl(a,u.changes),await pT(a.remoteStore)}catch(t){let e=pO(t,"Failed to persist write");n.reject(e)}}async function p8(e,t){var n;try{let i,r,s=await (n=e.localStore,i=t.snapshotVersion,r=n.Ss,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,a,o;let l,h,u=n.Cs.newChangeBuffer({trackRemovals:!0});r=n.Ss;let c=[];t.targetChanges.forEach((s,a)=>{var o;let l=r.get(a);if(!l)return;c.push(n.ai.removeMatchingKeys(e,s.removedDocuments,a).next(()=>n.ai.addMatchingKeys(e,s.addedDocuments,a)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?h=h.withResumeToken(u1.EMPTY_BYTE_STRING,uP.min()).withLastLimboFreeSnapshotVersion(uP.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,i)),r=r.insert(a,h),o=h,(0===l.resumeToken.approximateByteSize()||o.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.ai.updateTargetData(e,h))});let d=c8,f=dr();if(t.documentUpdates.forEach(i=>{t.resolvedLimboDocuments.has(i)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))}),c.push((s=e,a=u,o=t.documentUpdates,l=dr(),h=dr(),o.forEach(e=>l=l.add(e)),a.getEntries(s,l).next(e=>{let t=c8;return o.forEach((n,i)=>{let r=e.get(n);i.isFoundDocument()!==r.isFoundDocument()&&(h=h.add(n)),i.isNoDocument()&&i.version.isEqual(uP.min())?(a.removeEntry(n,i.readTime),t=t.insert(n,i)):!r.isValidDocument()||i.version.compareTo(r.version)>0||0===i.version.compareTo(r.version)&&r.hasPendingWrites?(a.addEntry(i),t=t.insert(n,i)):ua(fj,"Ignoring outdated watch update for ",n,". Current version:",r.version," Watch version:",i.version)}),{xs:t,Os:h}})).next(e=>{d=e.xs,f=e.Os})),!i.isEqual(uP.min())){let t=n.ai.getLastRemoteSnapshotVersion(e).next(t=>n.ai.setTargetsMetadata(e,e.currentSequenceNumber,i));c.push(t)}return uq.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ss=r,e)));t.targetChanges.forEach((t,n)=>{let i=e._u.get(n);i&&(ud(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?i.tu=!0:t.modifiedDocuments.size>0?ud(i.tu,14607):t.removedDocuments.size>0&&(ud(i.tu,42227),i.tu=!1))}),await gl(e,s,t)}catch(e){await uj(e)}}function p9(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,r=[];e.ru.forEach((e,n)=>{let i=n.view.ga(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.Ra)e.ga(t)&&(n=!0)}),n&&pH(i),r.length&&e.nu.Q_(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function p7(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e._u.get(t),r=i&&i.key;if(r){let n=new uG(uF.comparator);n=n.insert(r,ck.newNoDocument(r,uP.min()));let i=dr().add(r),s=new dz(uP.min(),new Map,new uG(uS),n,i);await p8(e,s),e.ou=e.ou.remove(r),e._u.delete(t),go(e)}else await f$(e.localStore,t,!1).then(()=>gr(e,t,n)).catch(uj)}async function ge(e,t){var n;let i=t.batch.batchId;try{let r=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let i,r,s,a=t.batch.keys(),o=n.Cs.newChangeBuffer({trackRemovals:!0});return(r=(i=t.batch).keys(),s=uq.resolve(),r.forEach(n=>{s=s.next(()=>o.getEntry(e,n)).next(e=>{let r=t.docVersions.get(n);ud(null!==r,48541),0>e.version.compareTo(r)&&(i.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),o.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,i))).next(()=>o.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,a,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=dr();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,a))}));gi(e,i,null),gn(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await gl(e,r)}catch(e){await uj(e)}}async function gt(e,t,n){var i;try{let r=await (i=e.localStore,i.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return i.mutationQueue.lookupMutationBatch(e,t).next(t=>(ud(null!==t,37113),n=t.keys(),i.mutationQueue.removeMutationBatch(e,t))).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>i.localDocuments.getDocuments(e,n))}));gi(e,t,n),gn(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await gl(e,r)}catch(e){await uj(e)}}function gn(e,t){(e.cu.get(t)||[]).forEach(e=>{e.resolve()}),e.cu.delete(t)}function gi(e,t,n){let i=e.uu[e.currentUser.toKey()];if(i){let r=i.get(t);r&&(n?r.reject(n):r.resolve(),i=i.remove(t)),e.uu[e.currentUser.toKey()]=i}}function gr(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.iu.get(t)))e.ru.delete(i),n&&e.nu.Tu(i,n);e.iu.delete(t),e.isPrimaryClient&&e.au.Ur(t).forEach(t=>{e.au.containsKey(t)||gs(e,t)})}function gs(e,t){e.su.delete(t.path.canonicalString());let n=e.ou.get(t);null!==n&&(pu(e.remoteStore,n),e.ou=e.ou.remove(t),e._u.delete(n),go(e))}function ga(e,t,n){for(let i of n)i instanceof pK?(e.au.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.ou.get(n)||e.su.has(i)||(ua(pY,"New document in limbo: "+n),e.su.add(i),go(e))}(e,i)):i instanceof pG?(ua(pY,"Document no longer in limbo: "+i.key),e.au.removeReference(i.key,t),e.au.containsKey(i.key)||gs(e,i.key)):uu(19791,{Iu:i})}function go(e){for(;e.su.size>0&&e.ou.size<e.maxConcurrentLimboResolutions;){let t=e.su.values().next().value;e.su.delete(t);let n=new uF(uO.fromString(t)),i=e.lu.next();e._u.set(i,new pX(n)),e.ou=e.ou.insert(n,i),ph(e.remoteStore,new fl(cZ(new cY(n.path)),i,"TargetPurposeLimboResolution",uz.le))}}async function gl(e,t,n){let i=[],r=[],s=[];e.ru.isEmpty()||(e.ru.forEach((a,o)=>{s.push(e.Pu(o,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let i=t?!t.fromCache:null==(s=null==n?void 0:n.targetChanges.get(o.targetId))?void 0:s.current;e.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(t){i.push(t);let e=fF.Ps(o.targetId,t);r.push(e)}}))}),await Promise.all(s),e.nu.Q_(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>uq.forEach(t,t=>uq.forEach(t.ls,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>uq.forEach(t.hs,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!uB(e))throw e;ua(fj,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ss.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ss=e.Ss.insert(t,r)}}}(e.localStore,r))}async function gh(e,t){if(!e.currentUser.isEqual(t)){ua(pY,"User change. New user:",t.toKey());let n=await fB(e.localStore,t);e.currentUser=t,e.cu.forEach(e=>{e.forEach(e=>{e.reject(new up(uf.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.cu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await gl(e,n.Ms)}}function gu(e,t){let n=e._u.get(t);if(n&&n.tu)return dr().add(n.key);{let n=dr(),i=e.iu.get(t);if(!i)return n;for(let t of i){let i=e.ru.get(t);n=n.unionWith(i.view.Wa)}return n}}function gc(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=p8.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=gu.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=p7.bind(null,e),e.nu.Q_=pz.bind(null,e.eventManager),e.nu.Tu=p$.bind(null,e.eventManager),e}class gd{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=f4(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,t){return null}fu(e,t){return null}Vu(e){var t,n;return t=this.persistence,n=new fV,new fq(t,n,e.initialUser,this.serializer)}Ru(e){return new fD(fL.Ei,this.serializer)}Au(e){return new fK}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}gd.provider={build:()=>new gd};class gf extends gd{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){return ud(this.persistence.referenceDelegate instanceof fM,46915),new fv(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ru(e){let t=void 0!==this.cacheSizeBytes?fp.withCacheSize(this.cacheSizeBytes):fp.DEFAULT;return new fD(e=>fM.Ei(e,t),this.serializer)}}class gp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>p9(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=gh.bind(null,this.syncEngine),await pR(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new pV}createDatastore(e){var t;let n=f4(e.databaseInfo.databaseId),i=new f6(e.databaseInfo);return t=e.authCredentials,new pi(t,e.appCheckCredentials,i,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new pa(t,n,e.asyncQueue,e=>p9(this.syncEngine,e,0),fY.C()?new fY:new fG)}createSyncEngine(e,t){var n,i,r,s,a,o;let l;return n=this.localStore,i=this.remoteStore,r=this.eventManager,s=this.sharedClientState,a=e.initialUser,o=e.maxConcurrentLimboResolutions,l=new pZ(n,i,r,s,a,o),t&&(l.hu=!0),l}async terminate(){var e,t;await async function(e){ua(ps,"RemoteStore shutting down."),e.aa.add(5),await pl(e),e.ca.shutdown(),e.la.set("Unknown")}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}gp.provider={build:()=>new gp};class gg{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):uo("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let gm="FirestoreClient";class gy{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=un.UNAUTHENTICATED,this.clientId=uC.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{ua(gm,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ua(gm,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new ug;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=pO(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function g_(e,t){e.asyncQueue.verifyOperationInProgress(),ua(gm,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await fB(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function gv(e,t){e.asyncQueue.verifyOperationInProgress();let n=await gw(e);ua(gm,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>pN(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>pN(t.remoteStore,n)),e._onlineComponents=t}async function gw(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ua(gm,"Using user provided OfflineComponentProvider");try{await g_(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===uf.FAILED_PRECONDITION||t.code===uf.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;ul("Error using user provided cache. Falling back to memory cache: "+t),await g_(e,new gd)}}else ua(gm,"Using default OfflineComponentProvider"),await g_(e,new gf(void 0));return e._offlineComponents}async function gb(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ua(gm,"Using user provided OnlineComponentProvider"),await gv(e,e._uninitializedComponentsProvider._online)):(ua(gm,"Using default OnlineComponentProvider"),await gv(e,new gp))),e._onlineComponents}async function gT(e){let t=await gb(e),n=t.eventManager;return n.onListen=p0.bind(null,t.syncEngine),n.onUnlisten=p6.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=p1.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=p5.bind(null,t.syncEngine),n}function gE(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let gI=new Map;function gC(e){if(!uF.isDocumentKey(e))throw new up(uf.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function gS(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":uu(12329,{type:typeof e})}function gk(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new up(uf.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=gS(e);throw new up(uf.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}let gA="firestore.googleapis.com";class gN{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new up(uf.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=gA,this.ssl=!0}else this.host=e.host,this.ssl=null==(t=e.ssl)||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new up(uf.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new up(uf.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gE(null!=(n=e.experimentalLongPollingOptions)?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new up(uf.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new up(uf.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new up(uf.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gR{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gN({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new up(uf.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new up(uf.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gN(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new uy;switch(e.type){case"firstParty":return new ub(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new up(uf.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=gI.get(this))&&(ua("ComponentProvider","Removing Datastore"),gI.delete(this),e.terminate()),Promise.resolve()}}class gP{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new gP(this.firestore,e,this._query)}}class gx{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new gD(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new gx(this.firestore,e,this._key)}}class gD extends gP{constructor(e,t,n){super(e,t,new cY(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new gx(this.firestore,null,new uF(e))}withConverter(e){return new gD(this.firestore,e,this._path)}}function gO(e,t,...n){if(e=ej(e),1==arguments.length&&(t=uC.newId()),function(e,t,n){if(!n)throw new up(uf.INVALID_ARGUMENT,`Function doc() cannot be called with an empty ${t}.`)}(0,"path",t),e instanceof gR){let i=uO.fromString(t,...n);return gC(i),new gx(e,null,new uF(i))}{if(!(e instanceof gx||e instanceof gD))throw new up(uf.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(uO.fromString(t,...n));return gC(i),new gx(e.firestore,e instanceof gD?e.converter:null,new uF(i))}}let gL="AsyncQueue";class gM{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new f8(this,"async_queue_retry"),this.ju=()=>{let e=f5();e&&ua(gL,"Visibility state changed to "+e.visibilityState),this.y_.A_()},this.Hu=e;const t=f5();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=f5();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new ug;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(0!==this.Qu.length){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!uB(e))throw e;ua(gL,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(e=>{throw this.Ku=e,this.Wu=!1,uo("INTERNAL UNHANDLED ERROR: ",gF(e)),e}).then(e=>(this.Wu=!1,e))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=pD.createAndSchedule(this,e,t,n,e=>this.Xu(e));return this.Uu.push(i),i}Ju(){this.Ku&&uu(47125,{ec:gF(this.Ku)})}verifyOperationInProgress(){}async tc(){let e;do e=this.Hu,await e;while(e!==this.Hu)}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{for(let t of(this.Uu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Uu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function gF(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class gU extends gR{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new gM,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new gM(e),this._firestoreClient=void 0,await e}}}function gV(e,t){let n=tp("object"==typeof e?e:tS(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||cr});if(!n._initialized){let e=en("firestore");e&&function(e,t,n,i={}){var r;e=gk(e,gR);let s=eq(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&eB(`https://${l}`),a.host!==gA&&a.host!==l&&ul("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:i});if(!eA(h,o)&&(e._setSettings(h),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=un.MOCK_USER;else{t=ea(i.mockUserToken,null==(r=e._app)?void 0:r.options.projectId);let s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new up(uf.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new un(s)}e._authCredentials=new u_(new um(t,n))}}(n,...e)}return n}function gj(e){if(e._terminated)throw new up(uf.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i,r,s,a;let o,l=e._freezeSettings(),h=(r=e._databaseId,s=(null==(t=e._app)?void 0:t.options.appId)||"",new ci(r,s,e._persistenceKey,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,gE(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator));e._componentsProvider||(null==(n=l.localCache)?void 0:n._offlineComponentProvider)&&(null==(i=l.localCache)?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:l.localCache._offlineComponentProvider,_online:l.localCache._onlineComponentProvider}),e._firestoreClient=new gy(e._authCredentials,e._appCheckCredentials,e._queue,h,e._componentsProvider&&(o=null==(a=e._componentsProvider)?void 0:a._online.build(),{_offline:null==a?void 0:a._offline.build(o),_online:o}))}(e),e._firestoreClient}class gq{constructor(e){this._byteString=e}static fromBase64String(e){try{return new gq(u1.fromBase64String(e))}catch(e){throw new up(uf.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new gq(u1.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class gB{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new up(uf.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new uM(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class gz{constructor(e){this._methodName=e}}class g${constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new up(uf.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new up(uf.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return uS(this._lat,e._lat)||uS(this._long,e._long)}}class gH{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}let gW=/^__.*__$/;class gK{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new dk(e,this.data,this.fieldMask,t,this.fieldTransforms):new dS(e,this.data,t,this.fieldTransforms)}}function gG(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw uu(40011,{oc:e})}}class gQ{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this._c(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new gQ(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i.lc(e),i}hc(e){var t;let n=null==(t=this.path)?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return g1(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(0===e.length)throw this.Tc("Document fields must not be empty");if(gG(this.oc)&&gW.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class gY{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||f4(e)}dc(e,t,n,i=!1){return new gQ({oc:e,methodName:t,Ec:n,path:uM.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function gJ(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof uR||e instanceof g$||e instanceof gq||e instanceof gx||e instanceof gz||e instanceof gH)}function gX(e,t,n){if(!gJ(n)||"object"!=typeof n||null===n||Object.getPrototypeOf(n)!==Object.prototype&&null!==Object.getPrototypeOf(n)){let i=gS(n);throw"an object"===i?t.Tc(e+" a custom object"):t.Tc(e+" "+i)}}let gZ=RegExp("[~\\*/\\[\\]]");function g0(e,t,n){if(t.search(gZ)>=0)throw g1(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new gB(...t.split("."))._internalPath}catch(i){throw g1(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function g1(e,t,n,i,r){let s=i&&!i.isEmpty(),a=void 0!==r,o=`Function ${t}() called with invalid data`;n&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${i}`),a&&(l+=` in document ${r}`),l+=")"),new up(uf.INVALID_ARGUMENT,o+e+l)}class g2{constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new gx(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new g3(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(g6("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class g3 extends g2{data(){return super.data()}}function g6(e,t){return"string"==typeof t?g0(e,t):t instanceof gB?t._internalPath:t._delegate._internalPath}class g5{convertValue(e,t="none"){switch(cc(e)){case 0:return null;case 1:return e.booleanValue;case 2:return u6(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(u5(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw uu(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return uW(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,i;return new gH(null==(i=null==(n=null==(t=e.fields)?void 0:t[cu].arrayValue)?void 0:n.values)?void 0:i.map(e=>u6(e.doubleValue)))}convertGeoPoint(e){return new g$(u6(e.latitude),u6(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=ct(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(cn(e));default:return null}}convertTimestamp(e){let t=u3(e);return new uR(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=uO.fromString(e);ud(fo(n),9688,{name:e});let i=new cs(n.get(1),n.get(3)),r=new uF(n.popFirst(5));return i.isEqual(t)||uo(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}class g4{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class g8 extends g2{constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new g9(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(g6("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class g9 extends g8{data(e={}){return super.data(e)}}function g7(e){e=gk(e,gx);let t=gk(e.firestore,gU);return(function(e,t,n={}){let i=new ug;return e.asyncQueue.enqueueAndForget(async()=>{var r,s;let a,o;return r=await gT(e),s=e.asyncQueue,a=new gg({next:e=>{a.yu(),s.enqueueAndForget(()=>pB(r,o));let l=e.docs.has(t);!l&&e.fromCache?i.reject(new up(uf.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?i.reject(new up(uf.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(e)},error:e=>i.reject(e)}),pq(r,o=new pW(new cY(t.path),a,{includeMetadataChanges:!0,Fa:!0}))}),i.promise})(gj(t),e._key).then(n=>{var i,r,s;let a,o;return i=t,r=e,a=(s=n).docs.get(r._key),o=new me(i),new g8(i,o,r._key,a,new g4(s.hasPendingWrites,s.fromCache),r.converter)})}class me extends g5{constructor(e){super(),this.firestore=e}convertBytes(e){return new gq(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new gx(this.firestore,null,t)}}function mt(e,t,n){var i;let r,s;e=gk(e,gx);let a=gk(e.firestore,gU),o=(i=e.converter,i?n&&(n.merge||n.mergeFields)?i.toFirestore(t,n):i.toFirestore(t):t);return function(e,t){var n;let i;return n=gj(e),i=new ug,n.asyncQueue.enqueueAndForget(async()=>p4(await gb(n).then(e=>e.syncEngine),t,i)),i.promise}(a,[(function(e,t,n,i,r,s={}){let a,o,l=e.dc(s.merge||s.mergeFields?2:0,t,n,r);gX("Data must be an object, but it was:",l,i);let h=function e(t,n){let i={};return uK(t)?n.path&&n.path.length>0&&n.fieldMask.push(n.path):uW(t,(t,r)=>{let s=function t(n,i){if(gJ(n=ej(n)))return gX("Unsupported field value:",i,n),e(n,i);if(n instanceof gz)return function(e,t){if(!gG(t.oc))throw t.Tc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Tc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(n,i),null;if(void 0===n&&i.ignoreUndefinedProperties)return null;if(i.path&&i.fieldMask.push(i.path),n instanceof Array){if(i.settings.cc&&4!==i.oc)throw i.Tc("Nested arrays are not supported");let e=[],r=0;for(let s of n){let n=t(s,i.Pc(r));null==n&&(n={nullValue:"NULL_VALUE"}),e.push(n),r++}return{arrayValue:{values:e}}}return function(e,t){var n,i,r;if(null===(e=ej(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(r=i=e)&&Number.isInteger(r)&&!u$(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER?dl(i):da(n,i);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=uR.fromDate(e);return{timestampValue:d3(t.serializer,n)}}if(e instanceof uR){let n=new uR(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:d3(t.serializer,n)}}if(e instanceof g$)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof gq)return{bytesValue:d6(t.serializer,e._byteString)};if(e instanceof gx){let n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Tc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:d4(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof gH)return{mapValue:{fields:{[ca]:{stringValue:ch},[cu]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Tc("VectorValues must only contain numeric values.");return da(t.serializer,e)})}}}}};throw t.Tc(`Unsupported field value: ${gS(e)}`)}(n,i)}(r,n.uc(t));null!=s&&(i[t]=s)}),{mapValue:{fields:i}}}(i,l);if(s.merge)a=new uZ(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let i of s.mergeFields){let r=function(e,t,n){if((t=ej(t))instanceof gB)return t._internalPath;if("string"==typeof t)return g0(e,t);throw g1("Field path arguments must be of type string or ",e,!1,void 0,n)}(t,i,n);if(!l.contains(r))throw new up(uf.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);(function(e,t){return e.some(e=>e.isEqual(t))})(e,r)||e.push(r)}a=new uZ(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new gK(new cS(h),a,o)})((r=a._freezeSettings(),s=f4(a._databaseId),new gY(a._databaseId,!!r.ignoreUndefinedProperties,s)),"setDoc",e._key,o,null!==e.converter,n).toMutation(e._key,dw.none())])}new WeakMap,function(e=!0){ui=tE,tf(new ez("firestore",(t,{instanceIdentifier:n,options:i})=>{let r=t.getProvider("app").getImmediate(),s=new gU(new uv(t.getProvider("auth-internal")),new uE(r,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new up(uf.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cs(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),tN(ue,ut,void 0),tN(ue,ut,"esm2017")}(),e.s(["doc",()=>gO,"getDoc",()=>g7,"getFirestore",()=>gV,"setDoc",()=>mt],59385),e.s([],81516);let mn={apiKey:"AIzaSyBYOLsLlqNQTFgwWO1fyHUTgTHQ4JRgA-A",authDomain:"wmcyn-online-web.firebaseapp.com",projectId:"wmcyn-online-web",storageBucket:"wmcyn-online-web.appspot.com",messagingSenderId:"552241957320",appId:"1:552241957320:web:c32590238a5e7ec06858fd",measurementId:"G-KGVGX3LN7P",databaseURL:"https://wmcyn-online-web-default-rtdb.firebaseio.com/"};try{let e=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(e=>!mn[e]);if(e.length>0)throw console.error("Missing Firebase config fields:",e),Error(`Missing required Firebase config fields: ${e.join(", ")}`);y=tI(mn),_=aX(y),v=h6(y),w=gV(y),nq().then(e=>{e&&function(e=tS()){let t=tp(e=ej(e),nv);t.isInitialized()?t.getImmediate():function(e,t={}){let n=tp(e,nv);if(n.isInitialized()){if(n.getImmediate(),eA(t,n.getOptions()))return;throw nT.create("already-initialized")}n.initialize({options:t})}(e)}(y)}).catch(e=>{console.warn("Firebase Analytics initialization failed:",e)})}catch(e){console.error("Firebase initialization error:",e)}e.s(["auth",()=>v,"db",()=>_,"firestore",()=>w],48559)}]);