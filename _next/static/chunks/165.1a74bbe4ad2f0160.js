(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[165],{6165:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>v});var r=o(5893),n=o(7294);let a="USE_DEFAULT_HIRO_PATTERN",i=[{name:"hiro",patternUrl:a,modelUrl:"/models/wmcyn_3d_logo.glb",scale:1,position:{x:2,y:6.5,z:0},productId:"hiro_product_1"}];var l=o(9477),s=o(4250),d=o(7836);let c=e=>{let{mountRef:t,configs:o,setIsLoading:r}=e;(0,n.useEffect)(()=>{let e,n,i,c,u,m,p;let f=t.current,{THREE:h,THREEx:v}=window;if(!h||!v){console.error("three.js or ar.js (THREEx) not found on window object."),r(!1);return}let w=[],E=[],C=[],A=()=>{c&&e&&t.current&&(c.onResizeElement(),c.copyElementSizeTo(e.domElement),(null==u?void 0:u.arController)&&c.copyElementSizeTo(u.arController.canvas),t.current&&e.setSize(t.current.clientWidth,t.current.clientHeight))},g=()=>{if(p=requestAnimationFrame(g),e&&n&&i&&c&&u&&c.ready)try{u.update(c.domElement),w.forEach(e=>{e&&(n.visible=e.visible)}),e.render(n,i),C.forEach(e=>e.update(m.getDelta()))}catch(e){console.error("error during animation frame:",e)}};return(()=>{if(!t.current){console.error("mountRef.current is null in init. Aborting AR setup."),r(!1);return}(e=new l.CP7({antialias:!0,alpha:!0})).setClearColor(new s.Ilk("lightgrey"),0),e.setSize(t.current.clientWidth,t.current.clientHeight),t.current.appendChild(e.domElement),n=new s.xsS,i=new s.V1s,n.add(i),n.add(new s.Mig(0xffffff,.6));let p=new s.Ox3(0xffffff,.8);p.position.set(0,10,5),n.add(p),m=new s.SUY,(c=new v.ArToolkitSource({sourceType:"webcam",sourceWidth:640,sourceHeight:480})).init(()=>{setTimeout(()=>{A(),r(!1)},1e3)}),(u=new v.ArToolkitContext({cameraParametersUrl:v.ArToolkitContext.baseURL+"../data/data/camera_para.dat",detectionMode:"mono"})).init(()=>{u&&i&&(i.projectionMatrix.copy(u.getProjectionMatrix()),o.forEach(e=>{let t=new s.ZAu;n.add(t),w.push(t);let o=e.patternUrl;if(e.patternUrl===a){if(v.ArToolkitContext&&v.ArToolkitContext.baseURL)o=v.ArToolkitContext.baseURL+"../data/data/patt.hiro";else{console.error("THREEx.ArToolkitContext.baseURL is not available to construct default hiro pattern URL.");return}}let r=new v.ArMarkerControls(u,t,{type:"pattern",patternUrl:o,changeMatrixMode:"modelViewMatrix"});E.push(r),new d.E().load(e.modelUrl,o=>{let n=o.scene;if(n){let a=e.scale||1;if(n.scale.set(a,a,a),e.position&&n.position.set(e.position.x,e.position.y,e.position.z),t.add(n),o.animations&&o.animations.length){let e=new s.Xcj(n);C.push(e),e.clipAction(o.animations[0]).play()}e.onFound&&r.addEventListener("markerFound",()=>{e.onFound&&e.onFound()})}},void 0,t=>{console.error("error loading model ".concat(e.modelUrl," for marker ").concat(e.name,":"),t)})}))}),window.addEventListener("resize",A),g()})(),()=>{var t,o,r,a;cancelAnimationFrame(p),window.removeEventListener("resize",A),C.forEach(e=>{}),C.length=0,w.forEach(e=>{null==n||n.remove(e),e.traverse(e=>{if(e instanceof s.Kj0){var t,o;null===(t=e.geometry)||void 0===t||t.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):null===(o=e.material)||void 0===o||o.dispose()}})}),w.length=0,E.length=0,null==c||null===(t=c.domElement)||void 0===t||t.remove(),null==c||null===(o=c.destroy)||void 0===o||o.call(c),null==u||null===(a=u.arController)||void 0===a||null===(r=a.dispose)||void 0===r||r.call(a),null==e||e.dispose(),f&&(null==e?void 0:e.domElement)&&f.contains(e.domElement)&&f.removeChild(e.domElement)}},[t,o,r])};var u=o(2567),m=o.n(u),p=o(837),f=o(7920),h=o(109);let v=e=>{let{onClose:t,configs:o=i}=e,a=(0,n.useRef)(null),[l,s]=(0,n.useState)(!0),{currentUser:d}=(0,p.a)();return c({mountRef:a,configs:o.map(e=>({...e,onFound:async()=>{if(!d){alert("Please log in to claim this product.");return}if(!f.RZ){alert("Database not initialized.");return}let t=(0,h.JU)(f.RZ,"markers",e.productId);(await (0,h.QT)(t)).exists()?alert("This product has already been claimed."):(await (0,h.pl)(t,{owner:d.uid,claimedAt:new Date}),await (0,h.pl)((0,h.JU)(f.RZ,"users/".concat(d.uid,"/products"),e.productId),{name:e.name,acquired:new Date}),alert("Product claimed successfully!"))}})),setIsLoading:s}),n.useEffect(()=>(document.body.classList.add("cameraActive"),()=>{document.body.classList.remove("cameraActive")}),[]),(0,r.jsxs)("div",{className:m().arCameraContainer,children:[l&&(0,r.jsx)("div",{className:m().loadingOverlay,children:"Initializing AR..."}),(0,r.jsx)("div",{ref:a,className:m().mountPoint}),(0,r.jsx)("button",{onClick:t,className:m().closeButton,children:"Close AR"})]})}},2567:e=>{e.exports={arCameraContainer:"ARCamera_arCameraContainer__jxoSI",loadingOverlay:"ARCamera_loadingOverlay__FsDdX",mountPoint:"ARCamera_mountPoint__oeW3w",closeButton:"ARCamera_closeButton__FiWl_"}}}]);