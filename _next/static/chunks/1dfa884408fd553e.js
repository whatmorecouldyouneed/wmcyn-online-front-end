(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15125,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={VALID_LOADERS:function(){return r},imageConfigDefault:function(){return i}};for(var l in s)Object.defineProperty(t,l,{enumerable:!0,get:s[l]});let r=["default","imgix","cloudinary","akamai","custom"],i={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},13521,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ImageConfigContext",{enumerable:!0,get:function(){return r}});let s=e.r(41705)._(e.r(91788)),l=e.r(15125),r=s.default.createContext(l.imageConfigDefault)},2837,e=>{"use strict";var a=e.i(91398),t=e.i(91788),s=e.i(36613),l=e.i(77934);function r({onPatternSelect:e,selectedPatternId:r,disabled:i=!1}){let n,[d,o]=(0,t.useState)(!1),[c,m]=(0,t.useState)(0),[u,p]=(0,t.useState)([]),[f,h]=(0,t.useState)(!0),[x,g]=(0,t.useState)(null),[j,v]=(0,t.useState)(!1),b=(0,t.useRef)(null),N=(0,t.useCallback)(async()=>{if(!window.MINDAR?.IMAGE?.Compiler&&!document.querySelector('script[src*="mindar-image.prod.js"]')){let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js",e.crossOrigin="anonymous",await new Promise((a,t)=>{e.onload=()=>a(),e.onerror=()=>t(Error("Failed to load MindAR compiler script")),document.head.appendChild(e)})}},[]),y=(0,t.useCallback)(async()=>{await N();for(let e=0;e<100;e++){if(window.MINDAR?.IMAGE?.Compiler)return window.MINDAR.IMAGE.Compiler;await new Promise(e=>setTimeout(e,100))}throw Error("MindAR compiler failed to load after 10 seconds. Please refresh the page.")},[N]);t.default.useEffect(()=>{w()},[]);let w=async()=>{try{h(!0);let e=await s.markerPatterns.list();console.log("[MarkerUpload] API response:",e);let a=[];Array.isArray(e)?a=e:e?.markerPatterns?a=e.markerPatterns:e?.patterns?a=e.patterns:e?.items&&(a=e.items),p(a)}catch(e){console.error("failed to load marker patterns:",e),g(e.message||"failed to load marker patterns"),p([])}finally{h(!1)}},P=async a=>{if(!a.type.startsWith("image/"))return void g("please select an image file (png, jpg, etc.)");if(a.size>0xa00000)return void g("file size must be less than 10MB");try{o(!0),g(null),m(0);let t=await new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{let a=s.result.split(",")[1];e(a)},s.onerror=t,s.readAsDataURL(a)}),l=await new Promise((e,t)=>{let s=new Image;s.onload=()=>e(s),s.onerror=t,s.src=URL.createObjectURL(a)}),r=new(await y());await r.compileImageTargets([l],e=>{m(Math.round(100*e))});let i=await r.exportData(),n=(e=>{let a=new Uint8Array(e),t="";for(let e=0;e<a.byteLength;e++)t+=String.fromCharCode(a[e]);return btoa(t)})(i),d=Math.min(100,Math.round(i.byteLength/5e4*100)),c={name:a.name.replace(/\.[^/.]+$/,""),type:"upload",imageFile:{data:t,mimeType:a.type,filename:a.name},mindFileData:n,quality:d},u=await s.markerPatterns.upload(c);await w(),e(u.patternId)}catch(e){console.error("failed to upload marker pattern:",e),g(e.message||"failed to upload marker pattern")}finally{o(!1),m(0)}},C=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?v(!0):"dragleave"===e.type&&v(!1)},D=async a=>{if(confirm("are you sure you want to delete this marker pattern?"))try{await s.markerPatterns.delete(a),await w(),r===a&&e("")}catch(e){console.error("failed to delete marker pattern:",e),g(e.message||"failed to delete marker pattern")}};return f?(0,a.jsx)("div",{className:l.default.loadingContainer,children:"loading marker patterns..."}):(0,a.jsxs)("div",{className:l.default.markerUploadContainer,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"marker pattern"}),x&&(0,a.jsx)("div",{className:l.default.errorMessage,children:x}),(0,a.jsxs)("div",{className:`${l.default.uploadArea} ${j?l.default.dragActive:""} ${i?l.default.disabled:""}`,onDragEnter:C,onDragLeave:C,onDragOver:C,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),v(!1),i||d)return;let a=e.dataTransfer.files;a&&a[0]&&P(a[0])},onClick:()=>!i&&!d&&b.current?.click(),children:[(0,a.jsx)("input",{ref:b,type:"file",accept:"image/*",onChange:e=>{let a=e.target.files;a&&a[0]&&P(a[0])},style:{display:"none"},disabled:i||d}),d?(0,a.jsxs)("div",{className:l.default.uploadingState,children:[(0,a.jsx)("div",{className:l.default.spinner}),(0,a.jsx)("p",{children:c<100?`Compiling marker... ${c}%`:"Uploading to server..."})]}):(0,a.jsxs)("div",{className:l.default.uploadPrompt,children:[(0,a.jsx)("div",{className:l.default.uploadIcon,children:"ðŸ“"}),(0,a.jsx)("p",{children:"drag & drop an image here or click to browse"}),(0,a.jsx)("p",{className:l.default.uploadHint,children:"supported formats: png, jpg, jpeg (max 10MB)"})]})]}),u&&u.length>0&&(0,a.jsxs)("div",{className:l.default.existingPatterns,children:[(0,a.jsx)("h4",{className:l.default.subsectionTitle,children:"existing patterns"}),(0,a.jsx)("div",{className:l.default.patternsGrid,children:u.map(t=>(0,a.jsxs)("div",{className:`${l.default.patternCard} ${r===t.id?l.default.selected:""}`,onClick:()=>!i&&e(t.id),children:[(0,a.jsx)("div",{className:l.default.patternPreview,children:(0,a.jsx)("img",{src:t.previewUrl,alt:t.name,className:l.default.patternImage})}),(0,a.jsxs)("div",{className:l.default.patternInfo,children:[(0,a.jsx)("h5",{className:l.default.patternName,children:t.name}),(0,a.jsx)("p",{className:l.default.patternType,children:t.type}),(0,a.jsx)("p",{className:l.default.patternDate,children:new Date(t.createdAt).toLocaleDateString()})]}),!i&&(0,a.jsx)("button",{className:l.default.deletePatternButton,onClick:e=>{e.stopPropagation(),D(t.id)},title:"delete pattern",children:"Ã—"})]},t.id))})]}),r&&(0,a.jsxs)("div",{className:l.default.selectedPatternInfo,children:[(0,a.jsx)("h4",{className:l.default.subsectionTitle,children:"selected pattern"}),(n=u.find(e=>e.id===r))?(0,a.jsxs)("div",{className:l.default.selectedPatternCard,children:[(0,a.jsx)("img",{src:n.previewUrl,alt:n.name,className:l.default.selectedPatternImage}),(0,a.jsxs)("div",{className:l.default.selectedPatternDetails,children:[(0,a.jsx)("h5",{children:n.name}),(0,a.jsxs)("p",{children:["type: ",n.type]})]})]}):(0,a.jsx)("p",{children:"pattern not found"})]})]})}function i({initialData:e,onSubmit:s,onCancel:i,loading:n=!1,isEdit:d=!1}){let[o,c]=(0,t.useState)({name:e?.name||"",description:e?.description||"",campaign:e?.campaign||"",productId:e?.productId||"",selectedPatternId:e?.markerPattern?.patternId||"",asset3DUrl:e?.asset3D?.url||"",asset3DType:e?.asset3D?.type||"glb",metadata:{title:e?.metadata?.title||"",description:e?.metadata?.description||"",actions:e?.metadata?.actions||[]}}),[m,u]=(0,t.useState)({}),p=async e=>{let a;if(e.preventDefault(),a={},o.name.trim()||(a.name="name is required"),o.selectedPatternId||(a.pattern="marker pattern is required"),o.metadata.title.trim()||(a.metadataTitle="metadata title is required"),o.metadata.description.trim()||(a.metadataDescription="metadata description is required"),o.asset3DUrl&&!o.asset3DUrl.match(/\.(glb|gltf)$/i)&&(a.asset3DUrl="3d asset must be a .glb or .gltf file"),u(a),0!==Object.keys(a).length)return;let t={name:o.name.trim(),description:o.description.trim()||void 0,campaign:o.campaign.trim()||void 0,productId:o.productId.trim()||void 0,markerPattern:{patternId:o.selectedPatternId,type:"custom"},metadata:{title:o.metadata.title.trim(),description:o.metadata.description.trim(),actions:o.metadata.actions},asset3D:o.asset3DUrl?{url:o.asset3DUrl.trim(),type:o.asset3DType}:void 0};try{await s(t)}catch(e){console.error("form submission error:",e)}},f=(e,a,t)=>{c(s=>({...s,metadata:{...s.metadata,actions:s.metadata.actions.map((s,l)=>l===e?{...s,[a]:t}:s)}}))};return(0,a.jsxs)("form",{onSubmit:p,className:l.default.arSessionForm,children:[(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"session details"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["name *",(0,a.jsx)("input",{type:"text",value:o.name,onChange:e=>c(a=>({...a,name:e.target.value})),className:`${l.default.formInput} ${m.name?l.default.error:""}`,placeholder:"enter session name",disabled:n})]}),m.name&&(0,a.jsx)("span",{className:l.default.errorText,children:m.name})]}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["description",(0,a.jsx)("textarea",{value:o.description,onChange:e=>c(a=>({...a,description:e.target.value})),className:l.default.formTextarea,placeholder:"enter session description",rows:3,disabled:n})]})}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["campaign",(0,a.jsx)("input",{type:"text",value:o.campaign,onChange:e=>c(a=>({...a,campaign:e.target.value})),className:l.default.formInput,placeholder:"enter campaign name",disabled:n})]})}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["product id",(0,a.jsx)("input",{type:"text",value:o.productId,onChange:e=>c(a=>({...a,productId:e.target.value})),className:l.default.formInput,placeholder:"enter product id (optional)",disabled:n})]})})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)(r,{onPatternSelect:e=>c(a=>({...a,selectedPatternId:e})),selectedPatternId:o.selectedPatternId,disabled:n}),m.pattern&&(0,a.jsx)("span",{className:l.default.errorText,children:m.pattern})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"3d asset (optional)"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["3d model url",(0,a.jsx)("input",{type:"url",value:o.asset3DUrl,onChange:e=>c(a=>({...a,asset3DUrl:e.target.value})),className:`${l.default.formInput} ${m.asset3DUrl?l.default.error:""}`,placeholder:"https://example.com/model.glb",disabled:n})]}),m.asset3DUrl&&(0,a.jsx)("span",{className:l.default.errorText,children:m.asset3DUrl})]}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["model type",(0,a.jsxs)("select",{value:o.asset3DType,onChange:e=>c(a=>({...a,asset3DType:e.target.value})),className:l.default.formSelect,disabled:n,children:[(0,a.jsx)("option",{value:"glb",children:"glb"}),(0,a.jsx)("option",{value:"gltf",children:"gltf"})]})]})})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"metadata overlay"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["title *",(0,a.jsx)("input",{type:"text",value:o.metadata.title,onChange:e=>c(a=>({...a,metadata:{...a.metadata,title:e.target.value}})),className:`${l.default.formInput} ${m.metadataTitle?l.default.error:""}`,placeholder:"enter overlay title",disabled:n})]}),m.metadataTitle&&(0,a.jsx)("span",{className:l.default.errorText,children:m.metadataTitle})]}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["description *",(0,a.jsx)("textarea",{value:o.metadata.description,onChange:e=>c(a=>({...a,metadata:{...a.metadata,description:e.target.value}})),className:`${l.default.formTextarea} ${m.metadataDescription?l.default.error:""}`,placeholder:"enter overlay description",rows:3,disabled:n})]}),m.metadataDescription&&(0,a.jsx)("span",{className:l.default.errorText,children:m.metadataDescription})]}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("div",{className:l.default.actionsHeader,children:[(0,a.jsx)("label",{className:l.default.formLabel,children:"action buttons"}),(0,a.jsx)("button",{type:"button",onClick:()=>{c(e=>({...e,metadata:{...e.metadata,actions:[...e.metadata.actions,{type:"info",label:"new action",url:""}]}}))},className:l.default.addButton,disabled:n,children:"add action"})]}),o.metadata.actions.map((e,t)=>(0,a.jsxs)("div",{className:l.default.actionRow,children:[(0,a.jsxs)("select",{value:e.type,onChange:e=>f(t,"type",e.target.value),className:l.default.actionTypeSelect,disabled:n,children:[(0,a.jsx)("option",{value:"info",children:"info"}),(0,a.jsx)("option",{value:"purchase",children:"purchase"}),(0,a.jsx)("option",{value:"claim",children:"claim"}),(0,a.jsx)("option",{value:"share",children:"share"})]}),(0,a.jsx)("input",{type:"text",value:e.label,onChange:e=>f(t,"label",e.target.value),className:l.default.actionLabelInput,placeholder:"button label",disabled:n}),(0,a.jsx)("input",{type:"url",value:e.url||"",onChange:e=>f(t,"url",e.target.value),className:l.default.actionUrlInput,placeholder:"action url (optional)",disabled:n}),(0,a.jsx)("button",{type:"button",onClick:()=>{c(e=>({...e,metadata:{...e.metadata,actions:e.metadata.actions.filter((e,a)=>a!==t)}}))},className:l.default.removeButton,disabled:n,children:"Ã—"})]},t))]})]}),(0,a.jsxs)("div",{className:l.default.formActions,children:[(0,a.jsx)("button",{type:"button",onClick:i,className:l.default.buttonSecondary,disabled:n,children:"cancel"}),(0,a.jsx)("button",{type:"submit",className:l.default.buttonPrimary,disabled:n,children:n?"saving...":d?"update session":"create session"})]})]})}e.s(["default",()=>i],2837)},92072,e=>{"use strict";var a=e.i(91398),t=e.i(91788),s=e.i(3828),l=e.i(44054),r=e.i(36613),i=e.i(2837),n=e.i(32750),d=e.i(77934);function o(){let{isAuthenticated:e,loading:o}=(0,l.useAdminAuth)(),c=(0,s.useRouter)(),[m,u]=(0,t.useState)(!1);(0,t.useEffect)(()=>{o||e||c.push("/admin/login")},[e,o,c]);let p=async e=>{try{if(u(!0),!e.name||!e.metadata)throw Error("Missing required fields for AR session creation");let a=await r.arSessions.create(e);c.push(`/admin/ar-sessions/${a.sessionId}`)}catch(e){throw console.error("failed to create ar session:",e),e}finally{u(!1)}},f=()=>{c.push("/admin/ar-sessions")};return o?(0,a.jsx)("div",{className:d.default.adminPageContainer,children:(0,a.jsx)("div",{className:d.default.adminContainer,children:(0,a.jsx)("div",{className:d.default.loadingContainer,children:"loading..."})})}):e?(0,a.jsx)("div",{className:d.default.adminPageContainer,children:(0,a.jsxs)("div",{className:d.default.adminContainer,children:[(0,a.jsxs)("div",{className:d.default.adminHeader,children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,a.jsx)(n.default,{src:"/wmcyn_logo_white.png",alt:"WMCYN Logo",width:80,height:40,priority:!0}),(0,a.jsx)("h1",{className:d.default.adminTitle,children:"create ar session"})]}),(0,a.jsx)("button",{onClick:f,className:d.default.buttonSecondary,children:"back to ar sessions"})]}),(0,a.jsx)(i.default,{onSubmit:p,onCancel:f,loading:m})]})}):null}e.s(["default",()=>o])},29284,(e,a,t)=>{let s="/admin/ar-sessions/new";(window.__NEXT_P=window.__NEXT_P||[]).push([s,()=>e.r(92072)]),a.hot&&a.hot.dispose(function(){window.__NEXT_P.push([s])})},48761,e=>{e.v(a=>Promise.all(["static/chunks/fd7c0943d5cd5e09.js"].map(a=>e.l(a))).then(()=>a(93594)))},28805,e=>{e.v(a=>Promise.all(["static/chunks/3dcc93bb4829c1ba.js"].map(a=>e.l(a))).then(()=>a(79466)))}]);