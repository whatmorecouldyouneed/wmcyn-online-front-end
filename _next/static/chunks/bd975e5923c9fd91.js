(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,15125,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={VALID_LOADERS:function(){return r},imageConfigDefault:function(){return n}};for(var l in s)Object.defineProperty(t,l,{enumerable:!0,get:s[l]});let r=["default","imgix","cloudinary","akamai","custom"],n={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},13521,(e,a,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ImageConfigContext",{enumerable:!0,get:function(){return r}});let s=e.r(41705)._(e.r(91788)),l=e.r(15125),r=s.default.createContext(l.imageConfigDefault)},2837,e=>{"use strict";var a=e.i(91398),t=e.i(91788),s=e.i(36613),l=e.i(77934);function r({onPatternSelect:e,selectedPatternId:r,disabled:n=!1}){let i,[d,o]=(0,t.useState)(!1),[c,m]=(0,t.useState)(0),[u,p]=(0,t.useState)([]),[f,h]=(0,t.useState)(!0),[x,j]=(0,t.useState)(null),[g,v]=(0,t.useState)(!1),N=(0,t.useRef)(null),b=(0,t.useCallback)(async()=>{if(!window.MINDAR?.IMAGE?.Compiler&&!document.querySelector('script[src*="mindar-image.prod.js"]')){let e=document.createElement("script");e.src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.5/dist/mindar-image.prod.js",e.crossOrigin="anonymous",await new Promise((a,t)=>{e.onload=()=>a(),e.onerror=()=>t(Error("Failed to load MindAR compiler script")),document.head.appendChild(e)})}},[]),y=(0,t.useCallback)(async()=>{await b();for(let e=0;e<100;e++){if(window.MINDAR?.IMAGE?.Compiler)return window.MINDAR.IMAGE.Compiler;await new Promise(e=>setTimeout(e,100))}throw Error("MindAR compiler failed to load after 10 seconds. Please refresh the page.")},[b]);t.default.useEffect(()=>{w()},[]);let w=async()=>{try{h(!0);let e=await s.markerPatterns.list();console.log("[MarkerUpload] API response:",e);let a=[];Array.isArray(e)?a=e:e?.markerPatterns?a=e.markerPatterns:e?.patterns?a=e.patterns:e?.items&&(a=e.items),p(a)}catch(e){console.error("failed to load marker patterns:",e),j(e.message||"failed to load marker patterns"),p([])}finally{h(!1)}},C=async a=>{if(!a.type.startsWith("image/"))return void j("please select an image file (png, jpg, etc.)");if(a.size>0xa00000)return void j("file size must be less than 10MB");try{o(!0),j(null),m(0);let t=await new Promise((e,t)=>{let s=new FileReader;s.onload=()=>{let a=s.result.split(",")[1];e(a)},s.onerror=t,s.readAsDataURL(a)}),l=await new Promise((e,t)=>{let s=new Image;s.onload=()=>e(s),s.onerror=t,s.src=URL.createObjectURL(a)}),r=new(await y());await r.compileImageTargets([l],e=>{m(Math.round(100*e))});let n=await r.exportData(),i=(e=>{let a=new Uint8Array(e),t="";for(let e=0;e<a.byteLength;e++)t+=String.fromCharCode(a[e]);return btoa(t)})(n),d=Math.min(100,Math.round(n.byteLength/5e4*100)),c={name:a.name.replace(/\.[^/.]+$/,""),type:"upload",imageFile:{data:t,mimeType:a.type,filename:a.name},mindFileData:i,quality:d},u=await s.markerPatterns.upload(c);await w(),e(u.patternId)}catch(e){console.error("failed to upload marker pattern:",e),j(e.message||"failed to upload marker pattern")}finally{o(!1),m(0)}},P=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?v(!0):"dragleave"===e.type&&v(!1)},D=async a=>{if(confirm("are you sure you want to delete this marker pattern?"))try{await s.markerPatterns.delete(a),await w(),r===a&&e("")}catch(e){console.error("failed to delete marker pattern:",e),j(e.message||"failed to delete marker pattern")}};return f?(0,a.jsx)("div",{className:l.default.loadingContainer,children:"loading marker patterns..."}):(0,a.jsxs)("div",{className:l.default.markerUploadContainer,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"marker pattern"}),x&&(0,a.jsx)("div",{className:l.default.errorMessage,children:x}),(0,a.jsxs)("div",{className:`${l.default.uploadArea} ${g?l.default.dragActive:""} ${n?l.default.disabled:""}`,onDragEnter:P,onDragLeave:P,onDragOver:P,onDrop:e=>{if(e.preventDefault(),e.stopPropagation(),v(!1),n||d)return;let a=e.dataTransfer.files;a&&a[0]&&C(a[0])},onClick:()=>!n&&!d&&N.current?.click(),children:[(0,a.jsx)("input",{ref:N,type:"file",accept:"image/*",onChange:e=>{let a=e.target.files;a&&a[0]&&C(a[0])},style:{display:"none"},disabled:n||d}),d?(0,a.jsxs)("div",{className:l.default.uploadingState,children:[(0,a.jsx)("div",{className:l.default.spinner}),(0,a.jsx)("p",{children:c<100?`Compiling marker... ${c}%`:"Uploading to server..."})]}):(0,a.jsxs)("div",{className:l.default.uploadPrompt,children:[(0,a.jsx)("div",{className:l.default.uploadIcon,children:"ðŸ“"}),(0,a.jsx)("p",{children:"drag & drop an image here or click to browse"}),(0,a.jsx)("p",{className:l.default.uploadHint,children:"supported formats: png, jpg, jpeg (max 10MB)"})]})]}),u&&u.length>0&&(0,a.jsxs)("div",{className:l.default.existingPatterns,children:[(0,a.jsx)("h4",{className:l.default.subsectionTitle,children:"existing patterns"}),(0,a.jsx)("div",{className:l.default.patternsGrid,children:u.map(t=>(0,a.jsxs)("div",{className:`${l.default.patternCard} ${r===t.id?l.default.selected:""}`,onClick:()=>!n&&e(t.id),children:[(0,a.jsx)("div",{className:l.default.patternPreview,children:(0,a.jsx)("img",{src:t.previewUrl,alt:t.name,className:l.default.patternImage})}),(0,a.jsxs)("div",{className:l.default.patternInfo,children:[(0,a.jsx)("h5",{className:l.default.patternName,children:t.name}),(0,a.jsx)("p",{className:l.default.patternType,children:t.type}),(0,a.jsx)("p",{className:l.default.patternDate,children:new Date(t.createdAt).toLocaleDateString()})]}),!n&&(0,a.jsx)("button",{className:l.default.deletePatternButton,onClick:e=>{e.stopPropagation(),D(t.id)},title:"delete pattern",children:"Ã—"})]},t.id))})]}),r&&(0,a.jsxs)("div",{className:l.default.selectedPatternInfo,children:[(0,a.jsx)("h4",{className:l.default.subsectionTitle,children:"selected pattern"}),(i=u.find(e=>e.id===r))?(0,a.jsxs)("div",{className:l.default.selectedPatternCard,children:[(0,a.jsx)("img",{src:i.previewUrl,alt:i.name,className:l.default.selectedPatternImage}),(0,a.jsxs)("div",{className:l.default.selectedPatternDetails,children:[(0,a.jsx)("h5",{children:i.name}),(0,a.jsxs)("p",{children:["type: ",i.type]})]})]}):(0,a.jsx)("p",{children:"pattern not found"})]})]})}function n({initialData:e,onSubmit:s,onCancel:n,loading:i=!1,isEdit:d=!1}){let[o,c]=(0,t.useState)({name:e?.name||"",description:e?.description||"",campaign:e?.campaign||"",productId:e?.productId||"",selectedPatternId:e?.markerPattern?.patternId||"",asset3DUrl:e?.asset3D?.url||"",asset3DType:e?.asset3D?.type||"glb",metadata:{title:e?.metadata?.title||"",description:e?.metadata?.description||"",actions:e?.metadata?.actions||[]}}),[m,u]=(0,t.useState)({}),p=async e=>{let a;if(e.preventDefault(),a={},o.name.trim()||(a.name="name is required"),o.selectedPatternId||(a.pattern="marker pattern is required"),o.metadata.title.trim()||(a.metadataTitle="metadata title is required"),o.metadata.description.trim()||(a.metadataDescription="metadata description is required"),o.asset3DUrl&&!o.asset3DUrl.match(/\.(glb|gltf)$/i)&&(a.asset3DUrl="3d asset must be a .glb or .gltf file"),u(a),0!==Object.keys(a).length)return;let t={name:o.name.trim(),description:o.description.trim()||void 0,campaign:o.campaign.trim()||void 0,productId:o.productId.trim()||void 0,markerPattern:{patternId:o.selectedPatternId,type:"custom"},metadata:{title:o.metadata.title.trim(),description:o.metadata.description.trim(),actions:o.metadata.actions},asset3D:o.asset3DUrl?{url:o.asset3DUrl.trim(),type:o.asset3DType}:void 0};try{await s(t)}catch(e){console.error("form submission error:",e)}},f=(e,a,t)=>{c(s=>({...s,metadata:{...s.metadata,actions:s.metadata.actions.map((s,l)=>l===e?{...s,[a]:t}:s)}}))};return(0,a.jsxs)("form",{onSubmit:p,className:l.default.arSessionForm,children:[(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"session details"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["name *",(0,a.jsx)("input",{type:"text",value:o.name,onChange:e=>c(a=>({...a,name:e.target.value})),className:`${l.default.formInput} ${m.name?l.default.error:""}`,placeholder:"enter session name",disabled:i})]}),m.name&&(0,a.jsx)("span",{className:l.default.errorText,children:m.name})]}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["description",(0,a.jsx)("textarea",{value:o.description,onChange:e=>c(a=>({...a,description:e.target.value})),className:l.default.formTextarea,placeholder:"enter session description",rows:3,disabled:i})]})}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["campaign",(0,a.jsx)("input",{type:"text",value:o.campaign,onChange:e=>c(a=>({...a,campaign:e.target.value})),className:l.default.formInput,placeholder:"enter campaign name",disabled:i})]})}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["product id",(0,a.jsx)("input",{type:"text",value:o.productId,onChange:e=>c(a=>({...a,productId:e.target.value})),className:l.default.formInput,placeholder:"enter product id (optional)",disabled:i})]})})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)(r,{onPatternSelect:e=>c(a=>({...a,selectedPatternId:e})),selectedPatternId:o.selectedPatternId,disabled:i}),m.pattern&&(0,a.jsx)("span",{className:l.default.errorText,children:m.pattern})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"3d asset (optional)"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["3d model url",(0,a.jsx)("input",{type:"url",value:o.asset3DUrl,onChange:e=>c(a=>({...a,asset3DUrl:e.target.value})),className:`${l.default.formInput} ${m.asset3DUrl?l.default.error:""}`,placeholder:"https://example.com/model.glb",disabled:i})]}),m.asset3DUrl&&(0,a.jsx)("span",{className:l.default.errorText,children:m.asset3DUrl})]}),(0,a.jsx)("div",{className:l.default.formGroup,children:(0,a.jsxs)("label",{className:l.default.formLabel,children:["model type",(0,a.jsxs)("select",{value:o.asset3DType,onChange:e=>c(a=>({...a,asset3DType:e.target.value})),className:l.default.formSelect,disabled:i,children:[(0,a.jsx)("option",{value:"glb",children:"glb"}),(0,a.jsx)("option",{value:"gltf",children:"gltf"})]})]})})]}),(0,a.jsxs)("div",{className:l.default.formSection,children:[(0,a.jsx)("h3",{className:l.default.sectionTitle,children:"metadata overlay"}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["title *",(0,a.jsx)("input",{type:"text",value:o.metadata.title,onChange:e=>c(a=>({...a,metadata:{...a.metadata,title:e.target.value}})),className:`${l.default.formInput} ${m.metadataTitle?l.default.error:""}`,placeholder:"enter overlay title",disabled:i})]}),m.metadataTitle&&(0,a.jsx)("span",{className:l.default.errorText,children:m.metadataTitle})]}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("label",{className:l.default.formLabel,children:["description *",(0,a.jsx)("textarea",{value:o.metadata.description,onChange:e=>c(a=>({...a,metadata:{...a.metadata,description:e.target.value}})),className:`${l.default.formTextarea} ${m.metadataDescription?l.default.error:""}`,placeholder:"enter overlay description",rows:3,disabled:i})]}),m.metadataDescription&&(0,a.jsx)("span",{className:l.default.errorText,children:m.metadataDescription})]}),(0,a.jsxs)("div",{className:l.default.formGroup,children:[(0,a.jsxs)("div",{className:l.default.actionsHeader,children:[(0,a.jsx)("label",{className:l.default.formLabel,children:"action buttons"}),(0,a.jsx)("button",{type:"button",onClick:()=>{c(e=>({...e,metadata:{...e.metadata,actions:[...e.metadata.actions,{type:"info",label:"new action",url:""}]}}))},className:l.default.addButton,disabled:i,children:"add action"})]}),o.metadata.actions.map((e,t)=>(0,a.jsxs)("div",{className:l.default.actionRow,children:[(0,a.jsxs)("select",{value:e.type,onChange:e=>f(t,"type",e.target.value),className:l.default.actionTypeSelect,disabled:i,children:[(0,a.jsx)("option",{value:"info",children:"info"}),(0,a.jsx)("option",{value:"purchase",children:"purchase"}),(0,a.jsx)("option",{value:"claim",children:"claim"}),(0,a.jsx)("option",{value:"share",children:"share"})]}),(0,a.jsx)("input",{type:"text",value:e.label,onChange:e=>f(t,"label",e.target.value),className:l.default.actionLabelInput,placeholder:"button label",disabled:i}),(0,a.jsx)("input",{type:"url",value:e.url||"",onChange:e=>f(t,"url",e.target.value),className:l.default.actionUrlInput,placeholder:"action url (optional)",disabled:i}),(0,a.jsx)("button",{type:"button",onClick:()=>{c(e=>({...e,metadata:{...e.metadata,actions:e.metadata.actions.filter((e,a)=>a!==t)}}))},className:l.default.removeButton,disabled:i,children:"Ã—"})]},t))]})]}),(0,a.jsxs)("div",{className:l.default.formActions,children:[(0,a.jsx)("button",{type:"button",onClick:n,className:l.default.buttonSecondary,disabled:i,children:"cancel"}),(0,a.jsx)("button",{type:"submit",className:l.default.buttonPrimary,disabled:i,children:i?"saving...":d?"update session":"create session"})]})]})}e.s(["default",()=>n],2837)},58180,e=>{"use strict";var a=e.i(91398),t=e.i(91788),s=e.i(3828),l=e.i(44054),r=e.i(36613),n=e.i(2837),i=e.i(50080),d=e.i(32750),o=e.i(77934);function c(){let{isAuthenticated:e,loading:c}=(0,l.useAdminAuth)(),m=(0,s.useRouter)(),u=m.query.id,[p,f]=(0,t.useState)(null),[h,x]=(0,t.useState)(!0),[j,g]=(0,t.useState)(!1),[v,N]=(0,t.useState)(null),[b,y]=(0,t.useState)(!1);(0,t.useEffect)(()=>{c||e||m.push("/admin/login")},[e,c,m]),(0,t.useEffect)(()=>{e&&u&&w()},[e,u]),(0,t.useEffect)(()=>{"true"===m.query.generateQR&&y(!0)},[m.query]);let w=async()=>{try{x(!0),N(null);let e=await r.arSessions.list();console.log("[ARSessionEdit] API response:",e);let a=(Array.isArray(e)?e:e?.arSessions||e?.sessions||[]).find(e=>e.sessionId===u||e.id===u);if(!a)return void N("ar session not found");let t={...a,sessionId:a.sessionId||a.id};f(t)}catch(e){console.error("failed to load ar session:",e),N(e.message||"failed to load ar session")}finally{x(!1)}},C=async e=>{try{g(!0);let a=await r.arSessions.update(u,e);f(a)}catch(e){throw console.error("failed to update ar session:",e),e}finally{g(!1)}},P=()=>{m.push("/admin/ar-sessions")},D=async()=>{if(p&&confirm(`are you sure you want to delete "${p.metadata?.title||p.name||"this session"}"? this action cannot be undone.`))try{await r.arSessions.delete(u),m.push("/admin/ar-sessions")}catch(e){console.error("failed to delete ar session:",e),alert("failed to delete ar session: "+(e.message||"unknown error"))}};return c||h?(0,a.jsx)("div",{className:o.default.adminPageContainer,children:(0,a.jsx)("div",{className:o.default.adminContainer,children:(0,a.jsx)("div",{className:o.default.loadingContainer,children:c?"loading...":"loading ar session..."})})}):e?v?(0,a.jsx)("div",{className:o.default.adminPageContainer,children:(0,a.jsx)("div",{className:o.default.adminContainer,children:(0,a.jsxs)("div",{className:o.default.errorContainer,children:[(0,a.jsx)("h2",{children:"error"}),(0,a.jsx)("p",{children:v}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,a.jsx)("button",{onClick:w,className:o.default.button,children:"try again"}),(0,a.jsx)("button",{onClick:P,className:o.default.buttonSecondary,children:"back to ar sessions"})]})]})})}):p?(0,a.jsx)("div",{className:o.default.adminPageContainer,children:(0,a.jsxs)("div",{className:o.default.adminContainer,children:[(0,a.jsxs)("div",{className:o.default.adminHeader,children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(0,a.jsx)(d.default,{src:"/wmcyn_logo_white.png",alt:"WMCYN Logo",width:80,height:40,priority:!0}),(0,a.jsx)("h1",{className:o.default.adminTitle,children:"edit ar session"})]}),(0,a.jsxs)("div",{style:{display:"flex",gap:"12px"},children:[(0,a.jsx)("button",{onClick:P,className:o.default.buttonSecondary,children:"back to ar sessions"}),(0,a.jsx)("button",{onClick:()=>{window.open(`/ar-session/${u}`,"_blank")},className:o.default.buttonSecondary,children:"view ar session"}),(0,a.jsx)("button",{onClick:()=>{y(!0)},className:o.default.buttonPrimary,children:"generate qr code"}),(0,a.jsx)("button",{onClick:D,className:`${o.default.buttonSecondary} ${o.default.dangerButton}`,children:"delete"})]})]}),(0,a.jsx)("div",{className:o.default.sessionInfo,children:(0,a.jsxs)("div",{className:o.default.sessionMeta,children:[(0,a.jsxs)("div",{className:o.default.metaRow,children:[(0,a.jsx)("span",{className:o.default.metaLabel,children:"session id:"}),(0,a.jsx)("span",{className:o.default.metaValue,children:p.sessionId})]}),(0,a.jsxs)("div",{className:o.default.metaRow,children:[(0,a.jsx)("span",{className:o.default.metaLabel,children:"status:"}),(0,a.jsx)("span",{className:`${o.default.statusBadge} ${o.default[p.status]}`,children:p.status})]}),(0,a.jsxs)("div",{className:o.default.metaRow,children:[(0,a.jsx)("span",{className:o.default.metaLabel,children:"created:"}),(0,a.jsx)("span",{className:o.default.metaValue,children:new Date(p.createdAt).toLocaleString()})]}),(0,a.jsxs)("div",{className:o.default.metaRow,children:[(0,a.jsx)("span",{className:o.default.metaLabel,children:"updated:"}),(0,a.jsx)("span",{className:o.default.metaValue,children:new Date(p.updatedAt).toLocaleString()})]})]})}),(0,a.jsx)(n.default,{initialData:{name:p.metadata?.title||p.name||"",description:p.metadata?.description||p.campaign||"",campaign:p.campaign||"",productId:p.product?.id,markerPattern:{patternId:p.markerPattern?.patternId||p.markerPattern?.name||"",type:p.markerPattern?.type||"custom"},metadata:{title:p.metadata?.title||p.name||"",description:p.metadata?.description||"",actions:p.metadata?.actions?.map(e=>({...e,type:e.type}))||[]},asset3D:p.asset3D?{...p.asset3D,type:p.asset3D.type}:void 0},onSubmit:C,onCancel:P,loading:j,isEdit:!0}),(0,a.jsx)(i.default,{arSession:p,isOpen:b,onClose:()=>y(!1),onSuccess:()=>{y(!1)}})]})}):(0,a.jsx)("div",{className:o.default.adminPageContainer,children:(0,a.jsx)("div",{className:o.default.adminContainer,children:(0,a.jsxs)("div",{className:o.default.errorContainer,children:[(0,a.jsx)("h2",{children:"ar session not found"}),(0,a.jsx)("p",{children:"the requested ar session could not be found."}),(0,a.jsx)("button",{onClick:P,className:o.default.button,children:"back to ar sessions"})]})})}):null}e.s(["default",()=>c])},84247,(e,a,t)=>{let s="/admin/ar-sessions/[id]";(window.__NEXT_P=window.__NEXT_P||[]).push([s,()=>e.r(58180)]),a.hot&&a.hot.dispose(function(){window.__NEXT_P.push([s])})},48761,e=>{e.v(a=>Promise.all(["static/chunks/fd7c0943d5cd5e09.js"].map(a=>e.l(a))).then(()=>a(93594)))},28805,e=>{e.v(a=>Promise.all(["static/chunks/3dcc93bb4829c1ba.js"].map(a=>e.l(a))).then(()=>a(79466)))}]);