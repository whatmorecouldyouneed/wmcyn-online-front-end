(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{1683:(e,t,n)=>{"use strict";n.d(t,{BH:()=>C,LL:()=>V,ZR:()=>U,gQ:()=>ee,zI:()=>F,hu:()=>o,g5:()=>a,US:()=>u,tV:()=>p,h$:()=>d,L:()=>f,$s:()=>ea,r3:()=>G,Sg:()=>S,ne:()=>et,p$:()=>g,vZ:()=>function e(t,n){if(t===n)return!0;let i=Object.keys(t),r=Object.keys(n);for(let s of i){if(!r.includes(s))return!1;let i=t[s],o=n[s];if(Y(i)&&Y(o)){if(!e(i,o))return!1}else if(i!==o)return!1}for(let e of r)if(!i.includes(e))return!1;return!0},gK:()=>er,pd:()=>Z,aH:()=>E,q4:()=>I,P0:()=>b,Pz:()=>T,Rd:()=>m,m9:()=>el,z$:()=>x,GJ:()=>K,ru:()=>N,Xx:()=>eh,L_:()=>A,xb:()=>H,w1:()=>P,hl:()=>L,uI:()=>k,Yr:()=>D,b$:()=>R,G6:()=>O,w9:()=>$,cI:()=>B,UI:()=>Q,Uo:()=>eu,xO:()=>J,zd:()=>X,DV:()=>W,ug:()=>eo,dS:()=>es,Wl:()=>j,eu:()=>M});let i=()=>void 0;var r=n(4155);let s={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},o=function(e,t){if(!e)throw a(t)},a=function(e){return Error("Firebase Database ("+s.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},l=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},h=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},u={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,u=(3&r)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;a||(d=64,s||(c=64)),i.push(n[h],n[u],n[c],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(l(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):h(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new c;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class c extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let d=function(e){let t=l(e);return u.encodeByteArray(t,!0)},f=function(e){return d(e).replace(/\./g,"")},p=function(e){try{return u.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function g(e){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,e)}function m(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw Error("Unable to locate global object.")}let y=()=>m().__FIREBASE_DEFAULTS__,_=()=>{if(void 0===r||void 0===r.env)return;let e=r.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},v=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&p(e[1]);return t&&JSON.parse(t)},w=()=>{try{return i()||y()||_()||v()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},I=e=>{var t,n;return null===(n=null===(t=w())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},b=e=>{let t=I(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},E=()=>{var e;return null===(e=w())||void 0===e?void 0:e.config},T=e=>{var t;return null===(t=w())||void 0===t?void 0:t[`_${e}`]};class C{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function S(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[f(JSON.stringify({alg:"none",type:"JWT"})),f(JSON.stringify(s)),""].join(".")}function x(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function k(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(x())}function A(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function N(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function R(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function P(){let e=x();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function D(){return!0===s.NODE_CLIENT||!0===s.NODE_ADMIN}function O(){return!function(){var e;let t=null===(e=w())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function L(){try{return"object"==typeof indexedDB}catch(e){return!1}}function M(){return new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})}function F(){return"undefined"!=typeof navigator&&!!navigator.cookieEnabled}class U extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,U.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,V.prototype.create)}}class V{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){let n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?r.replace(q,(e,t)=>{let i=n[t];return null!=i?String(i):`<${t}?>`}):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new U(i,o,n)}}let q=/\{\$([^}]+)}/g;function B(e){return JSON.parse(e)}function j(e){return JSON.stringify(e)}let z=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=B(p(s[0])||""),n=B(p(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},$=function(e){let t=z(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},K=function(e){let t=z(e).claims;return"object"==typeof t&&!0===t.admin};function G(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function W(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function H(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function Q(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function Y(e){return null!==e&&"object"==typeof e}function J(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function X(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function Z(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class ee{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]&0xffffffff;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s&0xffffffff,this.chain_[1]=this.chain_[1]+o&0xffffffff,this.chain_[2]=this.chain_[2]+a&0xffffffff,this.chain_[3]=this.chain_[3]+l&0xffffffff,this.chain_[4]=this.chain_[4]+h&0xffffffff}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function et(e,t){let n=new en(e,t);return n.subscribe.bind(n)}class en{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=ei),void 0===i.error&&(i.error=ei),void 0===i.complete&&(i.complete=ei);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ei(){}function er(e,t){return`${e} failed: ${t} argument `}let es=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;o(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eo=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ea(e,t=1e3,n=2){let i=t*Math.pow(n,e),r=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+r)}function el(e){return e&&e._delegate?e._delegate:e}function eh(e){return e.endsWith(".cloudworkstations.dev")}async function eu(e){return(await fetch(e,{credentials:"include"})).ok}},9742:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],i=t[1];return(n+i)*3/4-i},t.toByteArray=function(e){var t,n,s=l(e),o=s[0],a=s[1],h=new r((o+a)*3/4-a),u=0,c=a>0?o-4:o;for(n=0;n<c;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],h[u++]=t>>16&255,h[u++]=t>>8&255,h[u++]=255&t;return 2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,h[u++]=255&t),1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,h[u++]=t>>8&255,h[u++]=255&t),h},t.fromByteArray=function(e){for(var t,i=e.length,r=i%3,s=[],o=0,a=i-r;o<a;o+=16383)s.push(function(e,t,i){for(var r,s=[],o=t;o<i;o+=3)s.push(n[(r=(e[o]<<16&0xff0000)+(e[o+1]<<8&65280)+(255&e[o+2]))>>18&63]+n[r>>12&63]+n[r>>6&63]+n[63&r]);return s.join("")}(e,o,o+16383>a?a:o+16383));return 1===r?s.push(n[(t=e[i-1])>>2]+n[t<<4&63]+"=="):2===r&&s.push(n[(t=(e[i-2]<<8)+e[i-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),s.join("")};for(var n=[],i=[],r="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,a=s.length;o<a;++o)n[o]=s[o],i[s.charCodeAt(o)]=o;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var i=n===t?0:4-n%4;return[n,i]}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},8764:(e,t,n)=>{"use strict";let i=n(9742),r=n(645),s="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function o(e){if(e>0x7fffffff)throw RangeError('The value "'+e+'" is invalid for option "size"');let t=new Uint8Array(e);return Object.setPrototypeOf(t,a.prototype),t}function a(e,t,n){if("number"==typeof e){if("string"==typeof t)throw TypeError('The "string" argument must be of type string. Received type number');return u(e)}return l(e,t,n)}function l(e,t,n){if("string"==typeof e)return function(e,t){if(("string"!=typeof t||""===t)&&(t="utf8"),!a.isEncoding(t))throw TypeError("Unknown encoding: "+t);let n=0|p(e,t),i=o(n),r=i.write(e,t);return r!==n&&(i=i.slice(0,r)),i}(e,t);if(ArrayBuffer.isView(e))return function(e){if(F(e,Uint8Array)){let t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return c(e)}(e);if(null==e)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(F(e,ArrayBuffer)||e&&F(e.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(F(e,SharedArrayBuffer)||e&&F(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"==typeof e)throw TypeError('The "value" argument must not be of type number. Received type number');let i=e.valueOf&&e.valueOf();if(null!=i&&i!==e)return a.from(i,t,n);let r=function(e){var t;if(a.isBuffer(e)){let t=0|f(e.length),n=o(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!=typeof e.length||(t=e.length)!=t?o(0):c(e):"Buffer"===e.type&&Array.isArray(e.data)?c(e.data):void 0}(e);if(r)return r;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return a.from(e[Symbol.toPrimitive]("string"),t,n);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!=typeof e)throw TypeError('"size" argument must be of type number');if(e<0)throw RangeError('The value "'+e+'" is invalid for option "size"')}function u(e){return h(e),o(e<0?0:0|f(e))}function c(e){let t=e.length<0?0:0|f(e.length),n=o(t);for(let i=0;i<t;i+=1)n[i]=255&e[i];return n}function d(e,t,n){let i;if(t<0||e.byteLength<t)throw RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(i=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),a.prototype),i}function f(e){if(e>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|e}function p(e,t){if(a.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||F(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);let n=e.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;let r=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return O(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return L(e).length;default:if(r)return i?-1:O(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length||((void 0===n||n>this.length)&&(n=this.length),n<=0||(n>>>=0)<=(t>>>=0)))return"";for(e||(e="utf8");;)switch(e){case"hex":return function(e,t,n){let i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);let r="";for(let i=t;i<n;++i)r+=U[e[i]];return r}(this,t,n);case"utf8":case"utf-8":return v(this,t,n);case"ascii":return function(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}(this,t,n);case"latin1":case"binary":return function(e,t,n){let i="";n=Math.min(e.length,n);for(let r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}(this,t,n);case"base64":var s,o;return s=t,o=n,0===s&&o===this.length?i.fromByteArray(this):i.fromByteArray(this.slice(s,o));case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return function(e,t,n){let i=e.slice(t,n),r="";for(let e=0;e<i.length-1;e+=2)r+=String.fromCharCode(i[e]+256*i[e+1]);return r}(this,t,n);default:if(r)throw TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function m(e,t,n){let i=e[t];e[t]=e[n],e[n]=i}function y(e,t,n,i,r){var s;if(0===e.length)return -1;if("string"==typeof n?(i=n,n=0):n>0x7fffffff?n=0x7fffffff:n<-0x80000000&&(n=-0x80000000),(s=n=+n)!=s&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return -1;n=e.length-1}else if(n<0){if(!r)return -1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:_(e,t,n,i,r);if("number"==typeof t)return(t&=255,"function"==typeof Uint8Array.prototype.indexOf)?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,i,r);throw TypeError("val must be string, number or Buffer")}function _(e,t,n,i,r){let s,o=1,a=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return -1;o=2,a/=2,l/=2,n/=2}function h(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(r){let i=-1;for(s=n;s<a;s++)if(h(e,s)===h(t,-1===i?0:s-i)){if(-1===i&&(i=s),s-i+1===l)return i*o}else -1!==i&&(s-=s-i),i=-1}else for(n+l>a&&(n=a-l),s=n;s>=0;s--){let n=!0;for(let i=0;i<l;i++)if(h(e,s+i)!==h(t,i)){n=!1;break}if(n)return s}return -1}function v(e,t,n){n=Math.min(e.length,n);let i=[],r=t;for(;r<n;){let t=e[r],s=null,o=t>239?4:t>223?3:t>191?2:1;if(r+o<=n){let n,i,a,l;switch(o){case 1:t<128&&(s=t);break;case 2:(192&(n=e[r+1]))==128&&(l=(31&t)<<6|63&n)>127&&(s=l);break;case 3:n=e[r+1],i=e[r+2],(192&n)==128&&(192&i)==128&&(l=(15&t)<<12|(63&n)<<6|63&i)>2047&&(l<55296||l>57343)&&(s=l);break;case 4:n=e[r+1],i=e[r+2],a=e[r+3],(192&n)==128&&(192&i)==128&&(192&a)==128&&(l=(15&t)<<18|(63&n)<<12|(63&i)<<6|63&a)>65535&&l<1114112&&(s=l)}}null===s?(s=65533,o=1):s>65535&&(s-=65536,i.push(s>>>10&1023|55296),s=56320|1023&s),i.push(s),r+=o}return function(e){let t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let n="",i=0;for(;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=4096));return n}(i)}function w(e,t,n){if(e%1!=0||e<0)throw RangeError("offset is not uint");if(e+t>n)throw RangeError("Trying to access beyond buffer length")}function I(e,t,n,i,r,s){if(!a.isBuffer(e))throw TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<s)throw RangeError('"value" argument is out of bounds');if(n+i>e.length)throw RangeError("Index out of range")}function b(e,t,n,i,r){N(t,i,r,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function E(e,t,n,i,r){N(t,i,r,e,n,7);let s=Number(t&BigInt(0xffffffff));e[n+7]=s,s>>=8,e[n+6]=s,s>>=8,e[n+5]=s,s>>=8,e[n+4]=s;let o=Number(t>>BigInt(32)&BigInt(0xffffffff));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function T(e,t,n,i,r,s){if(n+i>e.length||n<0)throw RangeError("Index out of range")}function C(e,t,n,i,s){return t=+t,n>>>=0,s||T(e,t,n,4,34028234663852886e22,-34028234663852886e22),r.write(e,t,n,i,23,4),n+4}function S(e,t,n,i,s){return t=+t,n>>>=0,s||T(e,t,n,8,17976931348623157e292,-17976931348623157e292),r.write(e,t,n,i,52,8),n+8}t.lW=a,t.h2=50,a.TYPED_ARRAY_SUPPORT=function(){try{let e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),a.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}}),a.poolSize=8192,a.from=function(e,t,n){return l(e,t,n)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array),a.alloc=function(e,t,n){return(h(e),e<=0)?o(e):void 0!==t?"string"==typeof n?o(e).fill(t,n):o(e).fill(t):o(e)},a.allocUnsafe=function(e){return u(e)},a.allocUnsafeSlow=function(e){return u(e)},a.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==a.prototype},a.compare=function(e,t){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),F(t,Uint8Array)&&(t=a.from(t,t.offset,t.byteLength)),!a.isBuffer(e)||!a.isBuffer(t))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let r=0,s=Math.min(n,i);r<s;++r)if(e[r]!==t[r]){n=e[r],i=t[r];break}return n<i?-1:i<n?1:0},a.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(e,t){let n;if(!Array.isArray(e))throw TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return a.alloc(0);if(void 0===t)for(n=0,t=0;n<e.length;++n)t+=e[n].length;let i=a.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){let t=e[n];if(F(t,Uint8Array))r+t.length>i.length?(a.isBuffer(t)||(t=a.from(t)),t.copy(i,r)):Uint8Array.prototype.set.call(i,t,r);else if(a.isBuffer(t))t.copy(i,r);else throw TypeError('"list" argument must be an Array of Buffers');r+=t.length}return i},a.byteLength=p,a.prototype._isBuffer=!0,a.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)m(this,t,t+1);return this},a.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},a.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},a.prototype.toString=function(){let e=this.length;return 0===e?"":0==arguments.length?v(this,0,e):g.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(e){if(!a.isBuffer(e))throw TypeError("Argument must be a Buffer");return this===e||0===a.compare(this,e)},a.prototype.inspect=function(){let e="",n=t.h2;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},s&&(a.prototype[s]=a.prototype.inspect),a.prototype.compare=function(e,t,n,i,r){if(F(e,Uint8Array)&&(e=a.from(e,e.offset,e.byteLength)),!a.isBuffer(e))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),t<0||n>e.length||i<0||r>this.length)throw RangeError("out of range index");if(i>=r&&t>=n)return 0;if(i>=r)return -1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,r>>>=0,this===e)return 0;let s=r-i,o=n-t,l=Math.min(s,o),h=this.slice(i,r),u=e.slice(t,n);for(let e=0;e<l;++e)if(h[e]!==u[e]){s=h[e],o=u[e];break}return s<o?-1:o<s?1:0},a.prototype.includes=function(e,t,n){return -1!==this.indexOf(e,t,n)},a.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},a.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},a.prototype.write=function(e,t,n,i){var r,s,o,a,l,h,u,c;if(void 0===t)i="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)i=t,n=this.length,t=0;else if(isFinite(t))t>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let d=this.length-t;if((void 0===n||n>d)&&(n=d),e.length>0&&(n<0||t<0)||t>this.length)throw RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let f=!1;for(;;)switch(i){case"hex":return function(e,t,n,i){let r;n=Number(n)||0;let s=e.length-n;i?(i=Number(i))>s&&(i=s):i=s;let o=t.length;for(i>o/2&&(i=o/2),r=0;r<i;++r){let i=parseInt(t.substr(2*r,2),16);if(i!=i)break;e[n+r]=i}return r}(this,e,t,n);case"utf8":case"utf-8":return r=t,s=n,M(O(e,this.length-r),this,r,s);case"ascii":case"latin1":case"binary":return o=t,a=n,M(function(e){let t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(e),this,o,a);case"base64":return l=t,h=n,M(L(e),this,l,h);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return u=t,c=n,M(function(e,t){let n,i;let r=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)i=(n=e.charCodeAt(s))>>8,r.push(n%256),r.push(i);return r}(e,this.length-u),this,u,c);default:if(f)throw TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),f=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},a.prototype.slice=function(e,t){let n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n)<0&&(e=0):e>n&&(e=n),t<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,a.prototype),i},a.prototype.readUintLE=a.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return i},a.prototype.readUintBE=a.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);let i=this[e+--t],r=1;for(;t>0&&(r*=256);)i+=this[e+--t]*r;return i},a.prototype.readUint8=a.prototype.readUInt8=function(e,t){return e>>>=0,t||w(e,1,this.length),this[e]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]|this[e+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(e,t){return e>>>=0,t||w(e,2,this.length),this[e]<<8|this[e+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+0x1000000*this[e+3]},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),0x1000000*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},a.prototype.readBigUInt64LE=V(function(e){R(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&P(e,this.length-8);let i=t+256*this[++e]+65536*this[++e]+0x1000000*this[++e],r=this[++e]+256*this[++e]+65536*this[++e]+0x1000000*n;return BigInt(i)+(BigInt(r)<<BigInt(32))}),a.prototype.readBigUInt64BE=V(function(e){R(e>>>=0,"offset");let t=this[e],n=this[e+7];(void 0===t||void 0===n)&&P(e,this.length-8);let i=0x1000000*t+65536*this[++e]+256*this[++e]+this[++e],r=0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n;return(BigInt(i)<<BigInt(32))+BigInt(r)}),a.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);let i=this[e],r=1,s=0;for(;++s<t&&(r*=256);)i+=this[e+s]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},a.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||w(e,t,this.length);let i=t,r=1,s=this[e+--i];for(;i>0&&(r*=256);)s+=this[e+--i]*r;return s>=(r*=128)&&(s-=Math.pow(2,8*t)),s},a.prototype.readInt8=function(e,t){return(e>>>=0,t||w(e,1,this.length),128&this[e])?-((255-this[e]+1)*1):this[e]},a.prototype.readInt16LE=function(e,t){e>>>=0,t||w(e,2,this.length);let n=this[e]|this[e+1]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt16BE=function(e,t){e>>>=0,t||w(e,2,this.length);let n=this[e+1]|this[e]<<8;return 32768&n?0xffff0000|n:n},a.prototype.readInt32LE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},a.prototype.readInt32BE=function(e,t){return e>>>=0,t||w(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},a.prototype.readBigInt64LE=V(function(e){R(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&P(e,this.length-8),(BigInt(this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24))<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+0x1000000*this[++e])}),a.prototype.readBigInt64BE=V(function(e){R(e>>>=0,"offset");let t=this[e],n=this[e+7];return(void 0===t||void 0===n)&&P(e,this.length-8),(BigInt((t<<24)+65536*this[++e]+256*this[++e]+this[++e])<<BigInt(32))+BigInt(0x1000000*this[++e]+65536*this[++e]+256*this[++e]+n)}),a.prototype.readFloatLE=function(e,t){return e>>>=0,t||w(e,4,this.length),r.read(this,e,!0,23,4)},a.prototype.readFloatBE=function(e,t){return e>>>=0,t||w(e,4,this.length),r.read(this,e,!1,23,4)},a.prototype.readDoubleLE=function(e,t){return e>>>=0,t||w(e,8,this.length),r.read(this,e,!0,52,8)},a.prototype.readDoubleBE=function(e,t){return e>>>=0,t||w(e,8,this.length),r.read(this,e,!1,52,8)},a.prototype.writeUintLE=a.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){let i=Math.pow(2,8*n)-1;I(this,e,t,n,i,0)}let r=1,s=0;for(this[t]=255&e;++s<n&&(r*=256);)this[t+s]=e/r&255;return t+n},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t>>>=0,n>>>=0,!i){let i=Math.pow(2,8*n)-1;I(this,e,t,n,i,0)}let r=n-1,s=1;for(this[t+r]=255&e;--r>=0&&(s*=256);)this[t+r]=e/s&255;return t+n},a.prototype.writeUint8=a.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,255,0),this[t]=255&e,t+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,0xffffffff,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,0xffffffff,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeBigUInt64LE=V(function(e,t=0){return b(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=V(function(e,t=0){return E(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=0,s=1,o=0;for(this[t]=255&e;++r<n&&(s*=256);)e<0&&0===o&&0!==this[t+r-1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+n},a.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t>>>=0,!i){let i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}let r=n-1,s=1,o=0;for(this[t+r]=255&e;--r>=0&&(s*=256);)e<0&&0===o&&0!==this[t+r+1]&&(o=1),this[t+r]=(e/s>>0)-o&255;return t+n},a.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},a.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},a.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},a.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,0x7fffffff,-0x80000000),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},a.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||I(this,e,t,4,0x7fffffff,-0x80000000),e<0&&(e=0xffffffff+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},a.prototype.writeBigInt64LE=V(function(e,t=0){return b(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=V(function(e,t=0){return E(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeFloatLE=function(e,t,n){return C(this,e,t,!0,n)},a.prototype.writeFloatBE=function(e,t,n){return C(this,e,t,!1,n)},a.prototype.writeDoubleLE=function(e,t,n){return S(this,e,t,!0,n)},a.prototype.writeDoubleBE=function(e,t,n){return S(this,e,t,!1,n)},a.prototype.copy=function(e,t,n,i){if(!a.isBuffer(e))throw TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||0===e.length||0===this.length)return 0;if(t<0)throw RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw RangeError("Index out of range");if(i<0)throw RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let r=i-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),r},a.prototype.fill=function(e,t,n,i){let r;if("string"==typeof e){if("string"==typeof t?(i=t,t=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw TypeError("encoding must be a string");if("string"==typeof i&&!a.isEncoding(i))throw TypeError("Unknown encoding: "+i);if(1===e.length){let t=e.charCodeAt(0);("utf8"===i&&t<128||"latin1"===i)&&(e=t)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw RangeError("Out of range index");if(n<=t)return this;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(r=t;r<n;++r)this[r]=e;else{let s=a.isBuffer(e)?e:a.from(e,i),o=s.length;if(0===o)throw TypeError('The value "'+e+'" is invalid for argument "value"');for(r=0;r<n-t;++r)this[r+t]=s[r%o]}return this};let x={};function k(e,t,n){x[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function A(e){let t="",n=e.length,i="-"===e[0]?1:0;for(;n>=i+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function N(e,t,n,i,r,s){if(e>n||e<t){let i;let r="bigint"==typeof t?"n":"";throw i=s>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${(s+1)*8}${r}`:`>= -(2${r} ** ${(s+1)*8-1}${r}) and < 2 ** ${(s+1)*8-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new x.ERR_OUT_OF_RANGE("value",i,e)}R(r,"offset"),(void 0===i[r]||void 0===i[r+s])&&P(r,i.length-(s+1))}function R(e,t){if("number"!=typeof e)throw new x.ERR_INVALID_ARG_TYPE(t,"number",e)}function P(e,t,n){if(Math.floor(e)!==e)throw R(e,n),new x.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new x.ERR_BUFFER_OUT_OF_BOUNDS;throw new x.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}k("ERR_BUFFER_OUT_OF_BOUNDS",function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),k("ERR_INVALID_ARG_TYPE",function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`},TypeError),k("ERR_OUT_OF_RANGE",function(e,t,n){let i=`The value of "${e}" is out of range.`,r=n;return Number.isInteger(n)&&Math.abs(n)>0x100000000?r=A(String(n)):"bigint"==typeof n&&(r=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(r=A(r)),r+="n"),i+=` It must be ${t}. Received ${r}`},RangeError);let D=/[^+/0-9A-Za-z-_]/g;function O(e,t){let n;t=t||1/0;let i=e.length,r=null,s=[];for(let o=0;o<i;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!r){if(n>56319||o+1===i){(t-=3)>-1&&s.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),r=n;continue}n=(r-55296<<10|n-56320)+65536}else r&&(t-=3)>-1&&s.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else if(n<1114112){if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}else throw Error("Invalid code point")}return s}function L(e){return i.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(D,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function M(e,t,n,i){let r;for(r=0;r<i&&!(r+n>=t.length)&&!(r>=e.length);++r)t[r+n]=e[r];return r}function F(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}let U=function(){let e="0123456789abcdef",t=Array(256);for(let n=0;n<16;++n){let i=16*n;for(let r=0;r<16;++r)t[i+r]=e[n]+e[r]}return t}();function V(e){return"undefined"==typeof BigInt?q:e}function q(){throw Error("BigInt not supported")}},645:(e,t)=>{t.read=function(e,t,n,i,r){var s,o,a=8*r-i-1,l=(1<<a)-1,h=l>>1,u=-7,c=n?r-1:0,d=n?-1:1,f=e[t+c];for(c+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+e[t+c],c+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=i;u>0;o=256*o+e[t+c],c+=d,u-=8);if(0===s)s=1-h;else{if(s===l)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,i),s-=h}return(f?-1:1)*o*Math.pow(2,s-i)},t.write=function(e,t,n,i,r,s){var o,a,l,h=8*s-r-1,u=(1<<h)-1,c=u>>1,d=23===r?5960464477539062e-23:0,f=i?0:s-1,p=i?1:-1,g=t<0||0===t&&1/t<0?1:0;for(isNaN(t=Math.abs(t))||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),o+c>=1?t+=d/l:t+=d*Math.pow(2,1-c),t*l>=2&&(o++,l/=2),o+c>=u?(a=0,o=u):o+c>=1?(a=(t*l-1)*Math.pow(2,r),o+=c):(a=t*Math.pow(2,c-1)*Math.pow(2,r),o=0));r>=8;e[n+f]=255&a,f+=p,a/=256,r-=8);for(o=o<<r|a,h+=r;h>0;e[n+f]=255&o,f+=p,o/=256,h-=8);e[n+f-p]|=128*g}},6840:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return n(5545)}])},837:(e,t,n)=>{"use strict";n.d(t,{H:()=>u,a:()=>h});var i=n(5893),r=n(7294),s=n(1382),o=n(1409),a=n(109);let l=(0,r.createContext)(void 0);function h(){let e=(0,r.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}function u(e){let{children:t}=e,[n,h]=(0,r.useState)(null),[u,c]=(0,r.useState)(!0),d=async(e,t)=>{if(!s.I8)throw Error("Authentication not initialized");if(!s.RZ)throw Error("Firestore not initialized");let n=await (0,o.Xb)(s.I8,e,t);return await (0,a.pl)((0,a.JU)(s.RZ,"users",n.user.uid),{email:e}),n};return(0,r.useEffect)(()=>s.I8?(0,o.Aj)(s.I8,async e=>{if(e){if(!s.RZ){console.error("Firestore not initialized");return}let t=(0,a.JU)(s.RZ,"users",e.uid);(await (0,a.QT)(t)).exists()||(await (0,a.pl)(t,{email:e.email}),await (0,a.pl)((0,a.JU)(s.RZ,"users/".concat(e.uid,"/products"),"mock1"),{name:"WMCYN Hat",acquired:new Date().toISOString()}),await (0,a.pl)((0,a.JU)(s.RZ,"users/".concat(e.uid,"/products"),"mock2"),{name:"WMCYN Shirt",acquired:new Date().toISOString()}))}h(e),c(!1)}):(c(!1),()=>{}),[]),(0,i.jsx)(l.Provider,{value:{currentUser:n,signup:d,login:(e,t)=>{if(!s.I8)throw Error("Authentication not initialized");return(0,o.e5)(s.I8,e,t)},logout:()=>{if(!s.I8)throw Error("Authentication not initialized");return(0,o.w7)(s.I8)},googleSignIn:()=>{if(!s.I8)throw Error("Authentication not initialized");let e=new o.hJ;return(0,o.rh)(s.I8,e)},resetPassword:e=>{if(!s.I8)throw Error("Authentication not initialized");return(0,o.LS)(s.I8,e)}},children:!u&&t})}},1540:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a,f:()=>o});var i=n(5893),r=n(7294);let s=(0,r.createContext)(void 0),o=()=>{let e=(0,r.useContext)(s);if(!e)throw Error("useShopifyCart must be used within a CartProvider");return e};function a(e){let{children:t}=e,[n,o]=(0,r.useState)([]),[a,l]=(0,r.useState)(!1),[h,u]=(0,r.useState)(0),[c,d]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=localStorage.getItem("shopify_cart");e&&o(JSON.parse(e))},[]),(0,r.useEffect)(()=>{localStorage.setItem("shopify_cart",JSON.stringify(n));let e=0,t=0;n.forEach(n=>{e+=n.quantity,t+=parseFloat(n.price)*n.quantity}),u(e),d(t)},[n]);let f=e=>{o(t=>t.filter(t=>t.variantId!==e))};return(0,i.jsx)(s.Provider,{value:{cartItems:n,isCartOpen:a,cartCount:h,cartTotal:c,openCart:()=>l(!0),closeCart:()=>l(!1),addToCart:(e,t,n)=>{o(i=>{var r,s;return i.find(e=>e.variantId===t.id)?i.map(e=>e.variantId===t.id?{...e,quantity:e.quantity+n}:e):[...i,{variantId:t.id,title:e.title,variantTitle:"Default Title"===t.title?void 0:t.title,price:t.price.amount,currencyCode:t.price.currencyCode,quantity:n,image:(null===(r=t.image)||void 0===r?void 0:r.src)||(null===(s=e.images[0])||void 0===s?void 0:s.src)||""}]})},removeFromCart:f,updateQuantity:(e,t)=>{if(t<1){f(e);return}o(n=>n.map(n=>n.variantId===e?{...n,quantity:t}:n))}},children:t})}},5545:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>l});var i=n(5893);n(9543),n(561),n(5855);var r=n(9008),s=n.n(r),o=n(1540),a=n(837);function l(e){let{Component:t,pageProps:n}=e;return(0,i.jsx)(a.H,{children:(0,i.jsxs)(o.Z,{children:[(0,i.jsxs)(s(),{children:[(0,i.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}),(0,i.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,i.jsx)("meta",{name:"apple-mobile-web-app-status-bar-style",content:"black-translucent"}),(0,i.jsx)("link",{rel:"manifest",href:"/manifest.json"}),(0,i.jsx)("link",{rel:"apple-touch-icon",href:"/logo-512x512.png"}),(0,i.jsx)("meta",{name:"theme-color",content:"#000000"}),(0,i.jsx)("link",{rel:"icon",href:"/wmcyn_logo_condensed.png",type:"image/png"}),(0,i.jsx)("title",{children:"WMCYN"}),(0,i.jsx)("meta",{name:"description",content:"WMCYN - A future-forward startup combining modern technology with everyday lifestyle."}),(0,i.jsx)("meta",{name:"keywords",content:"WMCYN, technology, lifestyle, newsletter, shop, VR, AR"}),(0,i.jsx)("meta",{property:"og:title",content:"WMCYN"}),(0,i.jsx)("meta",{property:"og:description",content:"A future-forward startup combining modern technology with lifestyle essentials."}),(0,i.jsx)("meta",{property:"og:image",content:"/wmcyn_logo_condensed.png"}),(0,i.jsx)("meta",{property:"og:url",content:"https://wmcyn.online/"}),(0,i.jsx)("meta",{property:"og:type",content:"website"}),(0,i.jsx)("link",{rel:"canonical",href:"https://wmcyn.online/"})]}),(0,i.jsx)(t,{...n})]})})}},1382:(e,t,n)=>{"use strict";let i,r,s,o,a,l,h,u,c,d,f,p,g,m,y,_,v,w;n.d(t,{I8:()=>v,db:()=>_,RZ:()=>w,VF:()=>rj,iH:()=>rq,t8:()=>rz});var I,b=n(2238);(0,b.KN)("firebase","11.7.1","app");var E=n(3333),T=n(1683),C=n(8463),S=n(6531);let x="@firebase/installations",k="0.6.14",A=`w:${k}`,N="FIS_v2",R=new T.LL("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function P(e){return e instanceof T.ZR&&e.code.includes("request-failed")}function D({projectId:e}){return`https://firebaseinstallations.googleapis.com/v1/projects/${e}/installations`}function O(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function L(e,t){let n=(await t.json()).error;return R.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function M({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function F(e){let t=await e();return t.status>=500&&t.status<600?e():t}async function U({appConfig:e,heartbeatServiceProvider:t},{fid:n}){let i=D(e),r=M(e),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let o={method:"POST",headers:r,body:JSON.stringify({fid:n,authVersion:N,appId:e.appId,sdkVersion:A})},a=await F(()=>fetch(i,o));if(a.ok){let e=await a.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:O(e.authToken)}}throw await L("Create Installation",a)}function V(e){return new Promise(t=>{setTimeout(t,e)})}let q=/^[cdef][\w-]{21}$/;function B(e){return`${e.appName}!${e.appId}`}let j=new Map;function z(e,t){let n=B(e);$(n,t),function(e,t){let n=(!K&&"BroadcastChannel"in self&&((K=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{$(e.data.key,e.data.fid)}),K);n&&n.postMessage({key:e,fid:t}),0===j.size&&K&&(K.close(),K=null)}(n,t)}function $(e,t){let n=j.get(e);if(n)for(let e of n)e(t)}let K=null,G="firebase-installations-store",W=null;function H(){return W||(W=(0,S.X3)("firebase-installations-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(G)}})),W}async function Q(e,t){let n=B(e),i=(await H()).transaction(G,"readwrite"),r=i.objectStore(G),s=await r.get(n);return await r.put(t,n),await i.done,s&&s.fid===t.fid||z(e,t.fid),t}async function Y(e){let t=B(e),n=(await H()).transaction(G,"readwrite");await n.objectStore(G).delete(t),await n.done}async function J(e,t){let n=B(e),i=(await H()).transaction(G,"readwrite"),r=i.objectStore(G),s=await r.get(n),o=t(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,o&&(!s||s.fid!==o.fid)&&z(e,o.fid),o}async function X(e){let t;let n=await J(e.appConfig,n=>{let i=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(R.create("app-offline"))};let n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=Z(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:ee(e)}:{installationEntry:t}}(e,en(n||{fid:function(){try{let e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;let t=btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22);return q.test(t)?t:""}catch(e){return""}}(),registrationStatus:0}));return t=i.registrationPromise,i.installationEntry});return""===n.fid?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Z(e,t){try{let n=await U(e,t);return Q(e.appConfig,n)}catch(n){throw P(n)&&409===n.customData.serverCode?await Y(e.appConfig):await Q(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}async function ee(e){let t=await et(e.appConfig);for(;1===t.registrationStatus;)await V(100),t=await et(e.appConfig);if(0===t.registrationStatus){let{installationEntry:t,registrationPromise:n}=await X(e);return n||t}return t}function et(e){return J(e,e=>{if(!e)throw R.create("installation-not-found");return en(e)})}function en(e){return 1===e.registrationStatus&&e.registrationTime+1e4<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function ei({appConfig:e,heartbeatServiceProvider:t},n){let i=function(e,{fid:t}){return`${D(e)}/${t}/authTokens:generate`}(e,n),r=function(e,{refreshToken:t}){let n=M(e);return n.append("Authorization",`${N} ${t}`),n}(e,n),s=t.getImmediate({optional:!0});if(s){let e=await s.getHeartbeatsHeader();e&&r.append("x-firebase-client",e)}let o={method:"POST",headers:r,body:JSON.stringify({installation:{sdkVersion:A,appId:e.appId}})},a=await F(()=>fetch(i,o));if(a.ok)return O(await a.json());throw await L("Generate Auth Token",a)}async function er(e,t=!1){let n;let i=await J(e.appConfig,i=>{var r;if(!el(i))throw R.create("not-registered");let s=i.authToken;if(!t&&2===(r=s).requestStatus&&!function(e){let t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+36e5}(r))return i;if(1===s.requestStatus)return n=es(e,t),i;{if(!navigator.onLine)throw R.create("app-offline");let t=function(e){let t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=ea(e,t),t}});return n?await n:i.authToken}async function es(e,t){let n=await eo(e.appConfig);for(;1===n.authToken.requestStatus;)await V(100),n=await eo(e.appConfig);let i=n.authToken;return 0===i.requestStatus?er(e,t):i}function eo(e){return J(e,e=>{var t;if(!el(e))throw R.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+1e4<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function ea(e,t){try{let n=await ei(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await Q(e.appConfig,i),n}catch(n){if(P(n)&&(401===n.customData.serverCode||404===n.customData.serverCode))await Y(e.appConfig);else{let n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await Q(e.appConfig,n)}throw n}}function el(e){return void 0!==e&&2===e.registrationStatus}async function eh(e){let{installationEntry:t,registrationPromise:n}=await X(e);return n?n.catch(console.error):er(e).catch(console.error),t.fid}async function eu(e,t=!1){return await ec(e),(await er(e,t)).token}async function ec(e){let{registrationPromise:t}=await X(e);t&&await t}function ed(e){return R.create("missing-app-config-values",{valueName:e})}let ef="installations";(0,b.Xd)(new C.wA(ef,e=>{let t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw ed("App Configuration");if(!e.name)throw ed("App Name");for(let t of["projectId","apiKey","appId"])if(!e.options[t])throw ed(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t),i=(0,b.qX)(t,"heartbeat");return{app:t,appConfig:n,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},"PUBLIC")),(0,b.Xd)(new C.wA("installations-internal",e=>{let t=e.getProvider("app").getImmediate(),n=(0,b.qX)(t,ef).getImmediate();return{getId:()=>eh(n),getToken:e=>eu(n,e)}},"PRIVATE")),(0,b.KN)(x,k),(0,b.KN)(x,k,"esm2017");let ep="analytics",eg="https://www.googletagmanager.com/gtag/js",em=new E.Yd("@firebase/analytics"),ey=new T.LL("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-initialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function e_(e){if(!e.startsWith(eg)){let t=ey.create("invalid-gtag-resource",{gtagURL:e});return em.warn(t.message),""}return e}function ev(e){return Promise.all(e.map(e=>e.catch(e=>e)))}async function ew(e,t,n,i,r,s){let o=i[r];try{if(o)await t[o];else{let e=(await ev(n)).find(e=>e.measurementId===r);e&&await t[e.appId]}}catch(e){em.error(e)}e("config",r,s)}async function eI(e,t,n,i,r){try{let s=[];if(r&&r.send_to){let e=r.send_to;Array.isArray(e)||(e=[e]);let i=await ev(n);for(let n of e){let e=i.find(e=>e.measurementId===n),r=e&&t[e.appId];if(r)s.push(r);else{s=[];break}}}0===s.length&&(s=Object.values(t)),await Promise.all(s),e("event",i,r||{})}catch(e){em.error(e)}}class eb{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}let eE=new eb;async function eT(e){var t;let{appId:n,apiKey:i}=e,r={method:"GET",headers:new Headers({Accept:"application/json","x-goog-api-key":i})},s="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig".replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let e="";try{let n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw ey.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}async function eC(e,t=eE,n){let{appId:i,apiKey:r,measurementId:s}=e.options;if(!i)throw ey.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw ey.create("no-api-key")}let o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new ex;return setTimeout(async()=>{a.abort()},void 0!==n?n:6e4),eS({appId:i,apiKey:r,measurementId:s},o,a,t)}async function eS(e,{throttleEndTimeMillis:t,backoffCount:n},i,r=eE){var s;let{appId:o,measurementId:a}=e;try{await new Promise((e,n)=>{let r=setTimeout(e,Math.max(t-Date.now(),0));i.addEventListener(()=>{clearTimeout(r),n(ey.create("fetch-throttle",{throttleEndTimeMillis:t}))})})}catch(e){if(a)return em.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==e?void 0:e.message}]`),{appId:o,measurementId:a};throw e}try{let t=await eT(e);return r.deleteThrottleMetadata(o),t}catch(h){if(!function(e){if(!(e instanceof T.ZR)||!e.customData)return!1;let t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(h)){if(r.deleteThrottleMetadata(o),a)return em.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==h?void 0:h.message}]`),{appId:o,measurementId:a};throw h}let t=503===Number(null===(s=null==h?void 0:h.customData)||void 0===s?void 0:s.httpStatus)?(0,T.$s)(n,r.intervalMillis,30):(0,T.$s)(n,r.intervalMillis),l={throttleEndTimeMillis:Date.now()+t,backoffCount:n+1};return r.setThrottleMetadata(o,l),em.debug(`Calling attemptFetch again in ${t} millis`),eS(e,l,i,r)}}class ex{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function ek(e,t,n,i,r){if(r&&r.global){e("event",n,i);return}{let r=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}async function eA(){if(!(0,T.hl)())return em.warn(ey.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await (0,T.eu)()}catch(e){return em.warn(ey.create("indexeddb-unavailable",{errorInfo:null==e?void 0:e.toString()}).message),!1}return!0}async function eN(e,t,n,s,o,a,l){var h;let u=eC(e);u.then(t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&em.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(e=>em.error(e)),t.push(u);let c=eA().then(e=>e?s.getId():void 0),[d,f]=await Promise.all([u,c]);!function(e){for(let t of Object.values(window.document.getElementsByTagName("script")))if(t.src&&t.src.includes(eg)&&t.src.includes(e))return t;return null}(a)&&function(e,t){var n,i;let r;let s=(n="firebase-js-sdk-policy",i={createScriptURL:e_},window.trustedTypes&&(r=window.trustedTypes.createPolicy(n,i)),r),o=document.createElement("script"),a=`${eg}?l=${e}&id=${t}`;o.src=s?null==s?void 0:s.createScriptURL(a):a,o.async=!0,document.head.appendChild(o)}(a,d.measurementId),r&&(o("consent","default",r),r=void 0),o("js",new Date);let p=null!==(h=null==l?void 0:l.config)&&void 0!==h?h:{};return p.origin="firebase",p.update=!0,null!=f&&(p.firebase_id=f),o("config",d.measurementId,p),i&&(o("set",i),i=void 0),d.measurementId}class eR{constructor(e){this.app=e}_delete(){return delete eP[this.app.options.appId],Promise.resolve()}}let eP={},eD=[],eO={},eL="dataLayer",eM=!1;async function eF(){if((0,T.ru)()||!(0,T.zI)()||!(0,T.hl)())return!1;try{return await (0,T.eu)()}catch(e){return!1}}let eU="@firebase/analytics",eV="0.10.13";(0,b.Xd)(new C.wA(ep,(e,{options:t})=>(function(e,t,n){!function(){let e=[];if((0,T.ru)()&&e.push("This is a browser extension environment."),(0,T.zI)()||e.push("Cookies are not available."),e.length>0){let t=e.map((e,t)=>`(${t+1}) ${e}`).join(" "),n=ey.create("invalid-analytics-context",{errorInfo:t});em.warn(n.message)}}();let i=e.options.appId;if(!i)throw ey.create("no-app-id");if(!e.options.apiKey){if(e.options.measurementId)em.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw ey.create("no-api-key")}if(null!=eP[i])throw ey.create("already-exists",{id:i});if(!eM){var r,a;let e,t;e=[],Array.isArray(window[eL])?e=window[eL]:window[eL]=e;let{wrappedGtag:n,gtagCore:i}=(r="gtag",t=function(...e){window[eL].push(arguments)},window[r]&&"function"==typeof window[r]&&(t=window[r]),window[r]=(a=t,async function(e,...t){try{if("event"===e){let[e,n]=t;await eI(a,eP,eD,e,n)}else if("config"===e){let[e,n]=t;await ew(a,eP,eD,eO,e,n)}else if("consent"===e){let[e,n]=t;a("consent",e,n)}else if("get"===e){let[e,n,i]=t;a("get",e,n,i)}else if("set"===e){let[e]=t;a("set",e)}else a(e,...t)}catch(e){em.error(e)}}),{gtagCore:t,wrappedGtag:window[r]});o=n,s=i,eM=!0}return eP[i]=eN(e,eD,eO,t,s,eL,n),new eR(e)})(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),(0,b.Xd)(new C.wA("analytics-internal",function(e){try{let t=e.getProvider(ep).getImmediate();return{logEvent:(e,n,i)=>{var r;return r=t,void(r=(0,T.m9)(r),ek(o,eP[r.app.options.appId],e,n,i).catch(e=>em.error(e)))}}}catch(e){throw ey.create("interop-component-reg-failed",{reason:e})}},"PRIVATE")),(0,b.KN)(eU,eV),(0,b.KN)(eU,eV,"esm2017");var eq=n(4155);let eB="@firebase/database",ej="1.0.15",ez="";class e${constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,T.Wl)(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,T.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class eK{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,T.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let eG=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new e$(t)}}catch(e){}return new eK},eW=eG("localStorage"),eH=eG("sessionStorage"),eQ=new E.Yd("@firebase/database"),eY=function(){let e=1;return function(){return e++}}(),eJ=function(e){let t=(0,T.dS)(e),n=new T.gQ;n.update(t);let i=n.digest();return T.US.encodeByteArray(i)},eX=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=eX.apply(null,i):"object"==typeof i?t+=(0,T.Wl)(i):t+=i,t+=" "}return t},eZ=null,e0=!0,e1=function(e,t){(0,T.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(eQ.logLevel=E.in.VERBOSE,eZ=eQ.log.bind(eQ),t&&eH.set("logging_enabled",!0)):"function"==typeof e?eZ=e:(eZ=null,eH.remove("logging_enabled"))},e2=function(...e){if(!0===e0&&(e0=!1,null===eZ&&!0===eH.get("logging_enabled")&&e1(!0)),eZ){let t=eX.apply(null,e);eZ(t)}},e3=function(e){return function(...t){e2(e,...t)}},e5=function(...e){let t="FIREBASE INTERNAL ERROR: "+eX(...e);eQ.error(t)},e6=function(...e){let t=`FIREBASE FATAL ERROR: ${eX(...e)}`;throw eQ.error(t),Error(t)},e8=function(...e){let t="FIREBASE WARNING: "+eX(...e);eQ.warn(t)},e4=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&e8("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},e9=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},e7=function(e){if((0,T.Yr)()||"complete"===document.readyState)e();else{let t=!1,n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}t||(t=!0,e())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},te="[MIN_NAME]",tt="[MAX_NAME]",tn=function(e,t){if(e===t)return 0;if(e===te||t===tt)return -1;if(t===te||e===tt)return 1;{let n=tu(e),i=tu(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},ti=function(e,t){return e===t?0:e<t?-1:1},tr=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+(0,T.Wl)(t))},ts=function(e){if("object"!=typeof e||null===e)return(0,T.Wl)(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=(0,T.Wl)(t[i]),n+=":",n+=ts(e[t[i]]);return n+"}"},to=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function ta(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let tl=function(e){let t,n,i,r,s;(0,T.hu)(!e9(e),"Invalid JSON number"),0===e?(n=0,i=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(t?1:0),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},th=RegExp("^-?(0*)\\d{1,10}$"),tu=function(e){if(th.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},tc=function(e){try{e()}catch(e){setTimeout(()=>{throw e8("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},td=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class tf{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,(0,b.rh)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){e8(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class tp{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(e2("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',e8(e)}}class tg{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}tg.OWNER="owner";let tm=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ty="websocket",t_="long_polling";class tv{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=eW.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&eW.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function tw(e,t,n){let i;if((0,T.hu)("string"==typeof t,"typeof type must == string"),(0,T.hu)("object"==typeof n,"typeof params must == object"),t===ty)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===t_)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return ta(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class tI{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,T.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,T.p$)(this.counters_)}}let tb={},tE={};function tT(e){let t=e.toString();return tb[t]||(tb[t]=new tI),tb[t]}class tC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&tc(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let tS="start";class tx{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=e3(e),this.stats_=tT(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),tw(t,t_,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new tC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),e7(()=>{if(this.isClosed_)return;this.scriptTagHolder=new tk((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder){if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===tS)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)}},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[tS]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&tm.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){tx.forceAllow_=!0}static forceDisallow(){tx.forceDisallow_=!0}static isAvailable(){return!(0,T.Yr)()&&(!!tx.forceAllow_||!tx.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=(0,T.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=to((0,T.h$)(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,T.Yr)())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=(0,T.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class tk{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,T.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=eY(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=tk.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');let i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){e2("frame writing exception"),e.stack&&e2(e.stack),e2(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||e2("No IE domain setting required")}catch(n){let t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){(0,T.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{e2("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let tA=null;"undefined"!=typeof MozWebSocket?tA=MozWebSocket:"undefined"!=typeof WebSocket&&(tA=WebSocket);class tN{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=e3(this.connId),this.stats_=tT(t),this.connURL=tN.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!(0,T.Yr)()&&"undefined"!=typeof location&&location.hostname&&tm.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),tw(e,ty,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,eW.set("previous_websocket_failure",!0);try{let e;if((0,T.Yr)()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${ez}/${eq.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=eq.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new tA(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){tN.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==tA&&!tN.forceDisallow_}static previouslyFailed(){return eW.isInMemoryStorage||!0===eW.get("previous_websocket_failure")}markConnectionHealthy(){eW.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=(0,T.cI)(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if((0,T.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=(0,T.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=to(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}tN.responsesRequiredToBeHealthy=2,tN.healthyTimeout=3e4;class tR{static get ALL_TRANSPORTS(){return[tx,tN]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=tN&&tN.isAvailable(),n=t&&!tN.previouslyFailed();if(e.webSocketOnly&&(t||e8("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[tN];else{let e=this.transports_=[];for(let t of tR.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);tR.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}tR.globalTransportInitialized_=!1;class tP{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=e3("c:"+this.id+":"),this.transportManager_=new tR(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=td(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=tr("t",e),n=tr("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=tr("t",e),n=tr("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=tr("t",e);if("d"in e){let n=e.d;if("h"===t){let e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?e5("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):e5("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&e8("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),td(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):td(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(eW.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class tD{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class tO{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,T.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context)){i.splice(e,1);return}}validateEventType_(e){(0,T.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class tL extends tO{static getInstance(){return new tL}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,T.uI)()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return(0,T.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class tM{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function tF(){return new tM("")}function tU(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function tV(e){return e.pieces_.length-e.pieceNum_}function tq(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new tM(e.pieces_,t)}function tB(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function tj(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function tz(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new tM(t,0)}function t$(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof tM)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new tM(n,0)}function tK(e){return e.pieceNum_>=e.pieces_.length}function tG(e,t){let n=tU(e),i=tU(t);if(null===n)return t;if(n===i)return tG(tq(e),tq(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function tW(e,t){let n=tj(e,0),i=tj(t,0);for(let e=0;e<n.length&&e<i.length;e++){let t=tn(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function tH(e,t){if(tV(e)!==tV(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function tQ(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(tV(e)>tV(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class tY{constructor(e,t){this.errorPrefix_=t,this.parts_=tj(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=(0,T.ug)(this.parts_[e]);tJ(this)}}function tJ(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+tX(e))}function tX(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class tZ extends tO{static getInstance(){return new tZ}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return(0,T.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}class t0 extends tD{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=t0.nextPersistentConnectionId_++,this.log_=e3("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!(0,T.Yr)())throw Error("Auth override specified in options, but not supported on non Node.js platforms");tZ.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&tL.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_((0,T.Wl)(r)),(0,T.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new T.BH,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),(0,T.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,T.hu)(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;t0.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&(0,T.r3)(e,"w")){let n=(0,T.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();e8(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||(0,T.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=(0,T.w9)(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),(0,T.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+(0,T.Wl)(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):e5("Unrecognized action received from server: "+(0,T.Wl)(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){(0,T.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){!e||this.visible_||this.reconnectDelay_!==this.maxReconnectDelay_||(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t0.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){(0,T.hu)(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?e2("getToken() completed but was canceled"):(e2("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new tP(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{e8(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&e8(e),a())}}}interrupt(e){e2("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){e2("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,T.xb)(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>ts(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n;let i=new tM(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){e2("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){e2("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";(0,T.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+ez.replace(/\./g,"-")]=1,(0,T.uI)()?e["framework.cordova"]=1:(0,T.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=tL.getInstance().currentlyOnline();return(0,T.xb)(this.interruptReasons_)&&e}}t0.nextPersistentConnectionId_=0,t0.nextConnectionId_=0;class t1{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new t1(e,t)}}class t2{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new t1(te,e),i=new t1(te,t);return 0!==this.compare(n,i)}minPost(){return t1.MIN}}class t3 extends t2{static get __EMPTY_NODE(){return a}static set __EMPTY_NODE(e){a=e}compare(e,t){return tn(e.name,t.name)}isDefinedOn(e){throw(0,T.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return t1.MIN}maxPost(){return new t1(tt,a)}makePost(e,t){return(0,T.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new t1(e,a)}toString(){return".key"}}let t5=new t3;class t6{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class t8{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:t8.RED,this.left=null!=i?i:t9.EMPTY_NODE,this.right=null!=r?r:t9.EMPTY_NODE}copy(e,t,n,i,r){return new t8(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return t9.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return t9.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,t8.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,t8.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+(this.isRed_()?0:1);throw Error("Black depths differ")}}t8.RED=!0,t8.BLACK=!1;class t4{copy(e,t,n,i,r){return this}insert(e,t,n){return new t8(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class t9{constructor(e,t=t9.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new t9(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,t8.BLACK,null,null))}remove(e){return new t9(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,t8.BLACK,null,null))}get(e){let t;let n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty()){if(i)return i.key;return null}for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new t6(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new t6(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new t6(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new t6(this.root_,null,this.comparator_,!0,e)}}function t7(e,t){return tn(e.name,t.name)}function ne(e,t){return tn(e,t)}t9.EMPTY_NODE=new t4;let nt=function(e){return"number"==typeof e?"number:"+tl(e):"string:"+e},nn=function(e){if(e.isLeafNode()){let t=e.val();(0,T.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,T.r3)(t,".sv"),"Priority must be a string or number.")}else(0,T.hu)(e===l||e.isEmpty(),"priority of unexpected type.");(0,T.hu)(e===l||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class ni{static set __childrenNodeConstructor(e){h=e}static get __childrenNodeConstructor(){return h}constructor(e,t=ni.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,(0,T.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),nn(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new ni(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:ni.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return tK(e)?this:".priority"===tU(e)?this.priorityNode_:ni.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:ni.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=tU(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:((0,T.hu)(".priority"!==n||1===tV(e),".priority must be the last token in a path"),this.updateImmediateChild(n,ni.__childrenNodeConstructor.EMPTY_NODE.updateChild(tq(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+nt(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=tl(this.value_):e+=this.value_,this.lazyHash_=eJ(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===ni.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof ni.__childrenNodeConstructor?-1:((0,T.hu)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=ni.VALUE_TYPE_ORDER.indexOf(t),r=ni.VALUE_TYPE_ORDER.indexOf(n);return((0,T.hu)(i>=0,"Unknown leaf type: "+t),(0,T.hu)(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}ni.VALUE_TYPE_ORDER=["object","boolean","number","string"];class nr extends t2{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?tn(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return t1.MIN}maxPost(){return new t1(tt,new ni("[PRIORITY-POST]",c))}makePost(e,t){return new t1(t,new ni("[PRIORITY-POST]",u(e)))}toString(){return".priority"}}let ns=new nr,no=Math.log(2);class na{constructor(e){this.count=parseInt(Math.log(e+1)/no,10),this.current_=this.count-1;let t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let nl=function(e,t,n,i){e.sort(t);let r=function(t,i){let s;let o=i-t;if(0===o)return null;if(1===o)return s=e[t],new t8(n?n(s):s,s.node,t8.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new t8(n?n(s):s,s.node,t8.BLACK,l,h)}};return new t9(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),u=e[s];l(new t8(n?n(u):u,u.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,t8.BLACK):(a(i,t8.BLACK),a(i,t8.RED))}return s}(new na(e.length)))},nh={};class nu{static get Default(){return(0,T.hu)(nh&&ns,"ChildrenNode.ts has not been loaded"),d=d||new nu({".priority":nh},{".priority":ns})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=(0,T.DV)(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof t9?t:null}hasIndex(e){return(0,T.r3)(this.indexSet_,e.toString())}addIndex(e,t){let n;(0,T.hu)(e!==t5,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(t1.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?nl(i,e.getCompare()):nh;let a=e.toString(),l=Object.assign({},this.indexSet_);l[a]=e;let h=Object.assign({},this.indexes_);return h[a]=n,new nu(h,l)}addToIndexes(e,t){return new nu((0,T.UI)(this.indexes_,(n,i)=>{let r=(0,T.DV)(this.indexSet_,i);if((0,T.hu)(r,"Missing index implementation for "+i),n===nh){if(!r.isDefinedOn(e.node))return nh;{let n=[],i=t.getIterator(t1.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),nl(n,r.getCompare())}}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new t1(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new nu((0,T.UI)(this.indexes_,n=>{if(n===nh)return n;{let i=t.get(e.name);return i?n.remove(new t1(e.name,i)):n}}),this.indexSet_)}}class nc{static get EMPTY_NODE(){return f||(f=new nc(new t9(ne),null,nu.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&nn(this.priorityNode_),this.children_.isEmpty()&&(0,T.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||f}updatePriority(e){return this.children_.isEmpty()?this:new nc(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?f:t}}getChild(e){let t=tU(e);return null===t?this:this.getImmediateChild(t).getChild(tq(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if((0,T.hu)(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i;let r=new t1(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?f:this.priorityNode_;return new nc(n,s,i)}}updateChild(e,t){let n=tU(e);if(null===n)return t;{(0,T.hu)(".priority"!==tU(e)||1===tV(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(tq(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(ns,(s,o)=>{t[s]=o.val(e),n++,r&&nc.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+nt(this.getPriority().val())+":"),this.forEachChild(ns,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":eJ(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new t1(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new t1(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new t1(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,t1.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,t1.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===nf?-1:0}withIndex(e){if(e===t5||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new nc(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===t5||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority())||this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(ns),n=e.getIterator(ns),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===t5?null:this.indexMap_.get(e.toString())}}nc.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class nd extends nc{constructor(){super(new t9(ne),nc.EMPTY_NODE,nu.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return nc.EMPTY_NODE}isEmpty(){return!1}}let nf=new nd;function np(e,t=null){if(null===e)return nc.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,T.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ni(e,np(t));if(e instanceof Array){let n=nc.EMPTY_NODE;return ta(e,(t,i)=>{if((0,T.r3)(e,t)&&"."!==t.substring(0,1)){let e=np(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(np(t))}{let n=[],i=!1;if(ta(e,(e,t)=>{if("."!==e.substring(0,1)){let r=np(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new t1(e,r)))}}),0===n.length)return nc.EMPTY_NODE;let r=nl(n,t7,e=>e.name,ne);if(!i)return new nc(r,np(t),nu.Default);{let e=nl(n,ns.getCompare());return new nc(r,np(t),new nu({".priority":e},{".priority":ns}))}}}Object.defineProperties(t1,{MIN:{value:new t1(te,nc.EMPTY_NODE)},MAX:{value:new t1(tt,nf)}}),t3.__EMPTY_NODE=nc.EMPTY_NODE,ni.__childrenNodeConstructor=nc,l=nf,c=nf,u=np;class ng extends t2{constructor(e){super(),this.indexPath_=e,(0,T.hu)(!tK(e)&&".priority"!==tU(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?tn(e.name,t.name):r}makePost(e,t){let n=np(e);return new t1(t,nc.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new t1(tt,nc.EMPTY_NODE.updateChild(this.indexPath_,nf))}toString(){return tj(this.indexPath_,0).join("/")}}class nm extends t2{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?tn(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return t1.MIN}maxPost(){return t1.MAX}makePost(e,t){return new t1(t,np(e))}toString(){return".value"}}let ny=new nm;function n_(e){return{type:"value",snapshotNode:e}}function nv(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function nw(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function nI(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class nb{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(nw(t,o)):assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(nv(t,n)):s.trackChildChange(nI(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null==n||(e.isLeafNode()||e.forEachChild(ns,(e,i)=>{t.hasChild(e)||n.trackChildChange(nw(e,i))}),t.isLeafNode()||t.forEachChild(ns,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(nI(t,i,r))}else n.trackChildChange(nv(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?nc.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class nE{constructor(e){this.indexedFilter_=new nb(e.getIndex()),this.index_=e.getIndex(),this.startPost_=nE.getStartPost_(e),this.endPost_=nE.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new t1(t,n))||(n=nc.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=nc.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(nc.EMPTY_NODE);let r=this;return t.forEachChild(ns,(e,t)=>{r.matches(new t1(e,t))||(i=i.updateImmediateChild(e,nc.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class nT{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new nE(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new t1(t,n))||(n=nc.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=nc.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=nc.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t)){if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(nc.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,nc.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();assert(e.numChildren()===this.limit_,"");let o=new t1(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),u=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=u&&(u.name===t||e.hasChild(u.name));)u=i.getChildAfterChild(this.index_,u,this.reverse_);let c=null==u?1:s(u,o);if(l&&!n.isEmpty()&&c>=0)return null!=r&&r.trackChildChange(nI(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(nw(t,h));let n=e.updateImmediateChild(t,nc.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=r&&r.trackChildChange(nv(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l&&s(a,o)>=0?(null!=r&&(r.trackChildChange(nw(a.name,a.node)),r.trackChildChange(nv(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,nc.EMPTY_NODE)):e}}class nC{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ns}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,T.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return((0,T.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:te}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,T.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return((0,T.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:tt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,T.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ns}copy(){let e=new nC;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function nS(e){let t;let n={};if(e.isDefault())return n;if(e.index_===ns?t="$priority":e.index_===ny?t="$value":e.index_===t5?t="$key":((0,T.hu)(e.index_ instanceof ng,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,T.Wl)(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=(0,T.Wl)(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+(0,T.Wl)(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=(0,T.Wl)(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+(0,T.Wl)(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function nx(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ns&&(t.i=e.index_.toString()),t}class nk extends tD{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,T.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=e3("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=nk.getListenId_(e,n),o={};this.listens_[s]=o;let a=nS(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),(0,T.DV)(this.listens_,s)===o&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=nk.getListenId_(e,t);delete this.listens_[n]}get(e){let t=nS(e._queryParams),n=e._path.toString(),i=new T.BH;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,T.xO)(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=(0,T.cI)(o.responseText)}catch(e){e8("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&e8("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class nA{constructor(){this.rootNode_=nc.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function nN(){return{value:null,children:new Map}}function nR(e,t,n){if(tK(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{let i=tU(t);e.children.has(i)||e.children.set(i,nN()),nR(e.children.get(i),t=tq(t),n)}}function nP(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((e,n)=>{t(n,e)})}(e,(e,i)=>{nP(i,new tM(t.toString()+"/"+e),n)})}class nD{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ta(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class nO{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new nD(e);let n=1e4+2e4*Math.random();td(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ta(e,(e,i)=>{i>0&&(0,T.r3)(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),td(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function nL(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function nM(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function nF(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(I||(I={}));class nU{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=I.ACK_USER_WRITE,this.source=nL()}operationForChild(e){if(!tK(this.path))return(0,T.hu)(tU(this.path)===e,"operationForChild called for unrelated child."),new nU(tq(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return(0,T.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new tM(e));return new nU(tF(),t,this.revert)}}}class nV{constructor(e,t){this.source=e,this.path=t,this.type=I.LISTEN_COMPLETE}operationForChild(e){return tK(this.path)?new nV(this.source,tF()):new nV(this.source,tq(this.path))}}class nq{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=I.OVERWRITE}operationForChild(e){return tK(this.path)?new nq(this.source,tF(),this.snap.getImmediateChild(e)):new nq(this.source,tq(this.path),this.snap)}}class nB{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=I.MERGE}operationForChild(e){if(!tK(this.path))return(0,T.hu)(tU(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new nB(this.source,tq(this.path),this.children);{let t=this.children.subtree(new tM(e));return t.isEmpty()?null:t.value?new nq(this.source,tF(),t.value):new nB(this.source,tF(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class nj{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(tK(e))return this.isFullyInitialized()&&!this.filtered_;let t=tU(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class nz{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function n$(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw(0,T.g5)("Should only compare child_ events.");let i=new t1(t.childName,t.snapshotNode),r=new t1(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{let i=("value"===n.type||"child_removed"===n.type||(n.prevName=s.getPredecessorChildName(n.childName,n.snapshotNode,e.index_)),n);r.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))})})}function nK(e,t){return{eventCache:e,serverCache:t}}function nG(e,t,n,i){return nK(new nj(t,n,i),e.serverCache)}function nW(e,t,n,i){return nK(e.eventCache,new nj(t,n,i))}function nH(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function nQ(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let nY=()=>(p||(p=new t9(ti)),p);class nJ{static fromObject(e){let t=new nJ(null);return ta(e,(e,n)=>{t=t.set(new tM(e),n)}),t}constructor(e,t=nY()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:tF(),value:this.value};if(tK(e))return null;{let n=tU(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(tq(e),t);return null!=r?{path:t$(new tM(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(tK(e))return this;{let t=tU(e),n=this.children.get(t);return null!==n?n.subtree(tq(e)):new nJ(null)}}set(e,t){if(tK(e))return new nJ(t,this.children);{let n=tU(e),i=(this.children.get(n)||new nJ(null)).set(tq(e),t),r=this.children.insert(n,i);return new nJ(this.value,r)}}remove(e){if(tK(e))return this.children.isEmpty()?new nJ(null):new nJ(null,this.children);{let t=tU(e),n=this.children.get(t);if(!n)return this;{let i;let r=n.remove(tq(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new nJ(null):new nJ(this.value,i)}}}get(e){if(tK(e))return this.value;{let t=tU(e),n=this.children.get(t);return n?n.get(tq(e)):null}}setTree(e,t){if(tK(e))return t;{let n;let i=tU(e),r=(this.children.get(i)||new nJ(null)).setTree(tq(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new nJ(this.value,n)}}fold(e){return this.fold_(tF(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(t$(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,tF(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;if(tK(e))return null;{let i=tU(e),r=this.children.get(i);return r?r.findOnPath_(tq(e),t$(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,tF(),t)}foreachOnPath_(e,t,n){if(tK(e))return this;{this.value&&n(t,this.value);let i=tU(e),r=this.children.get(i);return r?r.foreachOnPath_(tq(e),t$(t,i),n):new nJ(null)}}foreach(e){this.foreach_(tF(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(t$(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class nX{constructor(e){this.writeTree_=e}static empty(){return new nX(new nJ(null))}}function nZ(e,t,n){if(tK(t))return new nX(new nJ(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=tG(r,t);return s=s.updateChild(o,n),new nX(e.writeTree_.set(r,s))}{let i=new nJ(n);return new nX(e.writeTree_.setTree(t,i))}}}function n0(e,t,n){let i=e;return ta(n,(e,n)=>{i=nZ(i,t$(t,e),n)}),i}function n1(e,t){return tK(t)?nX.empty():new nX(e.writeTree_.setTree(t,new nJ(null)))}function n2(e,t){return null!=n3(e,t)}function n3(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(tG(n.path,t)):null}function n5(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ns,(e,n)=>{t.push(new t1(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new t1(e,n.value))}),t}function n6(e,t){if(tK(t))return e;{let n=n3(e,t);return new nX(null!=n?new nJ(n):e.writeTree_.subtree(t))}}function n8(e){return e.writeTree_.isEmpty()}function n4(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?((0,T.hu)(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(t$(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(t$(t,".priority"),r)),i}}(tF(),e.writeTree_,t)}function n9(e){return e.visible}function n7(e,t,n){let i=nX.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e;let t=s.path;if(s.snap)tQ(n,t)?i=nZ(i,e=tG(n,t),s.snap):tQ(t,n)&&(e=tG(t,n),i=nZ(i,tF(),s.snap.getChild(e)));else if(s.children){if(tQ(n,t))i=n0(i,e=tG(n,t),s.children);else if(tQ(t,n)){if(tK(e=tG(t,n)))i=n0(i,tF(),s.children);else{let t=(0,T.DV)(s.children,tU(e));if(t){let n=t.getChild(tq(e));i=nZ(i,tF(),n)}}}}else throw(0,T.g5)("WriteRecord should have .snap or .children")}}return i}function ie(e,t,n,i,r){if(i||r){let s=n6(e.visibleWrites,t);return!r&&n8(s)?n:r||null!=n||n2(s,tF())?n4(n7(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(tQ(e.path,t)||tQ(t,e.path))},t),n||nc.EMPTY_NODE):null}{let i=n3(e.visibleWrites,t);if(null!=i)return i;{let i=n6(e.visibleWrites,t);return n8(i)?n:null!=n||n2(i,tF())?n4(i,n||nc.EMPTY_NODE):null}}}function it(e,t,n,i){return ie(e.writeTree,e.treePath,t,n,i)}function ii(e,t){return function(e,t,n){let i=nc.EMPTY_NODE,r=n3(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(ns,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return n5(n6(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=n6(e.visibleWrites,t);return n.forEachChild(ns,(e,t)=>{let n=n4(n6(r,new tM(e)),t);i=i.updateImmediateChild(e,n)}),n5(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function ir(e,t,n,i){return function(e,t,n,i,r){(0,T.hu)(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=t$(t,n);if(n2(e.visibleWrites,s))return null;{let t=n6(e.visibleWrites,s);return n8(t)?r.getChild(n):n4(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function is(e,t){var n,i;return n=e.writeTree,i=t$(e.treePath,t),n3(n.visibleWrites,i)}function io(e,t,n){return function(e,t,n,i){let r=t$(t,n),s=n3(e.visibleWrites,r);return null!=s?s:i.isCompleteForChild(n)?n4(n6(e.visibleWrites,r),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function ia(e,t){return il(t$(e.treePath,t),e.writeTree)}function il(e,t){return{treePath:e,writeTree:t}}class ih{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;(0,T.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,T.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,nI(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,nw(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,nv(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,nI(n,e.snapshotNode,i.oldSnap));else throw(0,T.g5)("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}class iu{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}let ic=new iu;class id{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new nj(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return io(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:nQ(this.viewCache_),s=function(e,t,n,i,r,s,o){let a;let l=n6(e.visibleWrites,t),h=n3(l,tF());if(null!=h)a=h;else{if(null==n)return[];a=n4(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}((i=this.writes_).writeTree,i.treePath,r,t,0,n,e);return 0===s.length?null:s[0]}}function ip(e,t,n,i,r,s){let o=t.eventCache;if(null!=is(i,n))return t;{let a,l;if(tK(n)){if((0,T.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=nQ(t),r=ii(i,n instanceof nc?n:nc.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=it(i,nQ(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}}else{let h=tU(n);if(".priority"===h){(0,T.hu)(1===tV(n),"Can't have a priority with additional path components");let r=o.getNode(),s=ir(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let u;let c=tq(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=ir(i,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=io(i,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,r,s):o.getNode()}}return nG(t,a,o.isFullyInitialized()||tK(n),e.filter.filtersNodes())}}function ig(e,t,n,i,r,s,o,a){let l;let h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(tK(n))l=u.updateFullNode(h.getNode(),i,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=u.updateFullNode(h.getNode(),e,null)}else{let e=tU(n);if(!h.isCompleteForPath(n)&&tV(n)>1)return t;let r=tq(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,r,ic,null)}let c=nW(t,l,h.isFullyInitialized()||tK(n),u.filtersNodes()),d=new id(r,c,s);return ip(e,c,n,r,d,a)}function im(e,t,n,i,r,s,o){let a,l;let h=t.eventCache,u=new id(r,t,s);if(tK(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=nG(t,l,!0,e.filter.filtersNodes());else{let r=tU(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=nG(t,l,h.isFullyInitialized(),h.isFiltered());else{let s;let l=tq(n),c=h.getNode().getImmediateChild(r);if(tK(l))s=i;else{let e=u.getCompleteChild(r);s=null!=e?".priority"===tB(l)&&e.getChild(tz(l)).isEmpty()?e:e.updateChild(l,i):nc.EMPTY_NODE}a=c.equals(s)?t:nG(t,e.filter.updateChild(h.getNode(),r,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function iy(e,t){return e.eventCache.isCompleteForChild(t)}function i_(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function iv(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=tK(n)?i:new nJ(null).setTree(n,i);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(u.hasChild(n)){let l=i_(e,t.serverCache.getNode().getImmediateChild(n),i);h=ig(e,h,new tM(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!u.hasChild(n)&&!l){let l=i_(e,t.serverCache.getNode().getImmediateChild(n),i);h=ig(e,h,new tM(n),l,r,s,o,a)}}),h}class iw{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let n=this.query_._queryParams,i=new nb(n.getIndex()),r=function(e){return e.loadsAllData()?new nb(e.getIndex()):e.hasLimit()?new nT(e):new nE(e)}(n);this.processor_={filter:r};let s=t.serverCache,o=t.eventCache,a=i.updateFullNode(nc.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(nc.EMPTY_NODE,o.getNode(),null),h=new nj(a,s.isFullyInitialized(),i.filtersNodes()),u=new nj(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=nK(u,h),this.eventGenerator_=new nz(this.query_)}get query(){return this.query_}}function iI(e){return 0===e.eventRegistrations_.length}function ib(e,t,n){let i=[];if(n){assert(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function iE(e,t,n,i){var r,s;t.type===I.MERGE&&null!==t.source.queryId&&((0,T.hu)(nQ(e.viewCache_),"We should always have a full cache before handling merges"),(0,T.hu)(nH(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){let s,o;let a=new ih;if(n.type===I.OVERWRITE)n.source.fromUser?s=im(e,t,n.path,n.snap,i,r,a):((0,T.hu)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered()&&!tK(n.path),s=ig(e,t,n.path,n.snap,i,r,o,a));else if(n.type===I.MERGE){var l,h;let u;n.source.fromUser?(l=n.path,h=n.children,u=t,h.foreach((n,s)=>{let o=t$(l,n);iy(t,tU(o))&&(u=im(e,u,o,s,i,r,a))}),h.foreach((n,s)=>{let o=t$(l,n);iy(t,tU(o))||(u=im(e,u,o,s,i,r,a))}),s=u):((0,T.hu)(n.source.fromServer,"Unknown source."),o=n.source.tagged||t.serverCache.isFiltered(),s=iv(e,t,n.path,n.children,i,r,o,a))}else if(n.type===I.ACK_USER_WRITE)s=n.revert?function(e,t,n,i,r,s){let o;if(null!=is(i,n))return t;{let a;let l=new id(i,t,r),h=t.eventCache.getNode();if(tK(n)||".priority"===tU(n)){let n;if(t.serverCache.isFullyInitialized())n=it(i,nQ(t));else{let e=t.serverCache.getNode();(0,T.hu)(e instanceof nc,"serverChildren would be complete if leaf node"),n=ii(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=tU(n),u=io(i,r,t.serverCache);null==u&&t.serverCache.isCompleteForChild(r)&&(u=h.getImmediateChild(r)),(a=null!=u?e.filter.updateChild(h,r,u,tq(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,nc.EMPTY_NODE,tq(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=it(i,nQ(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=is(i,tF()),nG(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,a):function(e,t,n,i,r,s,o){if(null!=is(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value){if(tK(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return ig(e,t,n,l.getNode().getChild(n),r,s,a,o);if(!tK(n))return t;{let i=new nJ(null);return l.getNode().forEachChild(t5,(e,t)=>{i=i.set(new tM(e),t)}),iv(e,t,n,i,r,s,a,o)}}{let h=new nJ(null);return i.foreach((e,t)=>{let i=t$(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),iv(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,a);else if(n.type===I.LISTEN_COMPLETE)s=function(e,t,n,i,r){let s=t.serverCache;return ip(e,nW(t,s.getNode(),s.isFullyInitialized()||tK(n),s.isFiltered()),n,i,ic,r)}(e,t,n.path,i,a);else throw(0,T.g5)("Unknown operation type: "+n.type);let u=a.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=nH(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(n_(nH(t)))}}(t,s,u),{viewCache:s,changes:u}}(e.processor_,o,t,n,i);return r=e.processor_,s=a.viewCache,(0,T.hu)(s.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),(0,T.hu)(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),(0,T.hu)(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,iT(e,a.changes,a.viewCache.eventCache.getNode(),null)}function iT(e,t,n,i){let r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){let r=[],s=[];return t.forEach(t=>{if("child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)){var n;s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))}}),n$(e,r,"child_removed",t,i,n),n$(e,r,"child_added",t,i,n),n$(e,r,"child_moved",s,i,n),n$(e,r,"child_changed",t,i,n),n$(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}class iC{constructor(){this.views=new Map}}function iS(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return(0,T.hu)(null!=s,"SyncTree gave us an op for an invalid query."),iE(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(iE(s,t,n,i));return r}}function ix(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function ik(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=nQ(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!tK(t)&&!n.getImmediateChild(tU(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function iA(e,t){if(t._queryParams.loadsAllData())return iR(e);{let n=t._queryIdentifier;return e.views.get(n)}}function iN(e){return null!=iR(e)}function iR(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let iP=1;class iD{constructor(e){this.listenProvider_=e,this.syncPointTree_=new nJ(null),this.pendingWriteTree_={visibleWrites:nX.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function iO(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,(0,T.hu)(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=nZ(s.visibleWrites,t,n)),s.lastWriteId=i,r)?iV(e,new nq(nL(),t,n)):[]}function iL(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){let n=e.allWrites.findIndex(e=>e.writeId===t);(0,T.hu)(n>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[n];e.allWrites.splice(n,1);let r=i.visible,s=!1,o=e.allWrites.length-1;for(;r&&o>=0;){let t=e.allWrites[o];t.visible&&(o>=n&&function(e,t){if(e.snap)return tQ(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&tQ(t$(e.path,n),t))return!0;return!1}(t,i.path)?r=!1:tQ(i.path,t.path)&&(s=!0)),o--}return!!r&&(s?(e.visibleWrites=n7(e.allWrites,n9,tF()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1):i.snap?e.visibleWrites=n1(e.visibleWrites,i.path):ta(i.children,t=>{e.visibleWrites=n1(e.visibleWrites,t$(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new nJ(null);return null!=i.snap?t=t.set(tF(),!0):ta(i.children,e=>{t=t.set(new tM(e),!0)}),iV(e,new nU(i.path,t,n))}}function iM(e,t,n){return iV(e,new nq(nM(),t,n))}function iF(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=iA(o,t))){let l=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=iN(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(ib(r,n,i)),iI(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(ib(t,n,i)),iI(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!iN(e)&&s.push(new(assert(g,"Reference.ts has not been loaded"),g)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let h=l.removed;if(a=l.events,!r){let n=-1!==h.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>iN(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&iN(t))return[iR(t)];{let e=[];return t&&(e=ix(t)),ta(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=iq(e,i);e.listenProvider_.startListening(iG(r),iB(e,r),s.hashFn,s.onComplete)}}}r||!(h.length>0)||i||(n?e.listenProvider_.stopListening(iG(t),null):h.forEach(t=>{let n=e.queryToTagMap.get(ij(t));e.listenProvider_.stopListening(iG(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){let i=t[n];if(!i._queryParams.loadsAllData()){let t=ij(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return a}function iU(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=ik(n,tG(e,t));if(i)return i});return ie(i,t,r,n,!0)}function iV(e,t){var n;return function e(t,n,i,r){if(tK(t.path))return function e(t,n,i,r){let s=n.get(tF());null==i&&null!=s&&(i=ik(s,tF()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=ia(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(iS(s,t,r,i))),o}(t,n,i,r);{let s=n.get(tF());null==i&&null!=s&&(i=ik(s,tF()));let o=[],a=tU(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=ia(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(iS(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,il(tF(),n)))}function iq(e,t){let n=t.query,i=iB(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||nc.EMPTY_NODE).hash(),onComplete:t=>{if("ok"===t){var r;return i?function(e,t,n){let i=iz(e,n);if(!i)return[];{let n=i$(i),r=n.path,s=n.queryId,o=tG(r,t);return iK(e,r,new nV(nF(s),o))}}(e,n._path,i):(r=n._path,iV(e,new nV(nM(),r)))}{let i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");let i=Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return iF(e,n,null,i)}}}}function iB(e,t){let n=ij(t);return e.queryToTagMap.get(n)}function ij(e){return e._path.toString()+"$"+e._queryIdentifier}function iz(e,t){return e.tagToQueryMap.get(t)}function i$(e){let t=e.indexOf("$");return(0,T.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new tM(e.substr(0,t))}}function iK(e,t,n){let i=e.syncPointTree_.get(t);return(0,T.hu)(i,"Missing sync point for query tag that we're tracking"),iS(i,n,il(t,e.pendingWriteTree_),null)}function iG(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(assert(m,"Reference.ts has not been loaded"),m)(e._repo,e._path):e}class iW{constructor(e){this.node_=e}getImmediateChild(e){return new iW(this.node_.getImmediateChild(e))}node(){return this.node_}}class iH{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=t$(this.path_,e);return new iH(this.syncTree_,t)}node(){return iU(this.syncTree_,this.path_)}}let iQ=function(e,t,n){return e&&"object"==typeof e?((0,T.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?iY(e[".sv"],t,n):"object"==typeof e[".sv"]?iJ(e[".sv"],t):void(0,T.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},iY=function(e,t,n){if("timestamp"===e)return n.timestamp;(0,T.hu)(!1,"Unexpected server value: "+e)},iJ=function(e,t,n){e.hasOwnProperty("increment")||(0,T.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&(0,T.hu)(!1,"Unexpected increment value: "+i);let r=t.node();if((0,T.hu)(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},iX=function(e,t,n){return iZ(e,new iW(t),n)};function iZ(e,t,n){let i;let r=iQ(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new ni(r))),e.forEachChild(ns,(e,r)=>{let s=iZ(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=iQ(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new ni(i,np(r)):e}}class i0{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function i1(e,t){let n=t instanceof tM?t:new tM(t),i=e,r=tU(n);for(;null!==r;){let e=(0,T.DV)(i.node.children,r)||{children:{},childCount:0};i=new i0(r,i,e),r=tU(n=tq(n))}return i}function i2(e){return e.node.value}function i3(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===i2(i)&&!i5(i),s=(0,T.r3)(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function i5(e){return e.node.childCount>0}function i6(e,t){ta(e.node.children,(n,i)=>{t(new i0(n,e,i))})}function i8(e){return new tM(null===e.parent?e.name:i8(e.parent)+"/"+e.name)}let i4=/[\[\].#$\/\u0000-\u001F\u007F]/,i9=/[\[\].#$\u0000-\u001F\u007F]/,i7=function(e){return"string"==typeof e&&0!==e.length&&!i4.test(e)},re=function(e){return"string"==typeof e&&0!==e.length&&!i9.test(e)},rt=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!e9(e)||e&&"object"==typeof e&&(0,T.r3)(e,".sv")},rn=function(e,t,n,i){i&&void 0===t||ri((0,T.gK)(e,"value"),t,n)},ri=function(e,t,n){let i=n instanceof tM?new tY(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+tX(i));if("function"==typeof t)throw Error(e+"contains a function "+tX(i)+" with contents = "+t.toString());if(e9(t))throw Error(e+"contains "+t.toString()+" "+tX(i));if("string"==typeof t&&t.length>3495253.3333333335&&(0,T.ug)(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+tX(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(ta(t,(t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!i7(t)))throw Error(e+" contains an invalid key ("+t+") "+tX(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=(0,T.ug)(t),tJ(i),ri(e,s,i),function(e){let t=e.parts_.pop();e.byteLength_-=(0,T.ug)(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)}),n&&r)throw Error(e+' contains ".value" child '+tX(i)+" in addition to actual children.")}},rr=function(e,t){let n,i;for(n=0;n<t.length;n++){let r=tj(i=t[n]);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!i7(r[t]))throw Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(tW);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&tQ(r,i))throw Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}},rs=function(e,t,n,i){if((!i||void 0!==n)&&!re(n))throw Error((0,T.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},ro=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),rs(e,t,n,i)},ra=function(e,t){if(".info"===tU(t))throw Error(e+" failed = Can't modify data under /.info/")},rl=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!i7(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!re(n)))throw Error((0,T.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class rh{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ru(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||tH(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function rc(e,t,n){ru(e,n),rd(e,e=>tQ(e,t)||tQ(t,e))}function rd(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();eZ&&e2("event: "+n.toString()),tc(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class rf{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=nN(),this.transactionQueueTree_=new i0,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function rp(e){let t=e.infoData_.getNode(new tM(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function rg(e){var t;return(t=t={timestamp:rp(e)}).timestamp=t.timestamp||new Date().getTime(),t}function rm(e,t,n,i,r){e.dataUpdateCount++;let s=new tM(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r){if(i){let t=(0,T.UI)(n,e=>np(e));o=function(e,t,n,i){let r=iz(e,i);if(!r)return[];{let i=i$(r),s=i.path,o=i.queryId,a=tG(s,t),l=nJ.fromObject(n);return iK(e,s,new nB(nF(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=np(n);o=function(e,t,n,i){let r=iz(e,i);if(null==r)return[];{let i=i$(r),s=i.path,o=i.queryId,a=tG(s,t);return iK(e,s,new nq(nF(o),a,n))}}(e.serverSyncTree_,s,t,r)}}else if(i){let t=(0,T.UI)(n,e=>np(e));o=function(e,t,n){let i=nJ.fromObject(n);return iV(e,new nB(nM(),t,i))}(e.serverSyncTree_,s,t)}else{let t=np(n);o=iM(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=rE(e,s)),rc(e.eventQueue_,a,o)}function ry(e,t){r_(e,"connected",t),!1===t&&function(e){rw(e,"onDisconnectEvents");let t=rg(e),n=nN();nP(e.onDisconnect_,tF(),(i,r)=>{let s=iZ(r,new iH(e.serverSyncTree_,i),t);nR(n,i,s)});let i=[];nP(n,tF(),(t,n)=>{i=i.concat(iM(e.serverSyncTree_,t,n));let r=rx(e,t);rE(e,r)}),e.onDisconnect_=nN(),rc(e.eventQueue_,tF(),i)}(e)}function r_(e,t,n){let i=new tM("/.info/"+t),r=np(n);e.infoData_.updateSnapshot(i,r);let s=iM(e.infoSyncTree_,i,r);rc(e.eventQueue_,i,s)}function rv(e){return e.nextWriteId_++}function rw(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),e2(n,...t)}function rI(e,t,n,i){t&&tc(()=>{if("ok"===n)t(null);else{let e=(n||"error").toUpperCase(),r=e;i&&(r+=": "+i);let s=Error(r);s.code=e,t(s)}})}function rb(e,t,n){return iU(e.serverSyncTree_,t,n)||nc.EMPTY_NODE}function rE(e,t){let n=rT(e,t),i=i8(n),r=rC(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=tG(n,a.path),h=!1,u;if((0,T.hu)(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,r=r.concat(iL(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status){if(a.retryCount>=25)h=!0,u="maxretry",r=r.concat(iL(e.serverSyncTree_,a.currentWriteId,!0));else{let n=rb(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){ri("transaction failed: Data returned ",i,a.path);let t=np(i);"object"==typeof i&&null!=i&&(0,T.r3)(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=iX(t,n,rg(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=rv(e),s.splice(s.indexOf(o),1),r=(r=r.concat(iO(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(iL(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",r=r.concat(iL(e.serverSyncTree_,a.currentWriteId,!0))}}rc(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(u),!1,null))))}rS(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)tc(i[e]);(function e(t,n=t.transactionQueueTree_){if(n||rS(t,n),i2(n)){let i=rC(t,n);(0,T.hu)(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=rb(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];(0,T.hu)(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=tG(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{rw(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(iL(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();rS(t,i1(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),rc(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)tc(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{e8("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}rE(t,n)}},o)}(t,i8(n),i)}else i5(n)&&i6(n,n=>{e(t,n)})})(e,e.transactionQueueTree_)}(e,r,i),i}function rT(e,t){let n;let i=e.transactionQueueTree_;for(n=tU(t);null!==n&&void 0===i2(i);)i=i1(i,n),n=tU(t=tq(t));return i}function rC(e,t){let n=[];return function e(t,n,i){let r=i2(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);i6(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function rS(e,t){let n=i2(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,i3(t,n.length>0?n:void 0)}i6(t,t=>{rS(e,t)})}function rx(e,t){let n=i8(rT(e,t)),i=i1(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{rk(e,t)}),rk(e,i),!function e(t,n,i,r){i&&!r&&n(t),i6(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{rk(e,t)}),n}function rk(e,t){let n=i2(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?((0,T.hu)(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):((0,T.hu)(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(iL(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?i3(t,void 0):n.length=s+1,rc(e.eventQueue_,i8(t),r);for(let e=0;e<i.length;e++)tc(i[e])}}let rA=function(e,t){let n=rN(e),i=n.namespace;"firebase.com"===n.domain&&e6(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||e6("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||e4();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new tv(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new tM(n.pathString)}},rN=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):e8(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},rR="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",rP=function(){let e=0,t=[];return function(n){let i;let r=n===e;e=n;let s=Array(8);for(i=7;i>=0;i--)s[i]=rR.charAt(n%64),n=Math.floor(n/64);(0,T.hu)(0===n,"Cannot push at time == 0");let o=s.join("");if(r){for(i=11;i>=0&&63===t[i];i--)t[i]=0;t[i]++}else for(i=0;i<12;i++)t[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)o+=rR.charAt(t[i]);return(0,T.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class rD{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+stringify(this.snapshot.exportVal())}}class rO{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class rL{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return tK(this._path)?null:tB(this._path)}get ref(){return new rU(this._repo,this._path)}get _queryIdentifier(){let e=ts(nx(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return nx(this._queryParams)}isEqual(e){if(!((e=(0,T.m9)(e))instanceof rL))return!1;let t=this._repo===e._repo,n=tH(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}function rM(e){let t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===t5){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",r="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==te)throw Error(i);if("string"!=typeof t)throw Error(r)}if(e.hasEnd()){if(e.getIndexEndName()!==tt)throw Error(i);if("string"!=typeof n)throw Error(r)}}else if(e.getIndex()===ns){if(null!=t&&!rt(t)||null!=n&&!rt(n))throw Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,T.hu)(e.getIndex() instanceof ng||e.getIndex()===ny,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function rF(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class rU extends rL{constructor(e,t){super(e,t,new nC,!1)}get parent(){let e=tz(this._path);return null===e?null:new rU(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class rV{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new tM(e),n=rB(this.ref,e);return new rV(this._node.getChild(t),n,ns)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new rV(n,rB(this.ref,t),ns)))}hasChild(e){let t=new tM(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function rq(e,t){return(e=(0,T.m9)(e))._checkNotDeleted("ref"),void 0!==t?rB(e._root,t):e._root}function rB(e,t){return null===tU((e=(0,T.m9)(e))._path)?ro("child","path",t,!1):rs("child","path",t,!1),new rU(e._repo,t$(e._path,t))}function rj(e,t){let n;ra("push",(e=(0,T.m9)(e))._path),rn("push",t,e._path,!0);let i=rP(rp(e._repo)),r=rB(e,i),s=rB(e,i);return n=null!=t?rz(s,t).then(()=>s):Promise.resolve(s),r.then=n.then.bind(n),r.catch=n.then.bind(n,void 0),r}function rz(e,t){ra("set",(e=(0,T.m9)(e))._path),rn("set",t,e._path,!1);let n=new T.BH;return function(e,t,n,i,r){rw(e,"set",{path:t.toString(),value:n,priority:null});let s=rg(e),o=np(n,null),a=iX(o,iU(e.serverSyncTree_,t),s),l=rv(e),h=iO(e.serverSyncTree_,t,a,l,!0);ru(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),(n,i)=>{let s="ok"===n;s||e8("set at "+t+" failed: "+n);let o=iL(e.serverSyncTree_,l,!s);rc(e.eventQueue_,t,o),rI(e,r,n,i)});let u=rx(e,t);rE(e,u),rc(e.eventQueue_,u,[])}(e._repo,e._path,t,null,n.wrapCallback(()=>{})),n.promise}class r${constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new rD("value",this,new rV(e.snapshotNode,new rU(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rO(this,e,t):null}matches(e){return e instanceof r$&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class rK{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new rO(this,e,t):null}createEvent(e,t){assert(null!=e.childName,"Child events should have a childName.");let n=rB(new rU(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new rD(e.type,this,new rV(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof rK&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}class rG{}(0,T.hu)(!g,"__referenceConstructor has already been defined"),g=rU,(0,T.hu)(!m,"__referenceConstructor has already been defined"),m=rU;let rW={};class rH{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function(e,t,n){if(e.stats_=tT(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new nk(e.repoInfo_,(t,n,i,r)=>{rm(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>ry(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,T.Wl)(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new t0(e.repoInfo_,t,(t,n,i,r)=>{rm(e,t,n,i,r)},t=>{ry(e,t)},t=>{ta(t,(t,n)=>{r_(e,t,n)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),e.statsReporter_=function(e,t){let n=e.toString();return tE[n]||(tE[n]=t()),tE[n]}(e.repoInfo_,()=>new nO(e.stats_,e.server_)),e.infoData_=new nA,e.infoSyncTree_=new iD({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=iM(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),r_(e,"connected",!1),e.serverSyncTree_=new iD({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);rc(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new rU(this._repo,tF())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){let n=rW[t];n&&n[e.key]===e||e6(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&e6("Cannot call "+e+" on a deleted database.")}}t0.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},t0.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},ez=b.Jn,(0,b.Xd)(new C.wA("database",(e,{instanceIdentifier:t})=>(function(e,t,n,i,r){var s,o;let a,l,h,u,c=i||e.options.databaseURL;void 0===c&&(e.options.projectId||e6("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),e2("Using default host for project ",e.options.projectId),c=`${e.options.projectId}-default-rtdb.firebaseio.com`);let d=rA(c,void 0),f=d.repoInfo;void 0!==eq&&eq.env&&(h=eq.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(u=!0,f=(d=rA(c=`http://${h}?ns=${f.namespace}`,void 0)).repoInfo):u=!d.repoInfo.secure;let p=r&&u?new tg(tg.OWNER):new tp(e.name,e.options,t);return rl("Invalid Firebase Database URL",d),tK(d.path)||e6("Database URL must point to the root of a Firebase Database (not including a child path)."),new rH((s=f,o=new tf(e,n),(a=rW[e.name])||(a={},rW[e.name]=a),(l=a[s.toURLString()])&&e6("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new rf(s,!1,p,o),a[s.toURLString()]=l,l),e)})(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,b.KN)(eB,ej,void 0),(0,b.KN)(eB,ej,"esm2017");var rQ=n(1409),rY=n(109);let rJ={apiKey:"AIzaSyBYOLsLlqNQTFgwWO1fyHUTgTHQ4JRgA-A",authDomain:"wmcyn-online-web.firebaseapp.com",projectId:"wmcyn-online-web",storageBucket:"wmcyn-online-web.appspot.com",messagingSenderId:"552241957320",appId:"1:552241957320:web:c32590238a5e7ec06858fd",measurementId:"G-KGVGX3LN7P",databaseURL:"https://".concat("wmcyn-online-web",".firebaseio.com")};try{let e=["apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId"].filter(e=>!rJ[e]);if(e.length>0)throw console.error("Missing Firebase config fields:",e),Error("Missing required Firebase config fields: ".concat(e.join(", ")));console.log("Firebase config:",{...rJ,apiKey:rJ.apiKey?"[REDACTED]":void 0,projectId:rJ.projectId||void 0,databaseURL:rJ.databaseURL||void 0}),y=(0,b.ZF)(rJ),_=function(e=(0,b.Mq)(),t){let n=(0,b.qX)(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=(0,T.P0)("database");e&&function(e,t,n,i={}){let r;(e=(0,T.m9)(e))._checkNotDeleted("useEmulator");let s=`${t}:${n}`,o=e._repoInternal;if(e._instanceStarted){if(s===e._repoInternal.repoInfo_.host&&(0,T.vZ)(i,o.repoInfo_.emulatorOptions))return;e6("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}o.repoInfo_.nodeAdmin?(i.mockUserToken&&e6('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new tg(tg.OWNER)):i.mockUserToken&&(r=new tg("string"==typeof i.mockUserToken?i.mockUserToken:(0,T.Sg)(i.mockUserToken,e.app.options.projectId))),(0,T.Xx)(t)&&(0,T.Uo)(t),function(e,t,n,i){let r=t.lastIndexOf(":"),s=t.substring(0,r),o=(0,T.Xx)(s);e.repoInfo_=new tv(t,o,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0,n),i&&(e.authTokenProvider_=i)}(o,s,i,r)}(n,...e)}return n}(y),v=(0,rQ.v0)(y),w=(0,rY.ad)(y),eF().then(e=>{e&&function(e=(0,b.Mq)()){e=(0,T.m9)(e);let t=(0,b.qX)(e,ep);t.isInitialized()?t.getImmediate():function(e,t={}){let n=(0,b.qX)(e,ep);if(n.isInitialized()){let e=n.getImmediate();if((0,T.vZ)(t,n.getOptions()))return e;throw ey.create("already-initialized")}return n.initialize({options:t})}(e)}(y)})}catch(e){console.error("Firebase initialization error:",e)}},5855:()=>{},561:()=>{},9543:()=>{},9008:(e,t,n)=>{e.exports=n(3867)},2238:(e,t,n)=>{"use strict";n.d(t,{Jn:()=>b,KN:()=>C,Mq:()=>T,Xd:()=>y,ZF:()=>E,qX:()=>_,rh:()=>v});var i=n(8463),r=n(3333),s=n(1683),o=n(6531);class a{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let l="@firebase/app",h="0.12.1",u=new r.Yd("@firebase/app"),c="[DEFAULT]",d={[l]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},f=new Map,p=new Map,g=new Map;function m(e,t){try{e.container.addComponent(t)}catch(n){u.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function y(e){let t=e.name;if(g.has(t))return u.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(g.set(t,e),f.values()))m(n,e);for(let t of p.values())m(t,e);return!0}function _(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function v(e){return null!=e&&void 0!==e.settings}let w=new s.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class I{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw w.create("app-deleted",{appName:this._name})}}let b="11.7.1";function E(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r=Object.assign({name:c,automaticDataCollectionEnabled:!1},t),o=r.name;if("string"!=typeof o||!o)throw w.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.aH)()),!n)throw w.create("no-options");let a=f.get(o);if(a){if((0,s.vZ)(n,a.options)&&(0,s.vZ)(r,a.config))return a;throw w.create("duplicate-app",{appName:o})}let l=new i.H0(o);for(let e of g.values())l.addComponent(e);let h=new I(n,r,l);return f.set(o,h),h}function T(e=c){let t=f.get(e);if(!t&&e===c&&(0,s.aH)())return E();if(!t)throw w.create("no-app",{appName:e});return t}function C(e,t,n){var r;let s=null!==(r=d[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);let o=s.match(/\s|\//),a=t.match(/\s|\//);if(o||a){let e=[`Unable to register library "${s}" with version "${t}":`];o&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),u.warn(e.join(" "));return}y(new i.wA(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}let S="firebase-heartbeat-store",x=null;function k(){return x||(x=(0,o.X3)("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(S)}catch(e){console.warn(e)}}}).catch(e=>{throw w.create("idb-open",{originalErrorMessage:e.message})})),x}async function A(e){try{let t=(await k()).transaction(S),n=await t.objectStore(S).get(R(e));return await t.done,n}catch(e){if(e instanceof s.ZR)u.warn(e.message);else{let t=w.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});u.warn(t.message)}}}async function N(e,t){try{let n=(await k()).transaction(S,"readwrite"),i=n.objectStore(S);await i.put(t,R(e)),await n.done}catch(e){if(e instanceof s.ZR)u.warn(e.message);else{let t=w.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});u.warn(t.message)}}}function R(e){return`${e.name}!${e.options.appId}`}class P{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new O(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=D();if((null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(e=>e.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){u.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=D(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),L(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),L(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=(0,s.L)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return u.warn(e),""}}}function D(){return new Date().toISOString().substring(0,10)}class O{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await A(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let n=await this.read();return N(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function L(e){return(0,s.L)(JSON.stringify({version:2,heartbeats:e})).length}y(new i.wA("platform-logger",e=>new a(e),"PRIVATE")),y(new i.wA("heartbeat",e=>new P(e),"PRIVATE")),C(l,h,""),C(l,h,"esm2017"),C("fire-js","")},8463:(e,t,n)=>{"use strict";n.d(t,{H0:()=>a,wA:()=>r});var i=n(1683);class r{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let s="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=s){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=s){return this.instances.has(e)}getOptions(e=s){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;let i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);let s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:e===s?void 0:e,options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}return n||null}normalizeInstanceIdentifier(e=s){return this.component?this.component.multipleInstances?e:s:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:(e,t,n)=>{"use strict";var i;n.d(t,{Yd:()=>h,in:()=>i});let r=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(i||(i={}));let s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=a[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class h{constructor(e){this.name=e,this._logLevel=o,this._logHandler=l,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in i))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...e),this._logHandler(this,i.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...e),this._logHandler(this,i.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,i.INFO,...e),this._logHandler(this,i.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,i.WARN,...e),this._logHandler(this,i.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...e),this._logHandler(this,i.ERROR,...e)}}},1409:(e,t,n)=>{"use strict";n.d(t,{hJ:()=>e1,Xb:()=>tl,v0:()=>nN,Aj:()=>tc,LS:()=>ta,e5:()=>th,rh:()=>tX,w7:()=>td});var i=n(2238),r=n(1683),s=n(3333);function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&0>t.indexOf(i)&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(e);r<i.length;r++)0>t.indexOf(i[r])&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]]);return n}Object.create,Object.create;var a=("function"==typeof SuppressedError&&SuppressedError,n(8463));function l(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let h=new r.LL("auth","Firebase",l()),u=new s.Yd("@firebase/auth");function c(e,...t){u.logLevel<=s.in.ERROR&&u.error(`Auth (${i.Jn}): ${e}`,...t)}function d(e,...t){throw m(e,...t)}function f(e,...t){return m(e,...t)}function p(e,t,n){let i=Object.assign(Object.assign({},l()),{[t]:n});return new r.LL("auth","Firebase",i).create(t,{appName:e.name})}function g(e){return p(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function m(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return h.create(e,...t)}function y(e,t,...n){if(!e)throw m(t,...n)}function _(e){let t="INTERNAL ASSERTION FAILED: "+e;throw c(t),Error(t)}function v(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function w(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class I{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||_(n),this.isMobile=(0,r.uI)()||(0,r.b$)()}get(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===w()||"https:"===w()||(0,r.ru)()||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function b(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||_(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class E{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void _("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void _("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void _("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let T={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},C=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],S=new I(3e4,6e4);function x(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function k(e,t,n,i,s={}){return A(e,s,async()=>{let s={},o={};i&&("GET"===t?o=i:s={body:JSON.stringify(i)});let a=(0,r.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);let h=Object.assign({method:t,headers:l},s);return(0,r.L_)()||(h.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,r.Xx)(e.emulatorConfig.host)&&(h.credentials="include"),E.fetch()(await R(e,e.config.apiHost,n,a),h)})}async function A(e,t,n){e._canInitEmulator=!1;let i=Object.assign(Object.assign({},T),t);try{let t=new P(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw D(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw D(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw D(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw D(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw p(e,o,n);d(e,o)}}catch(t){if(t instanceof r.ZR)throw t;d(e,"network-request-failed",{message:String(t)})}}async function N(e,t,n,i,r={}){let s=await k(e,t,n,i,r);return"mfaPendingCredential"in s&&d(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function R(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?b(e.config,r):`${e.config.apiScheme}://${r}`;return C.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class P{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(f(this.auth,"network-request-failed")),S.get())})}}function D(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=f(e,t,i);return r.customData._tokenResponse=n,r}function O(e){return void 0!==e&&void 0!==e.enterprise}class L{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return function(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function M(e,t){return k(e,"GET","/v2/recaptchaConfig",x(e,t))}async function F(e,t){return k(e,"POST","/v1/accounts:delete",t)}async function U(e,t){return k(e,"POST","/v1/accounts:lookup",t)}function V(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function q(e,t=!1){let n=(0,r.m9)(e),i=await n.getIdToken(t),s=j(i);y(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");let o="object"==typeof s.firebase?s.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:V(B(s.auth_time)),issuedAtTime:V(B(s.iat)),expirationTime:V(B(s.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}function B(e){return 1e3*Number(e)}function j(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return c("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,r.tV)(n);if(!e)return c("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return c("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function z(e){let t=j(e);return y(t,"internal-error"),y(void 0!==t.exp,"internal-error"),y(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function $(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof r.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class K{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class G{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=V(this.lastLoginAt),this.creationTime=V(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function W(e){var t;let n=e.auth,i=await e.getIdToken(),r=await $(e,U(n,{idToken:i}));y(null==r?void 0:r.users.length,n,"internal-error");let s=r.users[0];e._notifyReloadListener(s);let o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?Q(s.providerUserInfo):[],a=[...e.providerData.filter(e=>!o.some(t=>t.providerId===e.providerId)),...o],l=e.isAnonymous,h=!(e.email&&s.passwordHash)&&!(null==a?void 0:a.length);Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new G(s.createdAt,s.lastLoginAt),isAnonymous:!!l&&h})}async function H(e){let t=(0,r.m9)(e);await W(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Q(e){return e.map(e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}async function Y(e,t){let n=await A(e,{},async()=>{let n=(0,r.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,o=await R(e,i,"/v1/token",`key=${s}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",E.fetch()(o,{method:"POST",headers:a,body:n})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function J(e,t){return k(e,"POST","/v2/accounts:revokeToken",x(e,t))}class X{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y(void 0!==e.idToken,"internal-error"),y(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):z(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){y(0!==e.length,"internal-error");let t=z(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(y(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await Y(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new X;return n&&(y("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(y("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(y("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new X,this.toJSON())}_performRefresh(){return _("not implemented")}}function Z(e,t){y("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ee{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,r=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new K(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new G(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await $(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return q(this,e)}reload(){return H(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ee(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await W(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,i.rh)(this.auth.app))return Promise.reject(g(this.auth));let e=await this.getIdToken();return await $(this,F(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,r,s,o,a,l,h;let u=null!==(n=t.displayName)&&void 0!==n?n:void 0,c=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(r=t.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(l=t.createdAt)&&void 0!==l?l:void 0,_=null!==(h=t.lastLoginAt)&&void 0!==h?h:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:b,stsTokenManager:E}=t;y(v&&E,e,"internal-error");let T=X.fromJSON(this.name,E);y("string"==typeof v,e,"internal-error"),Z(u,e.name),Z(c,e.name),y("boolean"==typeof w,e,"internal-error"),y("boolean"==typeof I,e,"internal-error"),Z(d,e.name),Z(f,e.name),Z(p,e.name),Z(g,e.name),Z(m,e.name),Z(_,e.name);let C=new ee({uid:v,auth:e,email:c,emailVerified:w,displayName:u,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:_});return b&&Array.isArray(b)&&(C.providerData=b.map(e=>Object.assign({},e))),g&&(C._redirectEventId=g),C}static async _fromIdTokenResponse(e,t,n=!1){let i=new X;i.updateFromServerResponse(t);let r=new ee({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await W(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];y(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?Q(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length),o=new X;o.updateFromIdToken(n);let a=new ee({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new G(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(null==r?void 0:r.length)}),a}}let et=new Map;function en(e){var t,n;t="Expected a class definition",e instanceof Function||_(t);let i=et.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||_(n)):(i=new e,et.set(e,i)),i}class ei{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function er(e,t,n){return`firebase:${e}:${t}:${n}`}ei.type="NONE";class es{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;let{config:i,name:r}=this.auth;this.fullUserKey=er(this.userKey,i.apiKey,r),this.fullPersistenceKey=er("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await U(this.auth,{idToken:e}).catch(()=>void 0);return t?ee._fromGetAccountInfoResponse(this.auth,t,e):null}return ee._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new es(en(ei),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||en(ei),s=er(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await U(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await ee._fromGetAccountInfoResponse(e,n,t)}else i=ee._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch(e){}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch(e){}}))),new es(r,e,n)}}function eo(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(eu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(ea(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ed(t))return"Blackberry";if(ef(t))return"Webos";if(el(t))return"Safari";if((t.includes("chrome/")||eh(t))&&!t.includes("edge/"))return"Chrome";if(ec(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function ea(e=(0,r.z$)()){return/firefox\//i.test(e)}function el(e=(0,r.z$)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function eh(e=(0,r.z$)()){return/crios\//i.test(e)}function eu(e=(0,r.z$)()){return/iemobile/i.test(e)}function ec(e=(0,r.z$)()){return/android/i.test(e)}function ed(e=(0,r.z$)()){return/blackberry/i.test(e)}function ef(e=(0,r.z$)()){return/webos/i.test(e)}function ep(e=(0,r.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function eg(e=(0,r.z$)()){return ep(e)||ec(e)||ef(e)||ed(e)||/windows phone/i.test(e)||eu(e)}function em(e,t=[]){let n;switch(e){case"Browser":n=eo((0,r.z$)());break;case"Worker":n=`${eo((0,r.z$)())}-${e}`;break;default:n=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.Jn}/${s}`}class ey{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function e_(e,t={}){return k(e,"GET","/v2/passwordPolicy",x(e,t))}class ev{constructor(e){var t,n,i,r;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=s.minPasswordLength)&&void 0!==t?t:6,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(r=e.forceUpgradeOnSignin)&&void 0!==r&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,r,s,o;let a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(r=a.containsUppercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsNumericCharacter)||void 0===s||s),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class ew{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new eb(this),this.idTokenSubscription=new eb(this),this.beforeStateQueue=new ey(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=en(t)),this._initializationPromise=this.queue(async()=>{var n,i,r;if(!this._deleted&&(this.persistenceManager=await es.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await U(this,{idToken:e}),n=await ee._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,i.rh)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let n=await this.assertedPersistence.getCurrentUser(),r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);(!n||n===i)&&(null==o?void 0:o.user)&&(r=o.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await W(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,i.rh)(this.app))return Promise.reject(g(this));let t=e?(0,r.m9)(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,i.rh)(this.app)?Promise.reject(g(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,i.rh)(this.app)?Promise.reject(g(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(en(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new ev(await e_(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new r.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await J(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&en(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await es.create(this,[en(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return(this._isInitialized&&await this.queue(async()=>{}),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e)?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(y(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=em(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let n=await (null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);let i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if((0,i.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){u.logLevel<=s.in.WARN&&u.warn(`Auth (${i.Jn}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function eI(e){return(0,r.m9)(e)}class eb{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,r.ne)(e=>this.observer=e)}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let eE={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eT(e){return`__${e}${Math.floor(1e6*Math.random())}`}class eC{constructor(){this.enterprise=new eS}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eS{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let ex="NO_RECAPTCHA";class ek{constructor(e){this.type="recaptcha-enterprise",this.auth=eI(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{M(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new L(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;O(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(ex)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new eC().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&O(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window){r(Error("RecaptchaVerifier is only supported in browser"));return}let t=eE.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,eE.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function eA(e,t,n,i=!1,r=!1){let s;let o=new ek(e);if(r)s=ex;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function eN(e,t,n,i,r){var s,o;if("EMAIL_PASSWORD_PROVIDER"===r){if(null===(s=e._getRecaptchaConfig())||void 0===s||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await eA(e,t,n,"getOobCode"===n);return i(e,r)}});{let r=await eA(e,t,n,"getOobCode"===n);return i(e,r)}}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){let r=await eA(e,t,n);return i(e,r).catch(async r=>{var s;if((null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await eA(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await eA(e,t,n,!1,!0);return i(e,r)}}async function eR(e){let t=eI(e),n=new L(await M(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new ek(t).verify()}function eP(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function eD(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class eO{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return _("not implemented")}_getIdTokenResponse(e){return _("not implemented")}_linkToIdToken(e,t){return _("not implemented")}_getReauthenticationResolver(e){return _("not implemented")}}async function eL(e,t){return k(e,"POST","/v1/accounts:signUp",t)}async function eM(e,t){return N(e,"POST","/v1/accounts:signInWithPassword",x(e,t))}async function eF(e,t){return k(e,"POST","/v1/accounts:sendOobCode",x(e,t))}async function eU(e,t){return eF(e,t)}async function eV(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}async function eq(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",x(e,t))}class eB extends eO{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new eB(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new eB(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eN(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",eM,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eV(e,{email:this._email,oobCode:this._password});default:d(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eN(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eL,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eq(e,{idToken:t,email:this._email,oobCode:this._password});default:d(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function ej(e,t){return N(e,"POST","/v1/accounts:signInWithIdp",x(e,t))}class ez extends eO{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new ez(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):d("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,r=o(t,["providerId","signInMethod"]);if(!n||!i)return null;let s=new ez(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(e){return ej(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,ej(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,ej(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,r.xO)(t)}return e}}async function e$(e,t){return k(e,"POST","/v1/accounts:sendVerificationCode",x(e,t))}async function eK(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t))}async function eG(e,t){let n=await N(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,t));if(n.temporaryProof)throw D(e,"account-exists-with-different-credential",n);return n}let eW={USER_NOT_FOUND:"user-not-found"};async function eH(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",x(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),eW)}class eQ extends eO{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new eQ({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new eQ({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eK(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return eG(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return eH(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new eQ({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class eY{constructor(e){var t,n,i,s,o,a;let l=(0,r.zd)((0,r.pd)(e)),h=null!==(t=l.apiKey)&&void 0!==t?t:null,u=null!==(n=l.oobCode)&&void 0!==n?n:null,c=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=l.mode)&&void 0!==i?i:null);y(h&&u&&c,"argument-error"),this.apiKey=h,this.operation=c,this.code=u,this.continueUrl=null!==(s=l.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(o=l.lang)&&void 0!==o?o:null,this.tenantId=null!==(a=l.tenantId)&&void 0!==a?a:null}static parseLink(e){let t=function(e){let t=(0,r.zd)((0,r.pd)(e)).link,n=t?(0,r.zd)((0,r.pd)(t)).deep_link_id:null,i=(0,r.zd)((0,r.pd)(e)).deep_link_id;return(i?(0,r.zd)((0,r.pd)(i)).link:null)||i||n||t||e}(e);try{return new eY(t)}catch(e){return null}}}class eJ{constructor(){this.providerId=eJ.PROVIDER_ID}static credential(e,t){return eB._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=eY.parseLink(t);return y(n,"argument-error"),eB._fromEmailAndCode(e,n.code,n.tenantId)}}eJ.PROVIDER_ID="password",eJ.EMAIL_PASSWORD_SIGN_IN_METHOD="password",eJ.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class eX{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class eZ extends eX{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class e0 extends eZ{constructor(){super("facebook.com")}static credential(e){return ez._fromParams({providerId:e0.PROVIDER_ID,signInMethod:e0.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e0.credentialFromTaggedObject(e)}static credentialFromError(e){return e0.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e0.credential(e.oauthAccessToken)}catch(e){return null}}}e0.FACEBOOK_SIGN_IN_METHOD="facebook.com",e0.PROVIDER_ID="facebook.com";class e1 extends eZ{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ez._fromParams({providerId:e1.PROVIDER_ID,signInMethod:e1.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return e1.credentialFromTaggedObject(e)}static credentialFromError(e){return e1.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return e1.credential(t,n)}catch(e){return null}}}e1.GOOGLE_SIGN_IN_METHOD="google.com",e1.PROVIDER_ID="google.com";class e2 extends eZ{constructor(){super("github.com")}static credential(e){return ez._fromParams({providerId:e2.PROVIDER_ID,signInMethod:e2.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e2.credentialFromTaggedObject(e)}static credentialFromError(e){return e2.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e2.credential(e.oauthAccessToken)}catch(e){return null}}}e2.GITHUB_SIGN_IN_METHOD="github.com",e2.PROVIDER_ID="github.com";class e3 extends eZ{constructor(){super("twitter.com")}static credential(e,t){return ez._fromParams({providerId:e3.PROVIDER_ID,signInMethod:e3.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return e3.credentialFromTaggedObject(e)}static credentialFromError(e){return e3.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return e3.credential(t,n)}catch(e){return null}}}async function e5(e,t){return N(e,"POST","/v1/accounts:signUp",x(e,t))}e3.TWITTER_SIGN_IN_METHOD="twitter.com",e3.PROVIDER_ID="twitter.com";class e6{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new e6({user:await ee._fromIdTokenResponse(e,n,i),providerId:e8(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new e6({user:e,providerId:e8(n),_tokenResponse:n,operationType:t})}}function e8(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class e4 extends r.ZR{constructor(e,t,n,i){var r;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,e4.prototype),this.customData={appName:e.name,tenantId:null!==(r=e.tenantId)&&void 0!==r?r:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new e4(e,t,n,i)}}function e9(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw e4._fromErrorAndOperation(e,n,t,i);throw n})}async function e7(e,t,n=!1){let i=await $(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return e6._forOperation(e,"link",i)}async function te(e,t,n=!1){let{auth:r}=e;if((0,i.rh)(r.app))return Promise.reject(g(r));let s="reauthenticate";try{let i=await $(e,e9(r,s,t,e),n);y(i.idToken,r,"internal-error");let o=j(i.idToken);y(o,r,"internal-error");let{sub:a}=o;return y(e.uid===a,r,"user-mismatch"),e6._forOperation(e,s,i)}catch(e){throw(null==e?void 0:e.code)==="auth/user-not-found"&&d(r,"user-mismatch"),e}}async function tt(e,t,n=!1){if((0,i.rh)(e.app))return Promise.reject(g(e));let r="signIn",s=await e9(e,r,t),o=await e6._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(o.user),o}async function tn(e,t){return tt(eI(e),t)}class ti{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?tr._fromServerResponse(e,t):"totpInfo"in t?ts._fromServerResponse(e,t):d(e,"internal-error")}}class tr extends ti{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new tr(t)}}class ts extends ti{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ts(t)}}async function to(e){let t=eI(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function ta(e,t,n){var i;let r=eI(e),s={requestType:"PASSWORD_RESET",email:t,clientType:"CLIENT_TYPE_WEB"};n&&(y((null===(i=n.url)||void 0===i?void 0:i.length)>0,r,"invalid-continue-uri"),y(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,r,"invalid-dynamic-link-domain"),y(void 0===n.linkDomain||n.linkDomain.length>0,r,"invalid-hosting-link-domain"),s.continueUrl=n.url,s.dynamicLinkDomain=n.dynamicLinkDomain,s.linkDomain=n.linkDomain,s.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(y(n.iOS.bundleId.length>0,r,"missing-ios-bundle-id"),s.iOSBundleId=n.iOS.bundleId),n.android&&(y(n.android.packageName.length>0,r,"missing-android-pkg-name"),s.androidInstallApp=n.android.installApp,s.androidMinimumVersionCode=n.android.minimumVersion,s.androidPackageName=n.android.packageName)),await eN(r,s,"getOobCode",eU,"EMAIL_PASSWORD_PROVIDER")}async function tl(e,t,n){if((0,i.rh)(e.app))return Promise.reject(g(e));let r=eI(e),s=eN(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",e5,"EMAIL_PASSWORD_PROVIDER"),o=await s.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&to(e),t}),a=await e6._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function th(e,t,n){return(0,i.rh)(e.app)?Promise.reject(g(e)):tn((0,r.m9)(e),eJ.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&to(e),t})}class tu{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}function tc(e,t,n,i){return(0,r.m9)(e).onAuthStateChanged(t,n,i)}function td(e){return(0,r.m9)(e).signOut()}class tf{constructor(e,t,n){this.type=e,this.credential=t,this.user=n}static _fromIdtoken(e,t){return new tf("enroll",e,t)}static _fromMfaPendingCredential(e){return new tf("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return tf._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return tf._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tp{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){let n=eI(e),i=t.customData._serverResponse,r=(i.mfaInfo||[]).map(e=>ti._fromServerResponse(n,e));y(i.mfaPendingCredential,n,"internal-error");let s=tf._fromMfaPendingCredential(i.mfaPendingCredential);return new tp(s,r,async e=>{let r=await e._process(n,s);delete i.mfaInfo,delete i.mfaPendingCredential;let o=Object.assign(Object.assign({},i),{idToken:r.idToken,refreshToken:r.refreshToken});switch(t.operationType){case"signIn":let a=await e6._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(a.user),a;case"reauthenticate":return y(t.user,n,"internal-error"),e6._forOperation(t.user,t.operationType,o);default:d(n,"internal-error")}})}async resolveSignIn(e){return this.signInResolver(e)}}function tg(e,t){return k(e,"POST","/v2/accounts/mfaEnrollment:start",x(e,t))}class tm{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>ti._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new tm(e)}async getSession(){return tf._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let n=await this.getSession(),i=await $(this.user,e._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,n=await this.user.getIdToken();try{var i,r;let e=await $(this.user,(i=this.user.auth,r={idToken:n,mfaEnrollmentId:t},k(i,"POST","/v2/accounts/mfaEnrollment:withdraw",x(i,r))));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;let ty="__sak";class t_{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(ty,"1"),this.storage.removeItem(ty),Promise.resolve(!0)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class tv extends t_{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=eg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});return}let n=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);(0,r.w1)()&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}function tw(e){var t,n;let i=e.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),r=RegExp(`${i}=([^;]+)`);return null!==(n=null===(t=document.cookie.match(r))||void 0===t?void 0:t[1])&&void 0!==n?n:null}function tI(e){let t="http:"===window.location.protocol;return`${t?"__dev_":"__HOST-"}FIREBASE_${e.split(":")[3]}`}tv.type="LOCAL";class tb{constructor(){this.type="COOKIE",this.listenerUnsubscribes=new Map}_getFinalTarget(e){let t=new URL(`${window.location.origin}/__cookies__`);return t.searchParams.set("finalTarget",e),t}async _isAvailable(){var e;return!!("boolean"!=typeof isSecureContext||isSecureContext)&&"undefined"!=typeof navigator&&"undefined"!=typeof document&&(null===(e=navigator.cookieEnabled)||void 0===e||e)}async _set(e,t){}async _get(e){if(!this._isAvailable())return null;let t=tI(e);if(window.cookieStore){let e=await window.cookieStore.get(t);return null==e?void 0:e.value}return tw(t)}async _remove(e){if(!this._isAvailable()||!await this._get(e))return;let t=tI(e);document.cookie=`${t}=;Max-Age=34560000;Partitioned;Secure;SameSite=Strict;Path=/;Priority=High`,await fetch("/__cookies__",{method:"DELETE"}).catch(()=>void 0)}_addListener(e,t){if(!this._isAvailable())return;let n=tI(e);if(window.cookieStore){let e=e=>{let i=e.changed.find(e=>e.name===n);i&&t(i.value),e.deleted.find(e=>e.name===n)&&t(null)};return this.listenerUnsubscribes.set(t,()=>window.cookieStore.removeEventListener("change",e)),window.cookieStore.addEventListener("change",e)}let i=tw(n),r=setInterval(()=>{let e=tw(n);e!==i&&(t(e),i=e)},1e3);this.listenerUnsubscribes.set(t,()=>clearInterval(r))}_removeListener(e,t){let n=this.listenerUnsubscribes.get(t);n&&(n(),this.listenerUnsubscribes.delete(t))}}tb.type="COOKIE";class tE extends t_{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}tE.type="SESSION";class tT{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new tT(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!(null==r?void 0:r.size))return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function tC(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}tT.receivers=[];class tS{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r;let s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=tC("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function tx(){return window}function tk(){return void 0!==tx().WorkerGlobalScope&&"function"==typeof tx().importScripts}async function tA(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}let tN="firebaseLocalStorageDb",tR="firebaseLocalStorage",tP="fbase_key";class tD{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function tO(e,t){return e.transaction([tR],t?"readwrite":"readonly").objectStore(tR)}function tL(){let e=indexedDB.open(tN,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(tR,{keyPath:tP})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(tR)?t(n):(n.close(),await new tD(indexedDB.deleteDatabase(tN)).toPromise(),t(await tL()))})})}async function tM(e,t,n){return new tD(tO(e,!0).put({[tP]:t,value:n})).toPromise()}async function tF(e,t){let n=tO(e,!1).get(t),i=await new tD(n).toPromise();return void 0===i?null:i.value}function tU(e,t){return new tD(tO(e,!0).delete(t)).toPromise()}class tV{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await tL()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return tk()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=tT._getInstance(tk()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await tA(),!this.activeServiceWorker)return;this.sender=new tS(this.activeServiceWorker);let n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null==navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await tL();return await tM(e,ty,"1"),await tU(e,ty),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>tM(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>tF(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>tU(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new tD(tO(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function tq(e,t){return k(e,"POST","/v2/accounts/mfaSignIn:start",x(e,t))}tV.type="LOCAL",eT("rcb"),new I(3e4,6e4);let tB="recaptcha";async function tj(e,t,n){var i;if(!e._getRecaptchaConfig())try{await eR(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){y("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===ex){y((null==n?void 0:n.type)===tB,e,"argument-error");let i=await tz(e,t,n);return tg(e,i)}return tg(e,t)},o=eN(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{y("signin"===t.type,e,"internal-error");let s=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;y(s,e,"missing-multi-factor-info");let o={mfaPendingCredential:t.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},a=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===ex){y((null==n?void 0:n.type)===tB,e,"argument-error");let i=await tz(e,t,n);return tq(e,i)}return tq(e,t)},l=eN(e,o,"mfaSmsSignIn",a,"PHONE_PROVIDER");return(await l.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===ex){y((null==n?void 0:n.type)===tB,e,"argument-error");let i=await tz(e,t,n);return e$(e,i)}return e$(e,t)},s=eN(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{null==n||n._reset()}}async function tz(e,t,n){y(n.type===tB,e,"argument-error");let i=await n.verify();y("string"==typeof i,e,"argument-error");let r=Object.assign({},t);if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class t${constructor(e){this.providerId=t$.PROVIDER_ID,this.auth=eI(e)}verifyPhoneNumber(e,t){return tj(this.auth,e,(0,r.m9)(t))}static credential(e,t){return eQ._fromVerification(e,t)}static credentialFromResult(e){return t$.credentialFromTaggedObject(e)}static credentialFromError(e){return t$.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?eQ._fromTokenResponse(t,n):null}}function tK(e,t){return t?en(t):(y(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}t$.PROVIDER_ID="phone",t$.PHONE_SIGN_IN_METHOD="phone";class tG extends eO{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return ej(e,this._buildIdpRequest())}_linkToIdToken(e,t){return ej(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return ej(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function tW(e){return tt(e.auth,new tG(e),e.bypassAuthState)}function tH(e){let{auth:t,user:n}=e;return y(n,t,"internal-error"),te(n,new tG(e),e.bypassAuthState)}async function tQ(e){let{auth:t,user:n}=e;return y(n,t,"internal-error"),e7(n,new tG(e),e.bypassAuthState)}class tY{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s){this.reject(s);return}let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return tW;case"linkViaPopup":case"linkViaRedirect":return tQ;case"reauthViaPopup":case"reauthViaRedirect":return tH;default:d(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||_(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let tJ=new I(2e3,1e4);async function tX(e,t,n){if((0,i.rh)(e.app))return Promise.reject(f(e,"operation-not-supported-in-this-environment"));let r=eI(e);!function(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&d(e,"argument-error"),p(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}(e,t,eX);let s=tK(r,n);return new tZ(r,"signInViaPopup",t,s).executeNotNull()}class tZ extends tY{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,tZ.currentPopupAction&&tZ.currentPopupAction.cancel(),tZ.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||_(t);let n=tC();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(f(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(f(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,tZ.currentPopupAction=null}pollUserCancellation(){let e=()=>{var t,n;if(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(f(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,tJ.get())};e()}}tZ.currentPopupAction=null;let t0=new Map;class t1 extends tY{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=t0.get(this.auth._key());if(!e){try{let t=await t2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}t0.set(this.auth._key(),e)}return this.bypassAuthState||t0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type){this.resolve(null);return}if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function t2(e,t){let n=t6(t),i=t5(e);if(!await i._isAvailable())return!1;let r=await i._get(n)==="true";return await i._remove(n),r}function t3(e,t){t0.set(e._key(),t)}function t5(e){return en(e._redirectPersistence)}function t6(e){return er("pendingRedirect",e.config.apiKey,e.name)}async function t8(e,t,n=!1){if((0,i.rh)(e.app))return Promise.reject(g(e));let r=eI(e),s=tK(r,t),o=new t1(r,s,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,t)),a}class t4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return t7(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!t7(e)){let i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(f(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(t9(e))}saveEventToCache(e){this.cachedEventUids.add(t9(e)),this.lastProcessedEventTime=Date.now()}}function t9(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function t7({type:e,error:t}){return"unknown"===e&&(null==t?void 0:t.code)==="auth/no-auth-event"}async function ne(e,t={}){return k(e,"GET","/v1/projects",t)}let nt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,nn=/^https?/;async function ni(e){if(e.config.emulator)return;let{authorizedDomains:t}=await ne(e);for(let e of t)try{if(function(e){let t=v(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!nn.test(n))return!1;if(nt.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch(e){}d(e,"unauthorized-domain")}let nr=new I(3e4,6e4);function ns(){let e=tx().___jsl;if(null==e?void 0:e.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let no=null,na=new I(5e3,15e3),nl={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},nh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function nu(e){let t=await (no=no||new Promise((t,n)=>{var i,r,s,o;function a(){ns(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ns(),n(f(e,"network-request-failed"))},timeout:nr.get()})}if(null===(r=null===(i=tx().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)t(gapi.iframes.getContext());else if(null===(s=tx().gapi)||void 0===s?void 0:s.load)a();else{let t=eT("iframefcb");return tx()[t]=()=>{gapi.load?a():n(f(e,"network-request-failed"))},(o=`${eE.gapiScript}?onload=${t}`,eE.loadJS(o)).catch(e=>n(e))}}).catch(e=>{throw no=null,e})),n=tx().gapi;return y(n,e,"internal-error"),t.open({where:document.body,url:function(e){let t=e.config;y(t.authDomain,e,"auth-domain-config-required");let n=t.emulator?b(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,s={apiKey:t.apiKey,appName:e.name,v:i.Jn},o=nh.get(e.config.apiHost);o&&(s.eid=o);let a=e._getFrameworks();return a.length&&(s.fw=a.join(",")),`${n}?${(0,r.xO)(s).slice(1)}`}(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:nl,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=f(e,"network-request-failed"),s=tx().setTimeout(()=>{i(r)},na.get());function o(){tx().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let nc={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class nd{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let nf=encodeURIComponent("fac");async function np(e,t,n,s,o,a){y(e.config.authDomain,e,"auth-domain-config-required"),y(e.config.apiKey,e,"invalid-api-key");let l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:s,v:i.Jn,eventId:o};if(t instanceof eX)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,r.xb)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(a||{})))l[n]=i;if(t instanceof eZ){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(l.scopes=e.join(","))}for(let t of(e.tenantId&&(l.tid=e.tenantId),Object.keys(l)))void 0===l[t]&&delete l[t];let h=await e._getAppCheckToken(),u=h?`#${nf}=${encodeURIComponent(h)}`:"";return`${function({config:e}){return e.emulator?b(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,r.xO)(l).slice(1)}${u}`}let ng="webStorageSupport";class nm{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tE,this._completeRedirectFn=t8,this._overrideRedirectResult=t3}async _openPopup(e,t,n,i){var s,o,a;o=null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,a="_initialize() not called before _openPopup()",o||_(a);let l=await np(e,t,n,v(),i);return function(e,t,n,i=500,s=600){let o=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString(),l="",h=Object.assign(Object.assign({},nc),{width:i.toString(),height:s.toString(),top:o,left:a}),u=(0,r.z$)().toLowerCase();n&&(l=eh(u)?"_blank":n),ea(u)&&(t=t||"http://localhost",h.scrollbars="yes");let c=Object.entries(h).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=(0,r.z$)()){var t;return ep(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==l)return function(e,t){let n=document.createElement("a");n.href=e,n.target=t;let i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new nd(null);let d=window.open(t||"",l,c);y(d,e,"popup-blocked");try{d.focus()}catch(e){}return new nd(d)}(e,l,tC())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await np(e,t,n,v(),i),tx().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||_(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await nu(e),n=new t4(e);return t.register("authEvent",t=>(y(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ng,{type:ng},n=>{var i;let r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[ng];void 0!==r&&t(!!r),d(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=ni(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return eg()||el()||ep()}}class ny{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return _("unexpected MultiFactorSessionType")}}}class n_ extends ny{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new n_(e)}_finalizeEnroll(e,t,n){return k(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}_finalizeSignIn(e,t){return k(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()}))}}class nv{constructor(){}static assertion(e){return n_._fromCredential(e)}}nv.FACTOR_ID="phone";class nw{static assertionForEnrollment(e,t){return nI._fromSecret(e,t)}static assertionForSignIn(e,t){return nI._fromEnrollmentId(e,t)}static async generateSecret(e){var t,n;y(void 0!==(null===(t=e.user)||void 0===t?void 0:t.auth),"internal-error");let i=await k(n=e.user.auth,"POST","/v2/accounts/mfaEnrollment:start",x(n,{idToken:e.credential,totpEnrollmentInfo:{}}));return nb._fromStartTotpMfaEnrollmentResponse(i,e.user.auth)}}nw.FACTOR_ID="totp";class nI extends ny{constructor(e,t,n){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=n}static _fromSecret(e,t){return new nI(t,void 0,e)}static _fromEnrollmentId(e,t){return new nI(t,e)}async _finalizeEnroll(e,t,n){return y(void 0!==this.secret,e,"argument-error"),k(e,"POST","/v2/accounts/mfaEnrollment:finalize",x(e,{idToken:t,displayName:n,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)}))}async _finalizeSignIn(e,t){y(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let n={verificationCode:this.otp};return k(e,"POST","/v2/accounts/mfaSignIn:finalize",x(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:n}))}}class nb{constructor(e,t,n,i,r,s,o){this.sessionInfo=s,this.auth=o,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=n,this.codeIntervalSeconds=i,this.enrollmentCompletionDeadline=r}static _fromStartTotpMfaEnrollmentResponse(e,t){return new nb(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var n;let i=!1;return(nE(e)||nE(t))&&(i=!0),i&&(nE(e)&&(e=(null===(n=this.auth.currentUser)||void 0===n?void 0:n.email)||"unknownuser"),nE(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function nE(e){return void 0===e||(null==e?void 0:e.length)===0}var nT="@firebase/auth",nC="1.10.2";class nS{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let nx=(0,r.Pz)("authIdTokenMaxAge")||300,nk=null,nA=e=>async t=>{let n=t&&await t.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>nx)return;let r=null==n?void 0:n.token;nk!==r&&(nk=r,await fetch(e,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))};function nN(e=(0,i.Mq)()){let t=(0,i.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=(0,i.qX)(e,"auth");if(n.isInitialized()){let e=n.getImmediate(),i=n.getOptions();if((0,r.vZ)(i,null!=t?t:{}))return e;d(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:nm,persistence:[tV,tv,tE]}),s=(0,r.Pz)("authTokenSyncURL");if(s&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(s,location.origin);if(location.origin===e.origin){var o,a;let t=nA(e.toString());o=()=>t(n.currentUser),(0,r.m9)(n).beforeAuthStateChanged(t,o),a=e=>t(e),(0,r.m9)(n).onIdTokenChanged(a,void 0,void 0)}}let l=(0,r.q4)("auth");return l&&function(e,t,n){let i=eI(e);y(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let s=eP(t),{host:o,port:a}=function(e){let t=eP(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:eD(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:eD(t)}}}(t),l=null===a?"":`:${a}`,h={url:`${s}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){y(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),y((0,r.vZ)(h,i.config.emulator)&&(0,r.vZ)(u,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=h,i.emulatorConfig=u,i.settings.appVerificationDisabledForTesting=!0,function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}(),(0,r.Xx)(o)&&(0,r.Uo)(`${s}//${o}${l}`)}(n,`http://${l}`),n}eE={loadJS:e=>new Promise((t,n)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=f("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document})().appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},function(e){(0,i.Xd)(new a.wA("auth",(t,{options:n})=>{let i=t.getProvider("app").getImmediate(),r=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;y(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let l=new ew(i,r,s,{apiKey:o,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:em(e)});return function(e,t){let n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(en);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(l,n),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),(0,i.Xd)(new a.wA("auth-internal",e=>new nS(eI(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KN)(nT,nC,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(e)),(0,i.KN)(nT,nC,"esm2017")}("Browser")},109:(e,t,n)=>{"use strict";n.d(t,{hJ:()=>la,oe:()=>hl,JU:()=>ll,QT:()=>hr,PL:()=>ho,ad:()=>lf,IO:()=>lQ,pl:()=>ha,ar:()=>lJ});var i,r,s,o,a,l,h,u,c,d,f,p,g,m,y=n(2238),_=n(8463),v=n(3333),w=n(1683),I="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},b={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var r=0;16>r;++r)i[r]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],r=e.g[2];var s=e.g[3],o=t+(s^n&(r^s))+i[0]+0xd76aa478&0xffffffff;o=s+(r^(t=n+(o<<7&0xffffffff|o>>>25))&(n^r))+i[1]+0xe8c7b756&0xffffffff,o=r+(n^(s=t+(o<<12&0xffffffff|o>>>20))&(t^n))+i[2]+0x242070db&0xffffffff,o=n+(t^(r=s+(o<<17&0xffffffff|o>>>15))&(s^t))+i[3]+0xc1bdceee&0xffffffff,o=t+(s^(n=r+(o<<22&0xffffffff|o>>>10))&(r^s))+i[4]+0xf57c0faf&0xffffffff,o=s+(r^(t=n+(o<<7&0xffffffff|o>>>25))&(n^r))+i[5]+0x4787c62a&0xffffffff,o=r+(n^(s=t+(o<<12&0xffffffff|o>>>20))&(t^n))+i[6]+0xa8304613&0xffffffff,o=n+(t^(r=s+(o<<17&0xffffffff|o>>>15))&(s^t))+i[7]+0xfd469501&0xffffffff,o=t+(s^(n=r+(o<<22&0xffffffff|o>>>10))&(r^s))+i[8]+0x698098d8&0xffffffff,o=s+(r^(t=n+(o<<7&0xffffffff|o>>>25))&(n^r))+i[9]+0x8b44f7af&0xffffffff,o=r+(n^(s=t+(o<<12&0xffffffff|o>>>20))&(t^n))+i[10]+0xffff5bb1&0xffffffff,o=n+(t^(r=s+(o<<17&0xffffffff|o>>>15))&(s^t))+i[11]+0x895cd7be&0xffffffff,o=t+(s^(n=r+(o<<22&0xffffffff|o>>>10))&(r^s))+i[12]+0x6b901122&0xffffffff,o=s+(r^(t=n+(o<<7&0xffffffff|o>>>25))&(n^r))+i[13]+0xfd987193&0xffffffff,o=r+(n^(s=t+(o<<12&0xffffffff|o>>>20))&(t^n))+i[14]+0xa679438e&0xffffffff,o=n+(t^(r=s+(o<<17&0xffffffff|o>>>15))&(s^t))+i[15]+0x49b40821&0xffffffff,n=r+(o<<22&0xffffffff|o>>>10),o=t+(r^s&(n^r))+i[1]+0xf61e2562&0xffffffff,t=n+(o<<5&0xffffffff|o>>>27),o=s+(n^r&(t^n))+i[6]+0xc040b340&0xffffffff,s=t+(o<<9&0xffffffff|o>>>23),o=r+(t^n&(s^t))+i[11]+0x265e5a51&0xffffffff,r=s+(o<<14&0xffffffff|o>>>18),o=n+(s^t&(r^s))+i[0]+0xe9b6c7aa&0xffffffff,n=r+(o<<20&0xffffffff|o>>>12),o=t+(r^s&(n^r))+i[5]+0xd62f105d&0xffffffff,t=n+(o<<5&0xffffffff|o>>>27),o=s+(n^r&(t^n))+i[10]+0x2441453&0xffffffff,s=t+(o<<9&0xffffffff|o>>>23),o=r+(t^n&(s^t))+i[15]+0xd8a1e681&0xffffffff,r=s+(o<<14&0xffffffff|o>>>18),o=n+(s^t&(r^s))+i[4]+0xe7d3fbc8&0xffffffff,n=r+(o<<20&0xffffffff|o>>>12),o=t+(r^s&(n^r))+i[9]+0x21e1cde6&0xffffffff,t=n+(o<<5&0xffffffff|o>>>27),o=s+(n^r&(t^n))+i[14]+0xc33707d6&0xffffffff,s=t+(o<<9&0xffffffff|o>>>23),o=r+(t^n&(s^t))+i[3]+0xf4d50d87&0xffffffff,r=s+(o<<14&0xffffffff|o>>>18),o=n+(s^t&(r^s))+i[8]+0x455a14ed&0xffffffff,n=r+(o<<20&0xffffffff|o>>>12),o=t+(r^s&(n^r))+i[13]+0xa9e3e905&0xffffffff,t=n+(o<<5&0xffffffff|o>>>27),o=s+(n^r&(t^n))+i[2]+0xfcefa3f8&0xffffffff,s=t+(o<<9&0xffffffff|o>>>23),o=r+(t^n&(s^t))+i[7]+0x676f02d9&0xffffffff,r=s+(o<<14&0xffffffff|o>>>18),o=n+(s^t&(r^s))+i[12]+0x8d2a4c8a&0xffffffff,o=t+((n=r+(o<<20&0xffffffff|o>>>12))^r^s)+i[5]+0xfffa3942&0xffffffff,o=s+((t=n+(o<<4&0xffffffff|o>>>28))^n^r)+i[8]+0x8771f681&0xffffffff,o=r+((s=t+(o<<11&0xffffffff|o>>>21))^t^n)+i[11]+0x6d9d6122&0xffffffff,o=n+((r=s+(o<<16&0xffffffff|o>>>16))^s^t)+i[14]+0xfde5380c&0xffffffff,o=t+((n=r+(o<<23&0xffffffff|o>>>9))^r^s)+i[1]+0xa4beea44&0xffffffff,o=s+((t=n+(o<<4&0xffffffff|o>>>28))^n^r)+i[4]+0x4bdecfa9&0xffffffff,o=r+((s=t+(o<<11&0xffffffff|o>>>21))^t^n)+i[7]+0xf6bb4b60&0xffffffff,o=n+((r=s+(o<<16&0xffffffff|o>>>16))^s^t)+i[10]+0xbebfbc70&0xffffffff,o=t+((n=r+(o<<23&0xffffffff|o>>>9))^r^s)+i[13]+0x289b7ec6&0xffffffff,o=s+((t=n+(o<<4&0xffffffff|o>>>28))^n^r)+i[0]+0xeaa127fa&0xffffffff,o=r+((s=t+(o<<11&0xffffffff|o>>>21))^t^n)+i[3]+0xd4ef3085&0xffffffff,o=n+((r=s+(o<<16&0xffffffff|o>>>16))^s^t)+i[6]+0x4881d05&0xffffffff,o=t+((n=r+(o<<23&0xffffffff|o>>>9))^r^s)+i[9]+0xd9d4d039&0xffffffff,o=s+((t=n+(o<<4&0xffffffff|o>>>28))^n^r)+i[12]+0xe6db99e5&0xffffffff,o=r+((s=t+(o<<11&0xffffffff|o>>>21))^t^n)+i[15]+0x1fa27cf8&0xffffffff,o=n+((r=s+(o<<16&0xffffffff|o>>>16))^s^t)+i[2]+0xc4ac5665&0xffffffff,n=r+(o<<23&0xffffffff|o>>>9),o=t+(r^(n|~s))+i[0]+0xf4292244&0xffffffff,t=n+(o<<6&0xffffffff|o>>>26),o=s+(n^(t|~r))+i[7]+0x432aff97&0xffffffff,s=t+(o<<10&0xffffffff|o>>>22),o=r+(t^(s|~n))+i[14]+0xab9423a7&0xffffffff,r=s+(o<<15&0xffffffff|o>>>17),o=n+(s^(r|~t))+i[5]+0xfc93a039&0xffffffff,n=r+(o<<21&0xffffffff|o>>>11),o=t+(r^(n|~s))+i[12]+0x655b59c3&0xffffffff,t=n+(o<<6&0xffffffff|o>>>26),o=s+(n^(t|~r))+i[3]+0x8f0ccc92&0xffffffff,s=t+(o<<10&0xffffffff|o>>>22),o=r+(t^(s|~n))+i[10]+0xffeff47d&0xffffffff,r=s+(o<<15&0xffffffff|o>>>17),o=n+(s^(r|~t))+i[1]+0x85845dd1&0xffffffff,n=r+(o<<21&0xffffffff|o>>>11),o=t+(r^(n|~s))+i[8]+0x6fa87e4f&0xffffffff,t=n+(o<<6&0xffffffff|o>>>26),o=s+(n^(t|~r))+i[15]+0xfe2ce6e0&0xffffffff,s=t+(o<<10&0xffffffff|o>>>22),o=r+(t^(s|~n))+i[6]+0xa3014314&0xffffffff,r=s+(o<<15&0xffffffff|o>>>17),o=n+(s^(r|~t))+i[13]+0x4e0811a1&0xffffffff,n=r+(o<<21&0xffffffff|o>>>11),o=t+(r^(n|~s))+i[4]+0xf7537e82&0xffffffff,t=n+(o<<6&0xffffffff|o>>>26),o=s+(n^(t|~r))+i[11]+0xbd3af235&0xffffffff,s=t+(o<<10&0xffffffff|o>>>22),o=r+(t^(s|~n))+i[2]+0x2ad7d2bb&0xffffffff,r=s+(o<<15&0xffffffff|o>>>17),o=n+(s^(r|~t))+i[9]+0xeb86d391&0xffffffff,e.g[0]=e.g[0]+t&0xffffffff,e.g[1]=e.g[1]+(r+(o<<21&0xffffffff|o>>>11))&0xffffffff,e.g[2]=e.g[2]+r&0xffffffff,e.g[3]=e.g[3]+s&0xffffffff}function n(e,t){this.h=t;for(var n=[],i=!0,r=e.length-1;0<=r;r--){var s=0|e[r];i&&s==t||(n[r]=s,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,n){void 0===n&&(n=e.length);for(var i=n-this.blockSize,r=this.B,s=this.h,o=0;o<n;){if(0==s)for(;o<=i;)t(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<n;)if(r[s++]=e.charCodeAt(o++),s==this.blockSize){t(this,r),s=0;break}}else for(;o<n;)if(r[s++]=e[o++],s==this.blockSize){t(this,r),s=0;break}}this.h=s,this.o+=n},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var s,o={};function a(e){var t;return -128<=e&&128>e?(t=function(e){return new n([0|e],0>e?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new n([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(0>e)return p(l(-e));for(var t=[],i=1,r=0;e>=i;r++)t[r]=e/i|0,i*=0x100000000;return new n(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){for(var t=e.g.length,i=[],r=0;r<t;r++)i[r]=~e.g[r];return new n(i,~e.h).add(u)}function g(e,t){return e.add(p(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(30<e.g.length){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,i=t;0>=i.l(e);)n=v(n),i=v(i);var r=w(n,1),s=w(i,1);for(i=w(i,2),n=w(n,2);!d(i);){var o=s.add(i);0>=o.l(e)&&(r=r.add(n),s=o),i=w(i,1),n=w(n,1)}return t=g(e,r.j(t)),new y(r,t)}for(r=h;0<=e.l(t);){for(i=48>=(i=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,i-48),o=(s=l(n)).j(t);f(o)||0<o.l(e);)n-=i,o=(s=l(n)).j(t);d(s)&&(s=u),r=r.add(s),e=g(e,o)}return new y(r,e)}function v(e){for(var t=e.g.length+1,i=[],r=0;r<t;r++)i[r]=e.i(r)<<1|e.i(r-1)>>>31;return new n(i,e.h)}function w(e,t){var i=t>>5;t%=32;for(var r=e.g.length-i,s=[],o=0;o<r;o++)s[o]=0<t?e.i(o+i)>>>t|e.i(o+i+1)<<32-t:e.i(o+i);return new n(s,e.h)}(s=n.prototype).m=function(){if(f(this))return-p(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:0x100000000+i)*t,t*=0x100000000}return e},s.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,i="";;){var r=_(n,t).g,s=((0<(n=g(n,r.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(d(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},s.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=g(this,e))?-1:d(e)?0:1},s.abs=function(){return f(this)?p(this):this},s.add=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],r=0,s=0;s<=t;s++){var o=r+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);r=a>>>16,o&=65535,a&=65535,i[s]=a<<16|o}return new n(i,-0x80000000&i[i.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,i=[],r=0;r<2*t;r++)i[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var o=this.i(r)>>>16,a=65535&this.i(r),u=e.i(s)>>>16,g=65535&e.i(s);i[2*r+2*s]+=a*g,m(i,2*r+2*s),i[2*r+2*s+1]+=o*g,m(i,2*r+2*s+1),i[2*r+2*s+1]+=a*u,m(i,2*r+2*s+1),i[2*r+2*s+2]+=o*u,m(i,2*r+2*s+2)}for(r=0;r<t;r++)i[r]=i[2*r+1]<<16|i[2*r];for(r=t;r<2*t;r++)i[r]=0;return new n(i,0)},s.A=function(e){return _(this,e).h},s.and=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],r=0;r<t;r++)i[r]=this.i(r)&e.i(r);return new n(i,this.h&e.h)},s.or=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],r=0;r<t;r++)i[r]=this.i(r)|e.i(r);return new n(i,this.h|e.h)},s.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),i=[],r=0;r<t;r++)i[r]=this.i(r)^e.i(r);return new n(i,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,r=b.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=l,n.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=l(Math.pow(n,8)),r=h,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=l(Math.pow(n,o)),r=r.j(o).add(l(a))):r=(r=r.j(i)).add(l(a))}return r},i=b.Integer=n}).apply(void 0!==I?I:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var E="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},T={};(function(){var e,t,n,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof E&&E];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,t){if(t)e:{var n=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in n))break e;n=n[o]}(t=t(s=n[e=e[e.length-1]]))!=s&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}("Array.prototype.values",function(e){return e||function(){var e,t,n,i,r;return e=this,t=function(e,t){return t},e instanceof String&&(e+=""),n=0,i=!1,(r={next:function(){if(!i&&n<e.length){var r=n++;return{value:t(r,e[r]),done:!1}}return i=!0,{done:!0,value:void 0}}})[Symbol.iterator]=function(){return r},r}});var f=f||{},p=this||self;function g(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function m(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e,t,n){return e.call.apply(e.bind,arguments)}function _(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function v(e,t,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:_).apply(null,arguments)}function w(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function I(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return t.prototype[n].apply(e,r)}}function b(e){let t=e.length;if(0<t){let n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function C(e,t){for(let t=1;t<arguments.length;t++){let n=arguments[t];if(g(n)){let t=e.length||0,i=n.length||0;e.length=t+i;for(let r=0;r<i;r++)e[t+r]=n[r]}else e.push(n)}}class S{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function x(e){return/^[\s\xa0]*$/.test(e)}function k(){var e=p.navigator;return e&&(e=e.userAgent)?e:""}function A(e){return A[" "](e),e}A[" "]=function(){};var N=-1!=k().indexOf("Gecko")&&!(-1!=k().toLowerCase().indexOf("webkit")&&-1==k().indexOf("Edge"))&&!(-1!=k().indexOf("Trident")||-1!=k().indexOf("MSIE"))&&-1==k().indexOf("Edge");function R(e,t,n){for(let i in e)t.call(n,e[i],i,e)}function P(e){let t={};for(let n in e)t[n]=e[n];return t}let D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t])e[n]=i[n];for(let t=0;t<D.length;t++)n=D[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}class L{constructor(){this.h=this.g=null}add(e,t){let n=M.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}var M=new S(()=>new F,e=>e.reset());class F{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let U,V=!1,q=new L,B=()=>{let e=p.Promise.resolve(void 0);U=()=>{e.then(j)}};var j=()=>{let e;for(var t;e=null,q.g&&(e=q.g,q.g=q.g.next,q.g||(q.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){p.setTimeout(()=>{throw e},0)}(e)}M.j(t),100>M.h&&(M.h++,t.next=M.g,M.g=t)}V=!1};function z(){this.s=this.s,this.C=this.C}function $(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}z.prototype.s=!1,z.prototype.ma=function(){this.s||(this.s=!0,this.N())},z.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},$.prototype.h=function(){this.defaultPrevented=!0};var K=function(){if(!p.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};p.addEventListener("test",e,t),p.removeEventListener("test",e,t)}catch(e){}return e}();function G(e,t){if($.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(N){e:{try{A(t.nodeName);var r=!0;break e}catch(e){}r=!1}r||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:W[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&G.aa.h.call(this)}}I(G,$);var W={2:"touch",3:"pen",4:"mouse"};G.prototype.h=function(){G.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var H="closure_listenable_"+(1e6*Math.random()|0),Q=0;function Y(e,t,n,i,r){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=r,this.key=++Q,this.da=this.fa=!1}function J(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function X(e){this.src=e,this.g={},this.h=0}function Z(e,t){var n=t.type;if(n in e.g){var i,r=e.g[n],s=Array.prototype.indexOf.call(r,t,void 0);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(J(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function ee(e,t,n,i){for(var r=0;r<e.length;++r){var s=e[r];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==i)return r}return -1}X.prototype.add=function(e,t,n,i,r){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=ee(e,t,i,r);return -1<o?(t=e[o],n||(t.fa=!1)):((t=new Y(t,this.src,s,!!i,r)).fa=n,e.push(t)),t};var et="closure_lm_"+(1e6*Math.random()|0),en={};function ei(e,t,n,i,r,s){if(!t)throw Error("Invalid event type");var o=m(r)?!!r.capture:!!r,a=ea(e);if(a||(e[et]=a=new X(e)),(n=a.add(t,n,i,o,s)).proxy)return n;if(i=function e(t){return eo.call(e.src,e.listener,t)},n.proxy=i,i.src=e,i.listener=n,e.addEventListener)K||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),i,r);else if(e.attachEvent)e.attachEvent(es(t.toString()),i);else if(e.addListener&&e.removeListener)e.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return n}function er(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[H])Z(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(es(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ea(t))?(Z(n,e),0==n.h&&(n.src=null,t[et]=null)):J(e)}}}function es(e){return e in en?en[e]:en[e]="on"+e}function eo(e,t){if(e.da)e=!0;else{t=new G(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&er(e),e=n.call(i,t)}return e}function ea(e){return(e=e[et])instanceof X?e:null}var el="__closure_events_fn_"+(1e9*Math.random()>>>0);function eh(e){return"function"==typeof e?e:(e[el]||(e[el]=function(t){return e.handleEvent(t)}),e[el])}function eu(){z.call(this),this.i=new X(this),this.M=this,this.F=null}function ec(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new $(t,e);else if(t instanceof $)t.target=t.target||e;else{var r=t;O(t=new $(i,e),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];r=ed(o,i,!0,t)&&r}if(r=ed(o=t.g=e,i,!0,t)&&r,r=ed(o,i,!1,t)&&r,n)for(s=0;s<n.length;s++)r=ed(o=t.g=n[s],i,!1,t)&&r}function ed(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var r=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.da&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.fa&&Z(e.i,o),r=!1!==a.call(l,i)&&r}}return r&&!i.defaultPrevented}function ef(e,t,n){if("function"==typeof e)n&&(e=v(e,n));else if(e&&"function"==typeof e.handleEvent)e=v(e.handleEvent,e);else throw Error("Invalid listener argument");return 0x7fffffff<Number(t)?-1:p.setTimeout(e,t||0)}I(eu,z),eu.prototype[H]=!0,eu.prototype.removeEventListener=function(e,t,n,i){!function e(t,n,i,r,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);else(r=m(r)?!!r.capture:!!r,i=eh(i),t&&t[H])?(t=t.i,(n=String(n).toString())in t.g&&-1<(i=ee(o=t.g[n],i,r,s))&&(J(o[i]),Array.prototype.splice.call(o,i,1),0==o.length&&(delete t.g[n],t.h--))):t&&(t=ea(t))&&(n=t.g[n.toString()],t=-1,n&&(t=ee(n,i,r,s)),(i=-1<t?n[t]:null)&&er(i))}(this,e,t,n,i)},eu.prototype.N=function(){if(eu.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)J(n[i]);delete t.g[e],t.h--}}this.F=null},eu.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},eu.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class ep extends z{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=ef(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(p.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function eg(e){z.call(this),this.h=e,this.g={}}I(eg,z);var em=[];function ey(e){R(e.g,function(e,t){this.g.hasOwnProperty(t)&&er(e)},e),e.g={}}eg.prototype.N=function(){eg.aa.N.call(this),ey(this)},eg.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var e_=p.JSON.stringify,ev=p.JSON.parse,ew=class{stringify(e){return p.JSON.stringify(e,void 0)}parse(e){return p.JSON.parse(e,void 0)}};function eI(){}function eb(e){return e.h||(e.h=e.i())}function eE(){}eI.prototype.h=null;var eT={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function eC(){$.call(this,"d")}function eS(){$.call(this,"c")}I(eC,$),I(eS,$);var ex={},ek=null;function eA(){return ek=ek||new eu}function eN(e){$.call(this,ex.La,e)}function eR(e){let t=eA();ec(t,new eN(t))}function eP(e,t){$.call(this,ex.STAT_EVENT,e),this.stat=t}function eD(e){let t=eA();ec(t,new eP(t,e))}function eO(e,t){$.call(this,ex.Ma,e),this.size=t}function eL(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return p.setTimeout(function(){e()},t)}function eM(){this.g=!0}function eF(e,t,n,i){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}}return e_(n)}catch(e){return t}}(e,n)+(i?" "+i:"")})}ex.La="serverreachability",I(eN,$),ex.STAT_EVENT="statevent",I(eP,$),ex.Ma="timingevent",I(eO,$),eM.prototype.xa=function(){this.g=!1},eM.prototype.info=function(){};var eU={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},eV={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function eq(){}function eB(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new eg(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new ej}function ej(){this.i=null,this.g="",this.h=!1}I(eq,eI),eq.prototype.g=function(){return new XMLHttpRequest},eq.prototype.i=function(){return{}},t=new eq;var ez={},e$={};function eK(e,t,n){e.L=1,e.v=to(tt(t)),e.m=n,e.P=!0,eG(e,null)}function eG(e,t){e.F=Date.now(),eH(e),e.A=tt(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),tv(n.i,"t",i),e.C=0,n=e.j.J,e.h=new ej,e.g=t6(e.j,n?t:null,!e.m),0<e.O&&(e.M=new ep(v(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var r="readystatechange";Array.isArray(r)||(r&&(em[0]=r.toString()),r=em);for(var s=0;s<r.length;s++){var o=function e(t,n,i,r,s){if(r&&r.once)return function e(t,n,i,r,s){if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=eh(i),t&&t[H]?t.L(n,i,m(r)?!!r.capture:!!r,s):ei(t,n,i,!0,r,s)}(t,n,i,r,s);if(Array.isArray(n)){for(var o=0;o<n.length;o++)e(t,n[o],i,r,s);return null}return i=eh(i),t&&t[H]?t.K(n,i,m(r)?!!r.capture:!!r,s):ei(t,n,i,!1,r,s)}(n,r[s],i||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?P(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),eR(),function(e,t,n,i,r,s){e.info(function(){if(e.g){if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var h=a[l].split("=");if(1<h.length){var u=h[0];h=h[1];var c=u.split("_");o=2<=c.length&&"type"==c[1]?o+(u+"=")+h+"&":o+(u+"=redacted&")}}else o=null}else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+t+"\n"+n+"\n"+o})}(e.i,e.u,e.A,e.l,e.R,e.m)}function eW(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function eH(e){e.S=Date.now()+e.I,eQ(e,e.I)}function eQ(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=eL(v(e.ba,e),t)}function eY(e){e.B&&(p.clearTimeout(e.B),e.B=null)}function eJ(e){0==e.j.G||e.J||t0(e.j,e)}function eX(e){eY(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ey(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function eZ(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||e5(n.h,e))){if(!e.K&&e5(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){e:if(!n.u){if(n.g){if(n.g.F+3e3<e.F)tZ(n),tz(n);else break e}tY(n),eD(18)}}else n.za=r[1],0<n.za-n.T&&37500>r[2]&&n.F&&0==n.v&&!n.C&&(n.C=eL(v(n.Za,n),6e3));if(1>=e3(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else t2(n,11)}else if((e.K||n.g==e)&&tZ(n),!x(t))for(r=n.Da.g.parse(t),t=0;t<r.length;t++){let a=r[t];if(n.T=a[0],a=a[1],2==n.G){if("c"==a[0]){n.K=a[1],n.ia=a[2];let t=a[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));let r=a[4];null!=r&&(n.Aa=r,n.j.info("SVER="+n.Aa));let l=a[5];null!=l&&"number"==typeof l&&0<l&&(i=1.5*l,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=i.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(e6(s,s.h),s.h=null))}if(i.D){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,ts(i.I,i.D,e))}}if(n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms")),(i=n).qa=t5(i,i.J?i.ia:null,i.W),e.K){e8(i.h,e);var o=i.L;o&&(e.I=o),e.B&&(eY(e),eH(e)),i.g=e}else tQ(i);0<n.i.length&&tK(n)}else"stop"!=a[0]&&"close"!=a[0]||t2(n,7)}else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?t2(n,7):tj(n):"noop"!=a[0]&&n.l&&n.l.ta(a),n.v=0)}}eR(4)}catch(e){}}eB.prototype.ca=function(e){e=e.target;let t=this.M;t&&3==tU(e)?t.j():this.Y(e)},eB.prototype.Y=function(e){try{if(e==this.g)e:{let c=tU(this.g);var t=this.g.Ba();let d=this.g.Z();if(!(3>c)&&(3!=c||this.g&&(this.h.h||this.g.oa()||tV(this.g)))){this.J||4!=c||7==t||(8==t||0>=d?eR(3):eR(2)),eY(this);var n=this.g.Z();this.X=n;t:if(eW(this)){var i=tV(this.g);e="";var r=i.length,s=4==tU(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){eX(this),eJ(this);var o="";break t}this.h.i=new p.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(s&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.oa();if(this.o=200==n,function(e,t,n,i,r,s,o){e.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+t+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,c,n),this.o){if(this.T&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(a)){var h=a;break t}}h=null}if(n=h)eF(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,eZ(this,n);else{this.o=!1,this.s=3,eD(12),eX(this),eJ(this);break e}}if(this.P){let e;for(n=!0;!this.J&&this.C<o.length;)if((e=function(e,t){var n=e.C,i=t.indexOf("\n",n);return -1==i?e$:isNaN(n=Number(t.substring(n,i)))?ez:(i+=1)+n>t.length?e$:(t=t.slice(i,i+n),e.C=i+n,t)}(this,o))==e$){4==c&&(this.s=4,eD(14),n=!1),eF(this.i,this.l,null,"[Incomplete Response]");break}else if(e==ez){this.s=4,eD(15),eF(this.i,this.l,o,"[Invalid Chunk]"),n=!1;break}else eF(this.i,this.l,e,null),eZ(this,e);if(eW(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=c||0!=o.length||this.h.h||(this.s=1,eD(16),n=!1),this.o=this.o&&n,n){if(0<o.length&&!this.W){this.W=!0;var u=this.j;u.g==this&&u.ba&&!u.M&&(u.j.info("Great, no buffering proxy detected. Bytes received: "+o.length),tJ(u),u.M=!0,eD(11))}}else eF(this.i,this.l,o,"[Invalid Chunked Response]"),eX(this),eJ(this)}else eF(this.i,this.l,o,null),eZ(this,o);4==c&&eX(this),this.o&&!this.J&&(4==c?t0(this.j,this):(this.o=!1,eH(this)))}else(function(e){let t={};e=(e.g&&2<=tU(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(x(e[i]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[i]);let r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[r]||[];t[r]=s,s.push(n)}!function(e,t){for(let n in e)t.call(void 0,e[n],n,e)}(t,function(e){return e.join(", ")})})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,eD(12)):(this.s=0,eD(13)),eX(this),eJ(this)}}}catch(e){}finally{}},eB.prototype.cancel=function(){this.J=!0,eX(this)},eB.prototype.ba=function(){this.B=null;let e=Date.now();0<=e-this.S?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.A),2!=this.L&&(eR(),eD(17)),eX(this),this.s=2,eJ(this)):eQ(this,this.S-e)};var e0=class{constructor(e,t){this.g=e,this.map=t}};function e1(e){this.l=e||10,e=p.PerformanceNavigationTiming?0<(e=p.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(p.chrome&&p.chrome.loadTimes&&p.chrome.loadTimes()&&p.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function e2(e){return!!e.h||!!e.g&&e.g.size>=e.j}function e3(e){return e.h?1:e.g?e.g.size:0}function e5(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function e6(e,t){e.g?e.g.add(t):e.h=t}function e8(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function e4(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.D);return t}return b(e.i)}function e9(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(g(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(g(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(let i in t=[],n=0,e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(g(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),r=i.length,s=0;s<r;s++)t.call(void 0,i[s],n&&n[s],e)}e1.prototype.cancel=function(){if(this.i=e4(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var e7=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function te(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof te){this.h=e.h,tn(this,e.j),this.o=e.o,this.g=e.g,ti(this,e.s),this.l=e.l;var t=e.i,n=new tg;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),tr(this,n),this.m=e.m}else e&&(t=String(e).match(e7))?(this.h=!1,tn(this,t[1]||"",!0),this.o=ta(t[2]||""),this.g=ta(t[3]||"",!0),ti(this,t[4]),this.l=ta(t[5]||"",!0),tr(this,t[6]||"",!0),this.m=ta(t[7]||"")):(this.h=!1,this.i=new tg(null,this.h))}function tt(e){return new te(e)}function tn(e,t,n){e.j=n?ta(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ti(e,t){if(t){if(isNaN(t=Number(t))||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function tr(e,t,n){var i,r;t instanceof tg?(e.i=t,i=e.i,(r=e.h)&&!i.j&&(tm(i),i.i=null,i.g.forEach(function(e,t){var n=t.toLowerCase();t!=n&&(ty(this,t),tv(this,n,e))},i)),i.j=r):(n||(t=tl(t,tf)),e.i=new tg(t,e.h))}function ts(e,t,n){e.i.set(t,n)}function to(e){return ts(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function ta(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tl(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,th),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function th(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}te.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tl(t,tu,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(tl(t,tu,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tl(n,"/"==n.charAt(0)?td:tc,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",tl(n,tp)),e.join("")};var tu=/[#\/\?@]/g,tc=/[#\?:]/g,td=/[#\?]/g,tf=/[#\?@]/g,tp=/#/g;function tg(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function tm(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),r=null;if(0<=i){var s=e[n].substring(0,i);r=e[n].substring(i+1)}else s=e[n];t(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function ty(e,t){tm(e),t=tw(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function t_(e,t){return tm(e),t=tw(e,t),e.g.has(t)}function tv(e,t,n){ty(e,t),0<n.length&&(e.i=null,e.g.set(tw(e,t),b(n)),e.h+=n.length)}function tw(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function tI(e,t,n,i,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),i(n)}catch(e){}}function tb(){this.g=new ew}function tE(e){this.l=e.Ub||null,this.j=e.eb||!1}function tT(e,t){eu.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function tC(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function tS(e){e.readyState=4,e.l=null,e.j=null,e.v=null,tx(e)}function tx(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tk(e){let t="";return R(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tA(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=tk(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):ts(e,t,n))}function tN(e){eu.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(n=tg.prototype).add=function(e,t){tm(this),this.i=null,e=tw(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},n.forEach=function(e,t){tm(this),this.g.forEach(function(n,i){n.forEach(function(n){e.call(t,n,i,this)},this)},this)},n.na=function(){tm(this);let e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){let r=e[i];for(let e=0;e<r.length;e++)n.push(t[i])}return n},n.V=function(e){tm(this);let t=[];if("string"==typeof e)t_(this,e)&&(t=t.concat(this.g.get(tw(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},n.set=function(e,t){return tm(this),this.i=null,t_(this,e=tw(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},n.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];let s=encodeURIComponent(String(i)),o=this.V(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),e.push(r)}}return this.i=e.join("&")},I(tE,eI),tE.prototype.g=function(){return new tT(this.l,this.j)},tE.prototype.i=(e={},function(){return e}),I(tT,eu),(n=tT.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,tx(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||p).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,tS(this)),this.readyState=0},n.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,tx(this)),this.g&&(this.readyState=3,tx(this),this.g))){if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==p.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;tC(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))}},n.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?tS(this):tx(this),3==this.readyState&&tC(this)}},n.Ra=function(e){this.g&&(this.response=this.responseText=e,tS(this))},n.Qa=function(e){this.g&&(this.response=e,tS(this))},n.ga=function(){this.g&&tS(this)},n.setRequestHeader=function(e,t){this.u.append(e,t)},n.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tT.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),I(tN,eu);var tR=/^https?$/i,tP=["POST","PUT"];function tD(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,tO(e),tM(e)}function tO(e){e.A||(e.A=!0,ec(e,"complete"),ec(e,"error"))}function tL(e){if(e.h&&void 0!==f&&(!e.v[1]||4!=tU(e)||2!=e.Z())){if(e.u&&4==tU(e))ef(e.Ea,0,e);else if(ec(e,"readystatechange"),4==tU(e)){e.h=!1;try{let o=e.Z();switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,i=!0;break;default:i=!1}if(!(t=i)){if(n=0===o){var r=String(e.D).match(e7)[1]||null;!r&&p.self&&p.self.location&&(r=p.self.location.protocol.slice(0,-1)),n=!tR.test(r?r.toLowerCase():"")}t=n}if(t)ec(e,"complete"),ec(e,"success");else{e.m=6;try{var s=2<tU(e)?e.g.statusText:""}catch(e){s=""}e.l=s+" ["+e.Z()+"]",tO(e)}}finally{tM(e)}}}}function tM(e,t){if(e.g){tF(e);let n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||ec(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function tF(e){e.I&&(p.clearTimeout(e.I),e.I=null)}function tU(e){return e.g?e.g.readyState:0}function tV(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tq(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tB(e){this.Aa=0,this.i=[],this.j=new eM,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tq("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tq("baseRetryDelayMs",5e3,e),this.cb=tq("retryDelaySeedMs",1e4,e),this.Wa=tq("forwardChannelMaxRetries",2,e),this.wa=tq("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new e1(e&&e.concurrentRequestLimit),this.Da=new tb,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function tj(e){if(t$(e),3==e.G){var t=e.U++,n=tt(e.I);if(ts(n,"SID",e.K),ts(n,"RID",t),ts(n,"TYPE","terminate"),tW(e,n),(t=new eB(e,e.j,t)).L=2,t.v=to(tt(n)),n=!1,p.navigator&&p.navigator.sendBeacon)try{n=p.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&p.Image&&((new Image).src=t.v,n=!0),n||(t.g=t6(t.j,null),t.g.ea(t.v)),t.F=Date.now(),eH(t)}t3(e)}function tz(e){e.g&&(tJ(e),e.g.cancel(),e.g=null)}function t$(e){tz(e),e.u&&(p.clearTimeout(e.u),e.u=null),tZ(e),e.h.cancel(),e.s&&("number"==typeof e.s&&p.clearTimeout(e.s),e.s=null)}function tK(e){if(!e2(e.h)&&!e.s){e.s=!0;var t=e.Ga;U||B(),V||(U(),V=!0),q.add(t,e),e.B=0}}function tG(e,t){var n;n=t?t.l:e.U++;let i=tt(e.I);ts(i,"SID",e.K),ts(i,"RID",n),ts(i,"AID",e.T),tW(e,i),e.m&&e.o&&tA(i,e.m,e.o),n=new eB(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=tH(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),e6(e.h,n),eK(n,i,t)}function tW(e,t){e.H&&R(e.H,function(e,n){ts(t,n,e)}),e.l&&e9({},function(e,n){ts(t,n,e)})}function tH(e,t,n){n=Math.min(e.i.length,n);var i=e.l?v(e.l.Na,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?0<n?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=r[o].g,a=r[o].map;if(0>(n-=t))t=Math.max(0,r[o].g-100),s=!1;else try{!function(e,t,n){let i=n||"";try{e9(e,function(e,n){let r=e;m(e)&&(r=e_(e)),t.push(i+n+"="+encodeURIComponent(r))})}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(s){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function tQ(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;U||B(),V||(U(),V=!0),q.add(t,e),e.v=0}}function tY(e){return!e.g&&!e.u&&!(3<=e.v)&&(e.Y++,e.u=eL(v(e.Fa,e),t1(e,e.v)),e.v++,!0)}function tJ(e){null!=e.A&&(p.clearTimeout(e.A),e.A=null)}function tX(e){e.g=new eB(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=tt(e.qa);ts(t,"RID","rpc"),ts(t,"SID",e.K),ts(t,"AID",e.T),ts(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&ts(t,"TO",e.ja),ts(t,"TYPE","xmlhttp"),tW(e,t),e.m&&e.o&&tA(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=to(tt(t)),n.m=null,n.P=!0,eG(n,e)}function tZ(e){null!=e.C&&(p.clearTimeout(e.C),e.C=null)}function t0(e,t){var n=null;if(e.g==t){tZ(e),tJ(e),e.g=null;var i=2}else{if(!e5(e.h,t))return;n=t.D,e8(e.h,t),i=1}if(0!=e.G){if(t.o){if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var r,s=e.B;ec(i=eA(),new eO(i,n)),tK(e)}else tQ(e)}else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&(r=t,!(e3(e.h)>=e.h.j-(e.s?1:0))&&(e.s?(e.i=r.D.concat(e.i),!0):1!=e.G&&2!=e.G&&!(e.B>=(e.Va?0:e.Wa))&&(e.s=eL(v(e.Ga,e,r),t1(e,e.B)),e.B++,!0)))||2==i&&tY(e)))switch(n&&0<n.length&&((t=e.h).i=t.i.concat(n)),s){case 1:t2(e,5);break;case 4:t2(e,10);break;case 3:t2(e,6);break;default:t2(e,2)}}}function t1(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function t2(e,t){if(e.j.info("Error code "+t),2==t){var n=v(e.fb,e),i=e.Xa;let t=!i;i=new te(i||"//www.google.com/images/cleardot.gif"),p.location&&"http"==p.location.protocol||tn(i,"https"),to(i),t?function(e,t){let n=new eM;if(p.Image){let i=new Image;i.onload=w(tI,n,"TestLoadImage: loaded",!0,t,i),i.onerror=w(tI,n,"TestLoadImage: error",!1,t,i),i.onabort=w(tI,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=w(tI,n,"TestLoadImage: timeout",!1,t,i),p.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){let n=new eM,i=new AbortController,r=setTimeout(()=>{i.abort(),tI(n,"TestPingServer: timeout",!1,t)},1e4);fetch(e,{signal:i.signal}).then(e=>{clearTimeout(r),e.ok?tI(n,"TestPingServer: ok",!0,t):tI(n,"TestPingServer: server error",!1,t)}).catch(()=>{clearTimeout(r),tI(n,"TestPingServer: error",!1,t)})}(i.toString(),n)}else eD(2);e.G=0,e.l&&e.l.sa(t),t3(e),t$(e)}function t3(e){if(e.G=0,e.ka=[],e.l){let t=e4(e.h);(0!=t.length||0!=e.i.length)&&(C(e.ka,t),C(e.ka,e.i),e.h.i.length=0,b(e.i),e.i.length=0),e.l.ra()}}function t5(e,t,n){var i=n instanceof te?tt(n):new te(n);if(""!=i.g)t&&(i.g=t+"."+i.g),ti(i,i.s);else{var r=p.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var s=new te(null);i&&tn(s,i),t&&(s.g=t),r&&ti(s,r),n&&(s.l=n),i=s}return n=e.D,t=e.ya,n&&t&&ts(i,n,t),ts(i,"VER",e.la),tW(e,i),i}function t6(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tN(e.Ca&&!e.pa?new tE({eb:n}):e.pa)).Ha(e.J),t}function t8(){}function t4(){}function t9(e,t){eu.call(this),this.g=new tB(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!x(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!x(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new nt(this)}function t7(e){eC.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ne(){eS.call(this),this.status=1}function nt(e){this.g=e}(n=tN.prototype).Ha=function(e){this.J=e},n.ea=function(e,n,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);n=n?n.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():t.g(),this.v=this.o?eb(this.o):eb(t),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(n,String(e),!0),this.B=!1}catch(e){tD(this,e);return}if(e=i||"",i=new Map(this.headers),r){if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)i.set(s,r[s]);else if("function"==typeof r.keys&&"function"==typeof r.get)for(let e of r.keys())i.set(e,r.get(e));else throw Error("Unknown input type for opt_headers: "+String(r))}for(let[t,o]of(r=Array.from(i.keys()).find(e=>"content-type"==e.toLowerCase()),s=p.FormData&&e instanceof p.FormData,!(0<=Array.prototype.indexOf.call(tP,n,void 0))||r||s||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i))this.g.setRequestHeader(t,o);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tF(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){tD(this,e)}},n.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,ec(this,"complete"),ec(this,"abort"),tM(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tM(this,!0)),tN.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?tL(this):this.bb())},n.bb=function(){tL(this)},n.isActive=function(){return!!this.g},n.Z=function(){try{return 2<tU(this)?this.g.status:-1}catch(e){return -1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},n.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ev(t)}},n.Ba=function(){return this.m},n.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(n=tB.prototype).la=8,n.G=1,n.connect=function(e,t,n,i){eD(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=t5(this,null,this.W),tK(this)},n.Ga=function(e){if(this.s){if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;let r=new eB(this,this.j,e),s=this.o;if(this.S&&(s?O(s=P(s),this.S):s=this.S),null!==this.m||this.O||(r.H=s,s=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var i=this.i[n];if("__data__"in i.map&&"string"==typeof(i=i.map.__data__)){i=i.length;break t}i=void 0}if(void 0===i)break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tH(this,r,t),ts(n=tt(this.I),"RID",e),ts(n,"CVER",22),this.D&&ts(n,"X-HTTP-Session-Id",this.D),tW(this,n),s&&(this.O?t="headers="+encodeURIComponent(String(tk(s)))+"&"+t:this.m&&tA(n,this.m,s)),e6(this.h,r),this.Ua&&ts(n,"TYPE","init"),this.P?(ts(n,"$req",t),ts(n,"SID","null"),r.T=!0,eK(r,n,null)):eK(r,n,t),this.G=2}}else 3==this.G&&(e?tG(this,e):0==this.i.length||e2(this.h)||tG(this))}},n.Fa=function(){if(this.u=null,tX(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=eL(v(this.ab,this),e)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,eD(10),tz(this),tX(this))},n.Za=function(){null!=this.C&&(this.C=null,tz(this),tY(this),eD(19))},n.fb=function(e){e?(this.j.info("Successfully pinged google.com"),eD(2)):(this.j.info("Failed to ping google.com"),eD(1))},n.isActive=function(){return!!this.l&&this.l.isActive(this)},(n=t8.prototype).ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){},t4.prototype.g=function(e,t){return new t9(e,t)},I(t9,eu),t9.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},t9.prototype.close=function(){tj(this.g)},t9.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=e_(e),e=n);t.i.push(new e0(t.Ya++,e)),3==t.G&&tK(t)},t9.prototype.N=function(){this.g.l=null,delete this.j,tj(this.g),delete this.g,t9.aa.N.call(this)},I(t7,eC),I(ne,eS),I(nt,t8),nt.prototype.ua=function(){ec(this.g,"a")},nt.prototype.ta=function(e){ec(this.g,new t7(e))},nt.prototype.sa=function(e){ec(this.g,new ne)},nt.prototype.ra=function(){ec(this.g,"b")},t4.prototype.createWebChannel=t4.prototype.g,t9.prototype.send=t9.prototype.o,t9.prototype.open=t9.prototype.m,t9.prototype.close=t9.prototype.close,d=T.createWebChannelTransport=function(){return new t4},c=T.getStatEventTarget=function(){return eA()},u=T.Event=ex,h=T.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},eU.NO_ERROR=0,eU.TIMEOUT=8,eU.HTTP_ERROR=6,l=T.ErrorCode=eU,eV.COMPLETE="complete",a=T.EventType=eV,eE.EventType=eT,eT.OPEN="a",eT.CLOSE="b",eT.ERROR="c",eT.MESSAGE="d",eu.prototype.listen=eu.prototype.K,o=T.WebChannel=eE,T.FetchXmlHttpFactory=tE,tN.prototype.listenOnce=tN.prototype.L,tN.prototype.getLastError=tN.prototype.Ka,tN.prototype.getLastErrorCode=tN.prototype.Ba,tN.prototype.getStatus=tN.prototype.Z,tN.prototype.getResponseJson=tN.prototype.Oa,tN.prototype.getResponseText=tN.prototype.oa,tN.prototype.send=tN.prototype.ea,tN.prototype.setWithCredentials=tN.prototype.Ha,s=T.XhrIo=tN}).apply(void 0!==E?E:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var C=n(4155),S=n(8764).lW;let x="@firebase/firestore",k="4.7.12";class A{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}A.UNAUTHENTICATED=new A(null),A.GOOGLE_CREDENTIALS=new A("google-credentials-uid"),A.FIRST_PARTY=new A("first-party-uid"),A.MOCK_USER=new A("mock-user");let N="11.7.0",R=new v.Yd("@firebase/firestore");function P(){return R.logLevel}function D(e,...t){if(R.logLevel<=v.in.DEBUG){let n=t.map(M);R.debug(`Firestore (${N}): ${e}`,...n)}}function O(e,...t){if(R.logLevel<=v.in.ERROR){let n=t.map(M);R.error(`Firestore (${N}): ${e}`,...n)}}function L(e,...t){if(R.logLevel<=v.in.WARN){let n=t.map(M);R.warn(`Firestore (${N}): ${e}`,...n)}}function M(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function F(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,U(e,i,n)}function U(e,t,n){let i=`FIRESTORE (${N}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw O(i),Error(i)}function V(e,t,n,i){let r="Unexpected state";"string"==typeof n?r=n:i=n,e||U(t,r,i)}let q={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class B extends w.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class j{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class z{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ${getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(A.UNAUTHENTICATED))}shutdown(){}}class K{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class G{constructor(e){this.t=e,this.currentUser=A.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){V(void 0===this.o,42304);let n=this.i,i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),r=new j;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new j,e.enqueueRetryable(()=>i(this.currentUser))};let s=()=>{let t=r;e.enqueueRetryable(async()=>{await t.promise,await i(this.currentUser)})},o=e=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new j)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(V("string"==typeof t.accessToken,31837,{l:t}),new z(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return V(null===e||"string"==typeof e,2055,{h:e}),new A(e)}}class W{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=A.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class H{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new W(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(A.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Q{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Y{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,y.rh)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){V(void 0===this.o,3512);let n=e=>{null!=e.error&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,D("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let i=e=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>i(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?i(e):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Q(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(V("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Q(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function J(){return new TextEncoder}class X{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function Z(e,t){return e<t?-1:e>t?1:0}function ee(e,t){let n=0;for(;n<e.length&&n<t.length;){let i=e.codePointAt(n),r=t.codePointAt(n);if(i!==r){if(i<128&&r<128)return Z(i,r);{let s=J(),o=function(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return Z(e[n],t[n]);return Z(e.length,t.length)}(s.encode(et(e,n)),s.encode(et(t,n)));return 0!==o?o:Z(i,r)}}n+=i>65535?2:1}return Z(e.length,t.length)}function et(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function en(e,t,n){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}class ei{static now(){return ei.fromMillis(Date.now())}static fromDate(e){return ei.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new ei(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new B(q.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new B(q.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Z(this.nanoseconds,e.nanoseconds):Z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class er{static fromTimestamp(e){return new er(e)}static min(){return new er(new ei(0,0))}static max(){return new er(new ei(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let es="__name__";class eo{constructor(e,t,n){void 0===t?t=0:t>e.length&&F(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&F(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===eo.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof eo?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let n=eo.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return Z(e.length,t.length)}static compareSegments(e,t){let n=eo.isNumericId(e),i=eo.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?eo.extractNumericId(e).compare(eo.extractNumericId(t)):ee(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return i.fromString(e.substring(4,e.length-2))}}class ea extends eo{construct(e,t,n){return new ea(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new B(q.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new ea(t)}static emptyPath(){return new ea([])}}let el=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class eh extends eo{construct(e,t,n){return new eh(e,t,n)}static isValidIdentifier(e){return el.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),eh.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===es}static keyField(){return new eh([es])}static fromServerFormat(e){let t=[],n="",i=0,r=()=>{if(0===n.length)throw new B(q.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;i<e.length;){let t=e[i];if("\\"===t){if(i+1===e.length)throw new B(q.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new B(q.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?s=!s:"."!==t||s?n+=t:r(),i++}if(r(),s)throw new B(q.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new eh(t)}static emptyPath(){return new eh([])}}class eu{constructor(e){this.path=e}static fromPath(e){return new eu(ea.fromString(e))}static fromName(e){return new eu(ea.fromString(e).popFirst(5))}static empty(){return new eu(ea.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ea.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ea.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new eu(new ea(e.slice()))}}class ec{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function ed(e){return e.fields.find(e=>2===e.kind)}function ef(e){return e.fields.filter(e=>2!==e.kind)}ec.UNKNOWN_ID=-1;class ep{constructor(e,t){this.fieldPath=e,this.kind=t}}class eg{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new eg(0,e_.min())}}function em(e,t){let n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1;return new e_(er.fromTimestamp(1e9===i?new ei(n+1,0):new ei(n,i)),eu.empty(),t)}function ey(e){return new e_(e.readTime,e.key,-1)}class e_{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new e_(er.min(),eu.empty(),-1)}static max(){return new e_(er.max(),eu.empty(),-1)}}function ev(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=eu.comparator(e.documentKey,t.documentKey))?n:Z(e.largestBatchId,t.largestBatchId)}let ew="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eI{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eb(e){if(e.code!==q.FAILED_PRECONDITION||e.message!==ew)throw e;D("LocalStore","Unexpectedly lost primary lease")}class eE{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eE((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof eE?t:eE.resolve(t)}catch(e){return eE.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eE.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eE.reject(t)}static resolve(e){return new eE((t,n)=>{t(e)})}static reject(e){return new eE((t,n)=>{n(e)})}static waitFor(e){return new eE((t,n)=>{let i=0,r=0,s=!1;e.forEach(e=>{++i,e.next(()=>{++r,s&&r===i&&t()},e=>n(e))}),s=!0,r===i&&t()})}static or(e){let t=eE.resolve(!1);for(let n of e)t=t.next(e=>e?eE.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,i)=>{n.push(t.call(this,e,i))}),this.waitFor(n)}static mapArray(e,t){return new eE((n,i)=>{let r=e.length,s=Array(r),o=0;for(let a=0;a<r;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===r&&n(s)},e=>i(e))}})}static doWhile(e,t){return new eE((n,i)=>{let r=()=>{!0===e()?t().next(()=>{r()},i):n()};r()})}}let eT="SimpleDb";class eC{static open(e,t,n,i){try{return new eC(t,e.transaction(i,n))}catch(e){throw new eA(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new j,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new eA(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{let n=eO(t.target.error);this.S.reject(new eA(e,n))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(D(eT,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eR(this.transaction.objectStore(e))}}class eS{static delete(e){return D(eT,"Removing database:",e),eP((0,w.Rd)().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,w.hl)())return!1;if(eS.F())return!0;let e=(0,w.z$)(),t=eS.M(e),n=ex(e);return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||0<t&&t<10||0<n&&n<4.5)}static F(){var e;return void 0!==C&&"YES"===(null===(e=C.__PRIVATE_env)||void 0===e?void 0:e.O)}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,12.2===eS.M((0,w.z$)())&&O("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async k(e){return this.db||(D(eT,"Opening database:",this.name),this.db=await new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=e=>{t(e.target.result)},i.onblocked=()=>{n(new eA(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=t=>{let i=t.target.error;"VersionError"===i.name?n(new B(q.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===i.name?n(new B(q.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+i)):n(new eA(e,i))},i.onupgradeneeded=e=>{D(eT,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.L&&this.L!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.B.q(t,i.transaction,e.oldVersion,this.version).next(()=>{D(eT,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.L=t.version},{passive:!0})),this.$&&(this.db.onversionchange=e=>this.$(e)),this.db}U(e){this.$=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,i){let r="readonly"===t,s=0;for(;;){++s;try{this.db=await this.k(e);let t=eC.open(this.db,e,r?"readonly":"readwrite",n),s=i(t).next(e=>(t.v(),e)).catch(e=>(t.abort(e),eE.reject(e))).toPromise();return s.catch(()=>{}),await t.D,s}catch(t){let e="FirebaseError"!==t.name&&s<3;if(D(eT,"Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ex(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class ek{constructor(e){this.K=e,this.W=!1,this.G=null}get isDone(){return this.W}get j(){return this.G}set cursor(e){this.K=e}done(){this.W=!0}H(e){this.G=e}delete(){return eP(this.K.delete())}}class eA extends B{constructor(e,t){super(q.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function eN(e){return"IndexedDbTransactionError"===e.name}class eR{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(D(eT,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(D(eT,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),eP(n)}add(e){return D(eT,"ADD",this.store.name,e,e),eP(this.store.add(e))}get(e){return eP(this.store.get(e)).next(t=>(void 0===t&&(t=null),D(eT,"GET",this.store.name,e,t),t))}delete(e){return D(eT,"DELETE",this.store.name,e),eP(this.store.delete(e))}count(){return D(eT,"COUNT",this.store.name),eP(this.store.count())}J(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){let e=i.getAll(n.range);return new eE((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(n),t=[];return this.Y(e,(e,n)=>{t.push(n)}).next(()=>t)}}Z(e,t){let n=this.store.getAll(e,null===t?void 0:t);return new eE((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}})}X(e,t){D(eT,"DELETE ALL",this.store.name);let n=this.options(e,t);n.ee=!1;let i=this.cursor(n);return this.Y(i,(e,t,n)=>n.delete())}te(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.Y(i,t)}ne(e){let t=this.cursor({});return new eE((n,i)=>{t.onerror=e=>{i(eO(e.target.error))},t.onsuccess=t=>{let i=t.target.result;i?e(i.primaryKey,i.value).next(e=>{e?i.continue():n()}):n()}})}Y(e,t){let n=[];return new eE((i,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{let r=e.target.result;if(!r)return void i();let s=new ek(r),o=t(r.primaryKey,r.value,s);if(o instanceof eE){let e=o.catch(e=>(s.done(),eE.reject(e)));n.push(e)}s.isDone?i():null===s.j?r.continue():r.continue(s.j)}}).next(()=>eE.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.ee?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function eP(e){return new eE((t,n)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{n(eO(e.target.error))}})}let eD=!1;function eO(e){let t=eS.M((0,w.z$)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new B("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eD||(eD=!0,setTimeout(()=>{throw e},0)),e}}return e}let eL="IndexBackfiller";class eM{constructor(e,t){this.asyncQueue=e,this.re=t,this.task=null}start(){this.ie(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}ie(e){D(eL,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.re.se();D(eL,`Documents written: ${e}`)}catch(e){eN(e)?D(eL,"Ignoring IndexedDB error during index backfill: ",e):await eb(e)}await this.ie(6e4)})}}class eF{constructor(e,t){this.localStore=e,this.persistence=t}async se(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.oe(t,e))}oe(e,t){let n=new Set,i=t,r=!0;return eE.doWhile(()=>!0===r&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!n.has(t))return D(eL,`Processing collection: ${t}`),this._e(e,t,i).next(e=>{i-=e,n.add(t)});r=!1})).next(()=>t-i)}_e(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(n=>{let r=n.changes;return this.localStore.indexManager.updateIndexEntries(e,r).next(()=>this.ae(i,n)).next(n=>(D(eL,`Updating offset: ${n}`),this.localStore.indexManager.updateCollectionGroup(e,t,n))).next(()=>r.size)}))}ae(e,t){let n=e;return t.changes.forEach((e,t)=>{let i=ey(t);ev(i,n)>0&&(n=i)}),new e_(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}class eU{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ue(e),this.ce=e=>t.writeSequenceNumber(e))}ue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ce&&this.ce(e),e}}function eV(e){return null==e}function eq(e){return 0===e&&1/e==-1/0}function eB(e){return"number"==typeof e&&Number.isInteger(e)&&!eq(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}function ej(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,i=e.length;for(let t=0;t<i;t++){let i=e.charAt(t);switch(i){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=i}}return n}(e.get(n),t);return t+"\x01\x01"}function ez(e){let t=e.length;if(V(t>=2,64408,{path:e}),2===t)return V("\x01"===e.charAt(0)&&"\x01"===e.charAt(1),56145,{path:e}),ea.emptyPath();let n=t-2,i=[],r="";for(let s=0;s<t;){let t=e.indexOf("\x01",s);switch((t<0||t>n)&&F(50515,{path:e}),e.charAt(t+1)){case"\x01":let o;let a=e.substring(s,t);0===r.length?o=a:(r+=a,o=r,r=""),i.push(o);break;case"\x10":r+=e.substring(s,t),r+="\0";break;case"\x11":r+=e.substring(s,t+1);break;default:F(61167,{path:e})}s=t+2}return new ea(i)}eU.le=-1;let e$="remoteDocuments",eK="owner",eG="owner",eW="mutationQueues",eH="mutations",eQ="batchId",eY="userMutationsIndex",eJ=["userId","batchId"],eX={},eZ="documentMutations",e0="remoteDocumentsV14",e1=["prefixPath","collectionGroup","readTime","documentId"],e2="documentKeyIndex",e3=["prefixPath","collectionGroup","documentId"],e5="collectionGroupIndex",e6=["collectionGroup","readTime","prefixPath","documentId"],e8="remoteDocumentGlobal",e4="remoteDocumentGlobalKey",e9="targets",e7="queryTargetsIndex",te=["canonicalId","targetId"],tt="targetDocuments",tn=["targetId","path"],ti="documentTargetsIndex",tr=["path","targetId"],ts="targetGlobalKey",to="targetGlobal",ta="collectionParents",tl=["collectionId","parent"],th="clientMetadata",tu="bundles",tc="namedQueries",td="indexConfiguration",tf="collectionGroupIndex",tp="indexState",tg=["indexId","uid"],tm="sequenceNumberIndex",ty=["uid","sequenceNumber"],t_="indexEntries",tv=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tw="documentKeyIndex",tI=["indexId","uid","orderedDocumentKey"],tb="documentOverlays",tE=["userId","collectionPath","documentId"],tT="collectionPathOverlayIndex",tC=["userId","collectionPath","largestBatchId"],tS="collectionGroupOverlayIndex",tx=["userId","collectionGroup","largestBatchId"],tk="globals",tA=[eW,eH,eZ,e$,e9,eK,to,tt,th,e8,ta,tu,tc],tN=[...tA,tb],tR=[eW,eH,eZ,e0,e9,eK,to,tt,th,e8,ta,tu,tc,tb],tP=[...tR,td,tp,t_],tD=[...tP,tk];class tO extends eI{constructor(e,t){super(),this.he=e,this.currentSequenceNumber=t}}function tL(e,t){return eS.N(e.he,t)}function tM(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function tF(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function tU(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class tV{constructor(e,t){this.comparator=e,this.root=t||tB.EMPTY}insert(e,t){return new tV(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,tB.BLACK,null,null))}remove(e){return new tV(this.comparator,this.root.remove(e,this.comparator).copy(null,null,tB.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new tq(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new tq(this.root,e,this.comparator,!1)}getReverseIterator(){return new tq(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new tq(this.root,e,this.comparator,!0)}}class tq{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,t&&i&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class tB{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:tB.RED,this.left=null!=i?i:tB.EMPTY,this.right=null!=r?r:tB.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,r){return new tB(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return tB.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,i=this;if(0>t(e,i.key))i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return tB.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,tB.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,tB.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw F(27949);return e+(this.isRed()?0:1)}}tB.EMPTY=null,tB.RED=!0,tB.BLACK=!1,tB.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(e,t,n,i,r){return this}insert(e,t,n){return new tB(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class tj{constructor(e){this.comparator=e,this.data=new tV(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tz(this.data.getIterator())}getIteratorFrom(e){return new tz(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof tj)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new tj(this.comparator);return t.data=e,t}}class tz{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function t$(e){return e.hasNext()?e.getNext():void 0}class tK{constructor(e){this.fields=e,e.sort(eh.comparator)}static empty(){return new tK([])}unionWith(e){let t=new tj(eh.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new tK(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return en(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class tG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class tW{constructor(e){this.binaryString=e}static fromBase64String(e){return new tW(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new tG("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new tW(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tW.EMPTY_BYTE_STRING=new tW("");let tH=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function tQ(e){if(V(!!e,39018),"string"==typeof e){let t=0,n=tH.exec(e);if(V(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:tY(e.seconds),nanos:tY(e.nanos)}}function tY(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function tJ(e){return"string"==typeof e?tW.fromBase64String(e):tW.fromUint8Array(e)}let tX="server_timestamp",tZ="__type__",t0="__previous_value__",t1="__local_write_time__";function t2(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[tZ])||void 0===n?void 0:n.stringValue)===tX}function t3(e){let t=e.mapValue.fields[t0];return t2(t)?t3(t):t}function t5(e){let t=tQ(e.mapValue.fields[t1].timestampValue);return new ei(t.seconds,t.nanos)}class t6{constructor(e,t,n,i,r,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}let t8="(default)";class t4{constructor(e,t){this.projectId=e,this.database=t||t8}static empty(){return new t4("","")}get isDefaultDatabase(){return this.database===t8}isEqual(e){return e instanceof t4&&e.projectId===this.projectId&&e.database===this.database}}let t9="__type__",t7="__max__",ne={mapValue:{fields:{__type__:{stringValue:t7}}}},nt="__vector__",nn="value",ni={nullValue:"NULL_VALUE"};function nr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?t2(e)?4:nv(e)?0x1fffffffffffff:ny(e)?10:11:F(28295,{value:e})}function ns(e,t){if(e===t)return!0;let n=nr(e);if(n!==nr(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return t5(e).isEqual(t5(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let n=tQ(e.timestampValue),i=tQ(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return tJ(e.bytesValue).isEqual(tJ(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return tY(e.geoPointValue.latitude)===tY(t.geoPointValue.latitude)&&tY(e.geoPointValue.longitude)===tY(t.geoPointValue.longitude);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return tY(e.integerValue)===tY(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=tY(e.doubleValue),i=tY(t.doubleValue);return n===i?eq(n)===eq(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return en(e.arrayValue.values||[],t.arrayValue.values||[],ns);case 10:case 11:return function(e,t){let n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(tM(n)!==tM(i))return!1;for(let e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!ns(n[e],i[e])))return!1;return!0}(e,t);default:return F(52216,{left:e})}}function no(e,t){return void 0!==(e.values||[]).find(e=>ns(e,t))}function na(e,t){if(e===t)return 0;let n=nr(e),i=nr(t);if(n!==i)return Z(n,i);switch(n){case 0:case 0x1fffffffffffff:return 0;case 1:return Z(e.booleanValue,t.booleanValue);case 2:return function(e,t){let n=tY(e.integerValue||e.doubleValue),i=tY(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return nl(e.timestampValue,t.timestampValue);case 4:return nl(t5(e),t5(t));case 5:return ee(e.stringValue,t.stringValue);case 6:return function(e,t){let n=tJ(e),i=tJ(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){let n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){let t=Z(n[e],i[e]);if(0!==t)return t}return Z(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){let n=Z(tY(e.latitude),tY(t.latitude));return 0!==n?n:Z(tY(e.longitude),tY(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return nh(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,r,s;let o=e.fields||{},a=t.fields||{},l=null===(n=o[nn])||void 0===n?void 0:n.arrayValue,h=null===(i=a[nn])||void 0===i?void 0:i.arrayValue,u=Z((null===(r=null==l?void 0:l.values)||void 0===r?void 0:r.length)||0,(null===(s=null==h?void 0:h.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:nh(l,h)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===ne.mapValue&&t===ne.mapValue)return 0;if(e===ne.mapValue)return 1;if(t===ne.mapValue)return -1;let n=e.fields||{},i=Object.keys(n),r=t.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let e=0;e<i.length&&e<s.length;++e){let t=ee(i[e],s[e]);if(0!==t)return t;let o=na(n[i[e]],r[s[e]]);if(0!==o)return o}return Z(i.length,s.length)}(e.mapValue,t.mapValue);default:throw F(23264,{Pe:n})}}function nl(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Z(e,t);let n=tQ(e),i=tQ(t),r=Z(n.seconds,i.seconds);return 0!==r?r:Z(n.nanos,i.nanos)}function nh(e,t){let n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){let t=na(n[e],i[e]);if(t)return t}return Z(n.length,i.length)}function nu(e){var t,n;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){let t=tQ(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?tJ(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,eu.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let i of e.values||[])n?n=!1:t+=",",t+=nu(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",i=!0;for(let r of t)i?i=!1:n+=",",n+=`${r}:${nu(e.fields[r])}`;return n+"}"}(e.mapValue):F(61005,{value:e})}function nc(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function nd(e){return!!e&&"integerValue"in e}function nf(e){return!!e&&"arrayValue"in e}function np(e){return!!e&&"nullValue"in e}function ng(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nm(e){return!!e&&"mapValue"in e}function ny(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[t9])||void 0===n?void 0:n.stringValue)===nt}function n_(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return tF(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=n_(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=n_(e.arrayValue.values[n]);return t}return Object.assign({},e)}function nv(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===t7}let nw={mapValue:{fields:{[t9]:{stringValue:nt},[nn]:{arrayValue:{}}}}};function nI(e,t){let n=na(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nb(e,t){let n=na(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nE{constructor(e){this.value=e}static empty(){return new nE({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!nm(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=n_(t)}setAll(e){let t=eh.emptyPath(),n={},i=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){let e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=r.popLast()}e?n[r.lastSegment()]=n_(e):i.push(r.lastSegment())});let r=this.getFieldsMap(t);this.applyChanges(r,n,i)}delete(e){let t=this.field(e.popLast());nm(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ns(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];nm(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){for(let i of(tF(t,(t,n)=>e[t]=n),n))delete e[i]}clone(){return new nE(n_(this.value))}}class nT{constructor(e,t,n,i,r,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(e){return new nT(e,0,er.min(),er.min(),er.min(),nE.empty(),0)}static newFoundDocument(e,t,n,i){return new nT(e,1,t,er.min(),n,i,0)}static newNoDocument(e,t){return new nT(e,2,t,er.min(),er.min(),nE.empty(),0)}static newUnknownDocument(e,t){return new nT(e,3,t,er.min(),er.min(),nE.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(er.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nE.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nE.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=er.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nT&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nT(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class nC{constructor(e,t){this.position=e,this.inclusive=t}}function nS(e,t,n){let i=0;for(let r=0;r<e.position.length;r++){let s=t[r],o=e.position[r];if(i=s.field.isKeyField()?eu.comparator(eu.fromName(o.referenceValue),n.key):na(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function nx(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ns(e.position[n],t.position[n]))return!1;return!0}class nk{constructor(e,t="asc"){this.field=e,this.dir=t}}class nA{}class nN extends nA{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new nF(e,t,n):"array-contains"===t?new nB(e,n):"in"===t?new nj(e,n):"not-in"===t?new nz(e,n):"array-contains-any"===t?new n$(e,n):new nN(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new nU(e,n):new nV(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(na(t,this.value)):null!==t&&nr(this.value)===nr(t)&&this.matchesComparison(na(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nR extends nA{constructor(e,t){super(),this.filters=e,this.op=t,this.Te=null}static create(e,t){return new nR(e,t)}matches(e){return nP(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function nP(e){return"and"===e.op}function nD(e){return"or"===e.op}function nO(e){return nL(e)&&nP(e)}function nL(e){for(let t of e.filters)if(t instanceof nR)return!1;return!0}function nM(e,t){let n=e.filters.concat(t);return nR.create(n,e.op)}class nF extends nN{constructor(e,t,n){super(e,t,n),this.key=eu.fromName(n.referenceValue)}matches(e){let t=eu.comparator(e.key,this.key);return this.matchesComparison(t)}}class nU extends nN{constructor(e,t){super(e,"in",t),this.keys=nq("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class nV extends nN{constructor(e,t){super(e,"not-in",t),this.keys=nq("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function nq(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map(e=>eu.fromName(e.referenceValue))}class nB extends nN{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nf(t)&&no(t.arrayValue,this.value)}}class nj extends nN{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&no(this.value.arrayValue,t)}}class nz extends nN{constructor(e,t){super(e,"not-in",t)}matches(e){if(no(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!no(this.value.arrayValue,t)}}class n$ extends nN{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!nf(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>no(this.value.arrayValue,e))}}class nK{constructor(e,t=null,n=[],i=[],r=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.Ie=null}}function nG(e,t=null,n=[],i=[],r=null,s=null,o=null){return new nK(e,t,n,i,r,s,o)}function nW(e){if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof nN)return t.field.canonicalString()+t.op.toString()+nu(t.value);if(nO(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:"+(e.startAt.inclusive?"b:":"a:"),t+=e.startAt.position.map(e=>nu(e)).join(",")),e.endAt&&(t+="|ub:"+(e.endAt.inclusive?"a:":"b:"),t+=e.endAt.position.map(e=>nu(e)).join(",")),e.Ie=t}return e.Ie}function nH(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++){var n,i;if(n=e.orderBy[r],i=t.orderBy[r],!(n.dir===i.dir&&n.field.isEqual(i.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof nN?n instanceof nN&&t.op===n.op&&t.field.isEqual(n.field)&&ns(t.value,n.value):t instanceof nR?n instanceof nR&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,i,r)=>t&&e(i,n.filters[r]),!0):void F(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!nx(e.startAt,t.startAt)&&nx(e.endAt,t.endAt)}function nQ(e){return eu.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function nY(e,t){return e.filters.filter(e=>e instanceof nN&&e.field.isEqual(t))}function nJ(e,t,n){let i=ni,r=!0;for(let n of nY(e,t)){let e=ni,t=!0;switch(n.op){case"<":case"<=":var s;e="nullValue"in(s=n.value)?ni:"booleanValue"in s?{booleanValue:!1}:"integerValue"in s||"doubleValue"in s?{doubleValue:NaN}:"timestampValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in s?{stringValue:""}:"bytesValue"in s?{bytesValue:""}:"referenceValue"in s?nc(t4.empty(),eu.empty()):"geoPointValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in s?{arrayValue:{}}:"mapValue"in s?ny(s)?nw:{mapValue:{}}:F(35942,{value:s});break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=ni}0>nI({value:i,inclusive:r},{value:e,inclusive:t})&&(i=e,r=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];0>nI({value:i,inclusive:r},{value:e,inclusive:n.inclusive})&&(i=e,r=n.inclusive);break}}return{value:i,inclusive:r}}function nX(e,t,n){let i=ne,r=!0;for(let n of nY(e,t)){let e=ne,t=!0;switch(n.op){case">=":case">":var s;e="nullValue"in(s=n.value)?{booleanValue:!1}:"booleanValue"in s?{doubleValue:NaN}:"integerValue"in s||"doubleValue"in s?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in s?{stringValue:""}:"stringValue"in s?{bytesValue:""}:"bytesValue"in s?nc(t4.empty(),eu.empty()):"referenceValue"in s?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in s?{arrayValue:{}}:"arrayValue"in s?nw:"mapValue"in s?ny(s)?{mapValue:{}}:ne:F(61959,{value:s}),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=ne}nb({value:i,inclusive:r},{value:e,inclusive:t})>0&&(i=e,r=t)}if(null!==n){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=n.position[s];nb({value:i,inclusive:r},{value:e,inclusive:n.inclusive})>0&&(i=e,r=n.inclusive);break}}return{value:i,inclusive:r}}class nZ{constructor(e,t=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function n0(e){return new nZ(e)}function n1(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function n2(e){return null!==e.collectionGroup}function n3(e){if(null===e.Ee){let t;e.Ee=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ee.push(t),n.add(t.field.canonicalString());let i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new tj(eh.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ee.push(new nk(t,i))}),n.has(eh.keyField().canonicalString())||e.Ee.push(new nk(eh.keyField(),i))}return e.Ee}function n5(e){return e.de||(e.de=function(e,t){if("F"===e.limitType)return nG(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new nk(e.field,t)});let n=e.endAt?new nC(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new nC(e.startAt.position,e.startAt.inclusive):null;return nG(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(e,n3(e))),e.de}function n6(e,t){let n=e.filters.concat([t]);return new nZ(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function n8(e,t,n){return new nZ(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function n4(e,t){return nH(n5(e),n5(t))&&e.limitType===t.limitType}function n9(e){return`${nW(n5(e))}|lt:${e.limitType}`}function n7(e){var t;let n;return`Query(target=${n=(t=n5(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof nN?`${t.field.canonicalString()} ${t.op} ${nu(t.value)}`:t instanceof nR?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: "+(t.startAt.inclusive?"b:":"a:"),n+=t.startAt.position.map(e=>nu(e)).join(",")),t.endAt&&(n+=", endAt: "+(t.endAt.inclusive?"a:":"b:"),n+=t.endAt.position.map(e=>nu(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function ie(e,t){return t.isFoundDocument()&&function(e,t){let n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):eu.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(let n of n3(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(!e.startAt||!!function(e,t,n){let i=nS(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,n3(e),t))&&(!e.endAt||!!function(e,t,n){let i=nS(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,n3(e),t))}function it(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function ii(e){return(t,n)=>{let i=!1;for(let r of n3(e)){let e=function(e,t,n){let i=e.field.isKeyField()?eu.comparator(t.key,n.key):function(e,t,n){let i=t.data.field(e),r=n.data.field(e);return null!==i&&null!==r?na(i,r):F(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return -1*i;default:return F(19790,{direction:e.dir})}}(r,t,n);if(0!==e)return e;i=i||r.field.isKeyField()}return 0}}class ir{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,i]of n)if(this.equalsFn(t,e))return i}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){tF(this.inner,(t,n)=>{for(let[t,i]of n)e(t,i)})}isEmpty(){return tU(this.inner)}size(){return this.innerSize}}let is=new tV(eu.comparator),io=new tV(eu.comparator);function ia(...e){let t=io;for(let n of e)t=t.insert(n.key,n);return t}function il(e){let t=io;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function ih(){return new ir(e=>e.toString(),(e,t)=>e.isEqual(t))}let iu=new tV(eu.comparator),ic=new tj(eu.comparator);function id(...e){let t=ic;for(let n of e)t=t.add(n);return t}let ip=new tj(Z);function ig(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:eq(t)?"-0":t}}function im(e){return{integerValue:""+e}}function iy(e,t){return eB(t)?im(t):ig(e,t)}class i_{constructor(){this._=void 0}}function iv(e,t){return e instanceof iC?nd(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class iw extends i_{}class iI extends i_{constructor(e){super(),this.elements=e}}function ib(e,t){let n=ix(t);for(let t of e.elements)n.some(e=>ns(e,t))||n.push(t);return{arrayValue:{values:n}}}class iE extends i_{constructor(e){super(),this.elements=e}}function iT(e,t){let n=ix(t);for(let t of e.elements)n=n.filter(e=>!ns(e,t));return{arrayValue:{values:n}}}class iC extends i_{constructor(e,t){super(),this.serializer=e,this.Re=t}}function iS(e){return tY(e.integerValue||e.doubleValue)}function ix(e){return nf(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ik{constructor(e,t){this.field=e,this.transform=t}}class iA{constructor(e,t){this.version=e,this.transformResults=t}}class iN{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new iN}static exists(e){return new iN(void 0,e)}static updateTime(e){return new iN(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function iR(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class iP{}function iD(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new iB(e.key,iN.none()):new iM(e.key,e.data,iN.none());{let n=e.data,i=nE.empty(),r=new tj(eh.comparator);for(let e of t.fields)if(!r.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),r=r.add(e)}return new iF(e.key,i,new tK(r.toArray()),iN.none())}}function iO(e,t,n,i){return e instanceof iM?function(e,t,n,i){if(!iR(e.precondition,t))return n;let r=e.value.clone(),s=iq(e.fieldTransforms,i,t);return r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,n,i):e instanceof iF?function(e,t,n,i){if(!iR(e.precondition,t))return n;let r=iq(e.fieldTransforms,i,t),s=t.data;return(s.setAll(iU(e)),s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,i):iR(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function iL(e,t){var n,i;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,i=t.fieldTransforms,!!(void 0===n&&void 0===i||!(!n||!i)&&en(n,i,(e,t)=>{var n,i;return e.field.isEqual(t.field)&&(n=e.transform,i=t.transform,n instanceof iI&&i instanceof iI||n instanceof iE&&i instanceof iE?en(n.elements,i.elements,ns):n instanceof iC&&i instanceof iC?ns(n.Re,i.Re):n instanceof iw&&i instanceof iw)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class iM extends iP{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class iF extends iP{constructor(e,t,n,i,r=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function iU(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let i=e.data.field(n);t.set(n,i)}}),t}function iV(e,t,n){let i=new Map;V(e.length===n.length,32656,{Ve:n.length,me:e.length});for(let s=0;s<n.length;s++){var r;let o=e[s],a=o.transform,l=t.data.field(o.field);i.set(o.field,(r=n[s],a instanceof iI?ib(a,l):a instanceof iE?iT(a,l):r))}return i}function iq(e,t,n){let i=new Map;for(let r of e){let e=r.transform,s=n.data.field(r.field);i.set(r.field,e instanceof iw?function(e,t){let n={fields:{[tZ]:{stringValue:tX},[t1]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&t2(t)&&(t=t3(t)),t&&(n.fields[t0]=t),{mapValue:n}}(t,s):e instanceof iI?ib(e,s):e instanceof iE?iT(e,s):function(e,t){let n=iv(e,t),i=iS(n)+iS(e.Re);return nd(n)&&nd(e.Re)?im(i):ig(e.serializer,i)}(e,s))}return i}class iB extends iP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ij extends iP{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class iz{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];if(r.key.isEqual(e.key)){var i;i=n[t],r instanceof iM?function(e,t,n){let i=e.value.clone(),r=iV(e.fieldTransforms,t,n.transformResults);i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(r,e,i):r instanceof iF?function(e,t,n){if(!iR(e.precondition,t))return void t.convertToUnknownDocument(n.version);let i=iV(e.fieldTransforms,t,n.transformResults),r=t.data;r.setAll(iU(e)),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(r,e,i):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,i)}}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=iO(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=iO(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=ih();return this.mutations.forEach(i=>{let r=e.get(i.key),s=r.overlayedDocument,o=this.applyToLocalView(s,r.mutatedFields),a=iD(s,o=t.has(i.key)?null:o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(er.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),id())}isEqual(e){return this.batchId===e.batchId&&en(this.mutations,e.mutations,(e,t)=>iL(e,t))&&en(this.baseMutations,e.baseMutations,(e,t)=>iL(e,t))}}class i${constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){V(e.mutations.length===n.length,58842,{fe:e.mutations.length,ge:n.length});let i=iu,r=e.mutations;for(let e=0;e<r.length;e++)i=i.insert(r[e].key,n[e].version);return new i$(e,t,n,i)}}class iK{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iG{constructor(e,t){this.count=e,this.unchangedNames=t}}function iW(e){if(void 0===e)return O("GRPC error has no .code"),q.UNKNOWN;switch(e){case f.OK:return q.OK;case f.CANCELLED:return q.CANCELLED;case f.UNKNOWN:return q.UNKNOWN;case f.DEADLINE_EXCEEDED:return q.DEADLINE_EXCEEDED;case f.RESOURCE_EXHAUSTED:return q.RESOURCE_EXHAUSTED;case f.INTERNAL:return q.INTERNAL;case f.UNAVAILABLE:return q.UNAVAILABLE;case f.UNAUTHENTICATED:return q.UNAUTHENTICATED;case f.INVALID_ARGUMENT:return q.INVALID_ARGUMENT;case f.NOT_FOUND:return q.NOT_FOUND;case f.ALREADY_EXISTS:return q.ALREADY_EXISTS;case f.PERMISSION_DENIED:return q.PERMISSION_DENIED;case f.FAILED_PRECONDITION:return q.FAILED_PRECONDITION;case f.ABORTED:return q.ABORTED;case f.OUT_OF_RANGE:return q.OUT_OF_RANGE;case f.UNIMPLEMENTED:return q.UNIMPLEMENTED;case f.DATA_LOSS:return q.DATA_LOSS;default:return F(39323,{code:e})}}(p=f||(f={}))[p.OK=0]="OK",p[p.CANCELLED=1]="CANCELLED",p[p.UNKNOWN=2]="UNKNOWN",p[p.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",p[p.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",p[p.NOT_FOUND=5]="NOT_FOUND",p[p.ALREADY_EXISTS=6]="ALREADY_EXISTS",p[p.PERMISSION_DENIED=7]="PERMISSION_DENIED",p[p.UNAUTHENTICATED=16]="UNAUTHENTICATED",p[p.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",p[p.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",p[p.ABORTED=10]="ABORTED",p[p.OUT_OF_RANGE=11]="OUT_OF_RANGE",p[p.UNIMPLEMENTED=12]="UNIMPLEMENTED",p[p.INTERNAL=13]="INTERNAL",p[p.UNAVAILABLE=14]="UNAVAILABLE",p[p.DATA_LOSS=15]="DATA_LOSS";let iH=new i([0xffffffff,0xffffffff],0);function iQ(e){let t=J().encode(e),n=new r;return n.update(t),new Uint8Array(n.digest())}function iY(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new i([n,r],0),new i([s,o],0)]}class iJ{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new iX(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new iX(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new iX(`Invalid padding when bitmap length is 0: ${t}`);this.pe=8*e.length-t,this.ye=i.fromNumber(this.pe)}we(e,t,n){let r=e.add(t.multiply(i.fromNumber(n)));return 1===r.compare(iH)&&(r=new i([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.pe)return!1;let[t,n]=iY(iQ(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);if(!this.be(i))return!1}return!0}static create(e,t,n){let i=new iJ(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>i.insert(e)),i}insert(e){if(0===this.pe)return;let[t,n]=iY(iQ(e));for(let e=0;e<this.hashCount;e++){let i=this.we(t,n,e);this.Se(i)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class iX extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class iZ{constructor(e,t,n,i,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,i0.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new iZ(er.min(),i,new tV(Z),is,id())}}class i0{constructor(e,t,n,i,r){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new i0(n,t,id(),id(),id())}}class i1{constructor(e,t,n,i){this.De=e,this.removedTargetIds=t,this.key=n,this.ve=i}}class i2{constructor(e,t){this.targetId=e,this.Ce=t}}class i3{constructor(e,t,n=tW.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class i5{constructor(){this.Fe=0,this.Me=i4(),this.xe=tW.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(e){e.approximateByteSize()>0&&(this.Ne=!0,this.xe=e)}qe(){let e=id(),t=id(),n=id();return this.Me.forEach((i,r)=>{switch(r){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:F(38017,{changeType:r})}}),new i0(this.xe,this.Oe,e,t,n)}Qe(){this.Ne=!1,this.Me=i4()}$e(e,t){this.Ne=!0,this.Me=this.Me.insert(e,t)}Ue(e){this.Ne=!0,this.Me=this.Me.remove(e)}Ke(){this.Fe+=1}We(){this.Fe-=1,V(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class i6{constructor(e){this.ze=e,this.je=new Map,this.He=is,this.Je=i8(),this.Ye=i8(),this.Ze=new tV(Z)}Xe(e){for(let t of e.De)e.ve&&e.ve.isFoundDocument()?this.et(t,e.ve):this.tt(t,e.key,e.ve);for(let t of e.removedTargetIds)this.tt(t,e.key,e.ve)}nt(e){this.forEachTarget(e,t=>{let n=this.rt(t);switch(e.state){case 0:this.it(t)&&n.ke(e.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(e.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(t);break;case 3:this.it(t)&&(n.Ge(),n.ke(e.resumeToken));break;case 4:this.it(t)&&(this.st(t),n.ke(e.resumeToken));break;default:F(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.je.forEach((e,n)=>{this.it(n)&&t(n)})}ot(e){let t=e.targetId,n=e.Ce.count,i=this._t(t);if(i){let r=i.target;if(nQ(r)){if(0===n){let e=new eu(r.path);this.tt(t,e,nT.newNoDocument(e,er.min()))}else V(1===n,20013,{expectedCount:n})}else{let i=this.ut(t);if(i!==n){let n=this.ct(e),r=n?this.lt(n,e,i):1;0!==r&&(this.st(t),this.Ze=this.Ze.insert(t,2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ct(e){let t,n;let i=e.Ce.unchangedNames;if(!i||!i.bits)return null;let{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=i;try{t=tJ(r).toUint8Array()}catch(e){if(e instanceof tG)return L("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new iJ(t,s,o)}catch(e){return L(e instanceof iX?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.pe?null:n}lt(e,t,n){return t.Ce.count===n-this.Tt(e,t.targetId)?0:2}Tt(e,t){let n=this.ze.getRemoteKeysForTarget(t),i=0;return n.forEach(n=>{let r=this.ze.Pt(),s=`projects/${r.projectId}/databases/${r.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.tt(t,n,null),i++)}),i}It(e){let t=new Map;this.je.forEach((n,i)=>{let r=this._t(i);if(r){if(n.current&&nQ(r.target)){let t=new eu(r.target.path);this.Et(t).has(i)||this.dt(i,t)||this.tt(i,t,nT.newNoDocument(t,e))}n.Le&&(t.set(i,n.qe()),n.Qe())}});let n=id();this.Ye.forEach((e,t)=>{let i=!0;t.forEachWhile(e=>{let t=this._t(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)}),i&&(n=n.add(e))}),this.He.forEach((t,n)=>n.setReadTime(e));let i=new iZ(e,t,this.Ze,this.He,n);return this.He=is,this.Je=i8(),this.Ye=i8(),this.Ze=new tV(Z),i}et(e,t){if(!this.it(e))return;let n=this.dt(e,t.key)?2:0;this.rt(e).$e(t.key,n),this.He=this.He.insert(t.key,t),this.Je=this.Je.insert(t.key,this.Et(t.key).add(e)),this.Ye=this.Ye.insert(t.key,this.At(t.key).add(e))}tt(e,t,n){if(!this.it(e))return;let i=this.rt(e);this.dt(e,t)?i.$e(t,1):i.Ue(t),this.Ye=this.Ye.insert(t,this.At(t).delete(e)),this.Ye=this.Ye.insert(t,this.At(t).add(e)),n&&(this.He=this.He.insert(t,n))}removeTarget(e){this.je.delete(e)}ut(e){let t=this.rt(e).qe();return this.ze.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ke(e){this.rt(e).Ke()}rt(e){let t=this.je.get(e);return t||(t=new i5,this.je.set(e,t)),t}At(e){let t=this.Ye.get(e);return t||(t=new tj(Z),this.Ye=this.Ye.insert(e,t)),t}Et(e){let t=this.Je.get(e);return t||(t=new tj(Z),this.Je=this.Je.insert(e,t)),t}it(e){let t=null!==this._t(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}_t(e){let t=this.je.get(e);return t&&t.Be?null:this.ze.Rt(e)}st(e){this.je.set(e,new i5),this.ze.getRemoteKeysForTarget(e).forEach(t=>{this.tt(e,t,null)})}dt(e,t){return this.ze.getRemoteKeysForTarget(e).has(t)}}function i8(){return new tV(eu.comparator)}function i4(){return new tV(eu.comparator)}let i9={asc:"ASCENDING",desc:"DESCENDING"},i7={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},re={and:"AND",or:"OR"};class rt{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function rn(e,t){return e.useProto3Json||null==t?t:{value:t}}function ri(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function rr(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function rs(e){return V(!!e,49232),er.fromTimestamp(function(e){let t=tQ(e);return new ei(t.seconds,t.nanos)}(e))}function ro(e,t){return ra(e,t).canonicalString()}function ra(e,t){let n=new ea(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function rl(e){let t=ea.fromString(e);return V(rT(t),10190,{key:t.toString()}),t}function rh(e,t){return ro(e.databaseId,t.path)}function ru(e,t){let n=rl(t);if(n.get(1)!==e.databaseId.projectId)throw new B(q.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new B(q.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new eu(rp(n))}function rc(e,t){return ro(e.databaseId,t)}function rd(e){let t=rl(e);return 4===t.length?ea.emptyPath():rp(t)}function rf(e){return new ea(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function rp(e){return V(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function rg(e,t,n){return{name:rh(e,t),fields:n.value.mapValue.fields}}function rm(e,t,n){let i=ru(e,t.name),r=rs(t.updateTime),s=t.createTime?rs(t.createTime):er.min(),o=new nE({mapValue:{fields:t.fields}}),a=nT.newFoundDocument(i,r,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function ry(e,t){var n;let i;if(t instanceof iM)i={update:rg(e,t.key,t.value)};else if(t instanceof iB)i={delete:rh(e,t.key)};else if(t instanceof iF)i={update:rg(e,t.key,t.data),updateMask:function(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}(t.fieldMask)};else{if(!(t instanceof ij))return F(16599,{ft:t.type});i={verify:rh(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof iw)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof iI)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof iE)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof iC)return{fieldPath:t.field.canonicalString(),increment:n.Re};throw F(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:ri(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:F(27497)),i}function r_(e,t){var n;let i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?iN.updateTime(rs(n.updateTime)):void 0!==n.exists?iN.exists(n.exists):iN.none():iN.none(),r=t.updateTransforms?t.updateTransforms.map(t=>{let n;return n=null,"setToServerValue"in t?(V("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),n=new iw):"appendMissingElements"in t?n=new iI(t.appendMissingElements.values||[]):"removeAllFromArray"in t?n=new iE(t.removeAllFromArray.values||[]):"increment"in t?n=new iC(e,t.increment):F(16584,{proto:t}),new ik(eh.fromServerFormat(t.fieldPath),n)}):[];if(t.update){t.update.name;let n=ru(e,t.update.name),s=new nE({mapValue:{fields:t.update.fields}});return t.updateMask?new iF(n,s,new tK((t.updateMask.fieldPaths||[]).map(e=>eh.fromServerFormat(e))),i,r):new iM(n,s,i,r)}return t.delete?new iB(ru(e,t.delete),i):t.verify?new ij(ru(e,t.verify),i):F(1463,{proto:t})}function rv(e,t){return{documents:[rc(e,t.path)]}}function rw(e,t){var n,i;let r;let s={structuredQuery:{}},o=t.path;null!==t.collectionGroup?(r=o,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=o.popLast(),s.structuredQuery.from=[{collectionId:o.lastSegment()}]),s.parent=rc(e,r);let a=function(e){if(0!==e.length)return function e(t){return t instanceof nN?function(e){if("=="===e.op){if(ng(e.value))return{unaryFilter:{field:rb(e.field),op:"IS_NAN"}};if(np(e.value))return{unaryFilter:{field:rb(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(ng(e.value))return{unaryFilter:{field:rb(e.field),op:"IS_NOT_NAN"}};if(np(e.value))return{unaryFilter:{field:rb(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:rb(e.field),op:i7[e.op],value:e.value}}}(t):t instanceof nR?function(t){let n=t.getFilters().map(t=>e(t));return 1===n.length?n[0]:{compositeFilter:{op:re[t.op],filters:n}}}(t):F(54877,{filter:t})}(nR.create(e,"and"))}(t.filters);a&&(s.structuredQuery.where=a);let l=function(e){if(0!==e.length)return e.map(e=>({field:rb(e.field),direction:i9[e.dir]}))}(t.orderBy);l&&(s.structuredQuery.orderBy=l);let h=rn(e,t.limit);return null!==h&&(s.structuredQuery.limit=h),t.startAt&&(s.structuredQuery.startAt={before:(n=t.startAt).inclusive,values:n.position}),t.endAt&&(s.structuredQuery.endAt={before:!(i=t.endAt).inclusive,values:i.position}),{gt:s,parent:r}}function rI(e){var t;let n,i=rd(e.parent),r=e.structuredQuery,s=r.from?r.from.length:0,o=null;if(s>0){V(1===s,65062);let e=r.from[0];e.allDescendants?o=e.collectionId:i=i.child(e.collectionId)}let a=[];r.where&&(a=function(e){let t=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=rE(e.unaryFilter.field);return nN.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=rE(e.unaryFilter.field);return nN.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let i=rE(e.unaryFilter.field);return nN.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let r=rE(e.unaryFilter.field);return nN.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}}(t):void 0!==t.fieldFilter?nN.create(rE(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?nR.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return F(1026)}}(t.compositeFilter.op)):F(30097,{filter:t})}(e);return t instanceof nR&&nO(t)?t.getFilters():[t]}(r.where));let l=[];r.orderBy&&(l=r.orderBy.map(e=>new nk(rE(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let h=null;r.limit&&(h=null==(n="object"==typeof(t=r.limit)?t.value:t)?null:n);let u=null;r.startAt&&(u=function(e){let t=!!e.before;return new nC(e.values||[],t)}(r.startAt));let c=null;return r.endAt&&(c=function(e){let t=!e.before;return new nC(e.values||[],t)}(r.endAt)),new nZ(i,o,l,a,h,"F",u,c)}function rb(e){return{fieldPath:e.canonicalString()}}function rE(e){return eh.fromServerFormat(e.fieldPath)}function rT(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class rC{constructor(e,t,n,i,r=er.min(),s=er.min(),o=tW.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new rC(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new rC(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new rC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new rC(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class rS{constructor(e){this.wt=e}}function rx(e,t){let n=t.key,i={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:rk(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument()){var r;i.document={name:rh(r=e.wt,t.key),fields:t.data.value.mapValue.fields,updateTime:ri(r,t.version.toTimestamp()),createTime:ri(r,t.createTime.toTimestamp())}}else if(t.isNoDocument())i.noDocument={path:n.path.toArray(),readTime:rA(t.version)};else{if(!t.isUnknownDocument())return F(57904,{document:t});i.unknownDocument={path:n.path.toArray(),version:rA(t.version)}}return i}function rk(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function rA(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function rN(e){let t=new ei(e.seconds,e.nanoseconds);return er.fromTimestamp(t)}function rR(e,t){let n=(t.baseMutations||[]).map(t=>r_(e.wt,t));for(let e=0;e<t.mutations.length-1;++e){let n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let i=t.mutations[e+1];n.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let i=t.mutations.map(t=>r_(e.wt,t)),r=ei.fromMillis(t.localWriteTimeMs);return new iz(t.batchId,r,n,i)}function rP(e){let t=rN(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?rN(e.lastLimboFreeSnapshotVersion):er.min();return new rC(void 0!==e.query.documents?function(e){let t=e.documents.length;return V(1===t,1966,{count:t}),n5(n0(rd(e.documents[0])))}(e.query):n5(rI(e.query)),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,n,tW.fromBase64String(e.resumeToken))}function rD(e,t){let n;let i=rA(t.snapshotVersion),r=rA(t.lastLimboFreeSnapshotVersion);n=nQ(t.target)?rv(e.wt,t.target):rw(e.wt,t.target).gt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:nW(t.target),readTime:i,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:n}}function rO(e){let t=rI({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?n8(t,t.limit,"L"):t}function rL(e,t){return new iK(t.largestBatchId,r_(e.wt,t.overlayMutation))}function rM(e,t){let n=t.path.lastSegment();return[e,ej(t.path.popLast()),n]}function rF(e,t,n,i){return{indexId:e,uid:t,sequenceNumber:n,readTime:rA(i.readTime),documentKey:ej(i.documentKey.path),largestBatchId:i.largestBatchId}}class rU{getBundleMetadata(e,t){return tL(e,tu).get(t).next(e=>{if(e)return{id:e.bundleId,createTime:rN(e.createTime),version:e.version}})}saveBundleMetadata(e,t){return tL(e,tu).put({bundleId:t.id,createTime:rA(rs(t.createTime)),version:t.version})}getNamedQuery(e,t){return tL(e,tc).get(t).next(e=>{if(e)return{name:e.name,query:rO(e.bundledQuery),readTime:rN(e.readTime)}})}saveNamedQuery(e,t){return tL(e,tc).put({name:t.name,readTime:rA(rs(t.readTime)),bundledQuery:t.bundledQuery})}}class rV{constructor(e,t){this.serializer=e,this.userId=t}static bt(e,t){return new rV(e,t.uid||"")}getOverlay(e,t){return tL(e,tb).get(rM(this.userId,t)).next(e=>e?rL(this.serializer,e):null)}getOverlays(e,t){let n=ih();return eE.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((n,r)=>{let s=new iK(t,r);i.push(this.St(e,s))}),eE.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(e=>i.add(ej(e.getCollectionPath())));let r=[];return i.forEach(t=>{let i=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);r.push(tL(e,tb).X(tT,i))}),eE.waitFor(r)}getOverlaysForCollection(e,t,n){let i=ih(),r=ej(t),s=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return tL(e,tb).J(tT,s).next(e=>{for(let t of e){let e=rL(this.serializer,t);i.set(e.getKey(),e)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let r;let s=ih(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return tL(e,tb).te({index:tS,range:o},(e,t,n)=>{let o=rL(this.serializer,t);s.size()<i||o.largestBatchId===r?(s.set(o.getKey(),o),r=o.largestBatchId):n.done()}).next(()=>s)}St(e,t){return tL(e,tb).put(function(e,t,n){let[i,r,s]=rM(t,n.mutation.key);return{userId:t,collectionPath:r,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:ry(e.wt,n.mutation)}}(this.serializer,this.userId,t))}}class rq{Dt(e){return tL(e,tk)}getSessionToken(e){return this.Dt(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?tW.fromUint8Array(t):tW.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Dt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class rB{constructor(){}vt(e,t){this.Ct(e,t),t.Ft()}Ct(e,t){if("nullValue"in e)this.Mt(t,5);else if("booleanValue"in e)this.Mt(t,10),t.xt(e.booleanValue?1:0);else if("integerValue"in e)this.Mt(t,15),t.xt(tY(e.integerValue));else if("doubleValue"in e){let n=tY(e.doubleValue);isNaN(n)?this.Mt(t,13):(this.Mt(t,15),eq(n)?t.xt(0):t.xt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Mt(t,20),"string"==typeof n&&(n=tQ(n)),t.Ot(`${n.seconds||""}`),t.xt(n.nanos||0)}else if("stringValue"in e)this.Nt(e.stringValue,t),this.Bt(t);else if("bytesValue"in e)this.Mt(t,30),t.Lt(tJ(e.bytesValue)),this.Bt(t);else if("referenceValue"in e)this.kt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Mt(t,45),t.xt(n.latitude||0),t.xt(n.longitude||0)}else"mapValue"in e?nv(e)?this.Mt(t,Number.MAX_SAFE_INTEGER):ny(e)?this.qt(e.mapValue,t):(this.Qt(e.mapValue,t),this.Bt(t)):"arrayValue"in e?(this.$t(e.arrayValue,t),this.Bt(t)):F(19022,{Ut:e})}Nt(e,t){this.Mt(t,25),this.Kt(e,t)}Kt(e,t){t.Ot(e)}Qt(e,t){let n=e.fields||{};for(let e of(this.Mt(t,55),Object.keys(n)))this.Nt(e,t),this.Ct(n[e],t)}qt(e,t){var n,i;let r=e.fields||{};this.Mt(t,53);let s=(null===(i=null===(n=r[nn].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.Mt(t,15),t.xt(tY(s)),this.Nt(nn,t),this.Ct(r[nn],t)}$t(e,t){let n=e.values||[];for(let e of(this.Mt(t,50),n))this.Ct(e,t)}kt(e,t){this.Mt(t,37),eu.fromName(e).path.forEach(e=>{this.Mt(t,60),this.Kt(e,t)})}Mt(e,t){e.xt(t)}Bt(e){e.xt(2)}}function rj(e){return Math.ceil((64-function(e){let t=0;for(let n=0;n<8;++n){let i=function(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}(255&e[n]);if(t+=i,8!==i)break}return t}(e))/8)}rB.Wt=new rB;class rz{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Gt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.zt(n.value),n=t.next();this.jt()}Ht(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Jt(n.value),n=t.next();this.Yt()}Zt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.zt(e);else if(e<2048)this.zt(960|e>>>6),this.zt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.zt(480|e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e);else{let e=t.codePointAt(0);this.zt(240|e>>>18),this.zt(128|63&e>>>12),this.zt(128|63&e>>>6),this.zt(128|63&e)}}this.jt()}Xt(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{let e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Yt()}en(e){let t=this.tn(e),n=rj(t);this.nn(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}rn(e){let t=this.tn(e),n=rj(t);this.nn(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}sn(){this._n(255),this._n(255)}an(){this.un(255),this.un(255)}reset(){this.position=0}seed(e){this.nn(e.length),this.buffer.set(e,this.position),this.position+=e.length}cn(){return this.buffer.slice(0,this.position)}tn(e){let t=function(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}zt(e){let t=255&e;0===t?(this._n(0),this._n(255)):255===t?(this._n(255),this._n(0)):this._n(t)}Jt(e){let t=255&e;0===t?(this.un(0),this.un(255)):255===t?(this.un(255),this.un(0)):this.un(e)}jt(){this._n(0),this._n(1)}Yt(){this.un(0),this.un(1)}_n(e){this.nn(1),this.buffer[this.position++]=e}un(e){this.nn(1),this.buffer[this.position++]=~e}nn(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class r${constructor(e){this.ln=e}Lt(e){this.ln.Gt(e)}Ot(e){this.ln.Zt(e)}xt(e){this.ln.en(e)}Ft(){this.ln.sn()}}class rK{constructor(e){this.ln=e}Lt(e){this.ln.Ht(e)}Ot(e){this.ln.Xt(e)}xt(e){this.ln.rn(e)}Ft(){this.ln.an()}}class rG{constructor(){this.ln=new rz,this.hn=new r$(this.ln),this.Pn=new rK(this.ln)}seed(e){this.ln.seed(e)}Tn(e){return 0===e?this.hn:this.Pn}cn(){return this.ln.cn()}reset(){this.ln.reset()}}class rW{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}In(){let e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new rW(this.indexId,this.documentKey,this.arrayValue,n)}}function rH(e,t){let n=e.indexId-t.indexId;return 0!==n?n:0!==(n=rQ(e.arrayValue,t.arrayValue))?n:0!==(n=rQ(e.directionalValue,t.directionalValue))?n:eu.comparator(e.documentKey,t.documentKey)}function rQ(e,t){for(let n=0;n<e.length&&n<t.length;++n){let i=e[n]-t[n];if(0!==i)return i}return e.length-t.length}class rY{constructor(e){for(let t of(this.En=new tj((e,t)=>eh.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.dn=e.orderBy,this.An=[],e.filters))t.isInequality()?this.En=this.En.add(t):this.An.push(t)}get Rn(){return this.En.size>1}Vn(e){if(V(e.collectionGroup===this.collectionId,49279),this.Rn)return!1;let t=ed(e);if(void 0!==t&&!this.mn(t))return!1;let n=ef(e),i=new Set,r=0,s=0;for(;r<n.length&&this.mn(n[r]);++r)i=i.add(n[r].fieldPath.canonicalString());if(r===n.length)return!0;if(this.En.size>0){let e=this.En.getIterator().getNext();if(!i.has(e.field.canonicalString())){let t=n[r];if(!this.fn(e,t)||!this.gn(this.dn[s++],t))return!1}++r}for(;r<n.length;++r){let e=n[r];if(s>=this.dn.length||!this.gn(this.dn[s++],e))return!1}return!0}pn(){if(this.Rn)return null;let e=new tj(eh.comparator),t=[];for(let n of this.An)if(!n.field.isKeyField()){if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new ep(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new ep(n.field,0))}}for(let n of this.dn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new ep(n.field,"asc"===n.dir?0:1)));return new ec(ec.UNKNOWN_ID,this.collectionId,t,eg.empty())}mn(e){for(let t of this.An)if(this.fn(t,e))return!0;return!1}fn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}gn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rJ(e){return e instanceof nN}function rX(e){return e instanceof nR&&nO(e)}function rZ(e){return rJ(e)||rX(e)||function(e){if(e instanceof nR&&nD(e)){for(let t of e.getFilters())if(!rJ(t)&&!rX(t))return!1;return!0}return!1}(e)}function r0(e,t){return V(e instanceof nN||e instanceof nR,38388),V(t instanceof nN||t instanceof nR,25473),r2(e instanceof nN?t instanceof nN?nR.create([e,t],"and"):r1(e,t):t instanceof nN?r1(t,e):function(e,t){if(V(e.filters.length>0&&t.filters.length>0,48005),nP(e)&&nP(t))return nM(e,t.getFilters());let n=nD(e)?e:t,i=nD(e)?t:e,r=n.filters.map(e=>r0(e,i));return nR.create(r,"or")}(e,t))}function r1(e,t){if(nP(t))return nM(t,e.getFilters());{let n=t.filters.map(t=>r0(e,t));return nR.create(n,"or")}}function r2(e){if(V(e instanceof nN||e instanceof nR,11850),e instanceof nN)return e;let t=e.getFilters();if(1===t.length)return r2(t[0]);if(nL(e))return e;let n=t.map(e=>r2(e)),i=[];return n.forEach(t=>{t instanceof nN?i.push(t):t instanceof nR&&(t.op===e.op?i.push(...t.filters):i.push(t))}),1===i.length?i[0]:nR.create(i,e.op)}class r3{constructor(){this.yn=new r5}addToCollectionParentIndex(e,t){return this.yn.add(t),eE.resolve()}getCollectionParents(e,t){return eE.resolve(this.yn.getEntries(t))}addFieldIndex(e,t){return eE.resolve()}deleteFieldIndex(e,t){return eE.resolve()}deleteAllFieldIndexes(e){return eE.resolve()}createTargetIndexes(e,t){return eE.resolve()}getDocumentsMatchingTarget(e,t){return eE.resolve(null)}getIndexType(e,t){return eE.resolve(0)}getFieldIndexes(e,t){return eE.resolve([])}getNextCollectionGroupToUpdate(e){return eE.resolve(null)}getMinOffset(e,t){return eE.resolve(e_.min())}getMinOffsetFromCollectionGroup(e,t){return eE.resolve(e_.min())}updateCollectionGroup(e,t,n){return eE.resolve()}updateIndexEntries(e,t){return eE.resolve()}}class r5{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new tj(ea.comparator),r=!i.has(n);return this.index[t]=i.add(n),r}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new tj(ea.comparator)).toArray()}}let r6="IndexedDbIndexManager",r8=new Uint8Array(0);class r4{constructor(e,t){this.databaseId=t,this.wn=new r5,this.bn=new ir(e=>nW(e),(e,t)=>nH(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.wn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.wn.add(t)});let r={collectionId:n,parent:ej(i)};return tL(e,ta).put(r)}return eE.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[t+"\0",""],!1,!0);return tL(e,ta).J(i).next(e=>{for(let i of e){if(i.collectionId!==t)break;n.push(ez(i.parent))}return n})}addFieldIndex(e,t){let n=tL(e,td),i={indexId:t.indexId,collectionGroup:t.collectionGroup,fields:t.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};delete i.indexId;let r=n.add(i);if(t.indexState){let n=tL(e,tp);return r.next(e=>{n.put(rF(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){let n=tL(e,td),i=tL(e,tp),r=tL(e,t_);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=tL(e,td),n=tL(e,t_),i=tL(e,tp);return t.X().next(()=>n.X()).next(()=>i.X())}createTargetIndexes(e,t){return eE.forEach(this.Sn(t),t=>this.getIndexType(e,t).next(n=>{if(0===n||1===n){let n=new rY(t).pn();if(null!=n)return this.addFieldIndex(e,n)}}))}getDocumentsMatchingTarget(e,t){let n=tL(e,t_),i=!0,r=new Map;return eE.forEach(this.Sn(t),t=>this.Dn(e,t).next(e=>{i&&(i=!!e),r.set(t,e)})).next(()=>{if(i){let e=id(),i=[];return eE.forEach(r,(r,s)=>{D(r6,`Using index id=${r.indexId}|cg=${r.collectionGroup}|f=${r.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")} to execute ${nW(t)}`);let o=function(e,t){let n=ed(t);if(void 0===n)return null;for(let t of nY(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,r),a=function(e,t){let n=new Map;for(let i of ef(t))for(let t of nY(e,i.fieldPath))switch(t.op){case"==":case"in":n.set(i.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(i.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,r),l=function(e,t){let n=[],i=!0;for(let r of ef(t)){let t=0===r.kind?nJ(e,r.fieldPath,e.startAt):nX(e,r.fieldPath,e.startAt);n.push(t.value),i&&(i=t.inclusive)}return new nC(n,i)}(s,r),h=function(e,t){let n=[],i=!0;for(let r of ef(t)){let t=0===r.kind?nX(e,r.fieldPath,e.endAt):nJ(e,r.fieldPath,e.endAt);n.push(t.value),i&&(i=t.inclusive)}return new nC(n,i)}(s,r),u=this.vn(r,s,l),c=this.vn(r,s,h),d=this.Cn(r,s,a),f=this.Fn(r.indexId,o,u,l.inclusive,c,h.inclusive,d);return eE.forEach(f,r=>n.Z(r,t.limit).next(t=>{t.forEach(t=>{let n=eu.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),i.push(n))})}))}).next(()=>i)}return eE.resolve(null)})}Sn(e){let t=this.bn.get(e);return t||(t=0===e.filters.length?[e]:(function(e){if(0===e.getFilters().length)return[];let t=function e(t){if(V(t instanceof nN||t instanceof nR,34018),t instanceof nN)return t;if(1===t.filters.length)return e(t.filters[0]);let n=t.filters.map(t=>e(t)),i=nR.create(n,t.op);return rZ(i=r2(i))?i:(V(i instanceof nR,64498),V(nP(i),40251),V(i.filters.length>1,57927),i.filters.reduce((e,t)=>r0(e,t)))}(function e(t){var n,i;if(V(t instanceof nN||t instanceof nR,20012),t instanceof nN){if(t instanceof nj){let e=(null===(i=null===(n=t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(e=>nN.create(t.field,"==",e)))||[];return nR.create(e,"or")}return t}let r=t.filters.map(t=>e(t));return nR.create(r,t.op)}(e));return V(rZ(t),7391),rJ(t)||rX(t)?[t]:t.getFilters()})(nR.create(e.filters,"and")).map(t=>nG(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.bn.set(e,t)),t}Fn(e,t,n,i,r,s,o){let a=(null!=t?t.length:1)*Math.max(n.length,r.length),l=a/(null!=t?t.length:1),h=[];for(let u=0;u<a;++u){let a=t?this.Mn(t[u/l]):r8,c=this.xn(e,a,n[u%l],i),d=this.On(e,a,r[u%l],s),f=o.map(t=>this.xn(e,a,t,!0));h.push(...this.createRange(c,d,f))}return h}xn(e,t,n,i){let r=new rW(e,eu.empty(),t,n);return i?r:r.In()}On(e,t,n,i){let r=new rW(e,eu.empty(),t,n);return i?r.In():r}Dn(e,t){let n=new rY(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(e=>{let t=null;for(let i of e)n.Vn(i)&&(!t||i.fields.length>t.fields.length)&&(t=i);return t})}getIndexType(e,t){let n=2,i=this.Sn(t);return eE.forEach(i,t=>this.Dn(e,t).next(e=>{e?0!==n&&e.fields.length<function(e){let t=new tj(eh.comparator),n=!1;for(let i of e.filters)for(let e of i.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field));for(let n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Nn(e,t){let n=new rG;for(let i of ef(e)){let e=t.data.field(i.fieldPath);if(null==e)return null;let r=n.Tn(i.kind);rB.Wt.vt(e,r)}return n.cn()}Mn(e){let t=new rG;return rB.Wt.vt(e,t.Tn(0)),t.cn()}Bn(e,t){let n=new rG;return rB.Wt.vt(nc(this.databaseId,t),n.Tn(function(e){let t=ef(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.cn()}Cn(e,t,n){if(null===n)return[];let i=[];i.push(new rG);let r=0;for(let s of ef(e)){let e=n[r++];for(let n of i)if(this.Ln(t,s.fieldPath)&&nf(e))i=this.kn(i,s,e);else{let t=n.Tn(s.kind);rB.Wt.vt(e,t)}}return this.qn(i)}vn(e,t,n){return this.Cn(e,t,n.position)}qn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].cn();return t}kn(e,t,n){let i=[...e],r=[];for(let e of n.arrayValue.values||[])for(let n of i){let i=new rG;i.seed(n.cn()),rB.Wt.vt(e,i.Tn(t.kind)),r.push(i)}return r}Ln(e,t){return!!e.filters.find(e=>e instanceof nN&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let n=tL(e,td),i=tL(e,tp);return(t?n.J(tf,IDBKeyRange.bound(t,t)):n.J()).next(e=>{let t=[];return eE.forEach(e,e=>i.get([e.indexId,this.uid]).next(n=>{t.push(function(e,t){let n=t?new eg(t.sequenceNumber,new e_(rN(t.readTime),new eu(ez(t.documentKey)),t.largestBatchId)):eg.empty(),i=e.fields.map(([e,t])=>new ep(eh.fromServerFormat(e),t));return new ec(e.indexId,e.collectionGroup,i,n)}(e,n))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Z(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=tL(e,td),r=tL(e,tp);return this.Qn(e).next(e=>i.J(tf,IDBKeyRange.bound(t,t)).next(t=>eE.forEach(t,t=>r.put(rF(t.indexId,this.uid,e,n)))))}updateIndexEntries(e,t){let n=new Map;return eE.forEach(t,(t,i)=>{let r=n.get(t.collectionGroup);return(r?eE.resolve(r):this.getFieldIndexes(e,t.collectionGroup)).next(r=>(n.set(t.collectionGroup,r),eE.forEach(r,n=>this.$n(e,t,n).next(t=>{let r=this.Un(i,n);return t.isEqual(r)?eE.resolve():this.Kn(e,i,n,t,r)}))))})}Wn(e,t,n,i){return tL(e,t_).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Bn(n,t.key),documentKey:t.key.path.toArray()})}Gn(e,t,n,i){return tL(e,t_).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Bn(n,t.key),t.key.path.toArray()])}$n(e,t,n){let i=tL(e,t_),r=new tj(rH);return i.te({index:tw,range:IDBKeyRange.only([n.indexId,this.uid,this.Bn(n,t)])},(e,i)=>{r=r.add(new rW(n.indexId,t,i.arrayValue,i.directionalValue))}).next(()=>r)}Un(e,t){let n=new tj(rH),i=this.Nn(t,e);if(null==i)return n;let r=ed(t);if(null!=r){let s=e.data.field(r.fieldPath);if(nf(s))for(let r of s.arrayValue.values||[])n=n.add(new rW(t.indexId,e.key,this.Mn(r),i))}else n=n.add(new rW(t.indexId,e.key,r8,i));return n}Kn(e,t,n,i,r){D(r6,"Updating index entries for document '%s'",t.key);let s=[];return function(e,t,n,i,r){let s=e.getIterator(),o=t.getIterator(),a=t$(s),l=t$(o);for(;a||l;){let e=!1,t=!1;if(a&&l){let i=n(a,l);i<0?t=!0:i>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(i(l),l=t$(o)):t?(r(a),a=t$(s)):(a=t$(s),l=t$(o))}}(i,r,rH,i=>{s.push(this.Wn(e,t,n,i))},i=>{s.push(this.Gn(e,t,n,i))}),eE.waitFor(s)}Qn(e){let t=1;return tL(e,tp).te({index:tm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,n,i)=>{i.done(),t=n.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((e,t)=>rH(e,t)).filter((e,t,n)=>!t||0!==rH(e,n[t-1]));let i=[];for(let r of(i.push(e),n)){let n=rH(r,e),s=rH(r,t);if(0===n)i[0]=e.In();else if(n>0&&s<0)i.push(r),i.push(r.In());else if(s>0)break}i.push(t);let r=[];for(let e=0;e<i.length;e+=2){if(this.zn(i[e],i[e+1]))return[];let t=[i[e].indexId,this.uid,i[e].arrayValue,i[e].directionalValue,r8,[]],n=[i[e+1].indexId,this.uid,i[e+1].arrayValue,i[e+1].directionalValue,r8,[]];r.push(IDBKeyRange.bound(t,n))}return r}zn(e,t){return rH(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(r9)}getMinOffset(e,t){return eE.mapArray(this.Sn(t),t=>this.Dn(e,t).next(e=>e||F(44426))).next(r9)}}function r9(e){V(0!==e.length,28825);let t=e[0].indexState.offset,n=t.largestBatchId;for(let i=1;i<e.length;i++){let r=e[i].indexState.offset;0>ev(r,t)&&(t=r),n<r.largestBatchId&&(n=r.largestBatchId)}return new e_(t.readTime,t.documentKey,n)}let r7={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class se{static withCacheSize(e){return new se(e,se.DEFAULT_COLLECTION_PERCENTILE,se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}function st(e,t,n){let i=e.store(eH),r=e.store(eZ),s=[],o=IDBKeyRange.only(n.batchId),a=0,l=i.te({range:o},(e,t,n)=>(a++,n.delete()));s.push(l.next(()=>{V(1===a,47070,{batchId:n.batchId})}));let h=[];for(let e of n.mutations){var u,c;let i=(u=e.key.path,c=n.batchId,[t,ej(u),c]);s.push(r.delete(i)),h.push(e.key)}return eE.waitFor(s).next(()=>h)}function sn(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw F(14731);t=e.noDocument}return JSON.stringify(t).length}se.DEFAULT_COLLECTION_PERCENTILE=10,se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,se.DEFAULT=new se(0x2800000,se.DEFAULT_COLLECTION_PERCENTILE,se.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),se.DISABLED=new se(-1,0,0);class si{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.jn={}}static bt(e,t,n,i){return V(""!==e.uid,64387),new si(e.isAuthenticated()?e.uid:"",t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ss(e).te({index:eY,range:n},(e,n,i)=>{t=!1,i.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let r=tL(e,eZ),s=ss(e);return s.add({}).next(o=>{V("number"==typeof o,49019);let a=new iz(o,t,n,i),l=function(e,t,n){let i=n.baseMutations.map(t=>ry(e.wt,t)),r=n.mutations.map(t=>ry(e.wt,t));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:i,mutations:r}}(this.serializer,this.userId,a),h=[],u=new tj((e,t)=>Z(e.canonicalString(),t.canonicalString()));for(let e of i){let t=[this.userId,ej(e.key.path),o];u=u.add(e.key.path.popLast()),h.push(s.put(l)),h.push(r.put(t,eX))}return u.forEach(t=>{h.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.jn[o]=a.keys()}),eE.waitFor(h).next(()=>a)})}lookupMutationBatch(e,t){return ss(e).get(t).next(e=>e?(V(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),rR(this.serializer,e)):null)}Hn(e,t){return this.jn[t]?eE.resolve(this.jn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){let n=e.keys();return this.jn[t]=n,n}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),r=null;return ss(e).te({index:eY,range:i},(e,t,i)=>{t.userId===this.userId&&(V(t.batchId>=n,47524,{Jn:n}),r=rR(this.serializer,t)),i.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ss(e).te({index:eY,range:t,reverse:!0},(e,t,i)=>{n=t.batchId,i.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ss(e).J(eY,t).next(e=>e.map(e=>rR(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=[this.userId,ej(t.path)],i=IDBKeyRange.lowerBound(n),r=[];return tL(e,eZ).te({range:i},(n,i,s)=>{let[o,a,l]=n,h=ez(a);if(o===this.userId&&t.path.isEqual(h))return ss(e).get(l).next(e=>{if(!e)throw F(61480,{Yn:n,batchId:l});V(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),r.push(rR(this.serializer,e))});s.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tj(Z),i=[];return t.forEach(t=>{let r=[this.userId,ej(t.path)],s=IDBKeyRange.lowerBound(r),o=tL(e,eZ).te({range:s},(e,i,r)=>{let[s,o,a]=e,l=ez(o);s===this.userId&&t.path.isEqual(l)?n=n.add(a):r.done()});i.push(o)}),eE.waitFor(i).next(()=>this.Zn(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=[this.userId,ej(n)],s=IDBKeyRange.lowerBound(r),o=new tj(Z);return tL(e,eZ).te({range:s},(e,t,r)=>{let[s,a,l]=e,h=ez(a);s===this.userId&&n.isPrefixOf(h)?h.length===i&&(o=o.add(l)):r.done()}).next(()=>this.Zn(e,o))}Zn(e,t){let n=[],i=[];return t.forEach(t=>{i.push(ss(e).get(t).next(e=>{if(null===e)throw F(35274,{batchId:t});V(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),n.push(rR(this.serializer,e))}))}),eE.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return st(e.he,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.Xn(t.batchId)}),eE.forEach(n,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}Xn(e){delete this.jn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eE.resolve();let n=IDBKeyRange.lowerBound([this.userId]),i=[];return tL(e,eZ).te({range:n},(e,t,n)=>{if(e[0]===this.userId){let t=ez(e[1]);i.push(t)}else n.done()}).next(()=>{V(0===i.length,56720,{er:i.map(e=>e.canonicalString())})})})}containsKey(e,t){return sr(e,this.userId,t)}tr(e){return tL(e,eW).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sr(e,t,n){let i=[t,ej(n.path)],r=i[1],s=IDBKeyRange.lowerBound(i),o=!1;return tL(e,eZ).te({range:s,ee:!0},(e,n,i)=>{let[s,a,l]=e;s===t&&a===r&&(o=!0),i.done()}).next(()=>o)}function ss(e){return tL(e,eH)}class so{constructor(e){this.nr=e}next(){return this.nr+=2,this.nr}static rr(){return new so(0)}static ir(){return new so(-1)}}class sa{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.sr(e).next(t=>{let n=new so(t.highestTargetId);return t.highestTargetId=n.next(),this._r(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.sr(e).next(e=>er.fromTimestamp(new ei(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.sr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.sr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this._r(e,i)))}addTargetData(e,t){return this.ar(e,t).next(()=>this.sr(e).next(n=>(n.targetCount+=1,this.ur(t,n),this._r(e,n))))}updateTargetData(e,t){return this.ar(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>tL(e,e9).delete(t.targetId)).next(()=>this.sr(e)).next(t=>(V(t.targetCount>0,8065),t.targetCount-=1,this._r(e,t)))}removeTargets(e,t,n){let i=0,r=[];return tL(e,e9).te((s,o)=>{let a=rP(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(i++,r.push(this.removeTargetData(e,a)))}).next(()=>eE.waitFor(r)).next(()=>i)}forEachTarget(e,t){return tL(e,e9).te((e,n)=>{t(rP(n))})}sr(e){return tL(e,to).get(ts).next(e=>(V(null!==e,2888),e))}_r(e,t){return tL(e,to).put(ts,t)}ar(e,t){return tL(e,e9).put(rD(this.serializer,t))}ur(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.sr(e).next(e=>e.targetCount)}getTargetData(e,t){let n=nW(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),r=null;return tL(e,e9).te({range:i,index:e7},(e,n,i)=>{let s=rP(n);nH(t,s.target)&&(r=s,i.done())}).next(()=>r)}addMatchingKeys(e,t,n){let i=[],r=sl(e);return t.forEach(t=>{let s=ej(t.path);i.push(r.put({targetId:n,path:s})),i.push(this.referenceDelegate.addReference(e,n,t))}),eE.waitFor(i)}removeMatchingKeys(e,t,n){let i=sl(e);return eE.forEach(t,t=>{let r=ej(t.path);return eE.waitFor([i.delete([n,r]),this.referenceDelegate.removeReference(e,n,t)])})}removeMatchingKeysForTargetId(e,t){let n=sl(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=sl(e),r=id();return i.te({range:n,ee:!0},(e,t,n)=>{let i=new eu(ez(e[1]));r=r.add(i)}).next(()=>r)}containsKey(e,t){let n=ej(t.path),i=IDBKeyRange.bound([n],[n+"\0"],!1,!0),r=0;return sl(e).te({index:ti,ee:!0,range:i},([e,t],n,i)=>{0!==e&&(r++,i.done())}).next(()=>r>0)}Rt(e,t){return tL(e,e9).get(t).next(e=>e?rP(e):null)}}function sl(e){return tL(e,tt)}let sh="LruGarbageCollector";function su([e,t],[n,i]){let r=Z(e,n);return 0===r?Z(t,i):r}class sc{constructor(e){this.cr=e,this.buffer=new tj(su),this.lr=0}hr(){return++this.lr}Pr(e){let t=[e,this.hr()];if(this.buffer.size<this.cr)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>su(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class sd{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Tr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Ir(6e4)}stop(){this.Tr&&(this.Tr.cancel(),this.Tr=null)}get started(){return null!==this.Tr}Ir(e){D(sh,`Garbage collection scheduled in ${e}ms`),this.Tr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Tr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){eN(e)?D(sh,"Ignoring IndexedDB error during garbage collection: ",e):await eb(e)}await this.Ir(3e5)})}}class sf{constructor(e,t){this.Er=e,this.params=t}calculateTargetCount(e,t){return this.Er.dr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eE.resolve(eU.le);let n=new sc(t);return this.Er.forEachTarget(e,e=>n.Pr(e.sequenceNumber)).next(()=>this.Er.Ar(e,e=>n.Pr(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Er.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Er.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),eE.resolve(r7)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),r7):this.Rr(e,t))}getCacheSize(e){return this.Er.getCacheSize(e)}Rr(e,t){let n,i,r,s,o,a,l;let h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,s=Date.now(),this.nthSequenceNumber(e,i))).next(i=>(n=i,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(r=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),P()<=v.in.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${i} in `+(o-s)+"ms\n"+`	Removed ${r} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),eE.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:r,documentsRemoved:e})))}}class sp{constructor(e,t){this.db=e,this.garbageCollector=new sf(this,t)}dr(e){let t=this.Vr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ar(e,t){return this.mr(e,(e,n)=>t(n))}addReference(e,t,n){return sg(e,n)}removeReference(e,t,n){return sg(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return sg(e,t)}gr(e,t){let n;return n=!1,tL(e,eW).ne(i=>sr(e,i,t).next(e=>(e&&(n=!0),eE.resolve(!e)))).next(()=>n)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],r=0;return this.mr(e,(s,o)=>{if(o<=t){let t=this.gr(e,s).next(t=>{if(!t)return r++,n.getEntry(e,s).next(()=>(n.removeEntry(s,er.min()),sl(e).delete([0,ej(s.path)])))});i.push(t)}}).next(()=>eE.waitFor(i)).next(()=>n.apply(e)).next(()=>r)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return sg(e,t)}mr(e,t){let n=sl(e),i,r=eU.le;return n.te({index:ti},([e,n],{path:s,sequenceNumber:o})=>{0===e?(r!==eU.le&&t(new eu(ez(i)),r),r=o,i=s):r=eU.le}).next(()=>{r!==eU.le&&t(new eu(ez(i)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sg(e,t){var n;return sl(e).put((n=e.currentSequenceNumber,{targetId:0,path:ej(t.path),sequenceNumber:n}))}class sm{constructor(){this.changes=new ir(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nT.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?eE.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sy{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return tL(e,e0).put(n)}removeEntry(e,t,n){return tL(e,e0).delete(function(e,t){let n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],rk(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.pr(e,n)))}getEntry(e,t){let n=nT.newInvalidDocument(t);return tL(e,e0).te({index:e2,range:IDBKeyRange.only(sv(t))},(e,i)=>{n=this.yr(t,i)}).next(()=>n)}wr(e,t){let n={size:0,document:nT.newInvalidDocument(t)};return tL(e,e0).te({index:e2,range:IDBKeyRange.only(sv(t))},(e,i)=>{n={document:this.yr(t,i),size:sn(i)}}).next(()=>n)}getEntries(e,t){let n=is;return this.br(e,t,(e,t)=>{let i=this.yr(e,t);n=n.insert(e,i)}).next(()=>n)}Sr(e,t){let n=is,i=new tV(eu.comparator);return this.br(e,t,(e,t)=>{let r=this.yr(e,t);n=n.insert(e,r),i=i.insert(e,sn(t))}).next(()=>({documents:n,Dr:i}))}br(e,t,n){if(t.isEmpty())return eE.resolve();let i=new tj(sI);t.forEach(e=>i=i.add(e));let r=IDBKeyRange.bound(sv(i.first()),sv(i.last())),s=i.getIterator(),o=s.getNext();return tL(e,e0).te({index:e2,range:r},(e,t,i)=>{let r=eu.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&0>sI(o,r);)n(o,null),o=s.getNext();o&&o.isEqual(r)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?i.H(sv(o)):i.done()}).next(()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,r){let s=t.path,o=[s.popLast().toArray(),s.lastSegment(),rk(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return tL(e,e0).J(IDBKeyRange.bound(o,a,!0)).next(e=>{null==r||r.incrementDocumentReadCount(e.length);let n=is;for(let r of e){let e=this.yr(eu.fromSegments(r.prefixPath.concat(r.collectionGroup,r.documentId)),r);e.isFoundDocument()&&(ie(t,e)||i.has(e.key))&&(n=n.insert(e.key,e))}return n})}getAllFromCollectionGroup(e,t,n,i){let r=is,s=sw(t,n),o=sw(t,e_.max());return tL(e,e0).te({index:e5,range:IDBKeyRange.bound(s,o,!0)},(e,t,n)=>{let s=this.yr(eu.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(r=r.insert(s.key,s)).size===i&&n.done()}).next(()=>r)}newChangeBuffer(e){return new s_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return tL(e,e8).get(e4).next(e=>(V(!!e,20021),e))}pr(e,t){return tL(e,e8).put(e4,t)}yr(e,t){if(t){let e=function(e,t){let n;if(t.document)n=rm(e.wt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=eu.fromSegments(t.noDocument.path),i=rN(t.noDocument.readTime);n=nT.newNoDocument(e,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return F(56709);{let e=eu.fromSegments(t.unknownDocument.path),i=rN(t.unknownDocument.version);n=nT.newUnknownDocument(e,i)}}return t.readTime&&n.setReadTime(function(e){let t=new ei(e[0],e[1]);return er.fromTimestamp(t)}(t.readTime)),n}(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(er.min())))return e}return nT.newInvalidDocument(e)}}class s_ extends sm{constructor(e,t){super(),this.vr=e,this.trackRemovals=t,this.Cr=new ir(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],n=0,i=new tj((e,t)=>Z(e.canonicalString(),t.canonicalString()));return this.changes.forEach((r,s)=>{let o=this.Cr.get(r);if(t.push(this.vr.removeEntry(e,r,o.readTime)),s.isValidDocument()){let a=rx(this.vr.serializer,s);i=i.add(r.path.popLast());let l=sn(a);n+=l-o.size,t.push(this.vr.addEntry(e,r,a))}else if(n-=o.size,this.trackRemovals){let n=rx(this.vr.serializer,s.convertToNoDocument(er.min()));t.push(this.vr.addEntry(e,r,n))}}),i.forEach(n=>{t.push(this.vr.indexManager.addToCollectionParentIndex(e,n))}),t.push(this.vr.updateMetadata(e,n)),eE.waitFor(t)}getFromCache(e,t){return this.vr.wr(e,t).next(e=>(this.Cr.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.vr.Sr(e,t).next(({documents:e,Dr:t})=>(t.forEach((t,n)=>{this.Cr.set(t,{size:n,readTime:e.get(t).readTime})}),e))}}function sv(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function sw(e,t){let n=t.documentKey.path.toArray();return[e,rk(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function sI(e,t){let n=e.path.toArray(),i=t.path.toArray(),r=0;for(let e=0;e<n.length-2&&e<i.length-2;++e)if(r=Z(n[e],i[e]))return r;return(r=Z(n.length,i.length))||(r=Z(n[n.length-2],i[i.length-2]))||Z(n[n.length-1],i[i.length-1])}class sb{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sE{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&iO(n.mutation,e,tK.empty(),ei.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,id()).next(()=>t))}getLocalViewOfDocuments(e,t,n=id()){let i=ih();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(e=>{let t=ia();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=ih();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,id()))}populateOverlays(e,t,n){let i=[];return n.forEach(e=>{t.has(e)||i.push(e)}),this.documentOverlayCache.getOverlays(e,i).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,i){let r=is,s=ih(),o=ih();return t.forEach((e,t)=>{let o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof iF)?r=r.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),iO(o.mutation,t,o.mutation.getFieldMask(),ei.now())):s.set(t.key,tK.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var n;return o.set(e,new sb(t,null!==(n=s.get(e))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(e,t){let n=ih(),i=new tV((e,t)=>e-t),r=id();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let r of e)r.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||tK.empty();o=r.applyToLocalView(s,o),n.set(e,o);let a=(i.get(r.batchId)||id()).add(e);i=i.insert(r.batchId,a)})}).next(()=>{let s=[],o=i.getReverseIterator();for(;o.hasNext();){let i=o.getNext(),a=i.key,l=i.value,h=ih();l.forEach(e=>{if(!r.has(e)){let i=iD(t.get(e),n.get(e));null!==i&&h.set(e,i),r=r.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return eE.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,i){return eu.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):n2(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(r=>{let s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-r.size):eE.resolve(ih()),o=-1,a=r;return s.next(t=>eE.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(t)?eE.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,a,t,id())).next(e=>({batchId:o,changes:il(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new eu(t)).next(e=>{let t=ia();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let r=t.collectionGroup,s=ia();return this.indexManager.getCollectionParents(e,r).next(o=>eE.forEach(o,o=>{let a=new nZ(o.child(r),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,i){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(r=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,r,i))).next(e=>{r.forEach((t,n)=>{let i=n.getKey();null===e.get(i)&&(e=e.insert(i,nT.newInvalidDocument(i)))});let n=ia();return e.forEach((e,i)=>{let s=r.get(e);void 0!==s&&iO(s.mutation,i,tK.empty(),ei.now()),ie(t,i)&&(n=n.insert(e,i))}),n})}}class sT{constructor(e){this.serializer=e,this.Fr=new Map,this.Mr=new Map}getBundleMetadata(e,t){return eE.resolve(this.Fr.get(t))}saveBundleMetadata(e,t){return this.Fr.set(t.id,{id:t.id,version:t.version,createTime:rs(t.createTime)}),eE.resolve()}getNamedQuery(e,t){return eE.resolve(this.Mr.get(t))}saveNamedQuery(e,t){return this.Mr.set(t.name,{name:t.name,query:rO(t.bundledQuery),readTime:rs(t.readTime)}),eE.resolve()}}class sC{constructor(){this.overlays=new tV(eu.comparator),this.Or=new Map}getOverlay(e,t){return eE.resolve(this.overlays.get(t))}getOverlays(e,t){let n=ih();return eE.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,i)=>{this.St(e,t,i)}),eE.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.Or.get(n);return void 0!==i&&(i.forEach(e=>this.overlays=this.overlays.remove(e)),this.Or.delete(n)),eE.resolve()}getOverlaysForCollection(e,t,n){let i=ih(),r=t.length+1,s=new eu(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===r&&e.largestBatchId>n&&i.set(e.getKey(),e)}return eE.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let r=new tV((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=r.get(e.largestBatchId);null===t&&(t=ih(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=ih(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=i)););return eE.resolve(o)}St(e,t,n){let i=this.overlays.get(n.key);if(null!==i){let e=this.Or.get(i.largestBatchId).delete(n.key);this.Or.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new iK(t,n));let r=this.Or.get(t);void 0===r&&(r=id(),this.Or.set(t,r)),this.Or.set(t,r.add(n.key))}}class sS{constructor(){this.sessionToken=tW.EMPTY_BYTE_STRING}getSessionToken(e){return eE.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eE.resolve()}}class sx{constructor(){this.Nr=new tj(sk.Br),this.Lr=new tj(sk.kr)}isEmpty(){return this.Nr.isEmpty()}addReference(e,t){let n=new sk(e,t);this.Nr=this.Nr.add(n),this.Lr=this.Lr.add(n)}qr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Qr(new sk(e,t))}$r(e,t){e.forEach(e=>this.removeReference(e,t))}Ur(e){let t=new eu(new ea([])),n=new sk(t,e),i=new sk(t,e+1),r=[];return this.Lr.forEachInRange([n,i],e=>{this.Qr(e),r.push(e.key)}),r}Kr(){this.Nr.forEach(e=>this.Qr(e))}Qr(e){this.Nr=this.Nr.delete(e),this.Lr=this.Lr.delete(e)}Wr(e){let t=new eu(new ea([])),n=new sk(t,e),i=new sk(t,e+1),r=id();return this.Lr.forEachInRange([n,i],e=>{r=r.add(e.key)}),r}containsKey(e){let t=new sk(e,0),n=this.Nr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class sk{constructor(e,t){this.key=e,this.Gr=t}static Br(e,t){return eu.comparator(e.key,t.key)||Z(e.Gr,t.Gr)}static kr(e,t){return Z(e.Gr,t.Gr)||eu.comparator(e.key,t.key)}}class sA{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Jn=1,this.zr=new tj(sk.Br)}checkEmpty(e){return eE.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){let r=this.Jn;this.Jn++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new iz(r,t,n,i);for(let t of(this.mutationQueue.push(s),i))this.zr=this.zr.add(new sk(t.key,r)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eE.resolve(s)}lookupMutationBatch(e,t){return eE.resolve(this.jr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.Hr(t+1),i=n<0?0:n;return eE.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return eE.resolve(0===this.mutationQueue.length?-1:this.Jn-1)}getAllMutationBatches(e){return eE.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new sk(t,0),i=new sk(t,Number.POSITIVE_INFINITY),r=[];return this.zr.forEachInRange([n,i],e=>{let t=this.jr(e.Gr);r.push(t)}),eE.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new tj(Z);return t.forEach(e=>{let t=new sk(e,0),i=new sk(e,Number.POSITIVE_INFINITY);this.zr.forEachInRange([t,i],e=>{n=n.add(e.Gr)})}),eE.resolve(this.Jr(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,r=n;eu.isDocumentKey(r)||(r=r.child(""));let s=new sk(new eu(r),0),o=new tj(Z);return this.zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Gr)),!0)},s),eE.resolve(this.Jr(o))}Jr(e){let t=[];return e.forEach(e=>{let n=this.jr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){V(0===this.Yr(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.zr;return eE.forEach(t.mutations,i=>{let r=new sk(i.key,t.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.zr=n})}Xn(e){}containsKey(e,t){let n=new sk(t,0),i=this.zr.firstAfterOrEqual(n);return eE.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,eE.resolve()}Yr(e,t){return this.Hr(e)}Hr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}jr(e){let t=this.Hr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class sN{constructor(e){this.Zr=e,this.docs=new tV(eu.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),r=i?i.size:0,s=this.Zr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return eE.resolve(n?n.document.mutableCopy():nT.newInvalidDocument(t))}getEntries(e,t){let n=is;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():nT.newInvalidDocument(e))}),eE.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let r=is,s=t.path,o=new eu(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=ev(ey(o),n)||(i.has(o.key)||ie(t,o))&&(r=r.insert(o.key,o.mutableCopy()))}return eE.resolve(r)}getAllFromCollectionGroup(e,t,n,i){F(9500)}Xr(e,t){return eE.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new sR(this)}getSize(e){return eE.resolve(this.size)}}class sR extends sm{constructor(e){super(),this.vr=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.vr.addEntry(e,i)):this.vr.removeEntry(n)}),eE.waitFor(t)}getFromCache(e,t){return this.vr.getEntry(e,t)}getAllFromCache(e,t){return this.vr.getEntries(e,t)}}class sP{constructor(e){this.persistence=e,this.ei=new ir(e=>nW(e),nH),this.lastRemoteSnapshotVersion=er.min(),this.highestTargetId=0,this.ti=0,this.ni=new sx,this.targetCount=0,this.ri=so.rr()}forEachTarget(e,t){return this.ei.forEach((e,n)=>t(n)),eE.resolve()}getLastRemoteSnapshotVersion(e){return eE.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eE.resolve(this.ti)}allocateTargetId(e){return this.highestTargetId=this.ri.next(),eE.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.ti&&(this.ti=t),eE.resolve()}ar(e){this.ei.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ri=new so(t),this.highestTargetId=t),e.sequenceNumber>this.ti&&(this.ti=e.sequenceNumber)}addTargetData(e,t){return this.ar(t),this.targetCount+=1,eE.resolve()}updateTargetData(e,t){return this.ar(t),eE.resolve()}removeTargetData(e,t){return this.ei.delete(t.target),this.ni.Ur(t.targetId),this.targetCount-=1,eE.resolve()}removeTargets(e,t,n){let i=0,r=[];return this.ei.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ei.delete(s),r.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)}),eE.waitFor(r).next(()=>i)}getTargetCount(e){return eE.resolve(this.targetCount)}getTargetData(e,t){let n=this.ei.get(t)||null;return eE.resolve(n)}addMatchingKeys(e,t,n){return this.ni.qr(t,n),eE.resolve()}removeMatchingKeys(e,t,n){this.ni.$r(t,n);let i=this.persistence.referenceDelegate,r=[];return i&&t.forEach(t=>{r.push(i.markPotentiallyOrphaned(e,t))}),eE.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.ni.Ur(t),eE.resolve()}getMatchingKeysForTargetId(e,t){let n=this.ni.Wr(t);return eE.resolve(n)}containsKey(e,t){return eE.resolve(this.ni.containsKey(t))}}class sD{constructor(e,t){this.ii={},this.overlays={},this.si=new eU(0),this.oi=!1,this.oi=!0,this._i=new sS,this.referenceDelegate=e(this),this.ai=new sP(this),this.indexManager=new r3,this.remoteDocumentCache=new sN(e=>this.referenceDelegate.ui(e)),this.serializer=new rS(t),this.ci=new sT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.oi=!1,Promise.resolve()}get started(){return this.oi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new sC,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ii[e.toKey()];return n||(n=new sA(t,this.referenceDelegate),this.ii[e.toKey()]=n),n}getGlobalsCache(){return this._i}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.ci}runTransaction(e,t,n){D("MemoryPersistence","Starting transaction:",e);let i=new sO(this.si.next());return this.referenceDelegate.li(),n(i).next(e=>this.referenceDelegate.hi(i).next(()=>e)).toPromise().then(e=>(i.raiseOnCommittedEvent(),e))}Pi(e,t){return eE.or(Object.values(this.ii).map(n=>()=>n.containsKey(e,t)))}}class sO extends eI{constructor(e){super(),this.currentSequenceNumber=e}}class sL{constructor(e){this.persistence=e,this.Ti=new sx,this.Ii=null}static Ei(e){return new sL(e)}get di(){if(this.Ii)return this.Ii;throw F(60996)}addReference(e,t,n){return this.Ti.addReference(n,t),this.di.delete(n.toString()),eE.resolve()}removeReference(e,t,n){return this.Ti.removeReference(n,t),this.di.add(n.toString()),eE.resolve()}markPotentiallyOrphaned(e,t){return this.di.add(t.toString()),eE.resolve()}removeTarget(e,t){this.Ti.Ur(t.targetId).forEach(e=>this.di.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.di.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}li(){this.Ii=new Set}hi(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eE.forEach(this.di,n=>{let i=eu.fromPath(n);return this.Ai(e,i).next(e=>{e||t.removeEntry(i,er.min())})}).next(()=>(this.Ii=null,t.apply(e)))}updateLimboDocument(e,t){return this.Ai(e,t).next(e=>{e?this.di.delete(t.toString()):this.di.add(t.toString())})}ui(e){return 0}Ai(e,t){return eE.or([()=>eE.resolve(this.Ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Pi(e,t)])}}class sM{constructor(e,t){this.persistence=e,this.Ri=new ir(e=>ej(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new sf(this,t)}static Ei(e,t){return new sM(e,t)}li(){}hi(e){return eE.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}dr(e){let t=this.Vr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}Vr(e){let t=0;return this.Ar(e,e=>{t++}).next(()=>t)}Ar(e,t){return eE.forEach(this.Ri,(n,i)=>this.gr(e,n,i).next(e=>e?eE.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),r=i.newChangeBuffer();return i.Xr(e,i=>this.gr(e,i,t).next(e=>{e||(n++,r.removeEntry(i,er.min()))})).next(()=>r.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.Ri.set(t,e.currentSequenceNumber),eE.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),eE.resolve()}removeReference(e,t,n){return this.Ri.set(n,e.currentSequenceNumber),eE.resolve()}updateLimboDocument(e,t){return this.Ri.set(t,e.currentSequenceNumber),eE.resolve()}ui(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(nr(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=t3(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return tJ(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var i;let r;return i=t.mapValue,r=0,tF(i.fields,(t,n)=>{r+=t.length+e(n)}),r;default:throw F(13486,{value:t})}}(e.data.value)),t}gr(e,t,n){return eE.or([()=>this.persistence.Pi(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.Ri.get(t);return eE.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sF{constructor(e){this.serializer=e}q(e,t,n,i){let r=new eC("createOrUpgrade",t);n<1&&i>=1&&(!function(e){e.createObjectStore(eK)}(e),e.createObjectStore(eW,{keyPath:"userId"}),e.createObjectStore(eH,{keyPath:eQ,autoIncrement:!0}).createIndex(eY,eJ,{unique:!0}),e.createObjectStore(eZ),sU(e),function(e){e.createObjectStore(e$)}(e));let s=eE.resolve();return n<3&&i>=3&&(0!==n&&(e.deleteObjectStore(tt),e.deleteObjectStore(e9),e.deleteObjectStore(to),sU(e)),s=s.next(()=>(function(e){let t=e.store(to),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:er.min().toTimestamp(),targetCount:0};return t.put(ts,n)})(r))),n<4&&i>=4&&(0!==n&&(s=s.next(()=>r.store(eH).J().next(t=>{e.deleteObjectStore(eH),e.createObjectStore(eH,{keyPath:eQ,autoIncrement:!0}).createIndex(eY,eJ,{unique:!0});let n=r.store(eH),i=t.map(e=>n.put(e));return eE.waitFor(i)}))),s=s.next(()=>{!function(e){e.createObjectStore(th,{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(s=s.next(()=>this.Vi(r))),n<6&&i>=6&&(s=s.next(()=>((function(e){e.createObjectStore(e8)})(e),this.mi(r)))),n<7&&i>=7&&(s=s.next(()=>this.fi(r))),n<8&&i>=8&&(s=s.next(()=>this.gi(e,r))),n<9&&i>=9&&(s=s.next(()=>{e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")})),n<10&&i>=10&&(s=s.next(()=>this.pi(r))),n<11&&i>=11&&(s=s.next(()=>{(function(e){e.createObjectStore(tu,{keyPath:"bundleId"})})(e),function(e){e.createObjectStore(tc,{keyPath:"name"})}(e)})),n<12&&i>=12&&(s=s.next(()=>{!function(e){let t=e.createObjectStore(tb,{keyPath:tE});t.createIndex(tT,tC,{unique:!1}),t.createIndex(tS,tx,{unique:!1})}(e)})),n<13&&i>=13&&(s=s.next(()=>(function(e){let t=e.createObjectStore(e0,{keyPath:e1});t.createIndex(e2,e3),t.createIndex(e5,e6)})(e)).next(()=>this.yi(e,r)).next(()=>e.deleteObjectStore(e$))),n<14&&i>=14&&(s=s.next(()=>this.wi(e,r))),n<15&&i>=15&&(s=s.next(()=>{e.createObjectStore(td,{keyPath:"indexId",autoIncrement:!0}).createIndex(tf,"collectionGroup",{unique:!1}),e.createObjectStore(tp,{keyPath:tg}).createIndex(tm,ty,{unique:!1}),e.createObjectStore(t_,{keyPath:tv}).createIndex(tw,tI,{unique:!1})})),n<16&&i>=16&&(s=s.next(()=>{t.objectStore(tp).clear()}).next(()=>{t.objectStore(t_).clear()})),n<17&&i>=17&&(s=s.next(()=>{!function(e){e.createObjectStore(tk,{keyPath:"name"})}(e)})),s}mi(e){let t=0;return e.store(e$).te((e,n)=>{t+=sn(n)}).next(()=>{let n={byteSize:t};return e.store(e8).put(e4,n)})}Vi(e){let t=e.store(eW),n=e.store(eH);return t.J().next(t=>eE.forEach(t,t=>{let i=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.J(eY,i).next(n=>eE.forEach(n,n=>{V(n.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:n.batchId});let i=rR(this.serializer,n);return st(e,t.userId,i).next(()=>{})}))}))}fi(e){let t=e.store(tt),n=e.store(e$);return e.store(to).get(ts).next(e=>{let i=[];return n.te((n,r)=>{let s=new ea(n),o=[0,ej(s)];i.push(t.get(o).next(n=>n?eE.resolve():t.put({targetId:0,path:ej(s),sequenceNumber:e.highestListenSequenceNumber})))}).next(()=>eE.waitFor(i))})}gi(e,t){e.createObjectStore(ta,{keyPath:tl});let n=t.store(ta),i=new r5,r=e=>{if(i.add(e)){let t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:ej(i)})}};return t.store(e$).te({ee:!0},(e,t)=>r(new ea(e).popLast())).next(()=>t.store(eZ).te({ee:!0},([e,t,n],i)=>r(ez(t).popLast())))}pi(e){let t=e.store(e9);return t.te((e,n)=>{let i=rP(n),r=rD(this.serializer,i);return t.put(r)})}yi(e,t){let n=t.store(e$),i=[];return n.te((e,n)=>{let r=t.store(e0),s=(n.document?new eu(ea.fromString(n.document.name).popFirst(5)):n.noDocument?eu.fromSegments(n.noDocument.path):n.unknownDocument?eu.fromSegments(n.unknownDocument.path):F(36783)).path.toArray(),o={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};i.push(r.put(o))}).next(()=>eE.waitFor(i))}wi(e,t){let n=t.store(eH),i=new sy(this.serializer),r=new sD(sL.Ei,this.serializer.wt);return n.J().next(e=>{let n=new Map;return e.forEach(e=>{var t;let i=null!==(t=n.get(e.userId))&&void 0!==t?t:id();rR(this.serializer,e).keys().forEach(e=>i=i.add(e)),n.set(e.userId,i)}),eE.forEach(n,(e,n)=>{let s=new A(n),o=rV.bt(this.serializer,s),a=r.getIndexManager(s);return new sE(i,si.bt(s,this.serializer,a,r.referenceDelegate),o,a).recalculateAndSaveOverlaysForDocumentKeys(new tO(t,eU.le),e).next()})})}}function sU(e){e.createObjectStore(tt,{keyPath:tn}).createIndex(ti,tr,{unique:!0}),e.createObjectStore(e9,{keyPath:"targetId"}).createIndex(e7,te,{unique:!0}),e.createObjectStore(to)}let sV="IndexedDbPersistence",sq="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class sB{constructor(e,t,n,i,r,s,o,a,l,h,u=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.bi=r,this.window=s,this.document=o,this.Si=l,this.Di=h,this.Ci=u,this.si=null,this.oi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fi=null,this.inForeground=!1,this.Mi=null,this.xi=null,this.Oi=Number.NEGATIVE_INFINITY,this.Ni=e=>Promise.resolve(),!sB.C())throw new B(q.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new sp(this,i),this.Bi=t+"main",this.serializer=new rS(a),this.Li=new eS(this.Bi,this.Ci,new sF(this.serializer)),this._i=new rq,this.ai=new sa(this.referenceDelegate,this.serializer),this.remoteDocumentCache=new sy(this.serializer),this.ci=new rU,this.window&&this.window.localStorage?this.ki=this.window.localStorage:(this.ki=null,!1===h&&O(sV,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.qi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new B(q.FAILED_PRECONDITION,sq);return this.Qi(),this.$i(),this.Ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.ai.getHighestSequenceNumber(e))}).then(e=>{this.si=new eU(e,this.Si)}).then(()=>{this.oi=!0}).catch(e=>(this.Li&&this.Li.close(),Promise.reject(e)))}Ki(e){return this.Ni=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Li.U(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.bi.enqueueAndForget(async()=>{this.started&&await this.qi()}))}qi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>tL(e,th).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Wi(e).next(e=>{e||(this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)))})}).next(()=>this.Gi(e)).next(t=>this.isPrimary&&!t?this.zi(e).next(()=>!1):!!t&&this.ji(e).next(()=>!0))).catch(e=>{if(eN(e))return D(sV,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(sV,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.bi.enqueueRetryable(()=>this.Ni(e)),this.isPrimary=e})}Wi(e){return tL(e,eK).get(eG).next(e=>eE.resolve(this.Hi(e)))}Ji(e){return tL(e,th).delete(this.clientId)}async Yi(){if(this.isPrimary&&!this.Zi(this.Oi,18e5)){this.Oi=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=tL(e,th);return t.J().next(e=>{let n=this.Xi(e,18e5),i=e.filter(e=>-1===n.indexOf(e));return eE.forEach(i,e=>t.delete(e.clientId)).next(()=>i)})}).catch(()=>[]);if(this.ki)for(let t of e)this.ki.removeItem(this.es(t.clientId))}}Ui(){this.xi=this.bi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.qi().then(()=>this.Yi()).then(()=>this.Ui()))}Hi(e){return!!e&&e.ownerId===this.clientId}Gi(e){return this.Di?eE.resolve(!0):tL(e,eK).get(eG).next(t=>{if(null!==t&&this.Zi(t.leaseTimestampMs,5e3)&&!this.ts(t.ownerId)){if(this.Hi(t)&&this.networkEnabled)return!0;if(!this.Hi(t)){if(!t.allowTabSynchronization)throw new B(q.FAILED_PRECONDITION,sq);return!1}}return!(!this.networkEnabled||!this.inForeground)||tL(e,th).J().next(e=>void 0===this.Xi(e,5e3).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,i=this.networkEnabled===e.networkEnabled;if(t||n&&i)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&D(sV,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this.oi=!1,this.ns(),this.xi&&(this.xi.cancel(),this.xi=null),this.rs(),this.ss(),await this.Li.runTransaction("shutdown","readwrite",[eK,th],e=>{let t=new tO(e,eU.le);return this.zi(t).next(()=>this.Ji(t))}),this.Li.close(),this._s()}Xi(e,t){return e.filter(e=>this.Zi(e.updateTimeMs,t)&&!this.ts(e.clientId))}us(){return this.runTransaction("getActiveClients","readonly",e=>tL(e,th).J().next(e=>this.Xi(e,18e5).map(e=>e.clientId)))}get started(){return this.oi}getGlobalsCache(){return this._i}getMutationQueue(e,t){return si.bt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.ai}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new r4(e,this.serializer.wt.databaseId)}getDocumentOverlayCache(e){return rV.bt(this.serializer,e)}getBundleCache(){return this.ci}runTransaction(e,t,n){var i;let r;D(sV,"Starting transaction:",e);let s=17===(i=this.Ci)?tD:16===i?tP:15===i?tP:14===i?tR:13===i?tR:12===i?tN:11===i?tA:void F(60245);return this.Li.runTransaction(e,"readonly"===t?"readonly":"readwrite",s,i=>(r=new tO(i,this.si?this.si.next():eU.le),"readwrite-primary"===t?this.Wi(r).next(e=>!!e||this.Gi(r)).next(t=>{if(!t)throw O(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.bi.enqueueRetryable(()=>this.Ni(!1)),new B(q.FAILED_PRECONDITION,ew);return n(r)}).next(e=>this.ji(r).next(()=>e)):this.cs(r).next(()=>n(r)))).then(e=>(r.raiseOnCommittedEvent(),e))}cs(e){return tL(e,eK).get(eG).next(e=>{if(null!==e&&this.Zi(e.leaseTimestampMs,5e3)&&!this.ts(e.ownerId)&&!this.Hi(e)&&!(this.Di||this.allowTabSynchronization&&e.allowTabSynchronization))throw new B(q.FAILED_PRECONDITION,sq)})}ji(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tL(e,eK).put(eG,t)}static C(){return eS.C()}zi(e){let t=tL(e,eK);return t.get(eG).next(e=>this.Hi(e)?(D(sV,"Releasing primary lease."),t.delete(eG)):eE.resolve())}Zi(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(O(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Qi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Mi=()=>{this.bi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.qi()))},this.document.addEventListener("visibilitychange",this.Mi),this.inForeground="visible"===this.document.visibilityState)}rs(){this.Mi&&(this.document.removeEventListener("visibilitychange",this.Mi),this.Mi=null)}$i(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Fi=()=>{this.ns();let e=/(?:Version|Mobile)\/1[456]/;(0,w.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.bi.enterRestrictedMode(!0),this.bi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Fi))}ss(){this.Fi&&(this.window.removeEventListener("pagehide",this.Fi),this.Fi=null)}ts(e){var t;try{let n=null!==(null===(t=this.ki)||void 0===t?void 0:t.getItem(this.es(e)));return D(sV,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return O(sV,"Failed to get zombied client id.",e),!1}}ns(){if(this.ki)try{this.ki.setItem(this.es(this.clientId),String(Date.now()))}catch(e){O("Failed to set zombie client id.",e)}}_s(){if(this.ki)try{this.ki.removeItem(this.es(this.clientId))}catch(e){}}es(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function sj(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class sz{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.ls=n,this.hs=i}static Ps(e,t){let n=id(),i=id();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new sz(e,t.fromCache,n,i)}}class s${constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sK{constructor(){this.Ts=!1,this.Is=!1,this.Es=100,this.ds=(0,w.G6)()?8:ex((0,w.z$)())>0?6:4}initialize(e,t){this.As=e,this.indexManager=t,this.Ts=!0}getDocumentsMatchingQuery(e,t,n,i){let r={result:null};return this.Rs(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.Vs(e,t,i,n).next(e=>{r.result=e})}).next(()=>{if(r.result)return;let n=new s$;return this.fs(e,t,n).next(i=>{if(r.result=i,this.Is)return this.gs(e,t,n,i.size)})}).next(()=>r.result)}gs(e,t,n,i){return n.documentReadCount<this.Es?(P()<=v.in.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",n7(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Es,"documents"),eE.resolve()):(P()<=v.in.DEBUG&&D("QueryEngine","Query:",n7(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.ds*i?(P()<=v.in.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",n7(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,n5(t))):eE.resolve())}Rs(e,t){if(n1(t))return eE.resolve(null);let n=n5(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(n=n5(t=n8(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(i=>{let r=id(...i);return this.As.getDocuments(e,r).next(i=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.ps(t,i);return this.ys(t,s,r,n.readTime)?this.Rs(e,n8(t,null,"F")):this.ws(e,s,t,n)}))})))}Vs(e,t,n,i){return n1(t)||i.isEqual(er.min())?eE.resolve(null):this.As.getDocuments(e,n).next(r=>{let s=this.ps(t,r);return this.ys(t,s,n,i)?eE.resolve(null):(P()<=v.in.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),n7(t)),this.ws(e,s,t,em(i,-1)).next(e=>e))})}ps(e,t){let n=new tj(ii(e));return t.forEach((t,i)=>{ie(e,i)&&(n=n.add(i))}),n}ys(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}fs(e,t,n){return P()<=v.in.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",n7(t)),this.As.getDocumentsMatchingQuery(e,t,e_.min(),n)}ws(e,t,n,i){return this.As.getDocumentsMatchingQuery(e,n,i).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let sG="LocalStore";class sW{constructor(e,t,n,i){this.persistence=e,this.bs=t,this.serializer=i,this.Ss=new tV(Z),this.Ds=new ir(e=>nW(e),nH),this.vs=new Map,this.Cs=e.getRemoteDocumentCache(),this.ai=e.getTargetCache(),this.ci=e.getBundleCache(),this.Fs(n)}Fs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sE(this.Cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Cs.setIndexManager(this.indexManager),this.bs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ss))}}async function sH(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(r=>(i=r,e.Fs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let r=[],s=[],o=id();for(let e of i)for(let t of(r.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ms:e,removedBatchIds:r,addedBatchIds:s}))})})}function sQ(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.ai.getLastRemoteSnapshotVersion(t))}function sY(e,t,n){let i=id(),r=id();return n.forEach(e=>i=i.add(e)),t.getEntries(e,i).next(e=>{let i=is;return n.forEach((n,s)=>{let o=e.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(er.min())?(t.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),i=i.insert(n,s)):D(sG,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{xs:i,Os:r}})}function sJ(e,t){return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.ai.getTargetData(n,t).next(r=>r?(i=r,eE.resolve(i)):e.ai.allocateTargetId(n).next(r=>(i=new rC(t,r,"TargetPurposeListen",n.currentSequenceNumber),e.ai.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.Ss.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Ss=e.Ss.insert(n.targetId,n),e.Ds.set(t,n.targetId)),n})}async function sX(e,t,n){let i=e.Ss.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,i))}catch(e){if(!eN(e))throw e;D(sG,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ss=e.Ss.remove(t),e.Ds.delete(i.target)}function sZ(e,t,n){let i=er.min(),r=id();return e.persistence.runTransaction("Execute query","readwrite",s=>(function(e,t,n){let i=e.Ds.get(n);return void 0!==i?eE.resolve(e.Ss.get(i)):e.ai.getTargetData(t,n)})(e,s,n5(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,e.ai.getMatchingKeysForTargetId(s,t.targetId).next(e=>{r=e})}).next(()=>e.bs.getDocumentsMatchingQuery(s,t,n?i:er.min(),n?r:id())).next(n=>(s2(e,it(t),n),{documents:n,Ns:r})))}function s0(e,t){let n=e.ai,i=e.Ss.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",e=>n.Rt(e,t).next(e=>e?e.target:null))}function s1(e,t){let n=e.vs.get(t)||er.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.Cs.getAllFromCollectionGroup(i,t,em(n,-1),Number.MAX_SAFE_INTEGER)).then(n=>(s2(e,t,n),n))}function s2(e,t,n){let i=e.vs.get(t)||er.min();n.forEach((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)}),e.vs.set(t,i)}let s3="firestore_clients";function s5(e,t){return`${s3}_${e}_${t}`}let s6="firestore_mutations";function s8(e,t,n){let i=`${s6}_${e}_${n}`;return t.isAuthenticated()&&(i+=`_${t.uid}`),i}let s4="firestore_targets";function s9(e,t){return`${s4}_${e}_${t}`}let s7="SharedClientState";class oe{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static qs(e,t,n){let i=JSON.parse(n),r,s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new B(i.error.code,i.error.message)),s?new oe(e,t,i.state,r):(O(s7,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Qs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ot{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static qs(e,t){let n=JSON.parse(t),i,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new B(n.error.code,n.error.message)),r?new ot(e,n.state,i):(O(s7,`Failed to parse target state for ID '${e}': ${t}`),null)}Qs(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class on{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static qs(e,t){let n=JSON.parse(t),i="object"==typeof n&&n.activeTargetIds instanceof Array,r=ip;for(let e=0;i&&e<n.activeTargetIds.length;++e)i=eB(n.activeTargetIds[e]),r=r.add(n.activeTargetIds[e]);return i?new on(e,r):(O(s7,`Failed to parse client data for instance '${e}': ${t}`),null)}}class oi{constructor(e,t){this.clientId=e,this.onlineState=t}static qs(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new oi(t.clientId,t.onlineState):(O(s7,`Failed to parse online state: ${e}`),null)}}class or{constructor(){this.activeTargetIds=ip}$s(e){this.activeTargetIds=this.activeTargetIds.add(e)}Us(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Qs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class os{constructor(e,t,n,i,r){var s,o,a;this.window=e,this.bi=t,this.persistenceKey=n,this.Ks=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Ws=this.Gs.bind(this),this.zs=new tV(Z),this.started=!1,this.js=[];let l=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Hs=s5(this.persistenceKey,this.Ks),this.Js=(s=this.persistenceKey,`firestore_sequence_number_${s}`),this.zs=this.zs.insert(this.Ks,new or),this.Ys=RegExp(`^${s3}_${l}_([^_]*)$`),this.Zs=RegExp(`^${s6}_${l}_(\\d+)(?:_(.*))?$`),this.Xs=RegExp(`^${s4}_${l}_(\\d+)$`),this.eo=(o=this.persistenceKey,`firestore_online_state_${o}`),this.no=(a=this.persistenceKey,`firestore_bundle_loaded_v2_${a}`),this.window.addEventListener("storage",this.Ws)}static C(e){return!(!e||!e.localStorage)}async start(){for(let e of(await this.syncEngine.us())){if(e===this.Ks)continue;let t=this.getItem(s5(this.persistenceKey,e));if(t){let n=on.qs(e,t);n&&(this.zs=this.zs.insert(n.clientId,n))}}this.ro();let e=this.storage.getItem(this.eo);if(e){let t=this.io(e);t&&this.so(t)}for(let e of this.js)this.Gs(e);this.js=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.Js,JSON.stringify(e))}getAllActiveQueryTargets(){return this.oo(this.zs)}isActiveQueryTarget(e){let t=!1;return this.zs.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this._o(e,"pending")}updateMutationState(e,t,n){this._o(e,t,n),this.ao(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(s9(this.persistenceKey,e));if(t){let i=ot.qs(e,t);i&&(n=i.state)}}return t&&this.uo.$s(e),this.ro(),n}removeLocalQueryTarget(e){this.uo.Us(e),this.ro()}isLocalQueryTarget(e){return this.uo.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(s9(this.persistenceKey,e))}updateQueryState(e,t,n){this.co(e,t,n)}handleUserChange(e,t,n){t.forEach(e=>{this.ao(e)}),this.currentUser=e,n.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.lo(e)}notifyBundleLoaded(e){this.ho(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Ws),this.removeItem(this.Hs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(s7,"READ",e,t),t}setItem(e,t){D(s7,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(s7,"REMOVE",e),this.storage.removeItem(e)}Gs(e){if(e.storageArea===this.storage){if(D(s7,"EVENT",e.key,e.newValue),e.key===this.Hs)return void O("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.bi.enqueueRetryable(async()=>{if(this.started){if(null!==e.key){if(this.Ys.test(e.key)){if(null==e.newValue){let t=this.Po(e.key);return this.To(t,null)}{let t=this.Io(e.key,e.newValue);if(t)return this.To(t.clientId,t)}}else if(this.Zs.test(e.key)){if(null!==e.newValue){let t=this.Eo(e.key,e.newValue);if(t)return this.Ao(t)}}else if(this.Xs.test(e.key)){if(null!==e.newValue){let t=this.Ro(e.key,e.newValue);if(t)return this.Vo(t)}}else if(e.key===this.eo){if(null!==e.newValue){let t=this.io(e.newValue);if(t)return this.so(t)}}else if(e.key===this.Js){let t=function(e){let t=eU.le;if(null!=e)try{let n=JSON.parse(e);V("number"==typeof n,30636,{mo:e}),t=n}catch(e){O(s7,"Failed to read sequence number from WebStorage",e)}return t}(e.newValue);t!==eU.le&&this.sequenceNumberHandler(t)}else if(e.key===this.no){let t=this.fo(e.newValue);await Promise.all(t.map(e=>this.syncEngine.po(e)))}}}else this.js.push(e)})}}get uo(){return this.zs.get(this.Ks)}ro(){this.setItem(this.Hs,this.uo.Qs())}_o(e,t,n){let i=new oe(this.currentUser,e,t,n),r=s8(this.persistenceKey,this.currentUser,e);this.setItem(r,i.Qs())}ao(e){let t=s8(this.persistenceKey,this.currentUser,e);this.removeItem(t)}lo(e){let t={clientId:this.Ks,onlineState:e};this.storage.setItem(this.eo,JSON.stringify(t))}co(e,t,n){let i=s9(this.persistenceKey,e),r=new ot(e,t,n);this.setItem(i,r.Qs())}ho(e){let t=JSON.stringify(Array.from(e));this.setItem(this.no,t)}Po(e){let t=this.Ys.exec(e);return t?t[1]:null}Io(e,t){let n=this.Po(e);return on.qs(n,t)}Eo(e,t){let n=this.Zs.exec(e),i=Number(n[1]),r=void 0!==n[2]?n[2]:null;return oe.qs(new A(r),i,t)}Ro(e,t){let n=Number(this.Xs.exec(e)[1]);return ot.qs(n,t)}io(e){return oi.qs(e)}fo(e){return JSON.parse(e)}async Ao(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.yo(e.batchId,e.state,e.error);D(s7,`Ignoring mutation for non-active user ${e.user.uid}`)}Vo(e){return this.syncEngine.wo(e.targetId,e.state,e.error)}To(e,t){let n=t?this.zs.insert(e,t):this.zs.remove(e),i=this.oo(this.zs),r=this.oo(n),s=[],o=[];return r.forEach(e=>{i.has(e)||s.push(e)}),i.forEach(e=>{r.has(e)||o.push(e)}),this.syncEngine.bo(s,o).then(()=>{this.zs=n})}so(e){this.zs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}oo(e){let t=ip;return e.forEach((e,n)=>{t=t.unionWith(n.activeTargetIds)}),t}}class oo{constructor(){this.So=new or,this.Do={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.So.$s(e),this.Do[e]||"not-current"}updateQueryState(e,t,n){this.Do[e]=t}removeLocalQueryTarget(e){this.So.Us(e)}isLocalQueryTarget(e){return this.So.activeTargetIds.has(e)}clearQueryState(e){delete this.Do[e]}getAllActiveQueryTargets(){return this.So.activeTargetIds}isActiveQueryTarget(e){return this.So.activeTargetIds.has(e)}start(){return this.So=new or,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class oa{vo(e){}shutdown(){}}let ol="ConnectivityMonitor";class oh{constructor(){this.Co=()=>this.Fo(),this.Mo=()=>this.xo(),this.Oo=[],this.No()}vo(e){this.Oo.push(e)}shutdown(){window.removeEventListener("online",this.Co),window.removeEventListener("offline",this.Mo)}No(){window.addEventListener("online",this.Co),window.addEventListener("offline",this.Mo)}Fo(){for(let e of(D(ol,"Network connectivity changed: AVAILABLE"),this.Oo))e(0)}xo(){for(let e of(D(ol,"Network connectivity changed: UNAVAILABLE"),this.Oo))e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ou=null;function oc(){return null===ou?ou=0x10000000+Math.round(0x80000000*Math.random()):ou++,"0x"+ou.toString(16)}let od="RestConnection",of={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class op{get Bo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.Lo=t+"://"+e.host,this.ko=`projects/${n}/databases/${i}`,this.qo=this.databaseId.database===t8?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Qo(e,t,n,i,r){let s=oc(),o=this.$o(e,t.toUriEncodedString());D(od,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.ko,"x-goog-request-params":this.qo};this.Uo(a,i,r);let{host:l}=new URL(o),h=(0,w.Xx)(l);return this.Ko(e,o,a,n,h).then(t=>(D(od,`Received RPC '${e}' ${s}: `,t),t),t=>{throw L(od,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Wo(e,t,n,i,r,s){return this.Qo(e,t,n,i,r)}Uo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+N,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}$o(e,t){let n=of[e];return`${this.Lo}/v1/${t}:${n}`}terminate(){}}class og{constructor(e){this.Go=e.Go,this.zo=e.zo}jo(e){this.Ho=e}Jo(e){this.Yo=e}Zo(e){this.Xo=e}onMessage(e){this.e_=e}close(){this.zo()}send(e){this.Go(e)}t_(){this.Ho()}n_(){this.Yo()}r_(e){this.Xo(e)}i_(e){this.e_(e)}}let om="WebChannelConnection";class oy extends op{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Ko(e,t,n,i,r){let o=oc();return new Promise((r,h)=>{let u=new s;u.setWithCredentials(!0),u.listenOnce(a.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case l.NO_ERROR:let t=u.getResponseJson();D(om,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(t)),r(t);break;case l.TIMEOUT:D(om,`RPC '${e}' ${o} timed out`),h(new B(q.DEADLINE_EXCEEDED,"Request time out"));break;case l.HTTP_ERROR:let n=u.getStatus();if(D(om,`RPC '${e}' ${o} failed with status:`,n,"response text:",u.getResponseText()),n>0){let e=u.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=null==e?void 0:e.error;if(t&&t.status&&t.message){let e=function(e){let t=e.toLowerCase().replace(/_/g,"-");return Object.values(q).indexOf(t)>=0?t:q.UNKNOWN}(t.status);h(new B(e,t.message))}else h(new B(q.UNKNOWN,"Server responded with status "+u.getStatus()))}else h(new B(q.UNAVAILABLE,"Connection failed."));break;default:F(9055,{s_:e,streamId:o,o_:u.getLastErrorCode(),__:u.getLastError()})}}finally{D(om,`RPC '${e}' ${o} completed.`)}});let c=JSON.stringify(i);D(om,`RPC '${e}' ${o} sending request:`,i),u.send(t,"POST",c,n,15)})}a_(e,t,n){let i=oc(),r=[this.Lo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=d(),a=c(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;void 0!==p&&(l.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(l.useFetchStreams=!0),this.Uo(l.initMessageHeaders,t,n),l.encodeInitMessageHeaders=!0;let g=r.join("");D(om,`Creating RPC '${e}' stream ${i}: ${g}`,l);let m=s.createWebChannel(g,l),y=!1,_=!1,v=new og({Go:t=>{_?D(om,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(y||(D(om,`Opening RPC '${e}' stream ${i} transport.`),m.open(),y=!0),D(om,`RPC '${e}' stream ${i} sending:`,t),m.send(t))},zo:()=>m.close()}),w=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return w(m,o.EventType.OPEN,()=>{_||(D(om,`RPC '${e}' stream ${i} transport opened.`),v.t_())}),w(m,o.EventType.CLOSE,()=>{_||(_=!0,D(om,`RPC '${e}' stream ${i} transport closed`),v.r_())}),w(m,o.EventType.ERROR,t=>{_||(_=!0,L(om,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),v.r_(new B(q.UNAVAILABLE,"The operation could not be completed")))}),w(m,o.EventType.MESSAGE,t=>{var n;if(!_){let r=t.data[0];V(!!r,16349);let s=(null==r?void 0:r.error)||(null===(n=r[0])||void 0===n?void 0:n.error);if(s){D(om,`RPC '${e}' stream ${i} received error:`,s);let t=s.status,n=function(e){let t=f[e];if(void 0!==t)return iW(t)}(t),r=s.message;void 0===n&&(n=q.INTERNAL,r="Unknown error status: "+t+" with message "+s.message),_=!0,v.r_(new B(n,r)),m.close()}else D(om,`RPC '${e}' stream ${i} received:`,r),v.i_(r)}}),w(a,u.STAT_EVENT,t=>{t.stat===h.PROXY?D(om,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===h.NOPROXY&&D(om,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{v.n_()},0),v}}function o_(){return"undefined"!=typeof window?window:null}function ov(){return"undefined"!=typeof document?document:null}function ow(e){return new rt(e,!0)}class oI{constructor(e,t,n=1e3,i=1.5,r=6e4){this.bi=e,this.timerId=t,this.u_=n,this.c_=i,this.l_=r,this.h_=0,this.P_=null,this.T_=Date.now(),this.reset()}reset(){this.h_=0}I_(){this.h_=this.l_}E_(e){this.cancel();let t=Math.floor(this.h_+this.d_()),n=Math.max(0,Date.now()-this.T_),i=Math.max(0,t-n);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.h_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.P_=this.bi.enqueueAfterDelay(this.timerId,i,()=>(this.T_=Date.now(),e())),this.h_*=this.c_,this.h_<this.u_&&(this.h_=this.u_),this.h_>this.l_&&(this.h_=this.l_)}A_(){null!==this.P_&&(this.P_.skipDelay(),this.P_=null)}cancel(){null!==this.P_&&(this.P_.cancel(),this.P_=null)}d_(){return(Math.random()-.5)*this.h_}}let ob="PersistentStream";class oE{constructor(e,t,n,i,r,s,o,a){this.bi=e,this.R_=n,this.V_=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.m_=0,this.f_=null,this.g_=null,this.stream=null,this.p_=0,this.y_=new oI(e,t)}w_(){return 1===this.state||5===this.state||this.b_()}b_(){return 2===this.state||3===this.state}start(){this.p_=0,4!==this.state?this.auth():this.S_()}async stop(){this.w_()&&await this.close(0)}D_(){this.state=0,this.y_.reset()}v_(){this.b_()&&null===this.f_&&(this.f_=this.bi.enqueueAfterDelay(this.R_,6e4,()=>this.C_()))}F_(e){this.M_(),this.stream.send(e)}async C_(){if(this.b_())return this.close(0)}M_(){this.f_&&(this.f_.cancel(),this.f_=null)}x_(){this.g_&&(this.g_.cancel(),this.g_=null)}async close(e,t){this.M_(),this.x_(),this.y_.cancel(),this.m_++,4!==e?this.y_.reset():t&&t.code===q.RESOURCE_EXHAUSTED?(O(t.toString()),O("Using maximum backoff delay to prevent overloading the backend."),this.y_.I_()):t&&t.code===q.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.O_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zo(t)}O_(){}auth(){this.state=1;let e=this.N_(this.m_),t=this.m_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.m_===t&&this.B_(e,n)},t=>{e(()=>{let e=new B(q.UNKNOWN,"Fetching auth token failed: "+t.message);return this.L_(e)})})}B_(e,t){let n=this.N_(this.m_);this.stream=this.k_(e,t),this.stream.jo(()=>{n(()=>this.listener.jo())}),this.stream.Jo(()=>{n(()=>(this.state=2,this.g_=this.bi.enqueueAfterDelay(this.V_,1e4,()=>(this.b_()&&(this.state=3),Promise.resolve())),this.listener.Jo()))}),this.stream.Zo(e=>{n(()=>this.L_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.p_?this.q_(e):this.onNext(e))})}S_(){this.state=5,this.y_.E_(async()=>{this.state=0,this.start()})}L_(e){return D(ob,`close with error: ${e}`),this.stream=null,this.close(4,e)}N_(e){return t=>{this.bi.enqueueAndForget(()=>this.m_===e?t():(D(ob,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class oT extends oE{constructor(e,t,n,i,r,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}k_(e,t){return this.connection.a_("Listen",e,t)}q_(e){return this.onNext(e)}onNext(e){this.y_.reset();let t=function(e,t){let n;if("targetChange"in t){var i,r;t.targetChange;let s="NO_CHANGE"===(i=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===i?1:"REMOVE"===i?2:"CURRENT"===i?3:"RESET"===i?4:F(39313,{state:i}),o=t.targetChange.targetIds||[],a=(r=t.targetChange.resumeToken,e.useProto3Json?(V(void 0===r||"string"==typeof r,58123),tW.fromBase64String(r||"")):(V(void 0===r||r instanceof S||r instanceof Uint8Array,16193),tW.fromUint8Array(r||new Uint8Array))),l=t.targetChange.cause;n=new i3(s,o,a,l&&new B(void 0===l.code?q.UNKNOWN:iW(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let i=t.documentChange;i.document,i.document.name,i.document.updateTime;let r=ru(e,i.document.name),s=rs(i.document.updateTime),o=i.document.createTime?rs(i.document.createTime):er.min(),a=new nE({mapValue:{fields:i.document.fields}}),l=nT.newFoundDocument(r,s,o,a);n=new i1(i.targetIds||[],i.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let i=t.documentDelete;i.document;let r=ru(e,i.document),s=i.readTime?rs(i.readTime):er.min(),o=nT.newNoDocument(r,s);n=new i1([],i.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let i=t.documentRemove;i.document;let r=ru(e,i.document);n=new i1([],i.removedTargetIds||[],r,null)}else{if(!("filter"in t))return F(11601,{Vt:t});{t.filter;let e=t.filter;e.targetId;let{count:i=0,unchangedNames:r}=e,s=new iG(i,r);n=new i2(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return er.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?er.min():t.readTime?rs(t.readTime):er.min()}(e);return this.listener.Q_(t,n)}U_(e){let t={};t.database=rf(this.serializer),t.addTarget=function(e,t){let n;let i=t.target;if((n=nQ(i)?{documents:rv(e,i)}:{query:rw(e,i).gt}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=rr(e,t.resumeToken);let i=rn(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(er.min())>0){n.readTime=ri(e,t.snapshotVersion.toTimestamp());let i=rn(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);let n=function(e,t){let n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.F_(t)}K_(e){let t={};t.database=rf(this.serializer),t.removeTarget=e,this.F_(t)}}class oC extends oE{constructor(e,t,n,i,r,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,s),this.serializer=r}get W_(){return this.p_>0}start(){this.lastStreamToken=void 0,super.start()}O_(){this.W_&&this.G_([])}k_(e,t){return this.connection.a_("Write",e,t)}q_(e){return V(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,V(!e.writeResults||0===e.writeResults.length,55816),this.listener.z_()}onNext(e){var t,n;V(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.y_.reset();let i=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(V(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?rs(e.updateTime):rs(n)).isEqual(er.min())&&(t=rs(n)),new iA(t,e.transformResults||[])})):[]),r=rs(e.commitTime);return this.listener.j_(r,i)}H_(){let e={};e.database=rf(this.serializer),this.F_(e)}G_(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>ry(this.serializer,e))};this.F_(t)}}class oS{}class ox extends oS{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.J_=!1}Y_(){if(this.J_)throw new B(q.FAILED_PRECONDITION,"The client has already been terminated.")}Qo(e,t,n,i){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.Qo(e,ra(t,n),i,r,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new B(q.UNKNOWN,e.toString())})}Wo(e,t,n,i,r){return this.Y_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(e,ra(t,n),i,s,o,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===q.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new B(q.UNKNOWN,e.toString())})}terminate(){this.J_=!0,this.connection.terminate()}}class ok{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.Z_=0,this.X_=null,this.ea=!0}ta(){0===this.Z_&&(this.na("Unknown"),this.X_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.X_=null,this.ra("Backend didn't respond within 10 seconds."),this.na("Offline"),Promise.resolve())))}ia(e){"Online"===this.state?this.na("Unknown"):(this.Z_++,this.Z_>=1&&(this.sa(),this.ra(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.na("Offline")))}set(e){this.sa(),this.Z_=0,"Online"===e&&(this.ea=!1),this.na(e)}na(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ra(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ea?(O(t),this.ea=!1):D("OnlineStateTracker",t)}sa(){null!==this.X_&&(this.X_.cancel(),this.X_=null)}}let oA="RemoteStore";class oN{constructor(e,t,n,i,r){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.oa=[],this._a=new Map,this.aa=new Set,this.ua=[],this.ca=r,this.ca.vo(e=>{n.enqueueAndForget(async()=>{oV(this)&&(D(oA,"Restarting streams for network reachability change."),await async function(e){e.aa.add(4),await oP(e),e.la.set("Unknown"),e.aa.delete(4),await oR(e)}(this))})}),this.la=new ok(n,i)}}async function oR(e){if(oV(e))for(let t of e.ua)await t(!0)}async function oP(e){for(let t of e.ua)await t(!1)}function oD(e,t){e._a.has(t.targetId)||(e._a.set(t.targetId,t),oU(e)?oF(e):o1(e).b_()&&oL(e,t))}function oO(e,t){let n=o1(e);e._a.delete(t),n.b_()&&oM(e,t),0===e._a.size&&(n.b_()?n.v_():oV(e)&&e.la.set("Unknown"))}function oL(e,t){if(e.ha.Ke(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(er.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}o1(e).U_(t)}function oM(e,t){e.ha.Ke(t),o1(e).K_(t)}function oF(e){e.ha=new i6({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Rt:t=>e._a.get(t)||null,Pt:()=>e.datastore.serializer.databaseId}),o1(e).start(),e.la.ta()}function oU(e){return oV(e)&&!o1(e).w_()&&e._a.size>0}function oV(e){return 0===e.aa.size}async function oq(e){e.la.set("Online")}async function oB(e){e._a.forEach((t,n)=>{oL(e,t)})}async function oj(e,t){e.ha=void 0,oU(e)?(e.la.ia(t),oF(e)):e.la.set("Unknown")}async function oz(e,t,n){if(e.la.set("Online"),t instanceof i3&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let i of t.targetIds)e._a.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e._a.delete(i),e.ha.removeTarget(i))}(e,t)}catch(n){D(oA,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await o$(e,n)}else if(t instanceof i1?e.ha.Xe(t):t instanceof i2?e.ha.ot(t):e.ha.nt(t),!n.isEqual(er.min()))try{let t=await sQ(e.localStore);n.compareTo(t)>=0&&await function(e,t){let n=e.ha.It(t);return n.targetChanges.forEach((n,i)=>{if(n.resumeToken.approximateByteSize()>0){let r=e._a.get(i);r&&e._a.set(i,r.withResumeToken(n.resumeToken,t))}}),n.targetMismatches.forEach((t,n)=>{let i=e._a.get(t);if(!i)return;e._a.set(t,i.withResumeToken(tW.EMPTY_BYTE_STRING,i.snapshotVersion)),oM(e,t);let r=new rC(i.target,t,n,i.sequenceNumber);oL(e,r)}),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){D(oA,"Failed to raise snapshot:",t),await o$(e,t)}}async function o$(e,t,n){if(!eN(t))throw t;e.aa.add(1),await oP(e),e.la.set("Offline"),n||(n=()=>sQ(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{D(oA,"Retrying IndexedDB access"),await n(),e.aa.delete(1),await oR(e)})}function oK(e,t){return t().catch(n=>o$(e,n,t))}async function oG(e){let t=o2(e),n=e.oa.length>0?e.oa[e.oa.length-1].batchId:-1;for(;oV(e)&&e.oa.length<10;)try{let i=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,n);if(null===i){0===e.oa.length&&t.v_();break}n=i.batchId,function(e,t){e.oa.push(t);let n=o2(e);n.b_()&&n.W_&&n.G_(t.mutations)}(e,i)}catch(t){await o$(e,t)}oW(e)&&oH(e)}function oW(e){return oV(e)&&!o2(e).w_()&&e.oa.length>0}function oH(e){o2(e).start()}async function oQ(e){o2(e).H_()}async function oY(e){let t=o2(e);for(let n of e.oa)t.G_(n.mutations)}async function oJ(e,t,n){let i=e.oa.shift(),r=i$.from(i,t,n);await oK(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),await oG(e)}async function oX(e,t){t&&o2(e).W_&&await async function(e,t){var n;if(function(e){switch(e){case q.OK:return F(64938);case q.CANCELLED:case q.UNKNOWN:case q.DEADLINE_EXCEEDED:case q.RESOURCE_EXHAUSTED:case q.INTERNAL:case q.UNAVAILABLE:case q.UNAUTHENTICATED:return!1;case q.INVALID_ARGUMENT:case q.NOT_FOUND:case q.ALREADY_EXISTS:case q.PERMISSION_DENIED:case q.FAILED_PRECONDITION:case q.ABORTED:case q.OUT_OF_RANGE:case q.UNIMPLEMENTED:case q.DATA_LOSS:return!0;default:return F(15467,{code:e})}}(n=t.code)&&n!==q.ABORTED){let n=e.oa.shift();o2(e).D_(),await oK(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await oG(e)}}(e,t),oW(e)&&oH(e)}async function oZ(e,t){e.asyncQueue.verifyOperationInProgress(),D(oA,"RemoteStore received new credentials");let n=oV(e);e.aa.add(3),await oP(e),n&&e.la.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.aa.delete(3),await oR(e)}async function o0(e,t){t?(e.aa.delete(2),await oR(e)):t||(e.aa.add(2),await oP(e),e.la.set("Unknown"))}function o1(e){var t,n,i;return e.Pa||(e.Pa=(t=e.datastore,n=e.asyncQueue,i={jo:oq.bind(null,e),Jo:oB.bind(null,e),Zo:oj.bind(null,e),Q_:oz.bind(null,e)},t.Y_(),new oT(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i)),e.ua.push(async t=>{t?(e.Pa.D_(),oU(e)?oF(e):e.la.set("Unknown")):(await e.Pa.stop(),e.ha=void 0)})),e.Pa}function o2(e){var t,n,i;return e.Ta||(e.Ta=(t=e.datastore,n=e.asyncQueue,i={jo:()=>Promise.resolve(),Jo:oQ.bind(null,e),Zo:oX.bind(null,e),z_:oY.bind(null,e),j_:oJ.bind(null,e)},t.Y_(),new oC(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,i)),e.ua.push(async t=>{t?(e.Ta.D_(),await oG(e)):(await e.Ta.stop(),e.oa.length>0&&(D(oA,`Stopping write stream with ${e.oa.length} pending writes`),e.oa=[]))})),e.Ta}class o3{constructor(e,t,n,i,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new j,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,r){let s=new o3(e,t,Date.now()+n,i,r);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new B(q.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function o5(e,t){if(O("AsyncQueue",`${t}: ${e}`),eN(e))return new B(q.UNAVAILABLE,`${t}: ${e}`);throw e}class o6{static emptySet(e){return new o6(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||eu.comparator(t.key,n.key):(e,t)=>eu.comparator(e.key,t.key),this.keyedMap=ia(),this.sortedSet=new tV(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof o6)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new o6;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class o8{constructor(){this.Ia=new tV(eu.comparator)}track(e){let t=e.doc.key,n=this.Ia.get(t);n?0!==e.type&&3===n.type?this.Ia=this.Ia.insert(t,e):3===e.type&&1!==n.type?this.Ia=this.Ia.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Ia=this.Ia.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Ia=this.Ia.remove(t):1===e.type&&2===n.type?this.Ia=this.Ia.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Ia=this.Ia.insert(t,{type:2,doc:e.doc}):F(63341,{Vt:e,Ea:n}):this.Ia=this.Ia.insert(t,e)}da(){let e=[];return this.Ia.inorderTraversal((t,n)=>{e.push(n)}),e}}class o4{constructor(e,t,n,i,r,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,r){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new o4(e,t,o6.emptySet(t),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&n4(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class o9{constructor(){this.Aa=void 0,this.Ra=[]}Va(){return this.Ra.some(e=>e.ma())}}class o7{constructor(){this.queries=ae(),this.onlineState="Unknown",this.fa=new Set}terminate(){!function(e,t){let n=e.queries;e.queries=ae(),n.forEach((e,n)=>{for(let e of n.Ra)e.onError(t)})}(this,new B(q.ABORTED,"Firestore shutting down"))}}function ae(){return new ir(e=>n9(e),n4)}async function at(e,t){let n=3,i=t.query,r=e.queries.get(i);r?!r.Va()&&t.ma()&&(n=2):(r=new o9,n=t.ma()?0:1);try{switch(n){case 0:r.Aa=await e.onListen(i,!0);break;case 1:r.Aa=await e.onListen(i,!1);break;case 2:await e.onFirstRemoteStoreListen(i)}}catch(n){let e=o5(n,`Initialization of query '${n7(t.query)}' failed`);return void t.onError(e)}e.queries.set(i,r),r.Ra.push(t),t.ga(e.onlineState),r.Aa&&t.pa(r.Aa)&&as(e)}async function an(e,t){let n=t.query,i=3,r=e.queries.get(n);if(r){let e=r.Ra.indexOf(t);e>=0&&(r.Ra.splice(e,1),0===r.Ra.length?i=t.ma()?0:1:!r.Va()&&t.ma()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function ai(e,t){let n=!1;for(let i of t){let t=i.query,r=e.queries.get(t);if(r){for(let e of r.Ra)e.pa(i)&&(n=!0);r.Aa=i}}n&&as(e)}function ar(e,t,n){let i=e.queries.get(t);if(i)for(let e of i.Ra)e.onError(n);e.queries.delete(t)}function as(e){e.fa.forEach(e=>{e.next()})}(m=g||(g={})).ya="default",m.Cache="cache";class ao{constructor(e,t,n){this.query=e,this.wa=t,this.ba=!1,this.Sa=null,this.onlineState="Unknown",this.options=n||{}}pa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new o4(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ba?this.Da(e)&&(this.wa.next(e),t=!0):this.va(e,this.onlineState)&&(this.Ca(e),t=!0),this.Sa=e,t}onError(e){this.wa.error(e)}ga(e){this.onlineState=e;let t=!1;return this.Sa&&!this.ba&&this.va(this.Sa,e)&&(this.Ca(this.Sa),t=!0),t}va(e,t){return!(e.fromCache&&this.ma())||(!this.options.Fa||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Da(e){if(e.docChanges.length>0)return!0;let t=this.Sa&&this.Sa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Ca(e){e=o4.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ba=!0,this.wa.next(e)}ma(){return this.options.source!==g.Cache}}class aa{constructor(e){this.key=e}}class al{constructor(e){this.key=e}}class ah{constructor(e,t){this.query=e,this.qa=t,this.Qa=null,this.hasCachedResults=!1,this.current=!1,this.$a=id(),this.mutatedKeys=id(),this.Ua=ii(e),this.Ka=new o6(this.Ua)}get Wa(){return this.qa}Ga(e,t){let n=t?t.za:new o8,i=t?t.Ka:this.Ka,r=t?t.mutatedKeys:this.mutatedKeys,s=i,o=!1,a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((e,t)=>{let h=i.get(e),u=ie(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.ja(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.Ua(u,a)>0||l&&0>this.Ua(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),r=d?r.add(e):r.delete(e)):(s=s.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),r=r.delete(e.key),n.track({type:1,doc:e})}return{Ka:s,za:n,ys:o,mutatedKeys:r}}ja(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let r=this.Ka;this.Ka=e.Ka,this.mutatedKeys=e.mutatedKeys;let s=e.za.da();s.sort((e,t)=>(function(e,t){let n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Vt:e})}};return n(e)-n(t)})(e.type,t.type)||this.Ua(e.doc,t.doc)),this.Ha(n),i=null!=i&&i;let o=t&&!i?this.Ja():[],a=0===this.$a.size&&this.current&&!i?1:0,l=a!==this.Qa;return(this.Qa=a,0!==s.length||l)?{snapshot:new o4(this.query,e.Ka,r,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ya:o}:{Ya:o}}ga(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ka:this.Ka,za:new o8,mutatedKeys:this.mutatedKeys,ys:!1},!1)):{Ya:[]}}Za(e){return!this.qa.has(e)&&!!this.Ka.has(e)&&!this.Ka.get(e).hasLocalMutations}Ha(e){e&&(e.addedDocuments.forEach(e=>this.qa=this.qa.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.qa=this.qa.delete(e)),this.current=e.current)}Ja(){if(!this.current)return[];let e=this.$a;this.$a=id(),this.Ka.forEach(e=>{this.Za(e.key)&&(this.$a=this.$a.add(e.key))});let t=[];return e.forEach(e=>{this.$a.has(e)||t.push(new al(e))}),this.$a.forEach(n=>{e.has(n)||t.push(new aa(n))}),t}Xa(e){this.qa=e.Ns,this.$a=id();let t=this.Ga(e.documents);return this.applyChanges(t,!0)}eu(){return o4.fromInitialDocuments(this.query,this.Ka,this.mutatedKeys,0===this.Qa,this.hasCachedResults)}}let au="SyncEngine";class ac{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ad{constructor(e){this.key=e,this.tu=!1}}class af{constructor(e,t,n,i,r,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.nu={},this.ru=new ir(e=>n9(e),n4),this.iu=new Map,this.su=new Set,this.ou=new tV(eu.comparator),this._u=new Map,this.au=new sx,this.uu={},this.cu=new Map,this.lu=so.ir(),this.onlineState="Unknown",this.hu=void 0}get isPrimaryClient(){return!0===this.hu}}async function ap(e,t,n=!0){let i;let r=a$(e),s=r.ru.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.eu()):i=await am(r,t,n,!0),i}async function ag(e,t){let n=a$(e);await am(n,t,!0,!1)}async function am(e,t,n,i){let r;let s=await sJ(e.localStore,n5(t)),o=s.targetId,a=e.sharedClientState.addLocalQueryTarget(o,n);return i&&(r=await ay(e,t,o,"current"===a,s.resumeToken)),e.isPrimaryClient&&n&&oD(e.remoteStore,s),r}async function ay(e,t,n,i,r){e.Pu=(t,n,i)=>(async function(e,t,n,i){let r=t.view.Ga(n);r.ys&&(r=await sZ(e.localStore,t.query,!1).then(({documents:e})=>t.view.Ga(e,r)));let s=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(r,e.isPrimaryClient,s,o);return aN(e,t.targetId,a.Ya),a.snapshot})(e,t,n,i);let s=await sZ(e.localStore,t,!0),o=new ah(t,s.Ns),a=o.Ga(s.documents),l=i0.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,r),h=o.applyChanges(a,e.isPrimaryClient,l);aN(e,n,h.Ya);let u=new ac(t,n,o);return e.ru.set(t,u),e.iu.has(n)?e.iu.get(n).push(t):e.iu.set(n,[t]),h.snapshot}async function a_(e,t,n){let i=e.ru.get(t),r=e.iu.get(i.targetId);if(r.length>1)return e.iu.set(i.targetId,r.filter(e=>!n4(e,t))),void e.ru.delete(t);e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(i.targetId),e.sharedClientState.isActiveQueryTarget(i.targetId)||await sX(e.localStore,i.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(i.targetId),n&&oO(e.remoteStore,i.targetId),ak(e,i.targetId)}).catch(eb)):(ak(e,i.targetId),await sX(e.localStore,i.targetId,!0))}async function av(e,t){let n=e.ru.get(t),i=e.iu.get(n.targetId);e.isPrimaryClient&&1===i.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),oO(e.remoteStore,n.targetId))}async function aw(e,t,n){let i=aK(e);try{var r;let e;let s=await function(e,t){let n,i;let r=ei.now(),s=t.reduce((e,t)=>e.add(t.key),id());return e.persistence.runTransaction("Locally write mutations","readwrite",o=>{let a=is,l=id();return e.Cs.getEntries(o,s).next(e=>{(a=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>e.localDocuments.getOverlayedDocuments(o,a)).next(i=>{n=i;let s=[];for(let e of t){let t=function(e,t){let n=null;for(let i of e.fieldTransforms){let e=t.data.field(i.field),r=iv(i.transform,e||null);null!=r&&(null===n&&(n=nE.empty()),n.set(i.field,r))}return n||null}(e,n.get(e.key).overlayedDocument);null!=t&&s.push(new iF(e.key,t,function e(t){let n=[];return tF(t.fields,(t,i)=>{let r=new eh([t]);if(nm(i)){let t=e(i.mapValue).fields;if(0===t.length)n.push(r);else for(let e of t)n.push(r.child(e))}else n.push(r)}),new tK(n)}(t.value.mapValue),iN.exists(!0)))}return e.mutationQueue.addMutationBatch(o,r,s,t)}).next(t=>{i=t;let r=t.applyToLocalDocumentSet(n,l);return e.documentOverlayCache.saveOverlays(o,t.batchId,r)})}).then(()=>({batchId:i.batchId,changes:il(n)}))}(i.localStore,t);i.sharedClientState.addPendingMutation(s.batchId),r=s.batchId,(e=i.uu[i.currentUser.toKey()])||(e=new tV(Z)),e=e.insert(r,n),i.uu[i.currentUser.toKey()]=e,await aP(i,s.changes),await oG(i.remoteStore)}catch(t){let e=o5(t,"Failed to persist write");n.reject(e)}}async function aI(e,t){try{let n=await function(e,t){let n=t.snapshotVersion,i=e.Ss;return e.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{let s=e.Cs.newChangeBuffer({trackRemovals:!0});i=e.Ss;let o=[];t.targetChanges.forEach((s,a)=>{var l;let h=i.get(a);if(!h)return;o.push(e.ai.removeMatchingKeys(r,s.removedDocuments,a).next(()=>e.ai.addMatchingKeys(r,s.addedDocuments,a)));let u=h.withSequenceNumber(r.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(tW.EMPTY_BYTE_STRING,er.min()).withLastLimboFreeSnapshotVersion(er.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(a,u),l=u,(0===h.resumeToken.approximateByteSize()||l.snapshotVersion.toMicroseconds()-h.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&o.push(e.ai.updateTargetData(r,u))});let a=is,l=id();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(e.persistence.referenceDelegate.updateLimboDocument(r,n))}),o.push(sY(r,s,t.documentUpdates).next(e=>{a=e.xs,l=e.Os})),!n.isEqual(er.min())){let t=e.ai.getLastRemoteSnapshotVersion(r).next(t=>e.ai.setTargetsMetadata(r,r.currentSequenceNumber,n));o.push(t)}return eE.waitFor(o).next(()=>s.apply(r)).next(()=>e.localDocuments.getLocalViewOfDocuments(r,a,l)).next(()=>a)}).then(t=>(e.Ss=i,t))}(e.localStore,t);t.targetChanges.forEach((t,n)=>{let i=e._u.get(n);i&&(V(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?i.tu=!0:t.modifiedDocuments.size>0?V(i.tu,14607):t.removedDocuments.size>0&&(V(i.tu,42227),i.tu=!1))}),await aP(e,n,t)}catch(e){await eb(e)}}function ab(e,t,n){var i;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n;let r=[];e.ru.forEach((e,n)=>{let i=n.view.ga(t);i.snapshot&&r.push(i.snapshot)}),(i=e.eventManager).onlineState=t,n=!1,i.queries.forEach((e,i)=>{for(let e of i.Ra)e.ga(t)&&(n=!0)}),n&&as(i),r.length&&e.nu.Q_(r),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function aE(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let i=e._u.get(t),r=i&&i.key;if(r){let n=new tV(eu.comparator);n=n.insert(r,nT.newNoDocument(r,er.min()));let i=id().add(r),s=new iZ(er.min(),new Map,new tV(Z),n,i);await aI(e,s),e.ou=e.ou.remove(r),e._u.delete(t),aR(e)}else await sX(e.localStore,t,!1).then(()=>ak(e,t,n)).catch(eb)}async function aT(e,t){var n;let i=t.batch.batchId;try{let r=await (n=e.localStore).persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let i=t.batch.keys(),r=n.Cs.newChangeBuffer({trackRemovals:!0});return(function(e,t,n,i){let r=n.batch,s=r.keys(),o=eE.resolve();return s.forEach(e=>{o=o.next(()=>i.getEntry(t,e)).next(t=>{let s=n.docVersions.get(e);V(null!==s,48541),0>t.version.compareTo(s)&&(r.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,r))})(n,e,t,r).next(()=>r.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=id();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,i))});ax(e,i,null),aS(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await aP(e,r)}catch(e){await eb(e)}}async function aC(e,t,n){var i;try{let r=await (i=e.localStore).persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return i.mutationQueue.lookupMutationBatch(e,t).next(t=>(V(null!==t,37113),n=t.keys(),i.mutationQueue.removeMutationBatch(e,t))).next(()=>i.mutationQueue.performConsistencyCheck(e)).next(()=>i.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>i.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>i.localDocuments.getDocuments(e,n))});ax(e,t,n),aS(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await aP(e,r)}catch(e){await eb(e)}}function aS(e,t){(e.cu.get(t)||[]).forEach(e=>{e.resolve()}),e.cu.delete(t)}function ax(e,t,n){let i=e.uu[e.currentUser.toKey()];if(i){let r=i.get(t);r&&(n?r.reject(n):r.resolve(),i=i.remove(t)),e.uu[e.currentUser.toKey()]=i}}function ak(e,t,n=null){for(let i of(e.sharedClientState.removeLocalQueryTarget(t),e.iu.get(t)))e.ru.delete(i),n&&e.nu.Tu(i,n);e.iu.delete(t),e.isPrimaryClient&&e.au.Ur(t).forEach(t=>{e.au.containsKey(t)||aA(e,t)})}function aA(e,t){e.su.delete(t.path.canonicalString());let n=e.ou.get(t);null!==n&&(oO(e.remoteStore,n),e.ou=e.ou.remove(t),e._u.delete(n),aR(e))}function aN(e,t,n){for(let i of n)i instanceof aa?(e.au.addReference(i.key,t),function(e,t){let n=t.key,i=n.path.canonicalString();e.ou.get(n)||e.su.has(i)||(D(au,"New document in limbo: "+n),e.su.add(i),aR(e))}(e,i)):i instanceof al?(D(au,"Document no longer in limbo: "+i.key),e.au.removeReference(i.key,t),e.au.containsKey(i.key)||aA(e,i.key)):F(19791,{Iu:i})}function aR(e){for(;e.su.size>0&&e.ou.size<e.maxConcurrentLimboResolutions;){let t=e.su.values().next().value;e.su.delete(t);let n=new eu(ea.fromString(t)),i=e.lu.next();e._u.set(i,new ad(n)),e.ou=e.ou.insert(n,i),oD(e.remoteStore,new rC(n5(n0(n.path)),i,"TargetPurposeLimboResolution",eU.le))}}async function aP(e,t,n){let i=[],r=[],s=[];e.ru.isEmpty()||(e.ru.forEach((o,a)=>{s.push(e.Pu(a,t,n).then(t=>{var s;if((t||n)&&e.isPrimaryClient){let i=t?!t.fromCache:null===(s=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===s?void 0:s.current;e.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);let e=sz.Ps(a.targetId,t);r.push(e)}}))}),await Promise.all(s),e.nu.Q_(i),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>eE.forEach(t,t=>eE.forEach(t.ls,i=>e.persistence.referenceDelegate.addReference(n,t.targetId,i)).next(()=>eE.forEach(t.hs,i=>e.persistence.referenceDelegate.removeReference(n,t.targetId,i)))))}catch(e){if(!eN(e))throw e;D(sG,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ss.get(t),i=n.snapshotVersion,r=n.withLastLimboFreeSnapshotVersion(i);e.Ss=e.Ss.insert(t,r)}}}(e.localStore,r))}async function aD(e,t){var n;if(!e.currentUser.isEqual(t)){D(au,"User change. New user:",t.toKey());let i=await sH(e.localStore,t);e.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",e.cu.forEach(e=>{e.forEach(e=>{e.reject(new B(q.CANCELLED,n))})}),e.cu.clear(),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await aP(e,i.Ms)}}function aO(e,t){let n=e._u.get(t);if(n&&n.tu)return id().add(n.key);{let n=id(),i=e.iu.get(t);if(!i)return n;for(let t of i){let i=e.ru.get(t);n=n.unionWith(i.view.Wa)}return n}}async function aL(e,t){let n=await sZ(e.localStore,t.query,!0),i=t.view.Xa(n);return e.isPrimaryClient&&aN(e,t.targetId,i.Ya),i}async function aM(e,t){return s1(e.localStore,t).then(t=>aP(e,t))}async function aF(e,t,n,i){let r=await function(e,t){let n=e.mutationQueue;return e.persistence.runTransaction("Lookup mutation documents","readonly",i=>n.Hn(i,t).next(t=>t?e.localDocuments.getDocuments(i,t):eE.resolve(null)))}(e.localStore,t);null!==r?("pending"===n?await oG(e.remoteStore):"acknowledged"===n||"rejected"===n?(ax(e,t,i||null),aS(e,t),function(e,t){e.mutationQueue.Xn(t)}(e.localStore,t)):F(6720,"Unknown batchState",{Eu:n}),await aP(e,r)):D(au,"Cannot apply mutation batch with id: "+t)}async function aU(e,t){if(a$(e),aK(e),!0===t&&!0!==e.hu){let t=e.sharedClientState.getAllActiveQueryTargets(),n=await aV(e,t.toArray());for(let t of(e.hu=!0,await o0(e.remoteStore,!0),n))oD(e.remoteStore,t)}else if(!1===t&&!1!==e.hu){let t=[],n=Promise.resolve();e.iu.forEach((i,r)=>{e.sharedClientState.isLocalQueryTarget(r)?t.push(r):n=n.then(()=>(ak(e,r),sX(e.localStore,r,!0))),oO(e.remoteStore,r)}),await n,await aV(e,t),e._u.forEach((t,n)=>{oO(e.remoteStore,n)}),e.au.Kr(),e._u=new Map,e.ou=new tV(eu.comparator),e.hu=!1,await o0(e.remoteStore,!1)}}async function aV(e,t,n){let i=[],r=[];for(let n of t){let t;let s=e.iu.get(n);if(s&&0!==s.length)for(let n of(t=await sJ(e.localStore,n5(s[0])),s)){let t=e.ru.get(n),i=await aL(e,t);i.snapshot&&r.push(i.snapshot)}else{let i=await s0(e.localStore,n);t=await sJ(e.localStore,i),await ay(e,aq(i),n,!1,t.resumeToken)}i.push(t)}return e.nu.Q_(r),i}function aq(e){var t,n,i,r;return t=e.path,n=e.collectionGroup,i=e.orderBy,r=e.filters,new nZ(t,n,i,r,e.limit,"F",e.startAt,e.endAt)}function aB(e){return e.localStore.persistence.us()}async function aj(e,t,n,i){if(e.hu)return void D(au,"Ignoring unexpected query state notification.");let r=e.iu.get(t);if(r&&r.length>0)switch(n){case"current":case"not-current":{let i=await s1(e.localStore,it(r[0])),s=iZ.createSynthesizedRemoteEventForCurrentChange(t,"current"===n,tW.EMPTY_BYTE_STRING);await aP(e,i,s);break}case"rejected":await sX(e.localStore,t,!0),ak(e,t,i);break;default:F(64155,n)}}async function az(e,t,n){let i=a$(e);if(i.hu){for(let e of t){if(i.iu.has(e)&&i.sharedClientState.isActiveQueryTarget(e)){D(au,"Adding an already active target "+e);continue}let t=await s0(i.localStore,e),n=await sJ(i.localStore,t);await ay(i,aq(t),n.targetId,!1,n.resumeToken),oD(i.remoteStore,n)}for(let e of n)i.iu.has(e)&&await sX(i.localStore,e,!1).then(()=>{oO(i.remoteStore,e),ak(i,e)}).catch(eb)}}function a$(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=aI.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=aO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aE.bind(null,e),e.nu.Q_=ai.bind(null,e.eventManager),e.nu.Tu=ar.bind(null,e.eventManager),e}function aK(e){return e.remoteStore.remoteSyncer.applySuccessfulWrite=aT.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=aC.bind(null,e),e}class aG{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ow(e.databaseInfo.databaseId),this.sharedClientState=this.Au(e),this.persistence=this.Ru(e),await this.persistence.start(),this.localStore=this.Vu(e),this.gcScheduler=this.mu(e,this.localStore),this.indexBackfillerScheduler=this.fu(e,this.localStore)}mu(e,t){return null}fu(e,t){return null}Vu(e){var t;return t=this.persistence,new sW(t,new sK,e.initialUser,this.serializer)}Ru(e){return new sD(sL.Ei,this.serializer)}Au(e){return new oo}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}aG.provider={build:()=>new aG};class aW extends aG{constructor(e){super(),this.cacheSizeBytes=e}mu(e,t){return V(this.persistence.referenceDelegate instanceof sM,46915),new sd(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ru(e){let t=void 0!==this.cacheSizeBytes?se.withCacheSize(this.cacheSizeBytes):se.DEFAULT;return new sD(e=>sM.Ei(e,t),this.serializer)}}class aH extends aG{constructor(e,t,n){super(),this.gu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.gu.initialize(this,e),await aK(this.gu.syncEngine),await oG(this.gu.remoteStore),await this.persistence.Ki(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Vu(e){var t;return t=this.persistence,new sW(t,new sK,e.initialUser,this.serializer)}mu(e,t){return new sd(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}fu(e,t){let n=new eF(t,this.persistence);return new eM(e.asyncQueue,n)}Ru(e){let t=sj(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?se.withCacheSize(this.cacheSizeBytes):se.DEFAULT;return new sB(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,o_(),ov(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Au(e){return new oo}}class aQ{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>ab(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=aD.bind(null,this.syncEngine),await o0(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new o7}createDatastore(e){let t=ow(e.databaseInfo.databaseId),n=new oy(e.databaseInfo);return new ox(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){var t;return t=this.localStore,new oN(t,this.datastore,e.asyncQueue,e=>ab(this.syncEngine,e,0),oh.C()?new oh:new oa)}createSyncEngine(e,t){return function(e,t,n,i,r,s,o){let a=new af(e,t,n,i,r,s);return o&&(a.hu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){D(oA,"RemoteStore shutting down."),e.aa.add(5),await oP(e),e.ca.shutdown(),e.la.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}aQ.provider={build:()=>new aQ};class aY{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.pu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.pu(this.observer.error,e):O("Uncaught Error in snapshot listener:",e.toString()))}yu(){this.muted=!0}pu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let aJ="FirestoreClient";class aX{constructor(e,t,n,i,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=A.UNAUTHENTICATED,this.clientId=X.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(n,async e=>{D(aJ,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(D(aJ,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new j;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=o5(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function aZ(e,t){e.asyncQueue.verifyOperationInProgress(),D(aJ,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener(async e=>{i.isEqual(e)||(await sH(t.localStore,e),i=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function a0(e,t){e.asyncQueue.verifyOperationInProgress();let n=await a1(e);D(aJ,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>oZ(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>oZ(t.remoteStore,n)),e._onlineComponents=t}async function a1(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){D(aJ,"Using user provided OfflineComponentProvider");try{await aZ(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===q.FAILED_PRECONDITION||t.code===q.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;L("Error using user provided cache. Falling back to memory cache: "+t),await aZ(e,new aG)}}else D(aJ,"Using default OfflineComponentProvider"),await aZ(e,new aW(void 0))}return e._offlineComponents}async function a2(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(D(aJ,"Using user provided OnlineComponentProvider"),await a0(e,e._uninitializedComponentsProvider._online)):(D(aJ,"Using default OnlineComponentProvider"),await a0(e,new aQ))),e._onlineComponents}async function a3(e){let t=await a2(e),n=t.eventManager;return n.onListen=ap.bind(null,t.syncEngine),n.onUnlisten=a_.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=ag.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=av.bind(null,t.syncEngine),n}function a5(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let a6=new Map;function a8(e,t,n){if(!n)throw new B(q.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function a4(e){if(!eu.isDocumentKey(e))throw new B(q.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function a9(e){if(eu.isDocumentKey(e))throw new B(q.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function a7(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":F(12329,{type:typeof e})}function le(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new B(q.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=a7(e);throw new B(q.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}let lt="firestore.googleapis.com";class ln{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new B(q.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lt,this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new B(q.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new B(q.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=a5(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new B(q.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new B(q.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new B(q.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class li{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ln({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new B(q.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new B(q.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ln(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new $;switch(e.type){case"firstParty":return new H(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new B(q.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let t=a6.get(e);t&&(D("ComponentProvider","Removing Datastore"),a6.delete(e),t.terminate())}(this),Promise.resolve()}}class lr{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new lr(this.firestore,e,this._query)}}class ls{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ls(this.firestore,e,this._key)}}class lo extends lr{constructor(e,t,n){super(e,t,n0(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ls(this.firestore,null,new eu(e))}withConverter(e){return new lo(this.firestore,e,this._path)}}function la(e,t,...n){if(e=(0,w.m9)(e),a8("collection","path",t),e instanceof li){let i=ea.fromString(t,...n);return a9(i),new lo(e,null,i)}{if(!(e instanceof ls||e instanceof lo))throw new B(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(ea.fromString(t,...n));return a9(i),new lo(e.firestore,null,i)}}function ll(e,t,...n){if(e=(0,w.m9)(e),1==arguments.length&&(t=X.newId()),a8("doc","path",t),e instanceof li){let i=ea.fromString(t,...n);return a4(i),new ls(e,null,new eu(i))}{if(!(e instanceof ls||e instanceof lo))throw new B(q.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let i=e._path.child(ea.fromString(t,...n));return a4(i),new ls(e.firestore,e instanceof lo?e.converter:null,new eu(i))}}let lh="AsyncQueue";class lu{constructor(e=Promise.resolve()){this.Qu=[],this.$u=!1,this.Uu=[],this.Ku=null,this.Wu=!1,this.Gu=!1,this.zu=[],this.y_=new oI(this,"async_queue_retry"),this.ju=()=>{let e=ov();e&&D(lh,"Visibility state changed to "+e.visibilityState),this.y_.A_()},this.Hu=e;let t=ov();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.ju)}get isShuttingDown(){return this.$u}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Ju(),this.Yu(e)}enterRestrictedMode(e){if(!this.$u){this.$u=!0,this.Gu=e||!1;let t=ov();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.ju)}}enqueue(e){if(this.Ju(),this.$u)return new Promise(()=>{});let t=new j;return this.Yu(()=>this.$u&&this.Gu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Qu.push(e),this.Zu()))}async Zu(){if(0!==this.Qu.length){try{await this.Qu[0](),this.Qu.shift(),this.y_.reset()}catch(e){if(!eN(e))throw e;D(lh,"Operation failed with retryable error: "+e)}this.Qu.length>0&&this.y_.E_(()=>this.Zu())}}Yu(e){let t=this.Hu.then(()=>(this.Wu=!0,e().catch(e=>{throw this.Ku=e,this.Wu=!1,O("INTERNAL UNHANDLED ERROR: ",lc(e)),e}).then(e=>(this.Wu=!1,e))));return this.Hu=t,t}enqueueAfterDelay(e,t,n){this.Ju(),this.zu.indexOf(e)>-1&&(t=0);let i=o3.createAndSchedule(this,e,t,n,e=>this.Xu(e));return this.Uu.push(i),i}Ju(){this.Ku&&F(47125,{ec:lc(this.Ku)})}verifyOperationInProgress(){}async tc(){let e;do e=this.Hu,await e;while(e!==this.Hu)}nc(e){for(let t of this.Uu)if(t.timerId===e)return!0;return!1}rc(e){return this.tc().then(()=>{for(let t of(this.Uu.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.Uu))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.tc()})}sc(e){this.zu.push(e)}Xu(e){let t=this.Uu.indexOf(e);this.Uu.splice(t,1)}}function lc(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class ld extends li{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new lu,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new lu(e),this._firestoreClient=void 0,await e}}}function lf(e,t){let n="object"==typeof e?e:(0,y.Mq)(),i=(0,y.qX)(n,"firestore").getImmediate({identifier:"string"==typeof e?e:t||t8});if(!i._initialized){let e=(0,w.P0)("firestore");e&&function(e,t,n,i={}){var r;e=le(e,li);let s=(0,w.Xx)(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${n}`;s&&(0,w.Uo)(`https://${l}`),o.host!==lt&&o.host!==l&&L("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:l,ssl:s,emulatorOptions:i});if(!(0,w.vZ)(h,a)&&(e._setSettings(h),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=A.MOCK_USER;else{t=(0,w.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);let s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new B(q.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new A(s)}e._authCredentials=new K(new z(t,n))}}(i,...e)}return i}function lp(e){if(e._terminated)throw new B(q.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i,r;let s=e._freezeSettings(),o=(r=e._databaseId,new t6(r,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,a5(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new aX(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&function(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class lg{constructor(e){this._byteString=e}static fromBase64String(e){try{return new lg(tW.fromBase64String(e))}catch(e){throw new B(q.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new lg(tW.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lm{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new B(q.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new eh(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ly{constructor(e){this._methodName=e}}class l_{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new B(q.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new B(q.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Z(this._lat,e._lat)||Z(this._long,e._long)}}class lv{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}}let lw=/^__.*__$/;class lI{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new iF(e,this.data,this.fieldMask,t,this.fieldTransforms):new iM(e,this.data,t,this.fieldTransforms)}}class lb{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new iF(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function lE(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{oc:e})}}class lT{constructor(e,t,n,i,r,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this._c(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get oc(){return this.settings.oc}ac(e){return new lT(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}uc(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i.lc(e),i}hc(e){var t;let n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ac({path:n,cc:!1});return i._c(),i}Pc(e){return this.ac({path:void 0,cc:!0})}Tc(e){return lj(e,this.settings.methodName,this.settings.Ic||!1,this.path,this.settings.Ec)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}_c(){if(this.path)for(let e=0;e<this.path.length;e++)this.lc(this.path.get(e))}lc(e){if(0===e.length)throw this.Tc("Document fields must not be empty");if(lE(this.oc)&&lw.test(e))throw this.Tc('Document fields cannot begin and end with "__"')}}class lC{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ow(e)}dc(e,t,n,i=!1){return new lT({oc:e,methodName:t,Ec:n,path:eh.emptyPath(),cc:!1,Ic:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function lS(e){let t=e._freezeSettings(),n=ow(e._databaseId);return new lC(e._databaseId,!!t.ignoreUndefinedProperties,n)}function lx(e,t,n,i,r,s={}){let o,a;let l=e.dc(s.merge||s.mergeFields?2:0,t,n,r);lU("Data must be an object, but it was:",l,i);let h=lM(i,l);if(s.merge)o=new tK(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let i of s.mergeFields){let r=lV(t,i,n);if(!l.contains(r))throw new B(q.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);lz(e,r)||e.push(r)}o=new tK(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new lI(new nE(h),o,a)}class lk extends ly{_toFieldTransform(e){if(2!==e.oc)throw 1===e.oc?e.Tc(`${this._methodName}() can only appear at the top level of your update data`):e.Tc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lk}}function lA(e,t,n){return new lT({oc:3,Ec:t.settings.Ec,methodName:e._methodName,cc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class lN extends null{_toFieldTransform(e){return new ik(e.path,new iw)}isEqual(e){return e instanceof lN}}class lR extends ly{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=lA(this,e,!0),n=new iI(this.Ac.map(e=>lL(e,t)));return new ik(e.path,n)}isEqual(e){return e instanceof lR&&(0,w.vZ)(this.Ac,e.Ac)}}class lP extends ly{constructor(e,t){super(e),this.Ac=t}_toFieldTransform(e){let t=lA(this,e,!0),n=new iE(this.Ac.map(e=>lL(e,t)));return new ik(e.path,n)}isEqual(e){return e instanceof lP&&(0,w.vZ)(this.Ac,e.Ac)}}class lD extends ly{constructor(e,t){super(e),this.Rc=t}_toFieldTransform(e){let t=new iC(e.serializer,iy(e.serializer,this.Rc));return new ik(e.path,t)}isEqual(e){return e instanceof lD&&this.Rc===e.Rc}}function lO(e,t,n,i=!1){return lL(n,e.dc(i?4:3,t))}function lL(e,t){if(lF(e=(0,w.m9)(e)))return lU("Unsupported field value:",t,e),lM(e,t);if(e instanceof ly)return function(e,t){if(!lE(t.oc))throw t.Tc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Tc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.cc&&4!==t.oc)throw t.Tc("Nested arrays are not supported");return function(e,t){let n=[],i=0;for(let r of e){let e=lL(r,t.Pc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,w.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return iy(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=ei.fromDate(e);return{timestampValue:ri(t.serializer,n)}}if(e instanceof ei){let n=new ei(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ri(t.serializer,n)}}if(e instanceof l_)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof lg)return{bytesValue:rr(t.serializer,e._byteString)};if(e instanceof ls){let n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.Tc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ro(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lv)return{mapValue:{fields:{[t9]:{stringValue:nt},[nn]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Tc("VectorValues must only contain numeric values.");return ig(t.serializer,e)})}}}}};throw t.Tc(`Unsupported field value: ${a7(e)}`)}(e,t)}function lM(e,t){let n={};return tU(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tF(e,(e,i)=>{let r=lL(i,t.uc(e));null!=r&&(n[e]=r)}),{mapValue:{fields:n}}}function lF(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ei||e instanceof l_||e instanceof lg||e instanceof ls||e instanceof ly||e instanceof lv)}function lU(e,t,n){if(!lF(n)||!("object"==typeof n&&null!==n&&(Object.getPrototypeOf(n)===Object.prototype||null===Object.getPrototypeOf(n)))){let i=a7(n);throw"an object"===i?t.Tc(e+" a custom object"):t.Tc(e+" "+i)}}function lV(e,t,n){if((t=(0,w.m9)(t))instanceof lm)return t._internalPath;if("string"==typeof t)return lB(e,t);throw lj("Field path arguments must be of type string or ",e,!1,void 0,n)}let lq=RegExp("[~\\*/\\[\\]]");function lB(e,t,n){if(t.search(lq)>=0)throw lj(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new lm(...t.split("."))._internalPath}catch(i){throw lj(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function lj(e,t,n,i,r){let s=i&&!i.isEmpty(),o=void 0!==r,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${i}`),o&&(l+=` in document ${r}`),l+=")"),new B(q.INVALID_ARGUMENT,a+e+l)}function lz(e,t){return e.some(e=>e.isEqual(t))}class l${constructor(e,t,n,i,r){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new ls(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new lK(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(lG("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class lK extends l${data(){return super.data()}}function lG(e,t){return"string"==typeof t?lB(e,t):t instanceof lm?t._internalPath:t._delegate._internalPath}class lW{}class lH extends lW{}function lQ(e,t,...n){let i=[];for(let r of(t instanceof lW&&i.push(t),function(e){let t=e.filter(e=>e instanceof lX).length,n=e.filter(e=>e instanceof lY).length;if(t>1||t>0&&n>0)throw new B(q.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i=i.concat(n)),i))e=r._apply(e);return e}class lY extends lH{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new lY(e,t,n)}_apply(e){let t=this._parse(e);return l8(e._query,t),new lr(e.firestore,e.converter,n6(e._query,t))}_parse(e){let t=lS(e.firestore);return function(e,t,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new B(q.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){l6(o,s);let t=[];for(let n of o)t.push(l5(i,e,n));a={arrayValue:{values:t}}}else a=l5(i,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||l6(o,s),a=lO(n,t,o,"in"===s||"not-in"===s);return nN.create(r,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function lJ(e,t,n){let i=lG("where",e);return lY._create(i,t,n)}class lX extends lW{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new lX(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nR.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;for(let e of t.getFlattenedFilters())l8(n,e),n=n6(n,e)}(e._query,t),new lr(e.firestore,e.converter,n6(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class lZ extends lH{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new lZ(e,t)}_apply(e){let t=function(e,t,n){if(null!==e.startAt)throw new B(q.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new B(q.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nk(t,n)}(e._query,this._field,this._direction);return new lr(e.firestore,e.converter,function(e,t){let n=e.explicitOrderBy.concat([t]);return new nZ(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class l0 extends lH{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new l0(e,t,n)}_apply(e){return new lr(e.firestore,e.converter,n8(e._query,this._limit,this._limitType))}}class l1 extends lH{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new l1(e,t,n)}_apply(e){var t;let n=l3(e,this.type,this._docOrFields,this._inclusive);return new lr(e.firestore,e.converter,new nZ((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,n,t.endAt))}}class l2 extends lH{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new l2(e,t,n)}_apply(e){var t;let n=l3(e,this.type,this._docOrFields,this._inclusive);return new lr(e.firestore,e.converter,new nZ((t=e._query).path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,n))}}function l3(e,t,n,i){if(n[0]=(0,w.m9)(n[0]),n[0]instanceof l$)return function(e,t,n,i,r){if(!i)throw new B(q.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);let s=[];for(let n of n3(e))if(n.field.isKeyField())s.push(nc(t,i.key));else{let e=i.data.field(n.field);if(t2(e))throw new B(q.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){let e=n.field.canonicalString();throw new B(q.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new nC(s,r)}(e._query,e.firestore._databaseId,t,n[0]._document,i);{let r=lS(e.firestore);return function(e,t,n,i,r,s){let o=e.explicitOrderBy;if(r.length>o.length)throw new B(q.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let s=0;s<r.length;s++){let l=r[s];if(o[s].field.isKeyField()){if("string"!=typeof l)throw new B(q.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof l}`);if(!n2(e)&&-1!==l.indexOf("/"))throw new B(q.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${l}' contains a slash.`);let n=e.path.child(ea.fromString(l));if(!eu.isDocumentKey(n))throw new B(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);let r=new eu(n);a.push(nc(t,r))}else{let e=lO(n,i,l);a.push(e)}}return new nC(a,s)}(e._query,e.firestore._databaseId,r,t,n,i)}}function l5(e,t,n){if("string"==typeof(n=(0,w.m9)(n))){if(""===n)throw new B(q.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!n2(t)&&-1!==n.indexOf("/"))throw new B(q.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);let i=t.path.child(ea.fromString(n));if(!eu.isDocumentKey(i))throw new B(q.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return nc(e,new eu(i))}if(n instanceof ls)return nc(e,n._key);throw new B(q.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${a7(n)}.`)}function l6(e,t){if(!Array.isArray(e)||0===e.length)throw new B(q.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function l8(e,t){let n=function(e,t){for(let n of e)for(let e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new B(q.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new B(q.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class l4{convertValue(e,t="none"){switch(nr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tY(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(tJ(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw F(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return tF(e,(e,i)=>{n[e]=this.convertValue(i,t)}),n}convertVectorValue(e){var t,n,i;return new lv(null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t[nn].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(e=>tY(e.doubleValue)))}convertGeoPoint(e){return new l_(tY(e.latitude),tY(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=t3(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(t5(e));default:return null}}convertTimestamp(e){let t=tQ(e);return new ei(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=ea.fromString(e);V(rT(n),9688,{name:e});let i=new t4(n.get(1),n.get(3)),r=new eu(n.popFirst(5));return i.isEqual(t)||O(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}function l9(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class l7 extends l4{constructor(e){super(),this.firestore=e}convertBytes(e){return new lg(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ls(this.firestore,null,t)}}class he{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ht extends l${constructor(e,t,n,i,r,s){super(e,t,n,i,s),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new hn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(lG("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class hn extends ht{data(e={}){return super.data(e)}}class hi{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new he(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new hn(this._firestore,this._userDataWriter,n.key,n,new he(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new B(q.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let i=new hn(e._firestore,e._userDataWriter,n.doc.key,n.doc,new he(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let i=new hn(e._firestore,e._userDataWriter,t.doc.key,t.doc,new he(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),r=-1,s=-1;return 0!==t.type&&(r=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:e})}}(t.type),doc:i,oldIndex:r,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function hr(e){e=le(e,ls);let t=le(e.firestore,ld);return(function(e,t,n={}){let i=new j;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,i,r){let s=new aY({next:a=>{s.yu(),t.enqueueAndForget(()=>an(e,o));let l=a.docs.has(n);!l&&a.fromCache?r.reject(new B(q.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&"server"===i.source?r.reject(new B(q.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(a)},error:e=>r.reject(e)}),o=new ao(n0(n.path),s,{includeMetadataChanges:!0,Fa:!0});return at(e,o)})(await a3(e),e.asyncQueue,t,n,i)),i.promise})(lp(t),e._key).then(n=>(function(e,t,n){let i=n.docs.get(t._key),r=new hs(e);return new ht(e,r,t._key,i,new he(n.hasPendingWrites,n.fromCache),t.converter)})(t,e,n))}class hs extends l4{constructor(e){super(),this.firestore=e}convertBytes(e){return new lg(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ls(this.firestore,null,t)}}function ho(e){e=le(e,lr);let t=le(e.firestore,ld),n=lp(t),i=new hs(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new B(q.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),(function(e,t,n={}){let i=new j;return e.asyncQueue.enqueueAndForget(async()=>(function(e,t,n,i,r){let s=new aY({next:n=>{s.yu(),t.enqueueAndForget(()=>an(e,o)),n.fromCache&&"server"===i.source?r.reject(new B(q.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:e=>r.reject(e)}),o=new ao(n,s,{includeMetadataChanges:!0,Fa:!0});return at(e,o)})(await a3(e),e.asyncQueue,t,n,i)),i.promise})(n,e._query).then(n=>new hi(t,i,e,n))}function ha(e,t,n){e=le(e,ls);let i=le(e.firestore,ld),r=l9(e.converter,t,n);return hh(i,[lx(lS(i),"setDoc",e._key,r,null!==e.converter,n).toMutation(e._key,iN.none())])}function hl(e){return hh(le(e.firestore,ld),[new iB(e._key,iN.none())])}function hh(e,t){return function(e,t){let n=new j;return e.asyncQueue.enqueueAndForget(async()=>aw(await a2(e).then(e=>e.syncEngine),t,n)),n.promise}(lp(e),t)}function hu(e,t){if((e=(0,w.m9)(e)).firestore!==t)throw new B(q.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}new WeakMap,function(e=!0){N=y.Jn,(0,y.Xd)(new _.wA("firestore",(t,{instanceIdentifier:n,options:i})=>{let r=t.getProvider("app").getImmediate(),s=new ld(new G(t.getProvider("auth-internal")),new Y(r,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new B(q.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new t4(e.options.projectId,t)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s},"PUBLIC").setMultipleInstances(!0)),(0,y.KN)(x,k,void 0),(0,y.KN)(x,k,"esm2017")}()},6531:(e,t,n)=>{"use strict";let i,r;n.d(t,{X3:()=>p});let s=(e,t)=>t.some(t=>e instanceof t),o=new WeakMap,a=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,c={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return a.get(e);if("objectStoreNames"===t)return e.objectStoreNames||l.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return d(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){var t;if(e instanceof IDBRequest)return function(e){let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(d(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&o.set(t,e)}).catch(()=>{}),u.set(t,e),t}(e);if(h.has(e))return h.get(e);let n="function"==typeof(t=e)?t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(r||(r=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(f(this),e),d(o.get(this))}:function(...e){return d(t.apply(f(this),e))}:function(e,...n){let i=t.call(f(this),e,...n);return l.set(i,e.sort?e.sort():[e]),d(i)}:(t instanceof IDBTransaction&&function(e){if(a.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});a.set(e,t)}(t),s(t,i||(i=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(t,c):t;return n!==e&&(h.set(e,n),u.set(n,e)),n}let f=e=>u.get(e);function p(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,t),a=d(o);return i&&o.addEventListener("upgradeneeded",e=>{i(d(o.result),e.oldVersion,e.newVersion,d(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}let g=["get","getKey","getAll","getAllKeys","count"],m=["put","add","delete","clear"],y=new Map;function _(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(y.get(t))return y.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=m.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||g.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return y.set(t,s),s}c=(e=>({...e,get:(t,n,i)=>_(t,n)||e.get(t,n,i),has:(t,n)=>!!_(t,n)||e.has(t,n)}))(c)}},e=>{var t=t=>e(e.s=t);e.O(0,[774,179],()=>(t(6840),t(3079))),_N_E=e.O()}]);