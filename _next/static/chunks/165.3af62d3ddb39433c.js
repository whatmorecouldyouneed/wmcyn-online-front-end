(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[165],{6165:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var o=r(5893),n=r(7294);let a="USE_DEFAULT_HIRO_PATTERN",i=[{name:"hiro",patternUrl:a,modelUrl:"/models/wmcyn_3d_logo.glb",scale:1,position:{x:2,y:6.5,z:0},productId:"hiro_product_1"}];var l=r(9477),s=r(4250),d=r(7836);let c=e=>{let{mountRef:t,configs:r,setIsLoading:o}=e;(0,n.useEffect)(()=>{let e,n,i,c,u,m,p;let{THREE:f,THREEx:h}=window;if(!f||!h){console.error("three.js or ar.js (THREEx) not found on window object."),o(!1);return}let v=[],w=[],E=[],C=()=>{c&&e&&t.current&&(c.onResizeElement(),c.copyElementSizeTo(e.domElement),(null==u?void 0:u.arController)&&c.copyElementSizeTo(u.arController.canvas),t.current&&e.setSize(t.current.clientWidth,t.current.clientHeight))},A=()=>{if(p=requestAnimationFrame(A),e&&n&&i&&c&&u&&c.ready)try{u.update(c.domElement),v.forEach(e=>{e&&(n.visible=e.visible)}),e.render(n,i),E.forEach(e=>e.update(m.getDelta()))}catch(e){console.error("error during animation frame:",e)}};return(()=>{if(!t.current){console.error("mountRef.current is null in init. Aborting AR setup."),o(!1);return}(e=new l.CP7({antialias:!0,alpha:!0})).setClearColor(new s.Ilk("lightgrey"),0),e.setSize(t.current.clientWidth,t.current.clientHeight),t.current.appendChild(e.domElement),n=new s.xsS,i=new s.V1s,n.add(i),n.add(new s.Mig(0xffffff,.6));let p=new s.Ox3(0xffffff,.8);p.position.set(0,10,5),n.add(p),m=new s.SUY,(c=new h.ArToolkitSource({sourceType:"webcam",sourceWidth:640,sourceHeight:480})).init(()=>{setTimeout(()=>{C(),o(!1)},1e3)}),(u=new h.ArToolkitContext({cameraParametersUrl:h.ArToolkitContext.baseURL+"../data/data/camera_para.dat",detectionMode:"mono"})).init(()=>{u&&i&&(i.projectionMatrix.copy(u.getProjectionMatrix()),r.forEach(e=>{let t=new s.ZAu;n.add(t),v.push(t);let r=e.patternUrl;if(e.patternUrl===a){if(h.ArToolkitContext&&h.ArToolkitContext.baseURL)r=h.ArToolkitContext.baseURL+"../data/data/patt.hiro";else{console.error("THREEx.ArToolkitContext.baseURL is not available to construct default hiro pattern URL.");return}}let o=new h.ArMarkerControls(u,t,{type:"pattern",patternUrl:r,changeMatrixMode:"modelViewMatrix"});w.push(o),new d.E().load(e.modelUrl,r=>{let n=r.scene;if(n){let a=e.scale||1;if(n.scale.set(a,a,a),e.position&&n.position.set(e.position.x,e.position.y,e.position.z),t.add(n),r.animations&&r.animations.length){let e=new s.Xcj(n);E.push(e),e.clipAction(r.animations[0]).play()}e.onFound&&o.addEventListener("markerFound",()=>{e.onFound&&e.onFound()})}},void 0,t=>{console.error("error loading model ".concat(e.modelUrl," for marker ").concat(e.name,":"),t)})}))}),window.addEventListener("resize",C),A()})(),()=>{var r,o,a,i;cancelAnimationFrame(p),window.removeEventListener("resize",C),E.forEach(e=>{}),E.length=0,v.forEach(e=>{null==n||n.remove(e),e.traverse(e=>{if(e instanceof s.Kj0){var t,r;null===(t=e.geometry)||void 0===t||t.dispose(),Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):null===(r=e.material)||void 0===r||r.dispose()}})}),v.length=0,w.length=0,null==c||null===(r=c.domElement)||void 0===r||r.remove(),null==c||null===(o=c.destroy)||void 0===o||o.call(c),null==u||null===(i=u.arController)||void 0===i||null===(a=i.dispose)||void 0===a||a.call(i),null==e||e.dispose(),t.current&&(null==e?void 0:e.domElement)&&t.current.contains(e.domElement)&&t.current.removeChild(e.domElement)}},[t,r,o])};var u=r(2567),m=r.n(u),p=r(837),f=r(1382),h=r(109);let v=e=>{let{onClose:t,configs:r=i}=e,a=(0,n.useRef)(null),[l,s]=(0,n.useState)(!0),{currentUser:d}=(0,p.a)();return c({mountRef:a,configs:r.map(e=>({...e,onFound:async()=>{if(!d){alert("Please log in to claim this product.");return}if(!f.RZ){alert("Database not initialized.");return}let t=(0,h.JU)(f.RZ,"markers",e.productId);(await (0,h.QT)(t)).exists()?alert("This product has already been claimed."):(await (0,h.pl)(t,{owner:d.uid,claimedAt:new Date}),await (0,h.pl)((0,h.JU)(f.RZ,"users/".concat(d.uid,"/products"),e.productId),{name:e.name,acquired:new Date}),alert("Product claimed successfully!"))}})),setIsLoading:s}),n.useEffect(()=>(document.body.classList.add("cameraActive"),()=>{document.body.classList.remove("cameraActive")}),[]),(0,o.jsxs)("div",{className:m().arCameraContainer,children:[l&&(0,o.jsx)("div",{className:m().loadingOverlay,children:"Initializing AR..."}),(0,o.jsx)("div",{ref:a,className:m().mountPoint}),(0,o.jsx)("button",{onClick:t,className:m().closeButton,children:"Close AR"})]})}},2567:e=>{e.exports={arCameraContainer:"ARCamera_arCameraContainer__jxoSI",loadingOverlay:"ARCamera_loadingOverlay__FsDdX",mountPoint:"ARCamera_mountPoint__oeW3w",closeButton:"ARCamera_closeButton__FiWl_"}}}]);